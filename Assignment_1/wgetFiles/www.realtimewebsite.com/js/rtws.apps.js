if(!Hummingbird){var Hummingbird={}}function toTitleCase(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}Hummingbird.WebSocket=function(url,token){this.url=url;this.token=token;this.state="stopped";this.handlers=[];this.emitted=[]};Hummingbird.WebSocket.prototype={onClose:function(){var self=this;if(this.state==="retrying"){console.log("still no socket, retrying in 1 seconds");setTimeout(function(){self.connect()},1e3)}else{this.state="retrying";console.log("socket lost, retrying immediately");setTimeout(function(){self.connect()},2e3)}},onOpen:function(){console.log("socket started");var siteName=window.location.pathname.toLowerCase();siteName=siteName.replace(/\/globe\//g,"");siteName=siteName.replace(/\/|www\./g,"");window.site=siteName;$("#active-site").text(toTitleCase(siteName));$("#active-site-on-globe").text(toTitleCase("Globe"));$("#active-site-on-globe").attr("href","/globe/www."+siteName);$("#active-site").attr("href","/www."+siteName);this.socket.emit("host",siteName);this.state="started";if(this.token){this.socket.emit("auth",this.token)}else{this.onAuth(true)}},onAuth:function(isAuthed){if(!isAuthed){console.log("socket auth failure");return}console.log("socket authed");this.state="authed";while(this.handlers.length){var handler=this.handlers.shift();this.socket.on(handler[0],handler[1])}for(var i=0;i<this.emitted.length;i++){var emitEvent=this.emitted[i];this.socket.emit.apply(this.socket,emitEvent)}},join:function(metric){this.emit("join",metric)},on:function(event,callback){if(this.socket){this.socket.on(event,callback)}else{this.handlers.push([event,callback])}},emit:function(event){if(this.socket&&this.state==="authed"){this.socket.emit.apply(this.socket,arguments)}else{this.emitted.push(arguments)}},connect:function(){console.log(this.url);this.socket=io.connect(this.url);var _this=this;this.socket.removeAllListeners();this.socket.once("disconnect",function(){_this.onClose()});this.socket.once("connect",function(){_this.onOpen()});this.socket.once("auth",function(isAuthed){_this.onAuth(isAuthed)});return this.socket},disconnect:function(){this.socket.disconnect()}};$(document).ready(function(){(function(po){po.fullscreen=function(){var fullscreen={};var svg=$(po.svg("svg"));var arrow=$(po.svg("path"));var map;var container;var isFullscreen=0;arrow.append("<title>Toggle Fullscreen. (ESC)</title>");arrow.attr("d","M0,0L0,.5 2,.5 2,1.5 4,0 2,-1.5 2,-.5 0,-.5Z").attr("pointer-events","none").attr("fill","#FFF");arrow.get(0).setAttribute("transform","translate(16,16)rotate(-45)scale(5)translate(-1.85,0)");var shadow=arrow.clone();shadow.css({fill:"#000"});shadow.get(0).setAttribute("transform","translate(18,18)rotate(-45)scale(5)translate(-1.85,0)");svg.append(shadow);svg.append(arrow);svg.click(toggleFullscreen);$(document).bind("webkitfullscreenchange mozfullscreenchange fullscreenchange fakefullscreenchange",fullscreenChange);svg.css({position:"absolute",right:"10px",top:"10px",visibility:"visible",cursor:"pointer"});svg.get(0).setAttribute("width","32");svg.get(0).setAttribute("height","32");fullscreen.map=function(x){if(!arguments.length)return map;if(map=x){container=$(map.container());draw()}return map};var fullscreenChange=function(){isFullscreen=!isFullscreen;if(isFullscreen){zoomToWindow()}else{unZoomToWindow()}map.resize()};var toggleFullscreen=function(){if(isFullscreen){cancelFullscreen()}else{requestFullscreen()}};var requestFullscreen=function(elem){var elem=container.parent().get(0);if(elem.requestFullScreen){elem.requestFullScreen()}else if(elem.mozRequestFullScreen){elem.mozRequestFullScreen()}else if(elem.webkitRequestFullScreen){elem.webkitRequestFullScreen()}else{requestFakeFullscreen()}};var cancelFullscreen=function(){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{cancelFakeFullscreen()}};var requestFakeFullscreen=function(){$("document").trigger("fakefullscreenchange")};var cancelFakeFullscreen=function(){$("document").trigger("fakefullscreenchange")};var unZoomToWindow=function(){container.css({position:"relative",borderWidth:null,width:null,height:null,top:null,left:null});svg.css({position:"absolute"});container.parent().find("img.map_logo").hide();container.parent().find("div.legend").css({position:"absolute"});arrow.get(0).setAttribute("transform","translate(16,16) rotate(-45) scale(5) translate(-1.85,0)");shadow.get(0).setAttribute("transform","translate(18,18) rotate(-45) scale(5) translate(-1.85,0)")};var zoomToWindow=function(){container.css({position:"fixed",borderWidth:0,width:"100%",height:"100%",top:0,left:0});svg.css({position:"fixed"});container.parent().find("img.map_logo").show();container.parent().find("div.legend").css({position:"fixed"});arrow.get(0).setAttribute("transform","translate(16,16) rotate(135) scale(5) translate(-1.85,0)");shadow.get(0).setAttribute("transform","translate(18,18) rotate(135) scale(5) translate(-1.85,0)")};var draw=function(){container.parent().append(svg);return fullscreen};return fullscreen}})(org.polymaps)});if(!Hummingbird){var Hummingbird={}}Array.prototype.sum=function(){return!this.length?0:this.slice(1).sum()+(typeof this[0]=="number"?this[0]:0)};Hummingbird.Base=function(){};Hummingbird.Base.prototype={messageCount:0,initialize:function(options){this.averageLog=[];this.start()},start:function(){this.registerHandler();this.socket.join(this.options.from)},registerHandler:function(){var self=this;this.socket.on(this.options.from,function(data){self.onData.apply(self,[data])})},onMessage:function(message){},onData:function(message){var average;this.messageCount+=1;if(this.options.averageOver&&typeof message=="number"){average=this.addToAverage(message)}if(!this.options.every||this.messageCount%this.options.every===0){this.onMessage(message,this.average())}},addToAverage:function(newValue){var averageCount=this.options.averageOver*this.options.ratePerSecond;this.averageLog.push(newValue);if(this.averageLog.length>averageCount){this.averageLog.shift()}},average:function(){if(this.averageLog.length===0){return 0}return this.averageLog.sum()*1/this.averageLog.length*this.options.ratePerSecond},pageIsVisible:function(){return true}};$.fn.hummingbirdCount=function(socket,options){if(this.length===0){return}this.each(function(){new Hummingbird.Count($(this),socket,options)});return this};if(!Hummingbird){var Hummingbird={}}Hummingbird.Count=function(element,socket,options){this.element=element;this.socket=socket;var defaults={averageOver:1,ratePerSecond:2,decimalPlaces:0};this.options=$.extend(defaults,options);this.initialize()};Hummingbird.Count.prototype=new Hummingbird.Base;$.extend(Hummingbird.Count.prototype,{name:"Count",onMessage:function(value,average){this.element.text(value);var siteName=window.location.pathname.toLowerCase();siteName=siteName.replace(/\/|www\./g,"");siteName=toTitleCase(siteName);document.title="( "+value+" ) Online - "+siteName}});$.fn.hummingbirdMap=function(socket,options){if(this.length===0){return}this.each(function(){new Hummingbird.Map($(this),socket,options)});return this};if(!Hummingbird){var Hummingbird={}}Hummingbird.Map=function(element,socket,options){this.element=element;this.socket=socket;var defaults={averageOver:1,ratePerSecond:2,decimalPlaces:0,maxPlaces:1e4,defaultEvent:"Online Users"};this.options=$.extend(defaults,options);this.po=org.polymaps;this.defaultZoom=$(window).height()>760?2.2:1.2;var zoomFactor=Math.log(window.devicePixelRatio||1)/Math.LN2;if(zoomFactor>0){var doubleSize="-2x"}else{var doubleSize=""}this.map=this.po.map().container(this.element.get(0).appendChild(this.po.svg("svg"))).center({lat:30,lon:10}).zoom(this.defaultZoom).zoomRange([1,19-zoomFactor]).add(this.po.interact());this.map.add(this.po.image().url(this.po.url("http://movableink-hummingbird-tiles.s3.amazonaws.com/hummingbird-dark"+doubleSize+"/{Z}/{X}/{Y}.png")).zoom(function(z){return z+zoomFactor}));this.map.add(this.po.compass().pan("none"));this.map.add(this.po.fullscreen());this.key=function(d){return[d.latitude,d.longitude,d.type].join(",")};this.data=[];this.eventTypes={};this.layer=d3.select("svg.map").insert("svg:g",".compass");this.transform=function(d){d=this.map.locationPoint({lon:d.longitude,lat:d.latitude});return"translate("+Math.floor(d.x)+","+Math.floor(d.y)+")"};this.map.on("move",function(){this.layer.selectAll("g").attr("transform",this.transform.bind(this))}.bind(this));this.map.on("resize",function(){this.layer.selectAll("g").attr("transform",this.transform.bind(this))}.bind(this));this.legend=$("<div class='legend'></div>");this.element.append(this.legend);this.initialize(options)};Hummingbird.Map.prototype=new Hummingbird.Base;$.extend(Hummingbird.Map.prototype,{name:"Map",onMessage:function(value,average){if(value&&value.length>0){var self=this;for(var i in value){var geo=value[i];if(!geo||typeof geo.latitude=="undefined"){continue}geo.label=[geo.country=="US"?geo.region:geo.country].join(", ");for(var i=0,len=this.data.length;i<len;i++){if(this.key(geo)==this.key(this.data[i])){this.data.splice(i,1);break}}this.data.push(geo);if(this.data.length>this.options.maxPlaces){this.data.shift()}if(!this.pageIsVisible()){setTimeout(function(){if(!self.pageIsVisible()){for(var i=0,len=self.data.length;i<len;i++){if(self.data[i]&&self.key(geo)==self.key(self.data[i])){self.data.splice(i,1)}}}},6e4);return}var elements=this.layer.selectAll("g").data(this.data,this.key);var finEle=undefined;elements.enter().append("svg:g").attr("class",function(d){var event=d.event||self.options.defaultEvent;self.addToLegend(event);return event}).attr("transform",this.transform.bind(this)).call(function(newElement){newElement.append("svg:circle").classed("radius",true).attr("r",40).transition().ease("exp").delay(2e3).duration(2e3).attr("r",3);var pathEl1=newElement.append("svg:circle").classed("point",true).transition().attr("r",4);var pathEl=newElement.append("path").classed("mLabel",true).attr("transform","scale(1) translate(0, -3)").transition().duration(3e3).attr("d",function(d){return Hummingbird.Map.bubble(d.label.length*5+15,12)}).attr("hello",function(d){textEl.remove()}.bind(this));var textEl=newElement.append("text").classed("mLabel",true).attr("transform","scale(1) translate(0, -11)").transition().duration(3e3).text(function(d){return d.label}).attr("hello",function(d){pathEl.remove();textEl.remove()}.bind(this))}).transition().delay(1e3*60*7).attr("to_remove",function(d){for(var i=0,len=this.data.length;i<len;i++){if(this.key(d)==this.key(this.data[i])){this.data.splice(i,1);break}}}.bind(this)).attr("transform",function(d){return this.transform(d)+" scale(0)"}.bind(this)).remove();elements.exit().transition().attr("transform",function(d){return this.transform(d)+" scale(0)"}.bind(this)).remove()}}},addToLegend:function(type){if(!this.eventTypes[type]){this.eventTypes[type]=true;$("<div><span></span></div>").addClass(type).append(type).appendTo(this.legend)}}});Hummingbird.Map.bubble=function(textWidth,textHeight,angle,notch,direction){var bg;if(textWidth==null)textWidth=200;if(textHeight==null)textHeight=152;if(direction==null)direction=-1;if(angle==null)angle=3;if(notch==null)notch=4;var d=direction;var l=function(x,y){return" l "+x+", "+y};var a=function(rx,ry,direction,x,y){var sweep=direction==-1?1:0;return" a "+rx+", "+ry+", 0, 0, "+sweep+", "+x+", "+y};bg="M0,0";bg+=l(-1*notch,d*notch);bg+=l((textWidth-notch-angle)/-2,0);bg+=a(angle,angle,d,-1*angle,d*angle);bg+=l(0,d*(textHeight-angle));bg+=a(angle,angle,d,angle,d*angle);bg+=l(textWidth-angle+notch,0);bg+=a(angle,angle,d,angle,-1*d*angle);bg+=l(0,-1*d*(textHeight-angle));bg+=a(angle,angle,d,-1*angle,-1*d*angle);bg+=l((textWidth-notch-angle)/-2,0);bg+=l(-1*notch,-1*d*notch);bg+="Z";return bg};$.fn.hummingbirdAgent=function(socket,options){if(this.length===0){return}this.each(function(){new Hummingbird.Agent($(this),socket,options)});return this};if(!Hummingbird){var Hummingbird={}}Hummingbird.Agent=function(element,socket,options){this.element=element;this.socket=socket;var defaults={averageOver:1,ratePerSecond:2,decimalPlaces:0};this.options=$.extend(defaults,options);this.initialize()};Hummingbird.Agent.prototype=new Hummingbird.Base;_inited=false;$.extend(Hummingbird.Agent.prototype,{name:"Agent",onMessage:function(value,average){if(!_inited){$("#agent_container .agent_data").empty();_inited=true}var cts=(new Date).getTime();dust.render("demo",{visits:value},function(err,output){$(".agent_data").prepend(output);$(".agent_data .timestamp").each(function(index,value){if(!$(this).attr("ts")||$(this).attr("ts")===""){console.log("No TS..")}else{var serverTS=parseInt($(this).attr("ts"));var dif=cts-serverTS;if(dif<0){var correctedTS=serverTS+dif+30;$(this).attr("ts",correctedTS)}$(this).text(formatElapsedTime(parseInt($(this).attr("ts"))))}});var seen={};var passed15Mins=(new Date).getTime()-1e3*60*15;$(".agent_data div").each(function(index,value){if(!$(this).attr("ts")||$(this).attr("ts")===""){$(this).remove()}else if(parseInt($(this).attr("ts"))<passed15Mins){$(this).remove()}else{var txt=$(this).attr("id");if(seen[txt]){$(this).remove()}else{seen[txt]=true}}});$(".agent_data div").orderBy(function(){return+$(this).attr("ts")}).appendTo(".agent_data")})}});devCount={d:0,t:0,p:0};$.fn.hummingbirdCharts=function(socket,options){if(this.length===0){return}this.each(function(){new Hummingbird.Charts($(this),socket,options)});return this};if(!Hummingbird){var Hummingbird={}}Hummingbird.Charts=function(element,socket,options){this.element=element;this.socket=socket;var defaults={averageOver:1,ratePerSecond:2,decimalPlaces:0};this.options=$.extend(defaults,options);this.initialize()};Hummingbird.Charts.prototype=new Hummingbird.Base;browsers={};totalBrowserHits=0;var compare=function(a,b){return b[1]-a[1]};var updateBrowserUsed=function(value,average){for(var i=0;i<value.length;i++){var msg=value[i];if(msg.userInfo&&msg.userInfo.browserName){var name=msg.userInfo.browserName;if(name.length>14){name=msg.userInfo.browserName.substring(0,14)}totalBrowserHits++;if(!browsers[name]){browsers[name]=1}else{browsers[name]++}}}var chart=$("#browser-used").highcharts();var data=[];for(var key in browsers){var per=browsers[key]/totalBrowserHits*100;data.push([Math.floor(per)+"% "+key,per])}data.sort(compare);chart.series[0].setData(data,true)};os={};totalOsHits=0;var updateOsUsed=function(value,average){for(var i=0;i<value.length;i++){var msg=value[i];if(msg.userInfo&&msg.userInfo.os){var name=msg.userInfo.os;var nameLow=name.toLowerCase();if(name.length>14){name=msg.userInfo.os.substring(0,14)}if(nameLow.indexOf("ios")!=-1||nameLow.indexOf("android")!=-1||nameLow.indexOf("symbian")!=-1){name=name.split(" ")[0]}else if(name.indexOf("OS X")!=-1){name="Mac OS X"}totalOsHits++;if(!os[name]){os[name]=1}else{os[name]++}}}var chart=$("#os-used").highcharts();var data=[];for(var key in os){var per=os[key]/totalOsHits*100;data.push([Math.floor(per)+"% "+key,per])}data.sort(compare);chart.series[0].setData(data,true)};var updateDeviceUsed=function(value,average){for(var i=0;i<value.length;i++){var msg=value[i];if(msg.userInfo&&msg.userInfo.device){var device=msg.userInfo.device;if(device.desktop){devCount.d++}else if(device.tablet){devCount.t++}else if(device.phone){devCount.p++}}}var mx=devCount.d+devCount.t+devCount.p;var dP=devCount.d/mx*100;var tP=devCount.t/mx*100;var pp=devCount.p/mx*100;var chart=$("#device-used").highcharts();chart.series[0].setData([dP],true);chart.series[1].setData([tP],true);chart.series[2].setData([pp],true)};$.extend(Hummingbird.Charts.prototype,{name:"Charts",onMessage:function(value,average){updateDeviceUsed(value,average);updateBrowserUsed(value,average);updateOsUsed(value,average)}});var compare=function(a,b){return b[1]-a[1]};var ToTitleCase=function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})};var getMinutes=function(){var minutes=[];minutes.push(["1",0],["2",0],["3",0],["4",0],["5",0],["6",0],["7",0],["8",0],["9",0],["10",0],["11",0],["12",0],["13",0],["14",0],["15",0],["16",0],["17",0],["18",0],["19",0],["20",0],["21",0],["22",0],["23",0],["24",0],["25",0],["26",0],["27",0],["28",0],["29",0],["30",0],["31",0],["32",0],["33",0],["34",0],["35",0],["36",0],["37",0],["38",0],["39",0],["40",0],["41",0],["42",0],["43",0],["44",0],["45",0],["46",0],["47",0],["48",0],["49",0],["50",0],["51",0],["52",0],["53",0],["54",0],["55",0],["56",0],["57",0],["58",0],["59",0],["60",0]);return minutes};var getHours=function(){var hours=[];hours.push(["12 AM",0],["1 AM",0],["2 AM",0],["3 AM",0],["4 AM",0],["5 AM",0],["6 AM",0],["7 AM",0],["8 AM",0],["9 AM",0],["10 AM",0],["11 AM",0],["12 PM",0],["1 PM",0],["2 PM",0],["3 PM",0],["4 PM",0],["5 PM",0],["6 PM",0],["7 PM",0],["8 PM",0],["9 PM",0],["10 PM",0],["11 PM",0]);return hours};var getDays=function(){var days=[];days.push(["1",0],["2",0],["3",0],["4",0],["5",0],["6",0],["7",0],["8",0],["9",0],["10",0],["11",0],["12",0],["13",0],["14",0],["15",0],["16",0],["17",0],["18",0],["19",0],["20",0],["21",0],["22",0],["23",0],["24",0],["25",0],["26",0],["27",0],["28",0],["29",0],["30",0],["31",0]);return days};var getMonths=function(){var months=[];months.push(["Jan",0],["Feb",0],["Mar",0],["Apr",0],["May",0],["Jun",0],["Jul",0],["Aug",0],["Sep",0],["Oct",0],["Nov",0],["Dec",0]);return months};var getYears=function(){var years=[];years.push(["2014",0],["2015",0],["2016",0],["2017",0]);return years};$.fn.hummingbirdStats=function(socket,options){if(this.length===0){return}this.each(function(){new Hummingbird.Stats($(this),socket,options)});return this};if(!Hummingbird){var Hummingbird={}}Hummingbird.Stats=function(element,socket,options){this.element=element;this.socket=socket;var defaults={averageOver:1,ratePerSecond:2,decimalPlaces:0};this.options=$.extend(defaults,options);this.initialize()};Hummingbird.Stats.prototype=new Hummingbird.Base;_inited=false;var updateHourly=function(uniqueViews,pageViews){var unique=getHours();var views=getHours();for(var i=0;i<uniqueViews.length;i+=2){var hr=moment.unix(uniqueViews[i]).hour();unique[hr][1]=parseInt(uniqueViews[i+1])}for(var i=0;i<pageViews.length;i+=2){var hr=moment.unix(pageViews[i]).hour();views[hr][1]=parseInt(pageViews[i+1])}var chart=$("#hourly-stats").highcharts();chart.series[0].setData(views,true);chart.series[1].setData(unique,true)};var updateDaily=function(uniqueViews,pageViews){var unique=getDays();var views=getDays();for(var i=0;i<uniqueViews.length;i+=2){var day=moment.unix(uniqueViews[i]).date()-1;unique[day][1]=parseInt(uniqueViews[i+1])}for(var i=0;i<pageViews.length;i+=2){var day=moment.unix(pageViews[i]).date()-1;views[day][1]=parseInt(pageViews[i+1])}var chart=$("#daily-stats").highcharts();chart.series[0].setData(views,true);chart.series[1].setData(unique,true)};var updateMonthly=function(uniqueViews,pageViews){var unique=getMonths();var views=getMonths();for(var i=0;i<uniqueViews.length;i+=2){var month=moment.unix(uniqueViews[i]).month();unique[month][1]=parseInt(uniqueViews[i+1])}for(var i=0;i<pageViews.length;i+=2){var month=moment.unix(pageViews[i]).month();views[month][1]=parseInt(pageViews[i+1])}var chart=$("#monthly-stats").highcharts();chart.series[0].setData(views,true);chart.series[1].setData(unique,true)};var updateYearly=function(uniqueViews,pageViews){var unique=getYears();var views=getYears();for(var i=0;i<uniqueViews.length;i+=2){var year=moment.unix(uniqueViews[i]).year()-2014;unique[year][1]=parseInt(uniqueViews[i+1])}for(var i=0;i<pageViews.length;i+=2){var year=moment.unix(pageViews[i]).year()-2014;views[year][1]=parseInt(pageViews[i+1])}var chart=$("#yearly-stats").highcharts();chart.series[0].setData(views,true);chart.series[1].setData(unique,true)};var updateMinutely=function(pageViews){var views=getMinutes();for(var i=0;i<pageViews.length;i+=2){var minute=moment.unix(pageViews[i]).minute();views[minute][1]=parseInt(pageViews[i+1])}var chart=$("#minutely-stats").highcharts();chart.series[0].setData(views,true)};var updateOrganic=function(pageViews){var views=[];var totalHits=0;for(var key in pageViews){if(pageViews.hasOwnProperty(key)){var hit=parseInt(pageViews[key]);totalHits+=hit}}var data=[];for(var key in pageViews){var per=pageViews[key]/totalHits*100;data.push([Math.ceil(per)+"% "+key+" - "+pageViews[key]+" Hits",Math.ceil(pageViews[key])])}data.sort(compare);var chart=$("#organic-stats").highcharts();chart.series[0].setData(data,true)};var updateReferrals=function(pageViews){var views=[];var totalHits=0;for(var key in pageViews){if(pageViews.hasOwnProperty(key)){var hit=parseInt(pageViews[key]);totalHits+=hit}}var data=[];for(var key in pageViews){var per=pageViews[key]/totalHits*100;data.push([Math.ceil(per)+"% "+ToTitleCase(key)+" - "+pageViews[key]+" Hits",Math.ceil(pageViews[key])])}data.sort(compare);var chart=$("#referrals-stats").highcharts();chart.series[0].setData(data,true)};$.extend(Hummingbird.Stats.prototype,{name:"Stats",onMessage:function(value,average){updateHourly(value[0],value[1]);updateDaily(value[2],value[3]);updateMonthly(value[4],value[5]);updateYearly(value[6],value[7]);updateOrganic(value[8]);updateReferrals(value[9]);if(value[10]){updateMinutely(value[10])}}});jQuery.fn.exists=function(){return this.length>0};$(function(){if($("#os-used").exists()){$("#os-used").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false},legend:{layout:"vertical",backgroundColor:"#FFFFFF",align:"left",verticalAlign:"top",floating:true,x:-6,y:-6,itemStyle:{cursor:"pointer",fontSize:"11px"}},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{center:["83%","50%"],allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:false},showInLegend:true}},credits:{enabled:false},series:[{type:"pie",name:"OS share",data:[]}]})}});$(function(){if($("#browser-used").exists()){$("#browser-used").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false},legend:{layout:"vertical",backgroundColor:"#FFFFFF",align:"left",verticalAlign:"top",floating:true,x:-6,y:-6,itemStyle:{cursor:"pointer",fontSize:"11px"}},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{center:["83%","50%"],allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:false},showInLegend:true}},credits:{enabled:false},series:[{type:"pie",name:"Browser share",data:[]}]})}});$(function(){if($("#device-used").exists()){$("#device-used").highcharts({chart:{type:"bar"},title:{text:""},xAxis:{gridLineColor:"#FFFFFF",lineColor:"#FFFFFF",labels:{enabled:false},categories:[""],title:{enabled:false}},yAxis:{min:0,max:100,gridLineColor:"#FFFFFF",title:{enabled:false},labels:{enabled:false}},tooltip:{enabled:false},legend:{backgroundColor:"#FFFFFF",reversed:true},plotOptions:{series:{stacking:"normal"}},credits:{enabled:false},series:[{name:"Desktop",data:[]},{name:"Tablet",data:[]},{name:"Phone",data:[]}]})}});jQuery.fn.exists=function(){return this.length>0};$(function(){if($("#hourly-stats").exists()){$("#hourly-stats").highcharts({chart:{type:"areaspline",height:"250"},title:{text:"PageViews VS. Unique Visits"},subtitle:{text:"Hourly (PST)"},xAxis:{categories:["12 AM","1 AM","2 AM","3 AM","4 AM","5 AM","6 AM","7 AM","8 AM","9 AM","10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM","7 PM","8 PM","9 PM","10 PM","11 PM"]},yAxis:{min:0,title:{text:"Hits"}},tooltip:{headerFormat:'<span style="font-size:10px"><strong>{point.key}</strong></span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b> {point.y} Hits</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.1,borderWidth:0}},credits:{enabled:false},series:[{name:"PageViews",data:[]},{name:"Unique Visits",data:[]}]})}});jQuery.fn.exists=function(){return this.length>0};$(function(){if($("#daily-stats").exists()){$("#daily-stats").highcharts({chart:{type:"areaspline",height:"250"},title:{text:"PageViews VS. Unique Visits"},subtitle:{text:"Daily (PST)"},xAxis:{categories:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"]},yAxis:{min:0,title:{text:"Hits"}},tooltip:{headerFormat:'<span style="font-size:10px"><strong>Day - {point.key}</strong></span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b> {point.y} Hits</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.1,borderWidth:0}},credits:{enabled:false},series:[{name:"PageViews",data:[]},{name:"Unique Visits",data:[]}]})}});jQuery.fn.exists=function(){return this.length>0};$(function(){if($("#monthly-stats").exists()){$("#monthly-stats").highcharts({chart:{type:"column",height:"250"},title:{text:"PageViews VS. Unique Visits"},subtitle:{text:"Monthly"},xAxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},yAxis:{min:0,title:{text:"Hits"}},tooltip:{headerFormat:'<span style="font-size:10px"><strong>Month - {point.key}</strong></span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b> {point.y} Hits</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.1,borderWidth:0}},credits:{enabled:false},series:[{name:"PageViews",data:[]},{name:"Unique Visits",data:[]}]})}});jQuery.fn.exists=function(){return this.length>0};$(function(){if($("#yearly-stats").exists()){$("#yearly-stats").highcharts({chart:{type:"column",height:"250"},title:{text:"PageViews VS. Unique Visits"},subtitle:{text:"Yearly"},xAxis:{categories:["2014","2015","2016","2017"]},yAxis:{min:0,title:{text:"Hits"}},tooltip:{headerFormat:'<span style="font-size:10px"><strong>Year - {point.key}</strong></span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b> {point.y} Hits</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.1,borderWidth:0}},credits:{enabled:false},series:[{name:"PageViews",data:[]},{name:"Unique Visits",data:[]}]})}});jQuery.fn.exists=function(){return this.length>0};$(function(){if($("#minutely-stats").exists()){$("#minutely-stats").highcharts({chart:{type:"column",height:"250"},title:{text:"Pageviews for every minute!"},subtitle:{text:"Minute wise (PST)"},xAxis:{},yAxis:{min:0,title:{text:"Hits"},labels:{formatter:function(){return Math.ceil(this.value)}}},tooltip:{headerFormat:'<span style="font-size:10px"><strong>{point.key} Minute</strong></span><br>',shared:true,useHTML:true},plotOptions:{column:{pointPadding:0,borderWidth:0}},credits:{enabled:false},series:[{name:"PageViews",data:[]}]})}});jQuery.fn.exists=function(){return this.length>0};$(function(){if($("#organic-stats").exists()){$("#organic-stats").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,height:"300"},legend:{layout:"vertical",backgroundColor:"#FFFFFF",align:"left",verticalAlign:"top",floating:true,x:15,y:15,itemStyle:{cursor:"pointer",fontSize:"15px"}},title:{text:"Direct VS. Referrals VS. Organic Traffic for Today!"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{center:["50%","50%"],allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:false},showInLegend:true}},credits:{enabled:false},series:[{type:"pie",name:"",data:[]}]})}});jQuery.fn.exists=function(){return this.length>0};$(function(){if($("#referrals-stats").exists()){$("#referrals-stats").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,height:"390"},legend:{layout:"vertical",backgroundColor:"#FFFFFF",align:"left",verticalAlign:"top",floating:true,x:15,y:15,itemStyle:{cursor:"pointer",fontSize:"13px"}},title:{text:"Referrals Traffic for Today!"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{center:["50%","50%"],allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:false},showInLegend:true}},credits:{enabled:false},series:[{type:"pie",name:"",data:[]}]})}});$(document).ready(function(){var WS_SERVER="http://"+document.location.host.toString();var socket=new Hummingbird.WebSocket(WS_SERVER);socket.connect();$(".online-counter").hummingbirdCount(socket,{from:"view_totals",every:1});$("#device-used").hummingbirdCharts(socket,{from:"locations"});$("#map_container").hummingbirdMap(socket,{from:"locations"});$("#agent_container .agent_data").hummingbirdAgent(socket,{from:"locations"});$("#hourly-stats").hummingbirdStats(socket,{from:"stats"})});(function(){dust.register("demo",body_0);function body_0(chk,ctx){return chk.section(ctx.get("visits"),ctx,{block:body_1},null)}function body_1(chk,ctx){return chk.write('<div ts="').reference(ctx.get("timestamp"),ctx,"h").write('" id="').reference(ctx.getPath(false,["userInfo","id"]),ctx,"h").write('"><img width="30" align="left" height="28" src="/images/user.gif" alt="user">A visitor from <img class="flag flag-').reference(ctx.get("cCode"),ctx,"h").write('" src="/images/blank.gif"> <strong>').reference(ctx.get("country"),ctx,"h").write("</strong><span> [").reference(ctx.getPath(false,["userInfo","ip"]),ctx,"h").write(']</span> is viewing <a class="elip" href="').reference(ctx.getPath(false,["userInfo","href"]),ctx,"h").write('" target="_blank">').reference(ctx.getPath(false,["userInfo","path"]),ctx,"h").write("</a><br>").section(ctx.getPath(false,["userInfo","searchEngine"]),ctx,{block:body_2},null).section(ctx.getPath(false,["userInfo","referrals"]),ctx,{block:body_5},null).section(ctx.getPath(false,["userInfo","direct"]),ctx,{block:body_6},null).write(" using <strong>").reference(ctx.getPath(false,["userInfo","browserName"]),ctx,"h").reference(ctx.getPath(false,["userInfo","browserVersion"]),ctx,"h").write("</strong>, <strong>").reference(ctx.getPath(false,["userInfo","os"]),ctx,"h").write("</strong>").section(ctx.getPath(false,["userInfo","device"]),ctx,{block:body_7},null).write(' - <span class="timestamp" ts="').reference(ctx.get("timestamp"),ctx,"h").write('">').reference(ctx.get("fTimestamp"),ctx,"h").write("</span> ago.</div>")}function body_2(chk,ctx){return chk.write('<strong>Organic from </strong><span class="se-name">').reference(ctx.get("name"),ctx,"h").write('</span> [ Keyword: <span class="se-kw">').reference(ctx.get("keyword"),ctx,"h").write("</span> ").section(ctx.get("hasKeyword"),ctx,{block:body_3},null).write(" ]")}function body_3(chk,ctx){return chk.section(ctx.get("cd"),ctx,{block:body_4},null)}function body_4(chk,ctx){return chk.write(', Position: <span class="se-pos">').reference(ctx.get("cd"),ctx,"h").write("</span>")}function body_5(chk,ctx){return chk.write('<strong>Referral from </strong><a href="').reference(ctx.get("href"),ctx,"h").write('" title="').reference(ctx.get("href"),ctx,"h").write('" rel="nofollow"><span class="ref-name">').reference(ctx.get("hostname"),ctx,"h").write("</span></a>")}function body_6(chk,ctx){return chk.write("<strong>Direct Browser</strong>")}function body_7(chk,ctx){return chk.write(" <strong>").reference(ctx.get("name"),ctx,"h").write("</strong>")}return body_0})();jQuery.fn.orderBy=function(keySelector){return this.sort(function(b,a){a=keySelector.apply(a);b=keySelector.apply(b);if(a>b)return 1;if(a<b)return-1;return 0})};function formatElapsedTime(fromDate){var second=1;var minute=60*second;var hour=60*minute;var day=24*hour;var month=30*day;var delta=new Date-new Date(fromDate);if(delta<0){delta=Math.abs(delta)}if(delta<1e3){return delta+" ms"}delta=delta/1e3;if(delta<1*minute){return delta==1?"1 sec":Math.floor(delta)+" secs"}if(delta<2*minute){return"1 mins"
}if(delta<45*minute){return Math.floor(delta/minute)+" mins"}if(delta<90*minute){return"1 hour"}if(delta<24*hour){return Math.floor(delta/hour)+" hours"}if(delta<48*hour){return"yesterday"}if(delta<30*day){return Math.floor(delta/day)+" days"}if(delta<12*month){var months=Math.floor(delta/day/30);return months<=1?"1 month":months+" months"}var years=Math.floor(delta/day/365);return years<=1?"1 year":years+" years"}