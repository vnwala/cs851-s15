if((typeof jQuery)=="function"){(function($){$.fn.dodMainMenu=function(q){var q;return this.each(function(){q=$.extend(true,{subMenuOffsetX:-3,subMenuOffsetY:-1,viewportPadding:5},q);var l=$(this);var m=l.children("ul.Menu");var n=m.children("li.MenuItem");var o=m.add(l.find("ul.SubMenu"));var p;$(o).each(function(i){var j=$(this);var k=j.children("li.MenuItem");j.bind("mouseleave focusout",function(a){a.stopPropagation();var b=$(this);if(b.get(0).className!="Menu"){b.children("li.MenuItemSelected").trigger("unselect")}l.data("DODMainMenuState").hideTimerID=setTimeout(function(){hideAllSubMenus.apply(l)},500)});j.bind("mouseenter focusin",function(a){a.stopPropagation();clearTimeout(l.data("DODMainMenuState").hideTimerID)});k.each(function(g){var h=$(this);var i=h.children("a");h.bind("hideSubMenu",function(a){a.stopPropagation();var b=$(this);if(b.children("ul.SubMenu:visible").length>0){hideSubMenu.apply(b)}});h.bind("showSubMenu",function(a){a.stopPropagation();var b=$(this);b.siblings().children("ul.SubMenu").parent().trigger("hideSubMenu");if(b.has("ul.SubMenu").length>0){showSubMenu.apply(b)}});h.bind("select",function(a){var b=$(this);b.addClass("MenuItemSelected");b.children("a").children("div.MenuItemArrow").addClass("MenuItemArrowSelected");b.children("a").addClass("MenuItemSelected");b.siblings(".MenuItemSelected").trigger("unselect");if(b.parent().get(0).className=="Menu"){a.stopPropagation()}});h.bind("unselect",function(a){a.stopPropagation();var b=$(this);b.removeClass("MenuItemSelected");b.children("a").children("div.MenuItemArrow").removeClass("MenuItemArrowSelected");b.children("a").removeClass("MenuItemSelected")});i.bind("mouseenter focusin",function(a){clearTimeout(l.data("DODMainMenuState").hideTimerID);clearTimeout(l.data("DODMainMenuState").showTimerID);h.trigger("select");if(h.parent().get(0).className=="Menu"){h.trigger("showSubMenu")}else{l.data("DODMainMenuState").showTimerID=setTimeout(function(){h.trigger("showSubMenu")},250)}});i.bind("touchstart",function(a){a.stopPropagation();clearTimeout(l.data("DODMainMenuState").hideTimerID);clearTimeout(l.data("DODMainMenuState").showTimerID);var b=$(this);b.unbind("mouseenter");b.unbind("focusin");b.unbind("mouseover");b.unbind("mouseleave");b.unbind("focusout");b.unbind("mouseout");j.unbind("mouseleave");j.unbind("mouseout");j.unbind("focusout");j.unbind("mouseenter");j.unbind("mouseover");j.unbind("focusin")});i.bind("click",function(b){b.stopPropagation();clearTimeout(l.data("DODMainMenuState").hideTimerID);clearTimeout(l.data("DODMainMenuState").showTimerID);var c=$(this);var d=h.children("ul.SubMenu").length;if(d){var e=h.children("ul.SubMenu:visible").length;if(e===0){var f=h.children("ul.SubMenu").eq(0);if(f.children("li.MenuItem").children(".CloseSubMenuItem").length===0){f.append("<li class=\"MenuItem\"><a href=\"\" class=\"CloseSubMenuItem\" style=\"text-align:center;\">[Close]</a></li>");f.children("li.MenuItem").children("a.CloseSubMenuItem").bind("click",function(a){a.stopPropagation();clearTimeout(l.data("DODMainMenuState").hideTimerID);clearTimeout(l.data("DODMainMenuState").showTimerID);h.trigger("hideSubMenu");h.trigger("unselect");a.preventDefault();return false})}h.trigger("select");h.trigger("showSubMenu");b.preventDefault();return false}}h.trigger("select");h.trigger("showSubMenu")})})});p={$menuBarItems:n,$allSubMenus:o,showTimerID:0,hideTimerID:0,subMenuOffsetX:q.subMenuOffsetX,subMenuOffsetY:q.subMenuOffsetY,viewportPadding:q.viewportPadding};l.data("DODMainMenuState",p);renderMenuBar.apply(l)})};function hideAllSubMenus(){var a=$(this);var b=a.data("DODMainMenuState");b.$allSubMenus.children("li.MenuItemSelected").trigger("hideSubMenu");b.$menuBarItems.filter("li.MenuItemSelected").trigger("unselect")}function hideSubMenu(){var a=$(this);var b=a.find("ul.SubMenu");var c=a.find("li.MenuItemSelected");b.hide();c.each(function(i){$(this).trigger("unselect")})}function showSubMenu(){var a=$(this);var b=a.closest("ul.Menu").closest("div");var c=b.data("DODMainMenuState");var d=a.children("ul.SubMenu");var e=d.children("li.MenuItem");var f=a.outerWidth();var g=d.outerWidth();var h=$(window).width();var i=$(window).height();var j=$(window).scrollLeft();var k=$(window).scrollTop();var l=a.offset();e.css("width",d.eq(0).innerWidth());if(a.parent().get(0).className=="Menu"){if((parseInt(l.left)+g)>((h-c.viewportPadding)+j)){var m=(parseInt(l.left)+g)-((h-c.viewportPadding)+j);d.css("left",-m)}else{d.css("left","0")}if(parseInt(l.left)<(j+c.viewportPadding)){var m=(j+c.viewportPadding)-parseInt(l.left);d.css("left",m)}}else{d.css("left",f+c.subMenuOffsetX).css("top",c.subMenuOffsetY);if(parseInt(a.parent().css("left"))<c.subMenuOffsetX||(parseInt(l.left)+f+g)>(h-c.viewportPadding)){d.css("left",-(g+c.subMenuOffsetX))}if((parseInt(l.left)-g)<(j+c.viewportPadding)){var m=(j+viewportPadding)-parseInt(l.left);d.css("left",m)}}d.fadeIn(250);renderArrows.apply(e)}function renderMenuBar(){var b=$(this);var c=b.data("DODMainMenuState");var d=c.$menuBarItems;var e=0;d.each(function(i){var a=$(this);e+=a.width()});if(e<b.width()){var f=b.width()-e;var g=f/d.length;g+=(g/d.length)-4;d.children("a").not("a:last").css("margin-right",g+"px")}else{b.css("width",(e+30)+"px")}}function renderArrows(){var c=$(this).has("ul");c.each(function(i){var a=$(this).children("a");if(a.has(".MenuItemArrow").length===0){a.append("<div class=\"MenuItemArrow\"></div>");var b=a.children(".MenuItemArrow");b.css("top",(a.innerHeight()/2)-(b.outerHeight()/2))}})}})(jQuery)}