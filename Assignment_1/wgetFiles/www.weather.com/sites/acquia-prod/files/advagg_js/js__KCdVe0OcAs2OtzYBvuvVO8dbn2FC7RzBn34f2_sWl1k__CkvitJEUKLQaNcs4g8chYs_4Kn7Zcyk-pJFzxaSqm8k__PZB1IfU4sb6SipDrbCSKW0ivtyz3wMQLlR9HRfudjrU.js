/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/node-rules.js. */
window.TWC=window.TWC||{};TWC.validators={NO_VALIDATOR:function(value,$){return true},NOT_NULL_VALIDATOR:function(value,$){return!!value},OBJECT_VALIDATOR:function(value,$){return(jQuery.type(val)==="object")},ARRAY_VALIDATOR:function(value,$){return $.type(val)==="array"}};TWC.node_rules=(function(){var nodeConfig={user:{allowedAttributes:{currentLocation:TWC.validators.OBJECT_VALIDATOR,declarations:TWC.validators.ARRAY_VALIDATOR,preferredLocation:TWC.validators.OBJECT_VALIDATOR,date:null,day:null,browser:null,flash:null,lotame:null,lastVisitedLocation:null,partner:null,locale:null,rmid:null,signedIn:null,site:null,time:null,tzOffset:null,unit:null,currentBackTo:TWC.validators.OBJECT_VALIDATOR,backTo:TWC.validators.OBJECT_VALIDATOR,savedLocations:TWC.validators.ARRAY_VALIDATOR,recentSearchLocations:TWC.validators.ARRAY_VALIDATOR,local_suite_bg:TWC.validators.OBJECT_VALIDATOR,titan_local_suite_bgwt:TWC.validators.OBJECT_VALIDATOR,titan_local_suite_bgwp:TWC.validators.OBJECT_VALIDATOR,article_bg:TWC.validators.OBJECT_VALIDATOR,preferredSite:null}}};return{getNodeConfig:function(nodeName){return nodeConfig[nodeName]}}})();;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/node-rules.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/node.js. */
TWC.PcoUtils.setTiming('pcoLoad',(new Date()).getTime());window.TWC=window.TWC||{};TWC.Node=function(){this.nodeName="node";this.attributes={};this.promises=[];this.isPersisted=false;this.restrictExtend=false;this.init(jQuery,arguments);this.postInit(jQuery,arguments);this.process(jQuery,arguments);this.restrictExtendBehavior(jQuery)};TWC.Node.prototype={postInit:function($,arguments){if(this.isPersisted){var persistedAttrs=TWC.LocalStorage.getPersistedValue(this.getPersistKey());if(persistedAttrs)if(!('expirationTime'in persistedAttrs)||!persistedAttrs.expirationTime||persistedAttrs.expirationTime>(new Date().getTime()))$.extend(this.attributes,persistedAttrs)};if(arguments&&arguments.length>0)$.extend(this.attributes,arguments[0])},restrictExtendBehavior:function($){if(this.restrictExtend){var _self=this;$.when.apply($,this.promises).done(function(){TWC.PcoUtils.restrictExtend(_self)})}},getNodeName:function(){return this.nodeName},getPromises:function(){return this.promises},getAttributes:function(){return this.attributes},get:function(key){return this.attributes[key]},getTransformedValue:function(key,value){var nullVal;if('config'in this&&'NULL_KEYNAME'in this.config)nullVal=this.config.NULL_KEYNAME;if(!value)return nullVal;var transformedVal=this.transform_rules[key](value,jQuery);return(transformedVal?transformedVal:nullVal)},set:function(key,value){var override='overrideSet'+TWC.PcoUtils.capitalize(key);if(override in this){this[override](jQuery,value)}else this.attributes[key]=(('transform_rules'in this&&key in this.transform_rules)?this.getTransformedValue(key,value):value);this.persistAttributes(key);this.checkEventTriggers(key)},deleteKey:function(key){delete this.attributes[key]},getPersistKey:function(){return('persistKey'in this?this.persistKey:this.nodeName)},deleteKeyIfNotAllowed:function(allowedAttributes,aKey){if(!(aKey in allowedAttributes))delete this.attributes[aKey]},cleanUpObject:function(allowedAttributes,aKey){if(aKey){this.deleteKeyIfNotAllowed(allowedAttributes,aKey)}else for(var vKey in this.attributes)this.deleteKeyIfNotAllowed(allowedAttributes,vKey)},persistAttributes:function(aKey){if(this.isPersisted){var nodeConfig=TWC.node_rules.getNodeConfig(this.nodeName);if(this.restrictExtend&&nodeConfig&&nodeConfig.allowedAttributes)this.cleanUpObject(nodeConfig.allowedAttributes,aKey);TWC.LocalStorage.persistValue(this.getPersistKey(),this.attributes)}},setAttributes:function(attributes){this.attributes=attributes;this.persistAttributes();var _self=this;jQuery.each(this.attributes,function(key,value){_self.checkEventTriggers(key)})},checkEventTriggers:function(key){if(key&&'eventTriggers'in this&&key in this.eventTriggers){var eventName=this.eventTriggers[key],event=TWC.Events.getEvent(eventName);event.notify({key:key,locations:this.attributes[key]})}}};
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/node.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/profile.js. */
TWC.Profile=TWC.Node.createSubClass({init:function(){this.nodeName="profile"},process:function($){this.setUpProfile($)},setUpProfile:function($){if($.isEmptyObject(this.attributes)){var uploginCookie=$.cookie('uplogin'),uplogin=uploginCookie&&decodeURIComponent(uploginCookie),uploginParts=uplogin&&uplogin.split('^'),length=uploginParts&&uploginParts.length;if(uploginParts&&length&&length>=4){this.set('uphostname',uploginParts[0]);this.set('lastmodified',uploginParts[1]);this.set('userid',uploginParts[2]);this.set('username',uploginParts[3]);this.set('addlparams',uploginParts.slice(4))}}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/profile.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/page.js. */
TWC.Page=TWC.Node.createSubClass({init:function($,arguments){this.nodeName="page"},process:function($,arguments){this.setUpPage($,arguments);this.setUpEnv($);this.setUpFV($);this.setUpPartner($,arguments);this.setUpFromStr($);this.setPathName();this.setAssetId($);this.setVideoPresent($)},setUpPage:function($,arguments){var locId,currentLocation={},that=this,userRef=arguments.length>1?arguments[1]:{},locale=TWC&&TWC.Titan&&TWC.Titan.locale||"en_US",lang=TWC&&TWC.Titan&&TWC.Titan.locale&&TWC.Titan.locale.split&&TWC.Titan.locale.split("_")||"en",locPromise=$.Deferred(),esi_location_available=!!(window.explicit_location&&window.explicit_location_obj);this.set("locale",locale);this.set("lang",lang);TWC.Events.ifReady(['drupalSettingsReady']).done(function(){var settings=Drupal&&Drupal.settings,twcsettings=settings&&settings.twc,pathname=window.location.pathname;if(twcsettings&&twcsettings.modules)that.set("modules",twcsettings.modules);if(twcsettings&&twcsettings.variant)that.set("variant",twcsettings.variant);if(!esi_location_available)if((twcsettings&&twcsettings.contexts&&twcsettings.contexts.is_page_loc)||(TWC&&TWC.Titan&&TWC.Titan.locid)){locId=TWC.PcoUtils.getURLlocid();if(TWC&&TWC.Titan&&TWC.Titan.locid)locId=TWC.Titan.locid;that.set("currentLocId",locId);var locale=(TWC&&TWC.Titan&&TWC.Titan.locale)||that.get("locale"),promise=TWC.PcoUtils.get_dsx_records(["wxd/v2/loc/"+locale+"/"+locId]);promise.success(function(data,textStatus,jqXHR){if(data&&data.body&&$.isArray(data.body)&&data.body.length>0){var locBody=data.body[0];if(locBody&&locBody.doc&&'locId'in locBody.doc){currentLocation=locBody.doc;currentLocation.loc=currentLocation.locId+":"+currentLocation.locType+":"+currentLocation.cntryCd;that.set("currentLocation",currentLocation);userRef.setLastVisitedLocation&&userRef.setLastVisitedLocation(currentLocation)}}else that.set("currentLocation",{error:"LOCATION_UNAVAILABLE"});locPromise.resolve()});promise.error(function(){that.set("currentLocation",{error:"LOCATION_UNAVAILABLE"});locPromise.resolve()})}else{that.set("currentLocation",{error:"LOCATION_UNAVAILABLE"});locPromise.resolve()};if(twcsettings&&twcsettings.modules&&twcsettings.modules.video_player){that.set('content','video')}else if(settings&&settings.ct_article){that.set('content','article')}else if(twcsettings&&twcsettings.modules&&twcsettings.modules.imap){that.set('content','imap')}else if(pathname.match(/\/weather\/today/)){that.set('content','today')}else if(pathname.match(/\/weather\/tomorrow/)){that.set('content','tomorrow')}else if(pathname.match(/\/weather\/hour/)){that.set('content','hourly')}else if(pathname.match(/\/weather\/5day/)){that.set('content','5day')}else if(pathname.match(/\/weather\/tenday/)){that.set('content','10day')}else if(pathname.match(/\/weather\/weekend/)){that.set('content','weekend')}else if(pathname.match(/\/weather\/today/)){that.set('content','today')}else if(pathname.match(/\/(?!.)/)){that.set('content','homepage')}else if(twcsettings&&twcsettings.modules&&twcsettings.modules.title_collection_index){that.set('content','index')}else that.set('content','other')});esi_location_available?(function(){var explicit_location_obj=window.explicit_location_obj;if(!explicit_location_obj.loc&&explicit_location_obj.locId&&explicit_location_obj.locType&&explicit_location_obj.cntryCd)explicit_location_obj.loc=explicit_location_obj.locId+":"+explicit_location_obj.locType+":"+explicit_location_obj.cntryCd;that.set("currentLocId",window.explicit_location);that.set("currentLocation",explicit_location_obj);userRef.setLastVisitedLocation&&userRef.setLastVisitedLocation(explicit_location_obj)})():this.promises.push(locPromise)},setUpFV:function($){var fv=$.cookie('fv'),expires=new Date(new Date().getTime()+(30*60*1e3));if(fv){fv=(fv==1||fv==2)?++fv:-1}else fv=1;this.set("fv",fv);$.cookie('fv',fv,{path:'/',domain:'.weather.com',expires:expires})},setAssetId:function($){var assetPromise=$.Deferred(),self=this;this.promises.push(assetPromise);TWC.Events.ifReady(['drupalSettingsReady']).done(function(){var node=Drupal&&Drupal.settings&&Drupal.settings.twc&&Drupal.settings.twc.contexts&&Drupal.settings.twc.contexts.node;if(node){assetId=node.uuid;assetType=node.type;self.set("assetId",assetId);self.set("assetType",assetType)};assetPromise.resolve()})},setUpPartner:function($,arguments){var p=TWC.PcoUtils.getURLParameter,userRef=arguments.length>1?arguments[1]:{},partner=p('par'),ilabel=p('ilabel'),ilabel_cookie=$.cookie("partner_ilabel"),site=p('site'),siteCookie=$.cookie("site"),cm_ven=p("cm_ven")?p("cm_ven"):"",cm_cat=p("cm_cat")?":"+p("cm_cat"):"",cm_pla=p("cm_pla")?":"+p("cm_pla"):"",cm_ite=p("cm_ite")?":"+p("cm_ite"):"",expires=new Date(new Date().getTime()+(30*60*1e3)),partnerCookie=$.cookie("partner"),partner_urlCookie=$.cookie("partner_url");this.set("cm_ven",cm_ven);this.set("cm_cat",cm_cat);this.set("cm_pla",cm_pla);this.set("cm_ite",cm_ite);if(partner){$.cookie("partner",partner,{domain:".weather.com",path:"/",expires:expires});userRef?userRef.set("partner",partner):null;this.set("partner",partner);this.set("parStr",true);if(window.history&&window.history.replaceState){window.history.replaceState({},document.title,TWC.PcoUtils.removeURLParameter(window.location.href,"par"));partner_urlCookie=document.referrer}}else if(partnerCookie&&userRef){$.cookie("partner",partnerCookie,{domain:".weather.com",path:"/",expires:expires});userRef.set("partner",partnerCookie);this.set("partner",partnerCookie)};if(partner_urlCookie)$.cookie("partner_url",partner_urlCookie,{domain:".weather.com",path:"/",expires:expires});if(site){$.cookie("site",site,{domain:".weather.com",path:"/",expires:expires});this.set("partnerSite",site)}else if(siteCookie)$.cookie("site",siteCookie,{domain:".weather.com",path:"/",expires:expires});if(ilabel&&this.get('partner')){$.cookie("partner_ilabel",ilabel,{domain:".weather.com",path:"/",expires:expires});this.set("partner_ilabel",ilabel)}else if(ilabel_cookie){$.cookie("partner_ilabel",ilabel_cookie,{domain:".weather.com",path:"/",expires:expires});this.set("partner_ilabel",ilabel_cookie)}},setUpEnv:function($){var serverEnv="",replEnvStr=location.host.replace(".weather.com","");if(location.href.match(/twcrb/)){serverEnv=["dev:",replEnvStr].join("")}else if(location.href.match(/preview/)){serverEnv=["preview:",replEnvStr].join("")}else if(location.href.match(/beta/)){serverEnv=["beta:",replEnvStr].join("")}else serverEnv=["live:",replEnvStr].join("");this.set("env",serverEnv)},setUpFromStr:function($){var fromStr=$.cookie("fromStr");if(!fromStr){fromStr=TWC.PcoUtils.getURLParameter("from")}else $.removeCookie("fromStr",{domain:".weather.com",path:"/"});this.set("fromStr",fromStr)},setPathName:function(){this.set('pathname',window.location.pathname.substr(window.location.pathname.lastIndexOf('/')+1))},setVideoPresent:function($){var videopresent=$.Deferred(),self=this;this.promises.push(videopresent);TWC.Events.ifReady(['drupalSettingsReady']).done(function(){var modules=Drupal&&Drupal.settings&&Drupal.settings.twc&&Drupal.settings.twc.modules,contains_videoplayer=(modules&&(modules.video_player||modules.wxnode_video_player))?"videoplayer-present":"videoplayer-not-present";self.set("contains_videoplayer",contains_videoplayer);videopresent.resolve()})}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/page.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/product.js. */
TWC.Products=TWC.Node.createSubClass({init:function($,arguments){this.nodeName="products";this.isPersisted=true;this.eventTriggers={products:'products_changed'}},process:function($){this.setUpProducts($)},setUpProducts:function($){var productsPromise=$.Deferred();productsPromise.resolve()}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/product.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/user.js. */
TWC.User=TWC.Node.createSubClass({init:function(){this.nodeName="user";this.isPersisted=true;this.attributes.savedLocations=[];this.attributes.recentSearchLocations=[];this.restrictExtend=true;this.eventTriggers={savedLocations:'locations_changed',recentSearchLocations:'locations_changed',preferredLocation:'preferred_location_change'};this.transform_rules={preferredLocation:function(val){if(val&&val.locId&&val.locType&&val.cntryCd)val.loc=[val.locId,":",val.locType,":",val.cntryCd].join("");return val}};this.postInit=function($,arguments){if(this.isPersisted){var persistedAttrs=TWC.LocalStorage.getPersistedValue(this.getPersistKey());if(persistedAttrs&&persistedAttrs.claritas)persistedAttrs=this.pco2ToPco3(persistedAttrs);persistedAttrs=this.cleanUpPcoObjects(persistedAttrs,$);if(persistedAttrs)$.extend(this.attributes,persistedAttrs)};if(arguments&&arguments.length>0)$.extend(this.attributes,arguments[0])}},setLastVisitedLocation:function(locObj){this.set("lastVisitedLocation",this.truncateSingleLoc(locObj))},process:function($){this.updateLocationObject($);this.setUpLocale($);this.setUpBrowserInfo($);this.setSignedIn($);this.setUnit($);this.setCurrentLocation($);this.setPlaceIQ($);this.setRMID($);this.setPreferredLocation($);this.setBackTo($)},updateLocationObject:function($){var defer=$.Deferred(),savedLocations=this.get('savedLocations'),rsLocations=this.get('recentSearchLocations'),locationToConsider=((savedLocations&&savedLocations.length>0)?savedLocations:rsLocations);if(locationToConsider&&locationToConsider[0]&&!locationToConsider[0]._gprId){var locationObj=locationToConsider[0],locId=locationObj.loc,promise=TWC.PcoUtils.get_dsx_records("wxd/v2/loc/en_US/"+locId),_self=this;promise.then(function(response){if(response&&response.body){locationObj._gprId=response.body._gprId;locationObj.dmaCd=response.body.dmaCd;locationObj.cntyNm=response.body.cntyNm;locationObj.lat=response.body.lat;locationObj['long']=response.body['long'];locationObj.zipCd=response.body.zipCd;locationObj.tmZnAbbr=response.body.tmZnAbbr}})}},setUpLocale:function($){var locale='en_US';this.set("locale",locale)},setUpBrowserInfo:function($){var browser=$.extend({},$.browser);browser.ltIE9=browser.msie&&parseInt(browser.version,10)<9;browser.lteIE9=browser.msie&&parseInt(browser.version,10)<=9;this.set("browser",browser);this.set("flash",browser)},setSignedIn:function($){var signedIn=$.cookie('Ticket_web');this.set("signedIn",signedIn)},setDateTime:function($){var dt=new Date(),yy=dt.getFullYear(),mt=dt.getMonth()+1,date=dt.getDate(),dow=dt.getDay(),mh=dt.getHours(),hh=(mh>12)?mh-12:(mh==0)?12:mh,ampm=(mh<12)?"AM":"PM",mm=dt.getMinutes(),ss=dt.getSeconds()+"",ss=(ss.length>1)?ss:"0"+ss,tm=dt.getTime(),day=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][dow],tzOffset=dt.getTimezoneOffset()/60;this.set("date",[mt,"/",date,"/",yy].join(""));this.set("time",[hh,":",mm,":",ss].join(""));this.set("day",day);this.set("tzOffset",tzOffset)},setUnit:function($){var units=this.get("unit")||"e";if(TWC&&TWC.Titan)units=TWC.Titan.locale!=='en_US'?'m':'e';if(TWC&&TWC.Titan&&TWC.Titan.temp)units=TWC.Titan.temp;this.set("unit",units)},setCurrentLocation:function($){var customPromise=$.Deferred();if(!this.attributes.currentLocation||!this.attributes.currentLocation.expirationTime||this.attributes.currentLocation.expirationTime<(new Date().getTime())){var _self=this,url="//gip.imwx.com/wxdata/gip/get.js?cb=?",gipCall=$.ajax({url:url,dataType:'jsonp',contentType:"application/json",cache:true});gipCall.then(function(data){if(!data||!data.lat||!data.lng){this.set("currentLocation",{gipResponse:data});customPromise.resolve();return};var trueLat=data.lat,trueLng=data.lng,lat=$.isNumeric(data.lat)?data.lat.toFixed(2):data.lat,lng=$.isNumeric(data.lng)?data.lng.toFixed(2):data.lng,locurl=TWC.Configs.dsx.host+"wxd/loc/"+lat+","+lng+"?jsonp=?",promise=TWC.PcoUtils.get_dsx_records(["wxd/loc/en_US/"+(lat+","+lng)]);promise.success(function(data,textStatus,jqXHR){if(data&&data.body&&$.isArray(data.body)&&data.body.length>0){var locBody=data.body[0];if(locBody&&locBody.doc&&'locId'in locBody.doc){var locBodyDoc=locBody.doc;_self.set("currentLocation",locBodyDoc);_self.get("currentLocation").lat=trueLat;_self.get("currentLocation").long=trueLng;_self.get("currentLocation").loc=(locBodyDoc.locId||'')+':'+(locBodyDoc.locType||'')+':'+(locBodyDoc.cntryCd||'');_self.get("currentLocation").expirationTime=(new Date().getTime())+9e5}}});promise.error(function(){_self.set("currentLocation",{error:true})});promise.always(function(){customPromise.resolve();TWC.PcoUtils.setTiming('gipEnd',(new Date()).getTime())})})}else customPromise.resolve();this.promises.push(customPromise);var _self=this;customPromise.done(function(){savedLocations=_self.get('savedLocations');rsLocations=_self.get('recentSearchLocations');if(savedLocations.length===0&&rsLocations.length===0){var currLoc=_self.get("currentLocation");if(currLoc&&"cityNm"in currLoc){_self.get("currentLocation").cityNm=TWC.PcoUtils.capitalize(currLoc.cityNm,true);_self.set('recentSearchLocations',[_self.get("currentLocation")])}}})},setPlaceIQ:function($){},setRMID:function($){var rmid=this.get("rmid");if(!rmid)rmid=TWC.PcoUtils.genRandStr(16,"0123456789");this.set("rmid",rmid)},setBackTo:function($){var current=this.get("currentBackTo"),currentLocation=window.location.href;if(current&&current.url&&current.url!==currentLocation)this.set("backTo",current);this.set("currentBackTo",{url:currentLocation,pagetype:"N/A"})},setSavedAndRecentLocations:function($){if(this.isPersisted){var persistedAttrs=TWC.LocalStorage.getPersistedValue(this.nodeName)||{};if(persistedAttrs)$.extend(this.attributes,persistedAttrs)}},setPreferredLocation:function($){var _self=this,savedLocs=_self.get("savedLocations"),recentSearchLocs=_self.get("recentSearchLocations");if(savedLocs&&savedLocs.length>0){_self.set("preferredLocation",savedLocs[0])}else if(recentSearchLocs&&recentSearchLocs.length>0){_self.set("preferredLocation",recentSearchLocs[0])}else _self.deleteKey("preferredLocation")},overrideSetSavedLocations:function($,value){this.attributes['savedLocations']=value;this.setPreferredLocation($)},overrideSetRecentSearchLocations:function($,value){this.attributes['recentSearchLocations']=value;this.setPreferredLocation($)},truncateSingleLoc:function(locObj){return{key:locObj.key||'',locId:locObj.locId||'',locType:locObj.locType||'',cntryCd:locObj.cntryCd||'',cityNm:locObj.cityNm||'',nickname:locObj.nickname||'',loc:[locObj.locId,":",locObj.locType,":",locObj.cntryCd].join(""),lat:locObj.lat||'',long:locObj.long||'',cntyNm:locObj.cntyNm||'',_gprId:locObj._gprId||'',prsntNm:locObj.prsntNm||'',_country:locObj._country||'',stNm:locObj.stNm||'',stCd:locObj.stCd||'',zipCd:locObj.zipCd||'',tmZnAbbr:locObj.tmZnAbbr||'',dmaCd:locObj.dmaCd||''}},truncateLoc:function(locArray){var returnLocs=[],locObj,location;if(locArray&&locArray.length>0){for(var i=0,l=locArray.length;i<l;i++){locObj=locArray[i];location=this.truncateSingleLoc(locObj);returnLocs.push(location)};return returnLocs}},updateLocation:function(idx,locObj){var savedLocs=this.attributes['savedLocations'];if(savedLocs&&jQuery.isArray(savedLocs)&&savedLocs.length>idx){savedLocs[idx]=locObj;this.set('savedLocations',savedLocs)}},cleanUpPcoObjects:function(localStorageObj,$){if(!localStorageObj)return;var locationTypes=["preferredLocation","recentSearchLocations","savedLocations"];$.each(locationTypes,function(indx,locationType){var locations=localStorageObj[locationType],newLocations=[],isArrayObj=$.isArray(locations);locations=isArrayObj?locations:[locations];for(var idx=0,len=locations.length;idx<len;idx++)if(locations[idx]&&locations[idx].locId)newLocations.push(locations[idx]);localStorageObj[locationType]=isArrayObj?newLocations:newLocations[0]});return localStorageObj},pco2ToPco3:function(localStorageObj){if(localStorageObj.claritas){var propsToKeep=["preferredLocation","recentSearchLocations","savedLocations","unit","rmid"],locationObjMap={countryName:"_country",city:"cityNm",country:"cntryCd",locid:"locId",loctype:"locType",state:"stCd",prsntNm:"prsntNm",nickname:"nickname",loc:"loc"},locationTypes=["preferredLocation","recentSearchLocations","savedLocations"],location,newLocalStorageObj={},i,k,j,p,locationsArray,newLocationsArray=[],locationType,locTypeIsObject=false;if(localStorageObj)for(i=0,l=propsToKeep.length;i<l;i++){p=propsToKeep[i];newLocalStorageObj[p]=localStorageObj[p]};for(i=0,l=locationTypes.length;i<l;i++){locationType=locationTypes[i];locTypeIsObject=false;locationsArray=newLocalStorageObj[locationType]||[];if(!jQuery.isArray(locationsArray)){locationsArray=[locationsArray];locTypeIsObject=true};newLocationsArray=[];for(k=0,j=locationsArray.length;k<j;k++){for(p in locationObjMap){location=locationsArray[k];if(locationObjMap.hasOwnProperty(p)){location[locationObjMap[p]]=(p==="nickname"&&location[p])?location[p].replace(/\+/," "):location[p];if(p!==locationObjMap[p])delete location[p]};if(p==="locid"&&location.locId)location.locId=location.locId.split(":")[0]};if(location.locId){location.loc=[location.locId,location.locType,location.cntryCd].join(":");location.prsntNm=location.cityNm+","+(location.cntryCd==="US"?location.stCd:location._country);location.nickname=location.nickname||"";newLocationsArray.push(location)}};newLocalStorageObj[locationType]=locTypeIsObject?newLocationsArray[0]:newLocationsArray};return newLocalStorageObj}},persistAttributes:function(aKey){if(this.isPersisted){var nodeConfig=TWC.node_rules.getNodeConfig(this.nodeName),user=jQuery.extend({},this.attributes),savedLoc={},recentLoc={},svdLocs=[],rcntLocs=[];if(this.restrictExtend&&nodeConfig&&nodeConfig.allowedAttributes)this.cleanUpObject(nodeConfig.allowedAttributes,aKey);if(user&&user.savedLocations&&user.savedLocations.length>0)user.savedLocations=this.truncateLoc(user.savedLocations);if(user&&user.recentSearchLocations&&user.recentSearchLocations.length>0)user.recentSearchLocations=this.truncateLoc(user.recentSearchLocations);var preferredLoc=user.preferredLocation?user.preferredLocation:null;if(preferredLoc)user.preferredLocation={key:preferredLoc.key||'',locId:preferredLoc.locId||'',locType:preferredLoc.locType||'',cntryCd:preferredLoc.cntryCd||'',cityNm:preferredLoc.cityNm||'',nickname:preferredLoc.nickname||'',loc:[preferredLoc.locId,":",preferredLoc.locType,":",preferredLoc.cntryCd].join(""),lat:preferredLoc.lat||'',long:preferredLoc.long||'',cntyNm:preferredLoc.cntyNm||'',_gprId:preferredLoc._gprId||'',prsntNm:preferredLoc.prsntNm||'',_country:preferredLoc._country||'',stNm:preferredLoc.stNm||'',stCd:preferredLoc.stCd||'',zipCd:preferredLoc.zipCd||'',tmZnAbbr:preferredLoc.tmZnAbbr||'',dmaCd:preferredLoc.dmaCd||''};TWC.LocalStorage.persistValue(this.getPersistKey(),user,null)}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/user.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/device.js. */
TWC.Device=TWC.Node.createSubClass({init:function($,arguments){this.nodeName="device";this.persistKey="pcoDeviceNode";this.isPersisted=true},process:function($){this.setUpDevice($);this.setUpDeviceWidth($)},setUpDevice:function($){var that=this;if($.isEmptyObject(this.attributes)){var url="//d.imwx.com/diag/ua.js?cb=?";this.promises.push($.ajax({url:url,dataType:'jsonp',contentType:"application/json",cache:true,success:function(data,textStatus,jqXHR){var attrs=this.attributes||{},data2Store;data.error=false;data2Store=$.extend(attrs,data);this.setAttributes(data2Store);$("html").addClass((data2Store&&data2Store.browserId&&data2Store.browserId.indexOf("msie")!==-1)?'msie':'');TWC.PcoUtils.setTiming('deviceEnd',(new Date()).getTime())},failure:function(){var defaults={UserAgent:null,dClass:null,dClassVersion:null,OpenDDRId:null,OpenDDRDevice:null,OpenDDRDisplay:null,OpenDDRJS:null,OpenDDRWireless:null,OpenDDRTablet:null,OpenDDRCrawler:null,OpenDDRDesktop:null,browserId:null,browserName:null,browserVer:null,browserOS:null,error:true},attrs=this.attributes||{};this.setAttributes($.extend(attrs,defaults))},context:that}))}else{var browserId=this.get("browserId");$("html").addClass((browserId&&browserId.indexOf("msie")!==-1)?'msie':'')}},setUpDeviceWidth:function($){var deviceWidth=$(window).width();this.set('deviceWidth',deviceWidth)}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/device.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/wx.js. */
TWC.WeatherInfo=TWC.Node.createSubClass({init:function($,arguments){TWC.PcoUtils.setTiming('wxDataStart',(new Date()).getTime());var _self=this;if(arguments.length>1){this.adRef=arguments.length>1?arguments[1]:{};this.userRef=arguments.length>2?arguments[2]:{};this.pageRef=arguments.length>3?arguments[3]:{}};TWC.Events.getEvent('ad_location_changed').progress(function(){if(_self.adRef.promises[0].state()!=="pending")_self.setUpWeatherInfo($)});this.customPromise=$.Deferred();this.customPromise.done(function(){TWC.PcoUtils.setTiming('wxResolved',(new Date()).getTime())});this.nodeName="wx";this.config={NULL_KEYNAME:"nl"};this.persistKey="pcoWxNode";this.isPersisted=true;this.transform_rules={hum:function(val){return((val>=61)?"hi":"lo")},wind:function(val){if(val>=6&&val<=29){return"lo"}else if(val>=30)return"hi"},uv:function(val){if(val>=5)return"hi"},getTempInc:function(tmpF){if(typeof tmpF==="undefined")return"fnnl";if(tmpF<20){return"fnnl"}else if(tmpF>=20&&tmpF<=24){return"20l"}else if(tmpF>=25&&tmpF<=29){return"20h"}else if(tmpF>=30&&tmpF<=34){return"30l"}else if(tmpF>=35&&tmpF<=39){return"30h"}else if(tmpF>=40&&tmpF<=44){return"40l"}else if(tmpF>=45&&tmpF<=49){return"40h"}else if(tmpF>=50&&tmpF<=54){return"50l"}else if(tmpF>=55&&tmpF<=59){return"50h"}else if(tmpF>=60&&tmpF<=64){return"60l"}else if(tmpF>=65&&tmpF<=69){return"60h"}else if(tmpF>=70&&tmpF<=74){return"70l"}else if(tmpF>=75&&tmpF<=79){return"70h"}else if(tmpF>=80&&tmpF<=84){return"80l"}else if(tmpF>=85&&tmpF<=89){return"80h"}else if(tmpF>=90&&tmpF<=94){return"90l"}else if(tmpF>=95&&tmpF<=100){return"90h"}else if(tmpF>100)return"fpnl";return"fnnl"},temp:function(val,$){if($.isArray(val)&&val.length===2){var tmpF=val[0],tmpC=val[1],tempFVal=this.getTempInc(tmpF),fUnit=(tmpF>=0)?(tmpF+"f"):((tmpF*-1)+"nf"),cUnit=(tmpC>=0)?(tmpC+"c"):((tmpC*-1)+"nc"),tempCVal="cpnl";if(tmpC>60){tempCVal="cpnl"}else if(tmpC%2==0&&tmpC>=0){tempCVal=(tmpC+1)+"ci"}else if(tmpC%2!=0&&tmpC>=0){tempCVal=tmpC+"ci"}else if(tmpC%2==0&&tmpC<0&&tmpC>-9){tempCVal=(tmpC*-1)+"nci"}else tempCVal="cnnl";return(tempFVal+","+fUnit+","+cUnit+","+tempCVal)};return val},tempR:function(val){if(typeof val==="undefined")return"nl";if(val<=31){return"icy"}else if(val>=32&&val<=40){return"cold"}else if(val>=41&&val<=55){return"thaw"}else if(val>=56&&val<=69){return"cool"}else if(val>=70&&val<=79){return"mod"}else if(val>=80&&val<=89){return"warm"}else if(val>=90&&val<=100){return"hot"}else if(val>=101)return"xhot"},snowR:function(val){if(typeof val==="undefined")return"nl";if(val>=1&&val<3){return"1"}else if(val>=3)return"3";return"nl"},cond:function(val){if([31,33].indexOf(val)!=-1){return"clr"}else if([26,27,28,29,30].indexOf(val)!=-1){return"cld"}else if([1,2,5,6,9,11,12,39,40,45].indexOf(val)!=-1){return"rain"}else if([13,14,15,16,41,42,43,46].indexOf(val)!=-1){return"snow"}else if([7,8,10,18].indexOf(val)!=-1){return"ice"}else if([32,34,36].indexOf(val)!=-1){return"sun"}else if([0,3,4,17,35,37,38,47].indexOf(val)!=-1)return"thdr"},baroTendency:function(val){if(val==0){return"stdy"}else if(val==0){return"rsng"}else if(val==0)return"fllng"},snw:function(val){if(val>=1&&val<3){return"1"}else if(val>=3)return"3"},fcst:function(daily,$){var fcst={},prcp={},prcpData12,prcpData24,record,cond={},fiveDayPhrase={},highTemp,lowTemp,highSnow;prcp.prcpStr="";if(daily&&$.isArray(daily)&&daily.length>2){var threeDay=daily.slice(0,3);for(var idx=0,len=(threeDay.length>3?3:threeDay.length);idx<len;idx++){var data=threeDay[idx];prcpData12=(data.pOP12?data.pOP12:"nl");record=((idx*2)+1);prcp[(record+"")]=prcpData12;prcp.prcpStr+=(prcpData12<50)?record+"_0,":record+"_50,";prcpData24=(data.pOP24?data.pOP24:"nl");record=((idx*2)+2);prcp[(record+"")]=prcpData24;prcp.prcpStr+=(prcpData24<50)?record+"_0,":record+"_50,";var dayCondInfo=this.cond(data.sky12),nightCondInfo=this.cond(data.sky12_24);cond[("fc"+((idx*2)+1))]=(dayCondInfo?dayCondInfo:"nl");cond[("fc"+((idx*2)+2))]=(nightCondInfo?nightCondInfo:"nl");if(!highTemp||data.hiTmpF>highTemp)highTemp=data.hiTmpF;highTemp=(!highTemp||data.hiTmpF>highTemp)?data.hiTmpF:highTemp;lowTemp=(!lowTemp||data.loTmpF<lowTemp)?data.loTmpF:lowTemp;var dayTimeSnowInches=data.snwQpf12,nightTimeSnowInches=data.snwQpf12_24;highSnow=(!highSnow||dayTimeSnowInches>highSnow)?dayTimeSnowInches:highSnow;highSnow=(!highSnow||nightTimeSnowInches<highSnow)?nightTimeSnowInches:highSnow};prcp.prcpStr=prcp.prcpStr.substr(0,prcp.prcpStr.length-1);fcst.prcp=prcp;fcst.cond=cond;fcst.tempH=this.getTempInc(highTemp);fcst.tempL=this.getTempInc(lowTemp);fcst.tempHR=this.tempR(highTemp);fcst.tempLR=this.tempR(lowTemp);fcst.fsnw=this.snowR(highSnow)};if(daily&&$.isArray(daily)&&daily.length>4){var fiveDay=daily.slice(0,5);for(var idx=0,len=(fiveDay.length>5?5:fiveDay.length);idx<len;idx++){var data=fiveDay[idx];fiveDayPhrase["d"+(idx+1)]=(data.wrlsWx12?data.wrlsWx12:"nl")};fcst.fiveDay=fiveDayPhrase};return fcst},severe:function(alerts,$){if(alerts&&$.isArray(alerts)&&alerts.length>0){var alertsInfo=[];for(var idx=0,len=alerts.length;idx<len;idx++){var alert=alerts[idx];if(alert&&'BEHdr'in alert&&'bEvent'in alert.BEHdr){var alertEventMetaData=alert.BEHdr.bEvent;if('eSgnfcnc'in alertEventMetaData&&'ePhenom'in alertEventMetaData){var phenomena=alertEventMetaData.ePhenom,significance=alertEventMetaData.eSgnfcnc,alertMap=[{regex:/(^|\s)(CF|LS|FA|FL|EL|FF|HY|TS|RP|TCL|TCO|TGR|TLM|TRA|TCW)(\s|$)/,key:"fld"},{regex:/(^|\s)(HU|HI|TI|TR|TTP|TY)(\s|$)/,key:"trop"},{regex:/(^|\s)(WC|SU|EW|FG|MF|AF|MH|BW|DS|DU|EC|EH|EW|FG|MF|FR|FW|FZ|GL|HF|HT|HW|HZ|LO|LW|MA|SE|MS|SM|UP|WI|ZF|TAD|TCA|TTW|TCD|TCE|TEQ|TEV|TLC|TLA|RB|SC|SI|SW|TNM|TST|TNS|TNU|TOF|TRE|TRF|TRH|TSS|TSG|TSL|TSP|TSF|TNO|TVO|TZO|TOZ|TAQ|TAP|TWA|THT|TFF|TWX)(\s|$)/,key:"oth"},{regex:/(^|\s)(SV|SW|SR|TLM|TSA|TRA|TTS)(\s|$)/,key:"thdr"},{regex:/(^|\s)(TO)(\s|$)/,key:"tor"},{regex:/(^|\s)(BZ|IS|LB|LE|WS|ZR|TAV|WW|TSI|TFA|TLT|TAA)(\s|$)/,key:"wint"}];for(var aidx=0,alen=alertMap.length;aidx<alen;aidx++)if(phenomena.match(alertMap[aidx].regex)){var key=alertMap[aidx].key;alertsInfo.push(key);alertsInfo.push(key+phenomena+significance);break}}}};return alertsInfo};return"nl"},pollen:function(indexData,$){var highVal;$.each(indexData,function(indexType,indexInfo){if(indexInfo&&$.isArray(indexInfo)&&indexInfo.length>0&&'idxPrt1'in indexInfo[0])highVal=(typeof highVal==="undefined"||highVal<indexInfo[0].idxPrt1)?indexInfo[0].idxPrt1:highVal});if(typeof highVal!=="undefined")if(highVal>=4){return"hi"}else if(highVal===2||highVal===3){return"me"}else if(highVal<2)return"lo";return"nl"}}},process:function($){this.setUpWeatherInfo($)},setUpWeatherInfo:function($){var _self=this,currentLocation,getRemainingSeconds=function(currentRecord,existingRemainder){var currentTime=existingRemainder;if(currentRecord.generatedTime&&currentRecord.cacheMaxSeconds&&currentRecord.currentTime)currentTime=(currentRecord.cacheMaxSeconds-(currentRecord.currentTime-currentRecord.generatedTime));return(currentTime<existingRemainder)?currentTime:existingRemainder},processWxData=function(data){TWC.PcoUtils.setTiming('wxPromiseBegin',(new Date()).getTime());if(data&&data.body&&$.isArray(data.body)&&data.body.length>0){var responseMap={},responseBody=data.body;for(var idx=0,len=responseBody.length;idx<len;idx++){var secondsToCache=300,currentRecord=responseBody[idx];if(currentRecord.id&&currentRecord.id.match(/^\/wxd\/v\d{1}\/MORecord\//)){responseMap.obs=(currentRecord.doc&&currentRecord.doc.MOData?currentRecord.doc.MOData:{});secondsToCache=getRemainingSeconds(currentRecord,secondsToCache)}else if(currentRecord.id&&currentRecord.id.match(/^\/wxd\/v\d{1}\/BERecord\//)){responseMap.wxalerts=(currentRecord.doc?currentRecord.doc:[]);secondsToCache=getRemainingSeconds(currentRecord,secondsToCache)}else if(currentRecord.id&&currentRecord.id.match(/^\/wxd\/v\d{1}\/DFRecord\//)){responseMap.daily=(currentRecord.doc&&currentRecord.doc.DFData?currentRecord.doc.DFData:{});secondsToCache=getRemainingSeconds(currentRecord,secondsToCache)}else if(currentRecord.id&&currentRecord.id.match(/^\/wxd\/v\d{1}\/IDRecord\//)){responseMap.indexData=responseMap.indexData||{};if(currentRecord.id.match(/^\/wxd\/v\d{1}\/IDRecord\/(.*)\/11\//)){responseMap.indexData.treepollen=(currentRecord.doc&&currentRecord.doc.IDData?currentRecord.doc.IDData:{});secondsToCache=getRemainingSeconds(currentRecord,secondsToCache)}else if(currentRecord.id.match(/^\/wxd\/v\d{1}\/IDRecord\/(.*)\/12\//)){responseMap.indexData.grasspollen=(currentRecord.doc&&currentRecord.doc.IDData?currentRecord.doc.IDData:{});secondsToCache=getRemainingSeconds(currentRecord,secondsToCache)}else if(currentRecord.id.match(/^\/wxd\/v\d{1}\/IDRecord\/(.*)\/13\//)){responseMap.indexData.weedpollen=(currentRecord.doc&&currentRecord.doc.IDData?currentRecord.doc.IDData:{});secondsToCache=getRemainingSeconds(currentRecord,secondsToCache)}};_self.set("secondsToCache",secondsToCache);_self.set("expirationTime",(new Date().getTime())+(secondsToCache*1e3))};if(responseMap.obs){var obs=responseMap.obs,eUnit=(_self.userRef.get&&_self.userRef.get("unit")==="e");_self.set("dayNight",obs.dyNght);_self.set("relativeHumidity",obs.rH);_self.set("hum",obs.rH);_self.set("windSpeed",obs.wSpdM);_self.set("wind",obs.wSpdM);_self.set("uvIndex",obs.uvIdx);_self.set("uv",obs.uvIdx);_self.set("realTemp",obs.tmpF);_self.set("temp",[obs.tmpF,obs.tmpC]);_self.set("tempR",obs.tmpF);_self.set("wxIcon",obs.sky);if(obs.iconExt)_self.set("wxExtIcon",obs.iconExt);_self.set("cond",obs.sky);_self.set("baroTendency",obs.baroTrnd);_self.set("snw",obs.snwDep)};if(responseMap.daily)_self.set("fcst",responseMap.daily);if(responseMap.wxalerts)_self.set("severe",responseMap.wxalerts);if(responseMap.indexData)_self.set("pollen",responseMap.indexData)};TWC.PcoUtils.setTiming('wxDataEnd',(new Date()).getTime())},getWxData=function(locId){TWC.PcoUtils.setTiming('wxCallMade',(new Date()).getTime());var promise=TWC.PcoUtils.get_dsx_records(["wxd/v2/MORecord/en_US/"+locId,"wxd/v2/DFRecord/en_US/"+locId,"wxd/v2/BERecord/en_US/"+locId,"wxd/v2/IDRecord/en_US/11/"+locId,"wxd/v2/IDRecord/en_US/12/"+locId,"wxd/v2/IDRecord/en_US/13/"+locId],"wxdata_callback");promise.then(function(data){processWxData(data)});promise.fail(function(){_self.setAttributes({error:true})});promise.always(function(){if(_self.customPromise.state()==='resolved'){TWC.Events.getEvent('wx_data_updated').notify()}else{_self.customPromise.resolve();TWC.PcoUtils.setTiming('wxResolved',(new Date()).getTime())}})};$.when.apply($,[].concat(_self.adRef.promises||[])).done(function(){window.wxdata_callback=function(data){processWxData(data);_self.customPromise.resolve()};currentLocation=_self.adRef.get("location");if(!currentLocation){_self.customPromise.resolve();return};if(currentLocation instanceof Object&&currentLocation!==null&&('_id'in currentLocation||('locId'in currentLocation&&'locType'in currentLocation&&'cntryCd'in currentLocation)||('lat'in currentLocation&&'lng'in currentLocation))){var locId=('_id'in currentLocation)?currentLocation._id:(function(){if('locId'in currentLocation&&'locType'in currentLocation&&'cntryCd'in currentLocation){return(currentLocation.locId+":"+currentLocation.locType+":"+currentLocation.cntryCd)}else return(currentLocation.lat+","+currentLocation.lng)})(),currentLocId=_self.get("locId");if(currentLocId===locId){_self.customPromise.resolve();return};_self.set("locId",locId);getWxData(locId)}else _self.customPromise.resolve()});this.promises.push(_self.customPromise)}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/wx.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/ad.js. */
TWC.Ad=TWC.Node.createSubClass({init:function($,arguments){var _self=this;this.nodeName="ad";this.isPersisted=true;this.eventTriggers={location:'ad_location_changed'};this.WX_WindowShadeTransform={"default":'WX_WindowShade',tablet:'WX_Leaderboard'};this.WX_Driver1Transform={"default":'WX_Driver1',tablet:'WX_DriverTablet'};this.WX_DriverUnitTransform={"default":"WX_DriverUnit",tablet:"WX_DriverUnitTablet"};this.WX_EditorialLGTransform={"default":"WX_EditorialLG",tablet:"WX_EditorialSM"};this.possible_ad_modules={admodule:{adtype_param:"admodule",ad_position_key:"",control:"server"},admodule_companion:{adtype_param:"admodule_companion",ad_position_key:"",control:"client"},content_media:{atype_param:"content_media",ad_position_key:"",control:"server"},wxnode_slideshow:{adtype_param:"slideshow",ad_position_key:"wxnode_slideshow_ad_pos",control:"client"},wxnode_content_inset:{adtype_param:"wxnode_content_inset",ad_position_key:"",control:"server"},delivery_units:{adtype_param:"delivery_units",ad_position_key:"",control:"client",collection:"hpdu"},hp_dl_stormdata:{adtype_param:"hp_dl_stormdata",ad_position_key:"",control:"client"},commutercast_map:{adtype_param:"commutercast_map",ad_position_key:"",control:"client"},commutercast_leftrail:{adtype_param:"commutercast_leftrail",ad_position_key:"",control:"client"},hp_countdown:{adtype_param:"hp_countdown",ad_position_key:"",control:"client"},video_player:{adtype_param:"video_player",ad_position_key:"",control:"client"},wxnode_video_player:{adtype_param:"wxnode_video_player",ad_position_key:"",control:"client"},haircast:{adtype_param:"haircast",ad_position_key:"",control:"server"},photos_details:{adtype_param:"photos_details",ad_position_key:"",control:"client"},photos_collection_feed:{adtype_param:"photos_collection_feed",ad_position_key:"",control:"client"},title_video_collection:{adtype_param:"title_video_collection",ad_position_key:"",control:"client"},title_collection_index:{adtype_param:"title_collection_index",ad_position_key:"",control:"client"}}},process:function($,arguments){this.setUpLocalParams($);this.setUpCustomParams($);this.setUpAd($,arguments);this.setUpSevere($);this.setUpUGC();this.setAdsTestCookie($)},setUpLocalParams:function($){var refURLmatch,hostValue,hostParts,hostPartsLength;refURLmatch=document.referrer.match(/http[s]?:\/\/([a-z\.\-]+)/);hostValue=refURLmatch?refURLmatch[1]:"";if(hostValue&&hostValue.indexOf(".")!=-1){hostParts=hostValue.split(".");hostPartsLength=hostParts.length;if(hostPartsLength>1){var startIndex=(hostParts[0]=='www'?1:0),website=hostParts.splice(startIndex,hostPartsLength-startIndex-1).join(".");this.set("refurl",website)}}},setUpCustomParams:function($){var _self=this;TWC.Events.getEvent('wx_data_updated').progress(function(){var cust_params=_self.get('cust_params'),custObj={},wx,adLoc,keyValues,i,targetMap={};cust_params=decodeURIComponent(cust_params);keyValues=cust_params.split("&");for(i=0,l=keyValues.length;i<l;i++){var keyValue=keyValues[i].split("=");targetMap[keyValue[0]]=keyValue[1]};wx=TWC&&TWC.pco&&TWC.pco.get('wx')&&TWC.pco.get('wx').attributes;adLoc=_self.get('location');targetMap.fsnw=wx.fcst.fsnw;targetMap.cnd=wx.cond;targetMap.loc=adLoc.locId;targetMap.dma=adLoc.dmaCd;targetMap.ct=adLoc.cityNm;targetMap.st=adLoc.stCd;targetMap.cc=adLoc.cntryCd;targetMap.cnty=adLoc.cntyNm;targetMap.zip=adLoc.zipCd;targetMap.lat=adLoc.lat;targetMap.lon=adLoc.long;targetMap.tmp=wx.temp;targetMap.tmpr=wx.tempR;targetMap.plln=wx.pollen;targetMap.wind=wx.wind;targetMap.uv=wx.uv;targetMap.hmid=wx.hum;targetMap.sev=wx.severe;targetMap.baro=wx.baroTendency;targetMap.snw=wx.snw;targetMap.fc1=wx.fcst.cond.fc1;targetMap.fc2=wx.fcst.cond.fc2;targetMap.fc3=wx.fcst.cond.fc3;targetMap.d1=wx.fcst.fiveDay.d1;targetMap.d2=wx.fcst.fiveDay.d2;targetMap.d3=wx.fcst.fiveDay.d3;targetMap.d4=wx.fcst.fiveDay.d4;targetMap.d5=wx.fcst.fiveDay.d5;cust_params=JSON.stringify(targetMap);cust_params=cust_params.replace(/,\"/g,"&\"");cust_params=cust_params.replace(/[{}]/g,"");cust_params=cust_params.replace(/"/g,'');cust_params=cust_params.replace(/:/g,"=");cust_params=encodeURIComponent(cust_params);TWC.pco.setNodeValue('ad','cust_params',cust_params);TWC.Events.getEvent('ad_cust_params_changed').resolve()})},setUpAd:function($,arguments){var adPromise=$.Deferred(),_self=this,pageRef=arguments.length>1?arguments[1]:{},userRef=arguments.length>2?arguments[2]:{},device=arguments.length>3?arguments[3]:{},setTypeAndRefreshParams,setTablet,setNone;_self.promises.push(adPromise);TWC.Events.ifReady(['drupalSettingsReady']).done(function(){var i,j,k,l,all_ad_positions=[],ad_video_companions={},DFPSlots={},pos,control,ads_ctrld_clientside={},admodules,collection,adIndx,selectedadpos,transform,pam=_self.possible_ad_modules,instance_id,allAdModules=[],adInstance,modules=Drupal.settings&&Drupal.settings.twc&&Drupal.settings.twc.modules,contexts=Drupal.settings&&Drupal.settings.twc&&Drupal.settings.twc.contexts,instance=Drupal.settings&&Drupal.settings.twc&&Drupal.settings.twc.instance;_self.set("ord",TWC.PcoUtils.genRandStr(16,"0123456789"));_self.set("zone",$('[name=adsmetrics_zone]').attr('value'));var promisesToWait=[].concat(device.promises),pageLocId=window.explicit_location,pageLocation=pageRef.get("currentLocation"),lastVisitedLocation=userRef.get("lastVisitedLocation");if(pageLocId&&!pageLocation)promisesToWait=promisesToWait.concat(pageRef.promises);if(!(promisesToWait.length>1)&&!lastVisitedLocation)promisesToWait=promisesToWait.concat(userRef.promises);$.when.apply($,promisesToWait).then(function(){pageLocation=pageRef.get("currentLocation");lastVisitedLocation=userRef.get("lastVisitedLocation");_self.set("location",(pageLocation&&(!pageLocation.error))?pageLocation:lastVisitedLocation||userRef.get("currentLocation")||null);setTablet=function(positionTransform){pos=adInstance.selectedadpos;if(typeof pos==="object"&&pos.length&&pos.length>0){adIndx=$.inArray(positionTransform["default"],pos);if(adIndx!==-1)pos[adIndx]=positionTransform.tablet}else if(pos===positionTransform["default"])pos=positionTransform.tablet;$(document).ready(function(){$('#'+positionTransform["default"]).attr('id',positionTransform.tablet)})};setNone=function(positionTransform){selectedadpos=adInstance.selectedadpos;if(typeof selectedadpos==="object"&&selectedadpos.length&&selectedadpos.length>0){adIndx=$.inArray(positionTransform["default"],selectedadpos);if(adIndx!==-1)selectedadpos[adIndx]=undefined};if(selectedadpos===positionTransform["default"])selectedadpos=undefined};setTypeAndRefreshParams=function(adInstance,control,adtype_param,ad_position_key){var default_adtype,tablet,viewport,orientation,browserWidth;default_adtype=adtype_param?adtype_param:"default";adInstance.adtype=adInstance.adtype?adInstance.adtype:default_adtype;adInstance.refresh=adInstance.refresh?adInstance.refresh:false;adInstance.refresh=(control==='client')?true:adInstance.refresh;adInstance.selectedadpos=ad_position_key?adInstance[ad_position_key]:adInstance.selectedadpos;adInstance.control=control;pos=adInstance.selectedadpos;pos=(typeof pos==="object"&&pos.length&&pos.length>0)?pos[0]:pos;viewport=device&&device.get('OpenDDRDisplay')&&device.get('OpenDDRDisplay').split('x');orientation=Math.abs(window.orientation)===90?1:0;tablet=(device.get('OpenDDRTablet')==="true");transform=pos+'Transform';if(_self[transform]&&pos===_self[transform]["default"]){if(tablet&&viewport[orientation]>>>0<768){setNone(_self[transform])}else if(tablet&&pos===_self[transform]["default"])setTablet(_self[transform]);if(tablet&&viewport[orientation]>>>0>=768&&tablet&&viewport[orientation]>>>0<1024)setTablet(_self[transform]);browserWidth=jQuery(window).width();if(!tablet&&browserWidth<1064&&browserWidth>=970&&pos==='WX_Driver1')setTablet(_self[transform]);if(!tablet&&browserWidth<970&&browserWidth>=768&&pos!=='WX_DriverUnit'){setTablet(_self[transform])}else if(!tablet&&browserWidth<768)setNone(_self[transform]);if(!tablet&&browserWidth>=768&&browserWidth<1024&&pos==='WX_DriverUnit')setTablet(_self[transform]);if(!tablet&&browserWidth>=768&&browserWidth<1024&&pos==='WX_EditorialLG')setTablet(_self[transform])};return adInstance};if(modules&&modules.page_keywords){var keywordModuleId=modules.page_keywords[0];if(keywordModuleId&&instance&&instance[keywordModuleId]&&instance[keywordModuleId].article_node){var contextKey=instance[keywordModuleId].article_node;if(contextKey&&contexts&&contexts[contextKey]){var nodeContext=contexts[contextKey];if(nodeContext&&nodeContext.field_keywords)_self.set("sponstory",nodeContext.field_keywords)}}};for(ad in pam)if(pam.hasOwnProperty(ad)){admodules=modules&&modules[ad]||[];control=pam[ad].control;if(admodules.length>0){for(i=admodules.length-1;i>=0;i--){adInstance=instance[admodules[i]];adInstance.adtype=adInstance.adtype||"";collection=pam[ad].collection;if(collection&&adInstance[collection]&&adInstance[collection].length){instance_id=admodules[i];for(j=0,k=adInstance[collection].length;j<k;j++)if(adInstance[collection][j].selectedadpos){instance_id=(j===0)?admodules[i]:admodules[i]+"-"+j;adInstance[collection][j][collection]=adInstance[collection];adInstance[collection][j].module_id=adInstance.module_id;setTypeAndRefreshParams(adInstance[collection][j],control,adInstance.adtype);instance[instance_id]=adInstance[collection][j];admodules[j]=instance_id;adInstance=adInstance[collection][j]}}else if(pam[ad].ad_position_key){adInstance=setTypeAndRefreshParams(adInstance,control,adInstance.adtype,pam[ad].ad_position_key)}else adInstance=setTypeAndRefreshParams(adInstance,control,adInstance.adtype);if(!adInstance.selectedadpos||(typeof adInstance.selectedadpos==="object"&&adInstance.selectedadpos.length&&adInstance.selectedadpos.length>0&&!adInstance.selectedadpos[0]))admodules.splice(i,1)};allAdModules=allAdModules.concat(admodules)}};if(!allAdModules||allAdModules.length===0){adPromise.resolve();return};for(i=0,l=allAdModules.length;i<l;i++){adInstance=instance[allAdModules[i]];if(adInstance&&('include_ad'in adInstance)&&adInstance.include_ad===0)continue;pos=(adInstance&&adInstance.selectedadpos&&typeof adInstance.selectedadpos==="string")?[adInstance.selectedadpos]:(adInstance&&adInstance.selectedadpos&&typeof adInstance.selectedadpos==="object"&&adInstance.selectedadpos.length&&adInstance.selectedadpos.length>0)?adInstance.selectedadpos:[];if(adInstance&&adInstance.overwriteadpos)pos=[adInstance.overwriteadpos];for(j=0,k=pos.length;j<k;j++){all_ad_positions.push(pos[j]);if(adInstance&&adInstance.adtype&&adInstance.adtype.match(/companion/)){ad_video_companions[pos[j]]={adtype:adInstance.adtype}}else if(adInstance&&adInstance.control==='client')ads_ctrld_clientside[pos[j]]={adtype:adInstance.adtype};DFPSlots[pos[j]]={adtype:adInstance.adtype,refresh:adInstance.refresh}}};_self.set('all_ad_positions',all_ad_positions);($.isEmptyObject(ad_video_companions))?null:_self.set('ad_video_companions',ad_video_companions);($.isEmptyObject(ads_ctrld_clientside))?null:_self.set('ads_ctrld_clientside',ads_ctrld_clientside);_self.set('DFPSlots',DFPSlots);adPromise.resolve()},function(){_self.set("location",null);adPromise.resolve()});TWC.Events.getEvent('dfpLoaded').done(function(){var slots=_self.get("DFPSlots"),i,l,all_ad_positions=_self.get("all_ad_positions"),do_only_once=true,ads_ctrld_clientside=_self.get("ads_ctrld_clientside"),ad,idx,adpositions=all_ad_positions.slice(0);for(ad in ads_ctrld_clientside){idx=adpositions.indexOf(ad);if(idx>=0)adpositions.splice(idx,1)};var new_ad_positions=[];for(var adidx=0,len=adpositions.length;adidx<len;adidx++)if(adpositions[adidx]!=="NONE")new_ad_positions.push(adpositions[adidx]);googletag.pubads().addEventListener('slotRenderEnded',function(e){if(do_only_once){var key=e.slot.getSlotId().getDomId();slots[key].slot=e.slot;if(key===new_ad_positions[new_ad_positions.length-1]){do_only_once=false;TWC.Events.getEvent('slotRefreshReady').resolve()}}})})})},setUpSevere:function($){if(this.get("severe"))return;var _self=this,cacheBuster=TWC.PcoUtils.genRandStr(),promise=TWC.PcoUtils.get_dsx_records(["cms/settings/content-mode"]),adSeverePromise=$.Deferred();this.promises.push(adSeverePromise);promise.success(function(data,textStatus,jqXHR){if(data&&data.body&&data.body.length&&data.body.length>0&&data.body[0].doc.mode==='severe2'){_self.set('severe',"y")}else _self.set('severe',"n");if(data&&data.body&&data.body.length&&data.body.length>0){var record=data.body[0];if(record.generatedTime&&record.cacheMaxSeconds&&record.currentTime){var remainingTime=(record.cacheMaxSeconds-(record.currentTime-record.generatedTime));if(remainingTime&&remainingTime<0)remainingTime=300;_self.set('expirationTime',(new Date().getTime())+(remainingTime*1e3))}};adSeverePromise.resolve()});promise.error(function(){adSeverePromise.resolve()})},setUpUGC:function(){var pageUrl=window.location.href,ugcMatch=pageUrl.match(/photos\/collection(.*)/);if(ugcMatch&&ugcMatch.length&&ugcMatch.length>1)this.set('ugcLookup',ugcMatch[1])},setAdsTestCookie:function($){var adstest=$.cookie('adstest');this.set('adstest',adstest)},persistAttributes:function(aKey){if(this.isPersisted&&(aKey==="severe"||aKey==="expirationTime"))TWC.LocalStorage.persistValue(this.getPersistKey(),{severe:this.attributes["severe"],expirationTime:this.attributes["expirationTime"]})}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/ad.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/metrics.js. */
TWC.Metrics=TWC.Node.createSubClass({init:function($,arguments){this.nodeName="metrics"},process:function($,arguments){this.setUpMetrics($,arguments)},setUpMetrics:function($,arguments){var attrVal=$('[name=metrics_levels]').attr('value'),metricLevels=attrVal?attrVal.split("/"):null,pagecode=$('[name=pagecode]').attr('value'),that=this,settingsPromise=$.Deferred();if($.isEmptyObject(this.attributes)){this.set("pagename",pagecode);if(metricLevels){this.set("level1",metricLevels[0]);this.set("level2",metricLevels[1]);this.set("level3",metricLevels[2]);this.set("level4",metricLevels[3])};this.set("contentFamily",this.get("level1")+"-"+this.get("level2"));this.set("contentChannel",this.get("contentFamily")+"-"+this.get("level3"));this.set("contentSection",this.get("contentChannel")+"-"+this.get("level4"))};TWC.Events.ifReady(['drupalSettingsReady']).done(function(){var twcsettings=Drupal.settings&&Drupal.settings.twc;if(twcsettings&&twcsettings.meta)that.set("meta",twcsettings.meta);settingsPromise.resolve();TWC.PcoUtils.setTiming('metricsResolved',(new Date()).getTime())});this.promises.push(settingsPromise)}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/metrics.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/twclog.js. */
TWC.Log=TWC.Node.createSubClass((function(){var mem_log={error:{logs:[],size:1e3,limitExceeded:false},debug:{logs:[],size:1e3,limitExceeded:false}}
function pushToMemory(attr,pArguments){var memNode=mem_log[attr];if(pArguments&&pArguments.length>0&&memNode&&!memNode.limitExceeded)memNode.logs.push(Array.prototype.slice.call(pArguments,0));if(memNode.logs.length===memNode.size&&!memNode.limitExceeded){memNode.limitExceeded=true;memNode.logs.push(["Memory limit reached. Logging will be stopped."])}};return{init:function($,arguments){this.nodeName="twclog";this.restrictExtend=true},process:function($){},debug:function(){pushToMemory('debug',arguments)},error:function(){pushToMemory('error',arguments)},print:function(attr){var attrValue=(attr?mem_log[attr].logs:null);if(attrValue&&jQuery.isArray(attrValue))jQuery.each(attrValue,function(idx,val){if('log'in console)if(typeof console.log=="object"){console.log([attr.toUpperCase()+": "].concat(val))}else console.log.apply(console,[attr.toUpperCase()+": "].concat(val))})}}})());;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/twclog.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/performance.js. */
TWC.Performance=TWC.Node.createSubClass((function(){var metrics=[]
function pushToMemory(perfObj){if(metrics.length<=1e3)metrics.push(perfObj)};return{init:function($,arguments){this.nodeName="performance";this.restrictExtend=true},process:function($){},log:function(type,operation,comment){pushToMemory({type:type,operation:operation,comment:comment,timing:(new Date()).getTime()})},log_dsx_call:function(recordUrl,isCached,timeTaken){this.log("DSX_CALL",recordUrl,(isCached?"CACHED":"NETWORK")+(timeTaken?(" (completed in "+timeTaken+"secs)"):""))},format:function(metric){return metric.type+" : "+metric.operation+" : "+metric.comment+" (SNAPSHOT TIME:"+metric.timing+")"},print:function(key){var metricsToDisplay=(key?jQuery.filter(metrics,function(metric){return metric.type===key}):metrics),_self=this;if(metricsToDisplay&&metricsToDisplay.length>0)jQuery.each(metricsToDisplay,function(idx,metric){if('log'in console)console.log(_self.format(metric))})},getAll:function(key){return metrics.slice(0)}}})());;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/nodes/performance.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/themes/radix/plugins/layouts/vegas/../../../js/viewport-changes.js. */
var viewport=document.querySelector("meta[name=viewport]");if(viewport)if((window.screen.width>=768&&window.screen.height>=768)||(TWC&&TWC.Titan)){viewport.setAttribute('content','width=device-width, initial-scale=1.0, minimum-scale=1.0')}else viewport.setAttribute('content','width=768');;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/themes/radix/plugins/layouts/vegas/../../../js/viewport-changes.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/pco.js. */
TWC.initpco=function($,pcoObject,mode,siteId,currlocObj){var PCO=pcoObject||{},set=function(pNode,node,value){pNode[node]=value},setNodes=function(pNode,nodes){$.each(nodes,function(idx,node){set(pNode,node.getNodeName(),node)})},prvlgd={};prvlgd.get=function(node){return prvlgd[node]};prvlgd.setNodeValue=function(nodeName,key,value){prvlgd.get(nodeName).set(key,value)};prvlgd.getNodeValue=function(nodeName,key){return prvlgd.get(nodeName).get(key)};window.twcperf=new TWC.Performance({});var profile=new TWC.Profile({}),user=new TWC.User({}),page=new TWC.Page(PCO.page?PCO.page:{},user),device=new TWC.Device({}),ad=new TWC.Ad({},page,user,device),wx=new TWC.WeatherInfo({},ad,user,page),metrics=new TWC.Metrics({}),products=new TWC.Products({});window.twclog=new TWC.Log({});setNodes(prvlgd,[page,user,device,wx,ad,metrics,products,profile,twclog,twcperf]);var node_setup_promises=[TWC.Events.getDummyDeferredEvent()].concat(page.promises,user.promises,device.promises,wx.promises,ad.promises,metrics.promises,products.promises),node_hooks=[].concat(TWC.node_hooks||[]);for(var count=0;count<node_hooks.length;count++)node_hooks[count](prvlgd,jQuery,node_setup_promises);TWC.PcoUtils.setTiming('pcoWaitForReady',(new Date()).getTime());$.when.apply($,page.promises).done(function(){TWC.PcoUtils.setTiming('pageResolved',(new Date()).getTime())});$.when.apply($,user.promises).done(function(){TWC.PcoUtils.setTiming('userResolved',(new Date()).getTime())});$.when.apply($,device.promises).done(function(){TWC.PcoUtils.setTiming('deviceResolved',(new Date()).getTime())});$.when.apply($,wx.promises).done(function(){TWC.PcoUtils.setTiming('wxResolved',(new Date()).getTime())});$.when.apply($,ad.promises).done(function(){TWC.PcoUtils.setTiming('adResolved',(new Date()).getTime())});$.when.apply($,metrics.promises).done(function(){TWC.PcoUtils.setTiming('metricsResolved',(new Date()).getTime())});$.when.apply($,node_setup_promises).done(function(){TWC.PcoUtils.setTiming('pcoReady',(new Date()).getTime());TWC.Events.getEvent("pcoReady").resolve()});if('preventExtensions'in Object)Object.preventExtensions(prvlgd);return prvlgd};
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/assets/pco/pco.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/background_utils/ad_background.util.js. */
var TWC=window.TWC||{};TWC.Events=TWC.Events||{};TWC.Events.adBgAvailable=TWC.Events.adBgAvailable||jQuery.Deferred();TWC.Events.adBackgroundRemoveClass=TWC.Events.adBackgroundRemoveClass||jQuery.Deferred();TWC.ad_background=TWC.ad_background||{};TWC.ad_background.setBrandingBg=function(bbgObj,transition){var setBkg=true,$=jQuery,trnz=transition?transition:"0.5s",bgType="weather",lsMod='#wx-local-wrap .ls-mod',wrapperDiv='#wx-local-wrap',$lsMod=jQuery(lsMod).parent(),textColor,darkClass,brandingImg,addlCSS,height='100%',ctaImg,ctaImgHt,ctaImgWd,ctaImgX,ctaImgY,clickCta;if(bbgObj&&bbgObj.type&&bbgObj.type==='video'&&!(bbgObj&&(typeof bbgObj.dir==="string")&&bbgObj.bg&&bbgObj.bg.img&&bbgObj.bg["background-size"]&&bbgObj)){setBkg=false}else if(!(bbgObj&&(typeof bbgObj.dir==="string")&&bbgObj.bg&&bbgObj.bg.img&&bbgObj.bg.textcolor&&bbgObj.bg["background-size"]))setBkg=false;if(!setBkg){try{console.log("Missing params in branding background object.")}catch(e){};return};textColor=bbgObj.bg.textcolor;brandingImg=decodeURIComponent(bbgObj.dir+bbgObj.bg.img);addlCSS='background-size: '+bbgObj.bg['background-size']+';';if(bbgObj.type!=="video"){height="490px",ctaImg=bbgObj.cta&&bbgObj.cta.img&&(bbgObj.dir+bbgObj.cta.img)||"";ctaImgHt=bbgObj.cta&&bbgObj.cta.height||0;ctaImgWd=bbgObj.cta&&bbgObj.cta.width||0;ctaImgX=bbgObj.cta&&bbgObj.cta.x||0;ctaImgY=bbgObj.cta&&bbgObj.cta.y||0;clickCta=bbgObj.clicks&&bbgObj.clicks.cta&&decodeURIComponent(bbgObj.clicks.cta)||"";darkClass=(textColor==='dark')?"":"dark",setStyle=function(height){var css4cta='.cta{ position: absolute; bottom:'+ctaImgY+'; right:'+ctaImgX+'}',css4ctaSm='';head=document.head||document.getElementsByTagName('head')[0],style=document.createElement('style'),cssToSet=css4cta;style.type='text/css';if(style.styleSheet){style.styleSheet.cssText=cssToSet}else style.appendChild(document.createTextNode(cssToSet));head.appendChild(style);$lsMod.css('height',height)};setStyle(height)};TWC.weather_background.setBackground(bgType,brandingImg,addlCSS,true,true);if(bbgObj.type!=="video"){$('body').addClass(darkClass)}else{darkClass=(textColor==='dark')?"wx-videobg-light":"";$(wrapperDiv).addClass(darkClass)};$lsMod.append('<a class="cta" href="'+clickCta+'" title="Click to Learn More" target="_blank" style="width:'+ctaImgWd+'; height:'+ctaImgHt+';"><img src="'+ctaImg+'" width="'+ctaImgWd+'" height="'+ctaImgHt+'"></a>')};TWC.Events.adBackgroundRemoveClass.progress(function(toggle){if(toggle)jQuery('#wx-local-wrap').removeClass("wx-videobg-light")});TWC.Events.adBgAvailable.progress(function(obj){if(TWC.pco.getNodeValue('page','content')!=='index'){TWC.ad_background.setBrandingBg(obj)}else if(TWC.ad_background.spotlight_override)TWC.ad_background.setBrandingBg(obj)});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/background_utils/ad_background.util.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/background_utils/weather_background.util.js. */
window.TWC=window.TWC||{};TWC.Events=TWC.Events||{};TWC.weather_background={setBackground:function(bgType,imageOverride,addlCSS,transition,opacityAnimate){addlCSS=addlCSS?addlCSS:"";var twcsettings=Drupal&&Drupal.settings&&Drupal.settings.twc,instancesArray=twcsettings&&twcsettings.instance,contexts=twcsettings&&twcsettings.contexts,modules=(twcsettings&&twcsettings.modules),module=modules&&(modules.background_article||modules.background_index||modules.background_wx_and_video),instance,default_article_image,default_video_image,default_weather_image;if(module&&module.length&&module.length>0&&instancesArray){instance=instancesArray[module[0]];default_article_image=instance&&instance.default_article_image;default_video_image=instance&&instance.default_video_image;default_weather_image=instance&&instance.default_weather_image};var locId,pcollid,userCurrentBg,image,$=jQuery,url,propname,sponsoredBackground=false,oldCollId="",setStyle=function(styleImg){if(!styleImg)return;var css='#wx-wrapper .panel-display #wx-local-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url("'+styleImg+'"); background-position: center; background-size: cover; background-repeat: no-repeat;'+addlCSS+'; }',head=document.head||document.getElementsByTagName('head')[0],style=document.createElement('style'),$el=jQuery("#wx-local-bg"),setCSSInHead=function(style,css,head){style.type='text/css';if(style.styleSheet){style.styleSheet.cssText=css}else style.appendChild(document.createTextNode(css));head.appendChild(style)};if(styleImg.match(/dark/)){jQuery(document).ready(function(){jQuery('body').addClass('dark')})}else jQuery(document).ready(function(){jQuery('body').removeClass('dark')});if(opacityAnimate&&$el.length>0){$el.animate({opacity:0},250,function(){setCSSInHead(style,css,head);$el.animate({opacity:"1"},250)})}else setCSSInHead(style,css,head)},checkLocalStorageImage=function(storedBgImg){if(storedBgImg&&new Date().getTime()<storedBgImg.expirationTime){setStyle(storedBgImg.image);return true};return false},setLightDarkAndStore=function(theImage,propname,settings){TWC.pco.setNodeValue("user",propname,$.extend(settings,{image:theImage,expirationTime:((new Date().getTime())+6e5)}))},getImage=function(bgType,storageSettings){switch(bgType){case"article":url=TWC.Configs.dsx.host+"cms/collections/"+pcollid+"?jsonp=?";propname="article_bg";break;case"weather":url=TWC.Configs.dsx.host+"util/v2/images/mw/"+locId+"?jsonp=?";propname="local_suite_bg";break;default:propname=null};jQuery.ajax({url:url,dataType:"jsonp",async:true,cache:true,data:{api:TWC.Configs.dsx.apiKey},type:"GET",success:function(data){if(data&&data.status&&data.status===200&&data.body&&data.body.length){var dataBody=data.body,selectedIdx=Math.floor(Math.random()*dataBody.length),selectedImg=dataBody[selectedIdx]+"?v=wp&w=1600&h=700";setStyle(selectedImg);setLightDarkAndStore(selectedImg,propname,storageSettings)}else if(data&&data.status&&data.status===200&&data.body&&data.body.background_image){image=data.body.background_image.article;if(image){setStyle(image);setLightDarkAndStore(image,propname,storageSettings)}}}})['always'](function(data){if(data&&data.status&&data.status!==200)if(bgType==="article"){setStyle(default_article_image)}else if(bgType==="weather")setStyle(default_weather_image)})};if(imageOverride){setStyle(imageOverride);return};if(bgType==="weather"&&twcsettings&&twcsettings.contexts&&twcsettings.contexts.is_page_loc){locId=TWC.PcoUtils.getURLlocid();if(!locId.match(/:/)&&locId.indexOf(",")===-1)locId+=":4:US";userCurrentBg=TWC.pco.getNodeValue("user","local_suite_bg");if(userCurrentBg&&userCurrentBg.locId===locId)if(checkLocalStorageImage(userCurrentBg))return;getImage(bgType,{locId:locId})}else TWC.pco.setNodeValue("user","local_suite_bg",null);if(bgType==='article'&&twcsettings&&twcsettings.contexts&&twcsettings.contexts.node){pcollid=twcsettings.contexts.node.field_pcoll;userCurrentBg=TWC.pco.getNodeValue('user','article_bg');if(userCurrentBg&&userCurrentBg.pcollid===pcollid)if(checkLocalStorageImage(userCurrentBg))return;getImage(bgType,{pcollid:pcollid})}else TWC.pco.setNodeValue("user","article_bg",null);if(bgType==='video'){TWC.Events.newAsset=TWC.Events.newAsset||jQuery.Deferred();TWC.Events.newAsset.progress(function(obj){var collectionData=obj.getCollectionData();if(collectionData){var backgroundImage=collectionData.getVideoBackgroundImage()||false;if(oldCollId!==collectionData.getId())if(backgroundImage){TWC.weather_background.setBackground("video",backgroundImage)}else TWC.weather_background.setBackground("video",default_video_image);oldCollId=collectionData.getId();if(collectionData.getSponsored()){sponsoredBackground=true}else sponsoredBackground=false}else TWC.weather_background.setBackground("video",default_video_image)})};if(bgType==='index'&&instance&&instance.collection){var collection=contexts[instance.collection];if(collection&&collection.field_background_image_article&&collection.field_background_image_article.und&&collection.field_background_image_article.und.length&&collection.field_background_image_article.und[0]&&collection.field_background_image_article.und[0].safe_value){bgImage=collection.field_background_image_article.und[0].safe_value;setStyle(bgImage)}else if(instance&&instance.default_index_image){defaultBgImage=instance.default_index_image;setStyle(defaultBgImage)}}}};TWC.Events.drupalSettingsReady=TWC.Events.drupalSettingsReady||jQuery.Deferred();TWC.Events.drupalSettingsReady.done(function(){var modules=window.Drupal&&window.Drupal.settings&&window.Drupal.settings.twc&&window.Drupal.settings.twc.modules;if(modules){var bgModules=modules.background_article||modules.background_index||modules.background_wx_and_video,bgMod,bgType,persistedImgOverride,scheduledImgOverride,startDateStr,endDateStr,startTimeMilliseconds,endTimeMilliseconds,currTimeMilliseconds,valid,bgModInstance=jQuery.isArray(bgModules)&&bgModules.length>0&&bgModules[0];if(bgModInstance){bgMod=window.Drupal.settings.twc.instance[bgModInstance];bgType=bgMod&&bgMod.bg_type;persistedImgOverride=bgMod&&bgMod.image_override;scheduledImgOverride=bgMod&&bgMod.scheduled_image_override;startDateStr=bgMod&&bgMod.startDate;endDateStr=bgMod&&bgMod.endDate;if(startDateStr){TWC.PcoUtils.getDateTimeISO().then(function(currDateTimeISO){var tzOffset=TWC.PcoUtils.getTzOffset(currDateTimeISO)||(new Date().getTimezoneOffset()/60)*-1;startTimeMilliseconds=TWC.PcoUtils.fromISOToDate(TWC.PcoUtils.toISOTimeFormat(startDateStr.substr(0,4)+"-"+startDateStr.substr(4,2)+"-"+startDateStr.substr(6,2)+" 00:00:00",tzOffset)).getTime();endTimeMilliseconds=TWC.PcoUtils.fromISOToDate(TWC.PcoUtils.toISOTimeFormat(endDateStr.substr(0,4)+"-"+endDateStr.substr(4,2)+"-"+endDateStr.substr(6,2)+" 00:00:00",tzOffset)).getTime();currTimeMilliseconds=TWC.PcoUtils.fromISOToDate(currDateTimeISO).getTime();valid=startTimeMilliseconds<currTimeMilliseconds&&(!endTimeMilliseconds||endTimeMilliseconds>currTimeMilliseconds);TWC.weather_background.setBackground(bgType,valid?scheduledImgOverride:persistedImgOverride,'',true)})}else TWC.weather_background.setBackground(bgType,persistedImgOverride,'',true)}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/background_utils/weather_background.util.js. */
