/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/shared_module/shared_module.app.js. */
window.twc=window.twc||{};window.twc.shared={};window.twc.shared.apps=angular.module("shared",["ngTouch","pascalprecht.translate"]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/shared_module/shared_module.app.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/config/config.factory.js. */
twc.shared.apps.provider('twcConfig',function(){var config={},overrideList=[];return{__override__:function(settings){overrideList.push(settings)},add:function(settings){angular.extend(config,settings)},$get:["twcUtil",function(twcUtil){angular.forEach(overrideList,function(overridingSettings){twcUtil.deepExtend(config,overridingSettings)});return config}]}});twc.shared.apps.provider('twcMessage',function(){var config={};return{deepExtend:function(destination){var sources=Array.prototype.slice.call(arguments,1),_self=this;angular.forEach(sources,function(source){angular.forEach(source,function(value,property){if(value&&angular.isObject(value)){destination[property]=destination[property]||{};_self.deepExtend(destination[property],value)}else destination[property]=value})})},add:function(settings){this.deepExtend(config,settings)},getAll:function(key){return config},$get:function(){return config}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/config/config.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/instance/instance.directive.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module("shared",[]);twc.shared.apps.directive('twcController',['$controller','DrupalSettings','$log','PcoPage','$interpolate','$rootScope','pcoUser','$q','twcPco',function($controller,DrupalSettings,$log,PcoPage,$interpolate,$rootScope,pcoUser,$q,twcPco){return{scope:true,replace:false,transclude:false,compile:function(){return{pre:function(scope,elem,attrs){var settings=DrupalSettings.getSettings(attrs.instance),logger=$log.getInstance(attrs.twcController),ret={settings:settings,logger:logger},startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol();angular.extend(ret,{$scope:scope});$q.all(twcPco.get("page").promises.concat(twcPco.get("user").promises)).then(function(){try{var settings=DrupalSettings.getSettings(attrs.instance);angular.forEach(settings,function(value,key){var firstOccurance=value.indexOf(startSymbol);if((firstOccurance!==-1)&&(value.indexOf(endSymbol,(firstOccurance+(startSymbol.length+2)))!==-1))settings[key]=$interpolate(value)($rootScope)})}catch(err){}});$controller(attrs.twcController,ret)}}},controller:["$scope","$element","$attrs","DrupalSettings",function($scope,$element,$attrs,DrupalSettings){$scope.getInstance=function(){var settings=DrupalSettings.getSettings($attrs.instance);return settings}}]}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/instance/instance.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/model/model.class.factory.js. */
twc.shared.apps.factory('TwcModel',['TwcClass','twcUtil',function(TwcClass,twcUtil){return TwcClass.extend({requiredAttrs:[],construct:function(attrs,config){this.attrs=angular.copy(this.defaults)||{};angular.forEach(this.requiredAttrs,function(reqAttr){if(attrs[reqAttr]===undefined)throw'Attribute "'+reqAttr+'" is required!'});this.fromDto(attrs);this.init&&this.init(attrs,config)},fromDto:function(dto){this.set(dto);return this},_get:function(key){if(arguments.length===2){var defaultVal=arguments[1],val=this.attrs[key];if(!val&&val!==defaultVal)this._set(key,defaultVal)};return this.attrs[key]},_set:function(key,val){if(angular.isObject(key)){angular.extend(this.attrs,arguments[0])}else this.attrs[key]=val;return this},get:function(key){var method='get'+twcUtil.capitalize(key);if(this[method]){return this[method].apply(this,twcUtil.rest(arguments))}else return this._get.apply(this,arguments)},set:function(key){if(angular.isObject(key)){var attrs=key,additionalSettings=arguments[1]||{},self=this;angular.forEach(attrs,function(val,key){self.set.apply(self,[key,val].concat(additionalSettings[key]||[]))});return this}else if(key){var method='set'+twcUtil.capitalize(key);if(this[method]){return this[method].apply(this,twcUtil.rest(arguments))}else return this._set.apply(this,arguments)}},mapTo:function(model,attrs,mapRules){mapRules=mapRules||{};var self=this;angular.forEach(attrs,function(fromAttr){var toAttr=mapRules[fromAttr]||fromAttr;model.set(toAttr,self.get(fromAttr))});return model}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/model/model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_init/twc_init.directive.js. */
twc.shared.apps.directive("twcInit",[function(){return{restrict:'AC',compile:function(element,attr){attr.$set('twcInit',undefined);element.removeClass('twc-init')}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_init/twc_init.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/q.loc.js. */
twc.shared.apps.factory('QLocModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({recordType:'QLocRecord',getKey:function(){return this._get('key')},getName:function(){return this._get('name')},setResponse:function(response){this.data=response;this.header="NA"}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/q.loc.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/pco.config.js. */
twc.shared.apps.config(['twcConfigProvider',function(twcConfigProvider){twcConfigProvider.add({pco:{models:{savedLocation:'PcoSavedLocationModel',recentSearchLocation:'PcoSavedLocationModel',wxdMORecordModel:'WxdMORecordModelClass'},createFullUserLocationList:function(user){return(user.getSavedLocations()||[]).concat(user.getRecentSearchLocations()||[])}}})}]).run(['pcoUser',function(pcoUser){window.user=pcoUser}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/pco.config.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/metrics_control/metrics_control.factory.js. */
twc.shared.apps.factory('MetricsControl',['twcPco','twcUtil','customEvent',function(twcPco,twcUtil,customEvent){var func,$=jQuery,metricsReady=customEvent.getEvent('utagReady');func={resetPCO:function($){pcoPage=twcPco.get('page');pcoPage.setUpFV($);pcoPage.setUpPartner($,[null,twcPco.get('user')])},resetMetrics:function(){s.prop39="";s.eVar39=twcPco.getNodeValue("user","partner");s.eVar60=twcPco.getNodeValue("page","partner")}};return{pageView:function(){metricsReady.done(function(){func.resetPCO($);func.resetMetrics();s.t()})}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/metrics_control/metrics_control.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_microdata/twc_microdata.factory.js. */
twc.shared.apps.factory('TwcMicrodata',['twcConstant','$q','$http',function(twcConstant,$q,$http){'use strict';var getDescription=function(){var meta=angular.element(document.querySelector('meta[name="description"]'));return meta&&meta.length>0?meta.attr('content'):'Brought to you by The Weather Channel'},createMicrodata=function(md){angular.forEach(md,function(val,key){if(key==='schema'){updateItemScope(val)}else if(angular.isObject(val)){angular.forEach(val,function(value,key){if(key==='schema'){updateItemScope(value)}else addOrUpdateMeta(value,key)})}else addOrUpdateMeta(val,key)})},updateItemScope=function(val){var html=angular.element(document.querySelector('html'));if(html){html.attr('itemscope','');html.attr('itemtype',val)}},addOrUpdateMeta=function(val,key){if(val===null)return;var meta,mask={fbShareCount:{itemProp:'interactionCount',content:'FacebookLikes'},gplusShareCount:{itemProp:'interactionCount',content:'GooglePlus'}},keyVal={};if(key.indexOf('ShareCount')>0&&mask[key]){keyVal.key=mask[key].itemProp;keyVal.val=mask[key].content+':'+val;meta=angular.element(document.querySelector("meta[content^='"+mask[key].content+"']"))}else{keyVal.key=key;keyVal.val=val;meta=angular.element(document.querySelector('meta[itemprop="'+key+'"]'))};if(meta&&meta.length===0){meta=angular.element('<meta itemprop="'+keyVal.key+'" content="'+keyVal.val+'" />');angular.element('head').append(meta)}else{meta.attr('itemprop',keyVal.key);meta.attr('content',keyVal.val)}},createSecurityPolicy=function(){var meta=angular.element('<meta http-equiv="Content-Security-Policy" content="script-src \'self\' https:\/\/plusone.google.com">');angular.element('head').append(meta)},getShareCount=function(url){var dffb=$q.defer();dffb.resolve({});return[dffb.promise]},twcMicrodata={injectMicrodata:function(obj){var md=obj?obj:{},url=md.url?md.url:window.location.href;$q.all(getShareCount(url)).then(function(response){var fbCount=response&&response.length>0?response[0].total_count:'N/A',twcMd=twcConstant.microdata,schema=md.schema?md.schema:'Organization',schemaUrl=twcMd.url,commonProps={schema:schemaUrl+schema,name:md.name?md.name:'The Weather Channel',description:md.description?md.description:getDescription(),image:md.image?md.image:'http://s.w-x.co/TWC_logo_100x100.gif'},creativeCommon={fbShareCount:fbCount},addressProps={streetAddress:'300 Interstate North Pkwy',addressLocality:'Atlanta, Georgia',postalCode:'30339'},itemType={Organization:{schema:schemaUrl+schema,common:commonProps},VideoObject:{common:commonProps,duration:md.duration?md.duration:null,thumbnailUrl:md.thumbnailUrl?md.thumbnailUrl:null,contentUrl:md.contentUrl?md.contentUrl:null,embedUrl:md.embedUrl?md.embedUrl:null,uploadDate:md.uploadDate?md.uploadDate:null,expires:md.expires?md.expires:null},ImageObject:{common:commonProps,author:md.author?md.author:'The Weather Channel',contentLocation:md.contentLocation?md.contentLocation:'',publishDate:md.publishDate?md.publishDate:''},Article:{schema:schemaUrl+schema,common:commonProps}};createMicrodata(itemType[schema])})}};return twcMicrodata}]);twc.shared.apps.run(['twcConstant','TwcMicrodata','customEvent',function(twcConstant,TwcMicrodata,customEvent){customEvent.getEvent('pcoReady').done(function(){var schema=twcConstant.microdata.schema,meta=angular.element(document.querySelector('meta[property="og:image"]')),canonical=angular.element(document.querySelector('link[rel="canonical"]')),type=TWC.pco.getNodeValue('page','content');switch(type){case'article':case'news':TwcMicrodata.injectMicrodata({schema:schema[type].name,image:meta?meta.attr('content'):null});break;case'video':TwcMicrodata.injectMicrodata({schema:schema[type].name,image:meta?meta.attr('content'):null,thumbnailUrl:meta?meta.attr('content'):null,embedUrl:canonical?canonical.attr('href'):null});break;case'other':if(TWC.pco.getNodeValue('page','pathname')==='ugc'){TwcMicrodata.injectMicrodata({schema:schema.image.name,image:meta?meta.attr('content'):null})}else TwcMicrodata.injectMicrodata();break;default:TwcMicrodata.injectMicrodata();break}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_microdata/twc_microdata.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/back_button_broadcast/back_button_broadcast.factory.js. */
twc.shared.apps.run(["customEvent",function(customEvent){angular.element(window).bind("pageshow",function(event){if(event.originalEvent.persisted)customEvent.getEvent("page-back-event").notify()})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/back_button_broadcast/back_button_broadcast.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/alert_factory/alert_factory.factory.js. */
twc.shared.apps.factory('alertFactory',['$rootScope','$q','PcoPage','twcConfig','dsxclient','twcUtil','datefactory','nwsOfficeIDMapping','wxReadyLinkMapping','$http','customEvent',function($rootScope,$q,PcoPage,twcConfig,dsxclient,twcUtil,datefactory,nwsOfficeIDMapping,wxReadyLinkMapping,$http,customEvent){'use strict';var statusCodes=twcConfig.module_status_codes,moduleStatus=statusCodes.LOADING,bulletinItem,otherAlerts=[],dataRequested=false,nationalAlertsRecord,keys,alertDetails={wxdRecords:twcConfig.dsxclient.wxd.records,config:[],records:[]},alertStatesRecord={wxdRecords:twcConfig.dsxclient.wxd.records,config:[],records:{}},api={getURLSignificance:function(){return TWC.PcoUtils.getURLParameter('significance')||''},getURLPhenomena:function(){return TWC.PcoUtils.getURLParameter('phenomena')||''},getURLEtn:function(){return TWC.PcoUtils.getURLParameter('etn')||''},getAreaId:function(){return TWC.PcoUtils.getURLParameter('areaid')||''},getTWCIId:function(){return TWC.PcoUtils.getURLParameter('tid')||''},getRecordPhenomena:function(){return bulletinItem.getEventPhenomena()},getRecordSignificance:function(){return bulletinItem.getEventSignificance()},getBulletinItem:function(){return bulletinItem},getModuleStatus:function(){return moduleStatus},dataRequested:function(){return dataRequested},configureAlertRecord:function(){alertDetails.bulletin={type:'bulletin',config:{recordType:'wxd',recordName:alertDetails.wxdRecords.alertArea,fullLocId:this.getAreaId()}};alertDetails.alertLocations={type:'alertLocations',config:{recordType:'wxd',recordName:alertDetails.wxdRecords.alertLocations,twcIId:this.getTWCIId()}};keys=twcUtil.keys(alertDetails);twcUtil.each(keys,function(key){if(twcUtil.has(alertDetails[key],'config'))alertDetails.config.push(alertDetails[key].config)})},getHeadline:function(){if(bulletinItem){var headline={desc:function(){return bulletinItem.getEventDescription()},cnty:function(){return bulletinItem.getLocationCounty()},stcd:function(){return bulletinItem.getLocationStateCd()}},fullHeadline=headline.desc()+' for '+headline.cnty()+', '+headline.stcd();return fullHeadline}},getFromString:function(){return PcoPage.attrs.fromStr},getStartTime:function(){var format='';if(bulletinItem&&bulletinItem.getEventStartLocalTime()){var regex=/00/gi,result,indicies=[];while((result=regex.exec(bulletinItem.getEventStartLocalTime())))indicies.push(result.index);if(indicies[0]===11||indicies[0]===14||indicies[0]===11&&indicies[1]===14){format='ha z, EEE, MMM d'}else format='h:mma z, EEE, MMM d';var timeZone=bulletinItem.getLocationTimeZone(),startTime=bulletinItem.getEventStartLocalTime(),validTime=this.getValidTime(startTime,timeZone,format);return validTime}},getEndTime:function(){var format='';if(bulletinItem&&bulletinItem.getEventEndLocalTime()){var regex=/00/gi,result,indicies=[];while((result=regex.exec(bulletinItem.getEventEndLocalTime())))indicies.push(result.index);if(indicies[0]===11||indicies[0]===14||indicies[0]===11&&indicies[1]===14){format='ha z, EEE, MMM d'}else format='h:mma z, EEE, MMM d';var timeZone=bulletinItem.getLocationTimeZone(),endTime=bulletinItem.getEventEndLocalTime(),validTime=this.getValidTime(endTime,timeZone,format);return validTime}},getSeverity:function(){if(bulletinItem)return bulletinItem.getEventSeverity()},getPhenomena:function(){if(bulletinItem)return bulletinItem.getEventPhenomena()},getSignificance:function(){if(bulletinItem)return bulletinItem.getEventSignificance()},getIssTime:function(){if(bulletinItem){var timeZone=bulletinItem.getLocationTimeZone(),issTime=bulletinItem.getIssueTimeLocalISO(),format='EEE, MMM d, h:mm a z',validTime=this.getValidTime(issTime,timeZone,format);return validTime}},getIssuer:function(){if(bulletinItem){var phenomena=this.getRecordPhenomena(),significance=this.getRecordSignificance(),provider='',twc='The Weather Channel',nws='The National Weather Service';if((phenomena!=null&&significance!=null)&&((phenomena==='TTW'&&significance==='TB')||(phenomena==='TEM'&&significance==='TB')||(phenomena==='TLL'&&significance==='TR')||(phenomena==='TWX'&&significance==='TR'))){provider=twc}else provider=nws;return provider}},getIssuerLoc:function(){if(bulletinItem){var officeId=bulletinItem.getEventOfficeId();return nwsOfficeIDMapping.getOfficeName(officeId)}},getValidTime:function(timestamp,timezone,format){var dsxdate=datefactory;if(!timestamp)return null;var date=dsxdate['new'](timestamp,timezone);if(!date)return null;return date.format(format)},verifyRecords:function(){var isValid=true;twcUtil.each(keys,function(key){if(twcUtil.has(alertDetails[key],'config'))if(key==='bulletin')if(!alertDetails.records[key]||!alertDetails.records[key].alerts||!alertDetails.records[key].alerts.length){moduleStatus='expired';customEvent.getEvent('localAlertDetails_alertExpired-event').resolve(true);isValid=false}});return isValid},buildResponseModel:function(response){twcUtil.each(keys,function(key){if(twcUtil.has(alertDetails[key],'config'))alertDetails.records[key]=response.getModel(alertDetails[key].config)})},getLocObject:function(){var loc=alertDetails.records['bulletin'].location;customEvent.getEvent('currentLocInfo-event').resolve(loc);return loc},getCountryCode:function(){return this.getLocObject().countryCode},getValidBulletin:function(){var alertRecords=alertDetails.records['bulletin'].alerts;for(var i=0;i<alertRecords.length;i++){var record=alertRecords[i];if(record.getEventPhenomena()===this.getURLPhenomena()&&record.getEventSignificance()===this.getURLSignificance()&&record.getEventTrackingNumber()===this.getURLEtn()){bulletinItem=record;break}};if(!bulletinItem){moduleStatus='expired';customEvent.getEvent('localAlertDetails_alertExpired-event').resolve(true)}},getOtherAlertsInfo:function(){if(alertDetails.records['bulletin']){var alertRecords=alertDetails.records['bulletin'].alerts;for(var i=0;i<alertRecords.length;i++){var record=alertRecords[i];if(!(record.getEventPhenomena()===this.getURLPhenomena()&&record.getEventSignificance()===this.getURLSignificance()&&record.getEventTrackingNumber()===this.getURLEtn()))otherAlerts.push(record)};var vicinityAlertRecords=alertDetails.records['bulletin'].otherAlerts;for(var j=0;j<vicinityAlertRecords.length;j++)otherAlerts.push(vicinityAlertRecords[j]);otherAlerts=twcUtil.sortBy(otherAlerts,function(o){return o.event.eActionCd__eActionPriority})}else otherAlerts=null},convertBulletinToAlert:function(bulletin,locId){var phenomena=bulletin.getEventPhenomena(),areaId=bulletin.getLocationCd(),etn=bulletin.getEventTrackingNumber(),officeId=bulletin.getEventOfficeId(),significance=bulletin.getEventSignificance(),startTime=bulletin.getEventStartLocalTime(),endTime=bulletin.getEventEndLocalTime(),timeZone=bulletin.getLocationTimeZone(),twciId=bulletin.getTwcIId(),issTime=bulletin.getIssueTimeLocalISO(),alert={},sFormat='',eFormat='',regex=/00/gi,result,startTimeIndex=[],endTimeIndex=[];while((result=regex.exec(startTime)))startTimeIndex.push(result.index);while((result=regex.exec(endTime)))endTimeIndex.push(result.index);if(bulletin.event.eFld){var suffix=bulletin.getFloodEventDescriptionSuffix(),floodLocation=bulletin.getFloodRiverName();if(floodLocation){alert.description=suffix?bulletin.getEventDescription()+' ('+floodLocation+')'+" #"+suffix:bulletin.getEventDescription()+' ('+floodLocation+')'}else alert.description=suffix?bulletin.getEventDescription()+" #"+suffix:bulletin.getEventDescription()}else alert.description=bulletin.getEventDescriptionSuffix()?bulletin.getEventDescription()+' #'+bulletin.getEventDescriptionSuffix():bulletin.getEventDescription();if(startTime)if(startTimeIndex[0]===11||startTimeIndex[0]===14||startTimeIndex[0]===11&&startTimeIndex[1]===14){sFormat='ha z, EEE, MMM d'}else sFormat='h:mma z, EEE, MMM d';if(endTime)if(endTimeIndex[0]===11||endTimeIndex[0]===14||endTimeIndex[0]===11&&endTimeIndex[1]===14){eFormat='ha z, EEE, MMM d'}else eFormat='h:mma z, EEE, MMM d';alert.severity=bulletin.getEventSeverity();alert.validStartTime=this.getValidTime(startTime,timeZone,sFormat);alert.validEndTime=this.getValidTime(endTime,timeZone,eFormat);alert.url=['/weather/alerts/localalerts/l',locId!==null?"/"+locId:'','?phenomena=',phenomena,'&significance=',significance,'&areaid=',areaId,'&office=',officeId,'&etn=',etn,'&tid=',twciId].join('');alert.type='bulletin';alert.issTime=issTime;alert.fromStr=phenomena+"-"+significance;return alert},getHighestPollenIndexValue:function(tree,grass,weed){var maxPollen=0;if(tree)maxPollen=Math.max(maxPollen,tree.getSeverity());if(grass)maxPollen=Math.max(maxPollen,grass.getSeverity());if(weed)maxPollen=Math.max(maxPollen,weed.getSeverity());return maxPollen},getVicinityAlerts:function(){this.getOtherAlertsInfo();return otherAlerts},formatTextForAlerts:function(textBody){var formattedText=[''],index=0;for(var i=0;i<textBody.length;i++){textBody[i]=textBody[i].replace(/[.]{3}/g,'... ');formattedText[index]=formattedText[index]?formattedText[index]+textBody[i]:textBody[i];formattedText[index]+=" ";formattedText[index]=formattedText[index].replace(/amp/,'&&');if(textBody[i+1]===" ")index++};return formattedText},getAlertNarrative:function(){if(bulletinItem){var locale=PcoPage.getLocale(),narrative=bulletinItem.getNarrativeTextByLanguage(locale);narrative=narrative&&this.formatTextForAlerts(narrative);return narrative||null}},getAlertSynopsis:function(){if(bulletinItem){var param=bulletinItem.data.bParameter,synopsis='',self=this,check=function(index){if(param[index]&&param[index].bLabel==='SYNOPSIS'){synopsis=self.formatTextForAlerts(param[index].bLn,param[index].bLn.length)}else synopsis=null};if(check(0)===null)check(1);return synopsis}},getAlertData:function(){dataRequested=true;var self=this;this.configureAlertRecord();var promise=dsxclient.execute(alertDetails.config);promise.then(function(response){self.buildResponseModel(response);if(!(self.getAreaId()&&self.getURLPhenomena()&&self.getURLSignificance())){moduleStatus='expired'}else{if(self.verifyRecords()){self.getValidBulletin();if(self.getModuleStatus()!=='expired')moduleStatus=statusCodes.DEFAULT}else customEvent.getEvent('localAlertDetails_alertExpired-event').resolve(true);customEvent.getEvent('alertFactoryResponse-event').resolve(api)}})['catch'](function(response){moduleStatus='expired'})},setMapLayer:function(){var self=this;$http.get('/sites/all/modules/custom/angularmods/app/shared/alert_factory/alerts_inventory.json').success(function(mapAlertInfo){var layer='radar',zoom,stateCode,alertLayers=[{title:'RADAR',layerName:'radar',type:'ginsu',weight:5,legend:"215x41_radar"},{title:'CLOUDS',layerName:'sat',type:'ginsu',weight:5,legend:"215x41_clouds"},{title:'CLOUDS',layerName:'ussat',type:'ginsu',weight:5,legend:"215x41_clouds"},{title:'FORECASTTEMPS',layerName:'temp',type:'ginsu',weight:5,legend:"215x41_temp",unit:true},{title:'WIND',layerName:'windspeed',type:'ginsu',weight:5,legend:"215x41_wind_speed",unit:true},{title:'DEWPOINT',layerName:'dewpoint',type:'ginsu',weight:5,legend:"215x41_dew_point",unit:true},{title:'RAIN',layerName:'rain',type:'ginsu',weight:5,legend:"215x41_estimated_24hr_precip",unit:true}],mapInfo;mapInfo=twcUtil.findWhere(mapAlertInfo,{phenomena:self.getPhenomena(),significance:self.getSignificance()});if(mapInfo){stateCode=self.getAreaId().length>2?self.getAreaId().substring(0,2):'';if(twcUtil.isConusByCountryState(stateCode,self.getCountryCode())){layer=twcUtil.findWhere(alertLayers,{layerName:mapInfo.conus_overlay||'radar'})}else layer=twcUtil.findWhere(alertLayers,{layerName:mapInfo.nonconus_overlay||'sat'});zoom=mapInfo.default_zoom_level;zoom=zoom>3?zoom:6};if(bulletinItem)customEvent.getEvent('localAlertDetails_info-event').resolve({significance:self.getSignificance(),phenomena:self.getPhenomena(),alertMapLayer:layer,zoom:zoom,offset:bulletinItem.getLocationUTCOffset(),tz:bulletinItem.getLocationTimeZone()})})},dynamicSort:function(property){var sortOrder=1;if(property[0]==="-"){sortOrder=-1;property=property.substr(1)};return function(a,b){var result=(a[property]<b[property])?-1:(a[property]>b[property])?1:0;return result*sortOrder}},getAlertStatesData:function(){alertStatesRecord.config.push({recordType:'wxd',recordName:'AlertsStates'});var promise=dsxclient.execute(alertStatesRecord.config);promise.then(function(response){nationalAlertsRecord=response.getModel(alertStatesRecord.config[0]);if(nationalAlertsRecord&&nationalAlertsRecord.length>1)customEvent.getEvent('nationalAlertStatesReady-event').resolve()})['catch'](function(){moduleStatus='expired'})},getStates:function(){var states=[];if(nationalAlertsRecord.length>0){for(var i=0;i<=nationalAlertsRecord.length-1;i++){var state={stateName:nationalAlertsRecord[i].getStateName(),stateCode:nationalAlertsRecord[i].getStateCode()};states.push(state)};return states.sort(this.dynamicSort("stateName"))}else return null},getAlertLocations:function(){var affectedLocations=alertDetails.records['alertLocations']&&alertDetails.records['alertLocations'].locations,locArray=[];if(affectedLocations)for(var i=0;i<=affectedLocations.length-1;i++){var location=affectedLocations[i].bLoc+", "+affectedLocations[i].bSt+"; ";locArray.push(location)};return affectedLocations?locArray:[]},getEventCategory:function(){return wxReadyLinkMapping.getCategory(this.getURLPhenomena(),this.getURLSignificance())},getEventLinks:function(){var category=this.getEventCategory(),q=$q.defer();customEvent.getEvent('linker_factory_tempScope').then(function(){return q.resolve(wxReadyLinkMapping.getLinks(category))});return q.promise}};return api}]).factory('nwsOfficeIDMapping',function(){nwsOfficeIDMapping={KALY:"Albany, NY",KLWX:"Baltimore/Washington, MD",KBGM:"Binghamton, NY",KBOX:"Boston, MA",KTAR:"Boston, NERFC MA",KBUF:"Buffalo, NY",KBTV:"Burlington, VT",KCAR:"Caribou, ME",KCTP:"State College, PA",KRHA:"State College, MARFC PA",KCHS:"Charleston, SC",KRLX:"Charleston, WV",KILN:"Cincinnati/Wilmington, OH",KTIR:"Cincinnati, OHRFC OH",KCLE:"Cleveland, OH",KCAE:"Columbia, SC",KGSP:"Greenville-Spartanburg, SC",KMHX:"Newport, NC",KOKX:"New York City, NY",KPHI:"Philadelphia, PA",KPBZ:"Pittsburgh, PA",KGYX:"Portland, ME",KRAH:"Raleigh/Durham, NC",KRNK:"Roanoke/Blacksburg, VA",KAKQ:"Wakefield, VA",KILM:"Wilmington, NC",KABQ:"Albuquerque, NM",KAMA:"Amarillo, TX",KFFC:"Atlanta, GA",KALR:"Atlanta, SERFC GA",KEWX:"Austin/San Antonio, TX",KBMX:"Birmingham, AL",KBRO:"Brownsville, TX",KCRP:"Corpus Christi, TX",KFWD:"Dallas/Fort Worth, TX",KFWR:"Fort Worth, WGRFC TX",KEPZ:"El Paso, TX",KHGX:"Houston/Galveston, TX",KHUN:"Huntsville, AL",KJAN:"Jackson, MS",KJAX:"Jacksonville, FL",KMRX:"Knoxville/Tri-Cities, TN",KEYX:"Key West, FL",KKEY:"Key West, FL",KEYW:"Key West, FL",KLCH:"Lake Charles, LA",KLZK:"Little Rock, AR",KLUB:"Lubbock, TX",KMLB:"Melbourne, FL",KMEG:"Memphis, TN",KMFL:"Miami, FL",KMAF:"Midland/Odessa, TX",KMOB:"Mobile, AL",KOHX:"Nashville, TN",KLIX:"New Orleans/Baton Rouge, LA",KORN:"Slidell, LMRFC LA",KOUN:"Oklahoma City, OK",KSJT:"San Angelo, TX",TJSJ:"San Juan, PR",KSHV:"Shreveport, LA",KTAE:"Tallahassee, FL",KTBW:"Tampa Bay/Ruskin, FL",KTSA:"Tulsa, OK",KTUA:"Tulsa, ABRFC OK",KABR:"Aberdeen, SD",KAPX:"Alpena/Gaylord, MI",KBIS:"Bismarck, ND",KCYS:"Cheyenne, WY",KLOT:"Chicago, IL",KDVN:"Davenport/Quad Cities, IA",KBOU:"Denver/Boulder, CO",KDMX:"Des Moines, IA",KDTX:"Detroit, MI",KDDC:"Dodge City, KS",KDLH:"Duluth, MN",KEVV:"Evansville, IN",KFGF:"Fargo/Grand Forks, ND",KGLD:"Goodland, KS",KGJT:"Grand Junction, CO",KGRR:"Grand Rapids, MI",KGRB:"Green Bay, WI",KGID:"Hastings, NE",KIND:"Indianapolis, IN",KJKL:"Jackson, KY",KEAX:"Kansas City/Pleasant Hill, MO",KKRF:"Pleasant Hill, MBRFC MO",KARX:"LaCrosse, WI",KILX:"Lincoln, IL",KLMK:"Louisville, KY",KMQT:"Marquette, MI",KMKX:"Milwaukee/Sullivan, WI",KMPX:"Minneapolis, MN",KMSR:"Chanhassen, NCRFC MN",KLBF:"North Platte, NE",KIWX:"North Webster, IN",KOAX:"Omaha, NE",KPAH:"Paducah, KY",KPUB:"Pueblo, CO",KUNR:"Rapid City, SD",KRIW:"Riverton, WY",KFSD:"Sioux Falls, SD",KSGF:"Springfield, MO",KLSX:"St. Louis, MO",KTOP:"Topeka, KS",KICT:"Wichita, KS",KBYZ:"Billings, MT",KBOI:"Boise, ID",KLKN:"Elko, NV",KEKA:"Eureka, CA",KFGZ:"Flagstaff, AZ",KGGW:"Glasgow, MT",KTFX:"Great Falls, MT",KHNX:"Hanford, CA",KVEF:"Las Vegas, NV",KLOX:"Los Angeles, CA",KMFR:"Medford, OR",KMSO:"Missoula, MT",KPDT:"Pendleton, OR",KPSR:"Phoenix, AZ",KPIH:"Pocatello/Idaho Falls, ID",KPQR:"Portland, OR",KPTR:"Portland, NWRFC OR",KREV:"Reno, NV",KSTO:"Sacramento, CA",KRSA:"Sacramento, CNRFC CA",KSLC:"Salt Lake City, UT",KSTR:"Salt Lake City, CBRFC UT",KSGX:"San Diego, CA",KMTR:"San Francisco/Monterey, CA",KSEW:"Seattle/Tacoma, WA",KOTX:"Spokane, WA",KTWC:"Tucson, AZ",PAFC:"Anchorage, AK",PACR:"Anchorage, APRFC AK",PANT:"Annette Island, AK",PABR:"Barrow, AK",PABE:"Bethel, AK",PACD:"Cold Bay, AK",PAFG:"Fairbanks, AK",PAJK:"Juneau, AK",PAKN:"King Salmon, AK",PADQ:"Kodiak, AK",PAOT:"Kotzebue, AK",PAMC:"McGrath, AK",PAOM:"Nome, AK",PASN:"St. Paul Island, AK",PAVW:"Valdez, AK",PAYA:"Yakutat, AK",PHFO:"Honolulu, HI",PGUM:"Tiyan, GU",NSTU:"Pago Pago, AS",NCDC:"National Climatic Data Center, NC",NCEP:"National Centers for Environmental Prediction, MD",NSSL:"National Severe Storms Laboratory, OK",NDBC:"National Data Buoy Center, MS",KTPC:"Tropical Prediction Center, FL",KNHC:"National Hurricane Center, FL",KHPC:"Hydrometeorological Prediction Center, MD",KWNH:"Hydrometeorological Prediction Center, MD",KAWC:"Aviation Weather Center, MO",KSPC:"Storm Prediction Center, OK",SWPC:"Space Weather Prediction Center, CO",KCPC:"Climate Prediction Center, MD",KOPC:"Ocean (Marine) Prediction Center, MD",KMPC:"Marine (Ocean) Prediction Center, MD",KWNM:"Marine (Ocean) Prediction Center, MD",KWBC:"Telecommunications Operations Center, MD",KWBN:"Telecommunications Operations Center, MD",PAAQ:"West Coast/Alaska Tsunami Warning Center, AK",PHEB:"Pacific Tsunami Warning Center, HI",AAWU:"Alaska Aviation Weather Unit, AK",CPHC:"Central Pacific Hurricane Center, HI",ITIC:"International Tsunami Information Center, HI",KZZZ:"The Weather Channel, GA"};return{getOfficeName:function(officeId){return nwsOfficeIDMapping[officeId]}}}).factory('wxReadyLinkMapping',['linkerFactory',function(linkerFactory){var phenomSigMapping=[["Air Quality","TAP","W"],["Air Quality","TAP","A"],["Air Quality","TAQ","Y"],["Air Quality","TAQ","TL"],["Air Quality","TAQ","W"],["Air Quality","TAQ","A"],["Air Quality","AS","Y"],["Air Quality","TOZ","TA"],["Air Quality","TOZ","TL"],["Air Quality","TOZ","W"],["Earthquakes","TEQ","W"],["Extreme Cold","EC","W"],["Extreme Cold","EC","A"],["Extreme Cold","WC","Y"],["Extreme Cold","WC","W"],["Extreme Cold","WC","A"],["Extreme Heat","EH","W"],["Extreme Heat","EH","A"],["Extreme Heat","HT","Y"],["Flooding","CF","Y"],["Flooding","CF","S"],["Flooding","CF","W"],["Flooding","CF","A"],["Flooding","FF","W"],["Flooding","FF","A"],["Flooding","FA","Y"],["Flooding","FA","TB"],["Flooding","FA","W"],["Flooding","FA","A"],["Flooding","HY","S"],["Flooding","LS","Y"],["Flooding","LS","S"],["Flooding","LS","W"],["Flooding","LS","A"],["Flooding","FL","Y"],["Flooding","FL","W"],["Flooding","FL","A"],["Fog","FG","Y"],["Fog","MF","Y"],["Fog","ZF","Y"],["Frost/Freezes","FZ","W"],["Frost/Freezes","FZ","A"],["Frost/Freezes","FR","Y"],["Frost/Freezes","HZ","W"],["Frost/Freezes","HZ","A"],["General Significant Weather","TNO","TE"],["General Significant Weather","AF","Y"],["General Significant Weather","MH","Y"],["General Significant Weather","AF","W"],["General Significant Weather","TCA","TE"],["General Significant Weather","TCD","W"],["General Significant Weather","TCE","TM"],["General Significant Weather","TEM","TB"],["General Significant Weather","TEV","TB"],["General Significant Weather","THM","W"],["General Significant Weather","TLA","W"],["General Significant Weather","TLC","TE"],["General Significant Weather","LO","Y"],["General Significant Weather","TNU","W"],["General Significant Weather","TRH","W"],["General Significant Weather","TSP","W"],["General Significant Weather","TSG","TL"],["General Significant Weather","TSL","S"],["General Significant Weather","TTW","TB"],["General Significant Weather","-","-"],["General Significant Weather","TVO","W"],["General Significant Weather","TWX","TB"],["General Significant Weather","TWX","TR"],["High Winds","DU","Y"],["High Winds","DS","W"],["High Winds","EW","W"],["High Winds","HW","W"],["High Winds","HW","A"],["High Winds","WI","Y"],["Hurricanes","HU","W"],["Hurricanes","HU","A"],["Hurricanes","HI","W"],["Hurricanes","HI","A"],["Hurricanes","HU","S"],["Hurricanes","TTP","S"],["Hurricanes","TY","W"],["Hurricanes","TY","A"],["Marine","BH","S"],["Marine","BW","Y"],["Marine","TCL","TB"],["Marine","UP","Y"],["Marine","GL","W"],["Marine","GL","A"],["Marine","SE","W"],["Marine","SE","A"],["Marine","UP","W"],["Marine","UP","A"],["Marine","SU","Y"],["Marine","SU","W"],["Marine","HF","W"],["Marine","HF","A"],["Marine","LW","Y"],["Marine","MA","TM"],["Marine","MA","S"],["Marine","RP","S"],["Marine","RB","Y"],["Marine","SC","Y"],["Marine","SI","Y"],["Marine","SW","Y"],["Marine","MA","W"],["Marine","SR","W"],["Marine","SR","A"],["Marine","TS","Y"],["Marine","TS","TB"],["Marine","TS","W"],["Marine","TS","A"],["Severe Weather","TAW","W"],["Severe Weather","TLM","TR"],["Severe Weather","SV","W"],["Severe Weather","SV","A"],["Severe Weather","TSA","W"],["Severe Weather","TSA","A"],["Severe Weather","TSG","Y"],["Tornadoes","TO","W"],["Tornadoes","TO","A"],["Tropical Storms","TR","W"],["Tropical Storms","TR","A"],["Tropical Storms","TI","W"],["Tropical Storms","TI","A"],["Winds/Wildfires","MS","Y"],["Winds/Wildfires","SM","Y"],["Winds/Wildfires","TFI","W"],["Winds/Wildfires","FW","TB"],["Winds/Wildfires","FW","W"],["Winds/Wildfires","FW","A"],["Winter Weather","TAV","TB"],["Winter Weather","TAV","W"],["Winter Weather","TAV","A"],["Winter Weather","BZ","W"],["Winter Weather","BZ","A"],["Winter Weather","ZR","Y"],["Winter Weather","IS","W"],["Winter Weather","LE","Y"],["Winter Weather","LB","Y"],["Winter Weather","LE","W"],["Winter Weather","LE","A"],["Winter Weather","WS","W"],["Winter Weather","WS","A"],["Winter Weather","WW","Y"],["Winter Weather","WW","TB"]],linksMapping=[{category:"EARTHQUAKES",title:"Stay Safe During an Earthquake",url:"/safety/earthquake/news/earthquake-safety-during-20120330",type:"",target:""},{category:"EARTHQUAKES",title:"Earthquake Recovery",url:"/safety/earthquake/news/earthquake-safety-after-20120330",type:"",target:""},{category:"EARTHQUAKES",title:"How to Prepare for Earthquakes",url:"/safety/earthquake/news/earthquake-safety-before-20120330",type:"",target:""},{category:"EARTHQUAKES",title:"Is Your Area At Risk for an Earthquake?",url:"/safety/earthquake/news/earthquake-risk-20120330",type:"",target:""},{category:"EARTHQUAKES",title:"Protect Your Property from a Landslide",url:"/safety/earthquake/news/prepare-for-landslide-20120330",type:"",target:""},{category:"EXTREME HEAT",title:"Ways to Stay Cool During a Heat Wave",url:"/safety/heat/news/wxready-heat-safety-during-20120419",type:"",target:""},{category:"EXTREME HEAT",title:"Conserving Water in a Drought",url:"/safety/heat/news/conserving-water-drought-20120330",type:"",target:""},{category:"EXTREME HEAT",title:"Health Impacts of Extreme Heat",url:"/safety/heat/news/impact-heat-health-20120330",type:"",target:""},{category:"EXTREME HEAT",title:"Heat Hazards for Outdoor Workers",url:"/safety/heat/news/heat-hazards-workers-20120330",type:"",target:""},{category:"EXTREME HEAT",title:"How to Prepare for a Heat Wave",url:"/safety/heat/news/heat-safety-before-20120330",type:"",target:""},{category:"EXTREME COLD",title:"Keep Your Pipes from Freezing",url:"/safety/winter/video/keeps-your-pipes-from-freezing",type:"video",target:""},{category:"EXTREME COLD",title:"Save Money on Heating This Winter",url:"/safety/winter/video/save-money-this-winter",type:"video",target:""},{category:"EXTREME COLD",title:"Winter Home Protection Tips",url:"/safety/winter/news/winter-home-protection-tips-20120423",type:"",target:""},{category:"EXTREME COLD",title:"What to Do If Your Pipes Freeze",url:"/safety/winter/news/your-pipes-freeze-20120404",type:"",target:""},{category:"EXTREME COLD",title:"Is Your Area At Risk For Winter Storms?",url:"/safety/winter/news/are-you-at-risk-20120404",type:"",target:""},{category:"FROST/FREEZES",title:"Preventing Frozen Pipes",url:"/safety/winter/news/preventing-frozen-pipes-20120404",type:"",target:""},{category:"FROST/FREEZES",title:"What to Do If Your Pipes Freeze",url:"/safety/winter/news/your-pipes-freeze-20120404",type:"",target:""},{category:"FROST/FREEZES",title:"Gear Up for Cold Weather",url:"/safety/winter/news/winter-preventative-action-20120601",type:"",target:""},{category:"FROST/FREEZES",title:"Driving in Hazardous Weather",url:"/safety/auto/video/driving-in-all-types-of-weather",type:"video",target:""},{category:"FROST/FREEZES",title:"Current Weather Maps",url:"/maps/current",type:"",target:""},{category:"FLOODING",title:"Power Outage Checklist",url:"/safety/hurricane/news/power-outage-checklist-20120601",type:"",target:""},{category:"FLOODING",title:"Preparing for a Flood",url:"/safety/floods/news/floods-safety-before-20120423",type:"",target:""},{category:"FLOODING",title:"Cleaning Up After a Flood",url:"/safety/floods/news/cleaning-up-after-flood-20120423",type:"",target:""},{category:"FLOODING",title:"Flood Watches and Warnings Explained",url:"/safety/floods/news/flood-watches-warnings-20120423",type:"",target:""},{category:"FLOODING",title:"Preventing Water Damage",url:"/safety/floods/news/preventing-water-damage-20120423",type:"",target:""},{category:"HURRICANES",title:"Power Outage Checklist",url:"/safety/hurricane/news/power-outage-checklist-20120601",type:"",target:""},{category:"HURRICANES",title:"Get Your Roof Hurricane-Ready",url:"/safety/hurricane/video/get-your-roof-ready-for-a-hurricane",type:"video",target:""},{category:"HURRICANES",title:"If a Hurricane Watch or Warning Is Issued",url:"/safety/hurricane/news/hurricanes-safety-during-20120330",type:"",target:""},{category:"HURRICANES",title:"Prepare Your Hurricane Safety Kit",url:"/safety/hurricane/video/get-your-hurricane-kit-ready-now",type:"video",target:""},{category:"HURRICANES",title:"Hurricane Wind and Water Protection",url:"/safety/hurricane/news/wind-and-water-protection-article-20120330",type:"",target:""},{category:"TROPICAL STORMS",title:"Power Outage Checklist",url:"/safety/hurricane/news/power-outage-checklist-20120601",type:"",target:""},{category:"TROPICAL STORMS",title:"Should You Tape Your Windows?",url:"/safety/hurricane/video/should-you-tape-windows-for-hurricane",type:"video",target:""},{category:"TROPICAL STORMS",title:"Getting Rid of Mold After the Storm",url:"/safety/hurricane/video/getting-rid-of-mold-after-a-hurricane",type:"video",target:""},{category:"TROPICAL STORMS",title:"Prepare Your Storm Safety Kit",url:"/safety/hurricane/video/get-your-hurricane-kit-ready-now",type:"video",target:""},{category:"TROPICAL STORMS",title:"Safety Tips During the Storm",url:"/safety/hurricane/news/hurricanes-safety-during-20120330",type:"",target:""},{category:"AIR QUALITY",title:"Protect Your Family From Air Pollution",url:"/health/airquality/news/protect-your-family-air-pollution-20120329",type:"",target:""},{category:"AIR QUALITY",title:"Three Tips for Faster Asthma Relief",url:"/health/airquality/news/3-tips-faster-20120417",type:"",target:""},{category:"AIR QUALITY",title:"Important Asthma Triggers",url:"/health/airquality/news/important-asthma-triggers-20120328",type:"",target:""},{category:"AIR QUALITY",title:"National Forecast",url:"/forecast/national/video/a-national-look-at-the-next-3-days",type:"video",target:""},{category:"AIR QUALITY",title:"Current Weather Maps",url:"/maps/current",type:"",target:""},{category:"FOG",title:"Drive Safely in Foggy Conditions",url:"/safety/auto/news/driving-reduced-visibility-20120423#/2",type:"",target:""},{category:"FOG",title:"Tips to See More Clearly on the Road",url:"/safety/auto/news/bright-idea-check-vehicle-lights-20120712",type:"",target:""},{category:"FOG",title:"Dangers of Driving in Dense Fog",url:"/news/news/fog-driving-travel-danger-20121127",type:"",target:""},{category:"FOG",title:"Safe Driving in All Types of Weather",url:"/safety/auto/video/driving-in-all-types-of-weather",type:"video",target:""},{category:"FOG",title:"Check the Latest Road Weather Conditions",url:"/forecast/commuter?layers=driving",type:"",target:""},{category:"MARINE",title:"Use Wind and Current When Docking",url:"/sports-recreation/boat-beach/news/motor-boat-wind-current-docking-20120418",type:"",target:""},{category:"MARINE",title:"Docking in Heavy Winds",url:"/sports-recreation/boat-beach/news/docking-in-heavy-winds-20120328",type:"",target:""},{category:"MARINE",title:"Rip Current Overview",url:"/health/news/nasty-ways-summer-can-hurt-your-health-20140630#/2",type:"",target:""},{category:"MARINE",title:"Crucial Tips to Avoid Lightning Strikes",url:"/sports-recreation/boat-beach/news/motor-boat-lightning-strikes-20120420",type:"",target:""},{category:"MARINE",title:"Interactive Boating Map (Intellicast)",url:"http://www.intellicast.com/Marine/Boating.aspx",type:"",target:"external"},{category:"SEVERE WEATHER",title:"Be Prepared for Severe Storms",url:"/news/tstorms-lightning-hail-before-20120423",type:"",target:""},{category:"SEVERE WEATHER",title:"Safety Tips During Severe Weather",url:"/safety/news/wxr008",type:"",target:""},{category:"SEVERE WEATHER",title:"Stay Safe After a Severe Storm Passes",url:"/news/tstorms-lightning-hail-after-20120423",type:"",target:""},{category:"SEVERE WEATHER",title:"Watches vs. Warnings; What's the Difference?",url:"/safety/thunderstorms/news/watch-vs-warning-whats-difference-20140409",type:"",target:""},{category:"SEVERE WEATHER",title:"Lightning Safety Tips",url:"/news/lightning-safety-tips-20120426",type:"",target:""},{category:"TORNADOES",title:"Tornado Watches and Warnings Explained",url:"/news/tornado-watches-warnings-20120330",type:"",target:""},{category:"TORNADOES",title:"What to Do if a Tornado Threatens",url:"/safety/tornado/news/tornadoes-safety-during-20120330",type:"",target:""},{category:"TORNADOES",title:"Safety Tips After the Storm",url:"/safety/tornado/news/tornadoes-safety-after-20120330",type:"",target:""},{category:"TORNADOES",title:"What to Include in a Disaster Supply Kit",url:"/safety/tornado/news/disaster-supply-kit-20120330",type:"",target:""},{category:"TORNADOES",title:"Tornado Safety Myths vs. Facts",url:"/storms/tornado/news/tornado-safety-red-cross-20140408",type:"",target:""},{category:"WINDS AND WILDFIRES",title:"Practice Wildfire Safety",url:"/news/wind-wildfires-safety-before-20120330",type:"",target:""},{category:"WINDS AND WILDFIRES",title:"What to Do if a Wildfire Threatens",url:"/news/wind-wildfires-safety-during-20120330",type:"",target:""},{category:"WINDS AND WILDFIRES",title:"Safety After a Wildfire",url:"/news/wind-wildfires-safety-page-20120330",type:"",target:""},{category:"WINDS AND WILDFIRES",title:"Inspecting Your Home After a Wildfire",url:"/news/wildfire-inpsect-home-20120601",type:"",target:""},{category:"WINDS AND WILDFIRES",title:"Are You at Risk for a Wildfire?",url:"/news/wildfires-risk-20120330",type:"",target:""},{category:"HIGH WINDS",title:"Be Prepared for High Winds",url:"/news/what-high-winds-20120330",type:"",target:""},{category:"HIGH WINDS",title:"General Driving Safety Tips",url:"/safety/auto",type:"",target:""},{category:"HIGH WINDS",title:"Check the Latest Road Weather Conditions",url:"/forecast/commuter?layers=driving",type:"",target:""},{category:"HIGH WINDS",title:"Interactive Wind Map",url:"/weather/map/interactive/l/{{dynamicLocId}}?layers=wind",type:"",target:""},{category:"HIGH WINDS",title:"More Current Weather Maps",url:"/maps/current",type:"",target:""},{category:"WINTER WEATHER",title:"Be Ready Before Wintry Weather Hits",url:"/safety/winter/news/winter-weather-safety-before-20120330",type:"",target:""},{category:"WINTER WEATHER",title:"Safety Tips During the Storm",url:"/safety/winter/news/storms-during-the-storm-20120416",type:"",target:""},{category:"WINTER WEATHER",title:"Ways to Stay Safe After a Winter Storm",url:"/safety/winter/news/winter-weather-safety-after-20120404",type:"",target:""},{category:"WINTER WEATHER",title:"Types of Winter Precipitation",url:"/safety/winter/news/types-winter-precipitation-20120423",type:"",target:""},{category:"WINTER WEATHER",title:"View Live Traffic and Commute Forecasts",url:"/forecast/commuter?layers=radar",type:"traffic",target:""},{category:"GENERAL SIGNIFICANT WEATHER",title:"All Severe Weather Safety Tips",url:"/safety",type:"",target:""},{category:"GENERAL SIGNIFICANT WEATHER",title:"See More Weather Alerts",url:"/storms/alerts",type:"",target:""},{category:"GENERAL SIGNIFICANT WEATHER",title:"Severe Weather News",url:"/storms/severe",type:"",target:""},{category:"GENERAL SIGNIFICANT WEATHER",title:"Watches & Warnings Explained",url:"/safety/thunderstorms/news/watch-vs-warning-whats-difference-20140409",type:"",target:""},{category:"GENERAL SIGNIFICANT WEATHER",title:"National Forecast",url:"/forecast/national/video/a-national-look-at-the-next-3-days",type:"video",target:""}];return{getCategory:function(phenomenon,significance){for(var i=0;i<=phenomSigMapping.length-1;i++){var phenomSigRow=phenomSigMapping[i];if(phenomSigRow[1]===phenomenon&&phenomSigRow[2]===significance)return phenomSigRow[0]};return null},getLinks:function(category){var linkArray=[];for(var i=0;i<=linksMapping.length-1;i++){var linkRow=linksMapping[i];if(linkRow.category.toLowerCase()===category.toLowerCase())linkArray.push({category:linkRow.category,title:linkRow.title,url:linkerFactory.interpolateLinkUrl(linkRow.url),type:linkRow.type||'article',target:linkRow.target||'internal'})};return linkArray}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/alert_factory/alert_factory.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/app_config/app.config.js. */
twc.shared.apps.config(['twcConfigProvider',function(twcConfigProvider){twcConfigProvider.add({module_status_codes:{LOADING:"loading",NOT_AVAILABLE:"na",ERROR:"error",DEFAULT:"default"}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/app_config/app.config.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_logger/twc_logger.factory.js. */
twc.shared.apps.factory('twcLogger',function(){return function($delegate){var timestamp=new Date(),getTime=function(){var t=new Date(),y=1900+t.getYear(),m=t.getMonth()+1;return m+'/'+t.getDate()+'/'+y+' '+t.getHours()+':'+t.getMinutes()+':'+t.getSeconds()+':'+t.getMilliseconds()};return{getInstance:function(className){className=className?className:'';return{log:function(){$delegate.log('LOG:  '+getTime()+' - '+className+'::',arguments)},debug:function(){$delegate.debug('DEBUG:  '+getTime()+' - '+className+'::',arguments)},warn:function(){$delegate.log('WARN:  '+getTime()+' - '+className+'::',arguments)},info:function(){$delegate.log('INFO:  '+getTime()+' - '+className+'::',arguments)},error:function(){var payload={url:location.href,agent:navigator.userAgent,stackTrace:arguments};$delegate.debug('ERROR:  '+getTime()+' - '+className+'::',payload);TWC.pco.twclog.error(getTime()+' - '+className+'::',payload)},group:function(){console.group('INFO:  '+getTime()+' - '+className+'::',arguments)},groupEnd:function(){console.groupEnd()},setClassName:function(name){className=name}}},error:$delegate.error,debug:$delegate.debug,info:$delegate.info,log:$delegate.log,warn:$delegate.warn}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_logger/twc_logger.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_logger/twc_logger.config.js. */
twc.shared.apps.config(['$provide','$logProvider',function($provide,$logProvider){$logProvider.debugEnabled(!!(TWC&&TWC.Configs&&TWC.Configs.debug));$provide.decorator('$log',['$delegate','twcLogger',function($delegate,twcLogger){return twcLogger($delegate)}])}]);twc.shared.apps.run(["$rootScope","$log",function($rootScope,$log){$rootScope.$log=$log}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_logger/twc_logger.config.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/xweb.webloc.js. */
twc.shared.apps.factory('XwebWebLocModelClass',['RecordModel','twcUtil','twcConstant',function(RecordModel,twcUtil,twcConstant){return RecordModel.extend({recordType:'WebLoc',isCacheable:false,setResponse:function(response){this.data=response;this.header="NA"},getFormattedName:function(isMobile,longRc){var locTypes=twcConstant.locTypes,types=[locTypes.Airports,locTypes.Ski,locTypes.Golf,locTypes.Lakes,locTypes.Outdoor,locTypes.Parks],country=this.getCountryCode()==='US'&&this.getLocType()===1||this.getCountryCode()!=='US'?twcUtil.capitalize(this._get('_country'),true):'',regionName=this.getStateCode().length>0?country.length>0?twcUtil.capitalize(this.getState(),true,true)+', ':twcUtil.capitalize(this.getState(),true,true):'',region=longRc?regionName+country:this._get('stCd'),presName=twcUtil.capitalize(this.getCity(),true,true),name3=types.indexOf(this.getLocType())>=0&&this.getParentCity()?this.getParentCity()+', ':'',name1=this.getCity()+', '+name3+region,zip=this.getLocId(),zipSearch=this.getLocType()===locTypes.Zips&&(twcUtil.isNumeric(zip)||this.getCountryCode()!=='US')?' ('+zip+')':'',name,name2;if(TWC&&TWC.Titan&&TWC.Titan.locale){name2=regionName.length>0?presName+(this._get('stCd')!==''&&this._get('stCd')!=='*'?', '+this._get('stCd'):''):presName;name=this.getCountryCode()==='US'?name1+zipSearch:twcUtil.capitalize(name2+(zipSearch.length>0?" "+zipSearch:""),false)+', '+country}else{name2=regionName.length>0?presName+', '+name3+this._get('stNm'):presName;name=this.getCountryCode()==='US'?name1+zipSearch:twcUtil.capitalize(name2,true,true)+', '+country};return name},isBigCity:function(){return this._get('bigCity')},getCityName:function(){return this._get('cityNm')},getNickname:function(){return this._get('nickname')},getCountryCode:function(){return this._get('cntryCd')},getKey:function(){return this._get('key')},getCountryName:function(){return this._get('_country')},getLocId:function(){return this._get('locId')},getLocType:function(){return this._get('locType')},getPresName:function(){return this._get('prsntNm')},getRegionCode:function(){return this._get('stCd')},getRegionName:function(){return this._get('stNm')},getStateName:function(){return this.getRegionName()},getStateCode:function(){return this._get('stCd')?this._get('stCd'):''},getParentCity:function(){return this._get('parentCity')},getState:function(){return this._get('stNm')?this._get('stNm'):''},getCity:function(){return this._get('cityNm')},getCountry:function(){return this._get('_country')},getAddress:function(){return this._get('addr')}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/xweb.webloc.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/base_search_controller/base_search_controller.controller.js. */
twc.shared.apps.controller('baseSearchController',['$scope','$injector','$q','customEvent','dsxclient','twcConfig','twcUtil','pcoUser','$filter','twcConstant',function($scope,$injector,$q,customEvent,dsxclient,twcConfig,twcUtil,pcoUser,$filter,twcConstant){'use strict';var logger=$scope.$root.$log.getInstance('baseSearchController'),LocModelClass=$injector.has('WxdLocModelClass')&&$injector.get('WxdLocModelClass'),XwebModelClass=$injector.has('XwebWebLocModelClass')&&$injector.get('XwebWebLocModelClass'),updateLocation=function(item,type,add){if(!LocModelClass)return;var loc=new LocModelClass({cntryCd:item.getCountryCode(),locId:item.getLocId(),locType:item.getLocType(),cityNm:twcUtil.capitalize(item.getCity(),true,true),bigCity:item.isBigCity(),stCd:item.getStateCode(),stNm:item.getState(),prsntNm:item.getFormattedName(),_country:item.getCountryName(),nickname:item.getNickname()||'',recentSearch:type==='recentSearch'?true:false},'WxdLocModelClass');if(type==='recentSearch'){if(add){pcoUser.addRecentSearchLocation(loc)}else pcoUser.removeRecentSearchLocation(loc)}else if(type==='saveLocation'){if(add){pcoUser.addSavedLocation(loc)}else pcoUser.removeSavedLocation(loc)}else pcoUser.updateLocation(loc)},createModel=function(locModel){if(locModel.getCity&&locModel.getStateCode&&locModel.getCountry&&locModel.getCountryCode&&locModel.getLocType){return new XwebModelClass({name:locModel.getCity()+', '+locModel.getStateCode()+', '+locModel.getCountry(),key:locModel.getFullLocId(),locId:locModel.getLocId(),locType:locModel.getLocType(),cntryCd:locModel.getCountryCode(),_country:locModel.getCountry(),stCd:locModel.getStateCode(),stNm:locModel.getState()||'',cityNm:locModel.getCity()||'',bigCity:locModel.getBigCity&&locModel.getBigCity()||false,nickname:locModel.getNickname&&locModel.getNickname()||'',recentSearch:true},'XwebWebLocModelClass')}else return null},notify=function(type){if(params&&params.notifier)customEvent.getEvent(params.notifier).notify(type)};customEvent.getEvent('pcoReady').then(function(e){$scope.$evalAsync(function(){params.recentSearches=null;params.savedLocations=null})});customEvent.getEvent('locations_changed').progress(function(e){if(e.key==='savedLocations'){$scope.$evalAsync(function(){params.savedLocations=null});notify('saved')}else if(e.key==='recentSearchLocations'){$scope.$evalAsync(function(){params.recentSearches=null});notify('recent')}});var localeToMinCharOverride={ar_AE:"2",bn_BD:"2",en_GB:"2",fa_IR:"2",hi_IN:"2",iw_IL:"2",ja_JP:"2",ko_KR:"2",th_TH:"2",uk_UA:"2",ur_PK:"2",zh_HK:"2"},localeToCountry={ar_AE:"ae",bn_BD:"bd",ca_ES:"sp",cs_CZ:"ez",da_DK:"da",de_DE:"gm",el_GR:"gr",en_GB:"uk",en_US:"us",es_US:"us",fa_IR:"ir",fi_FI:"fi",fr_FR:"fr",he_IL:"is",hi_IN:"in",hr_HR:"hr",hu_HU:"hu",in_ID:"id",it_IT:"it",iw_IL:"is",ja_JP:"ja",kk_KZ:"kz",ko_KR:"ks",ms_MY:"my",nl_NL:"nl",no_NO:"no",pl_PL:"pl",pt_BR:"br",ro_RO:"ro",ru_RU:"rs",sk_SK:"lo",sv_SE:"sw",th_TH:"th",tl_PH:"ph",tr_TR:"tu",uk_UA:"up",ur_PK:"pk",vi_VN:"vm",zh_HK:"hk"};$scope.getMinChar=function(locale){return localeToMinCharOverride[locale]||"3"};$scope.getBoostCountry=function(locale){return localeToCountry[locale]||"us"};$scope.config=[{}];$scope.params={minChar:$scope.getMinChar((TWC&&TWC.Titan&&TWC.Titan.locale)),resultLimit:10,dsx:twcConfig.dsxclient,locTypes:'',xwebRecords:twcConfig.dsxclient.xweb.records,wxdRecords:twcConfig.dsxclient.wxd.records,noResult:'No results found.',settings:{},moduleId:'',resultType:'',recentSearches:null,savedLocations:null,locArr:[],suppressRecentSearches:false,notifier:null,isIE8:angular.element('html').hasClass('lt-ie9'),titan_locale:(TWC&&TWC.Titan&&TWC.Titan.locale)||"en_US"};var params=$scope.params;$scope.term='';$scope.getXwebLocFromLoc=function(loc){return createModel(loc)};$scope.showRecentSearches=function(){return $scope.params.suppressRecentSearches===true?'Suppressed':'Recent'};$scope.createLocArray=function(locTypes){angular.forEach(locTypes,function(k,v){params.locArr.push(k)});params.locArr.sort(function(a,b){return a-b});angular.forEach(params.locArr,function(loc){params.locTypes+=loc+'/'})};$scope.noResultError=function(){params.resultType='NoResult';$scope.results=[{result:params.noResult}];customEvent.getEvent('search-with-noresults').resolve({item:{result:params.noResult,autoSelect:true}})};$scope.goSelectItem=function(item){logger.debug('This function needs to be overridden.')};$scope.getRecentSearches=function(){if(!params.recentSearches){var recentSearchLocs=pcoUser.getRecentSearchLocations();if(recentSearchLocs){params.recentSearches=[];angular.forEach(recentSearchLocs,function(recentSearchLoc){var model=createModel(recentSearchLoc);if(!!model)params.recentSearches.push(model)})}};return params.recentSearches};$scope.getSavedLocations=function(){if(!params.savedLocations){var savedLocs=pcoUser.getSavedLocations();if(savedLocs){params.savedLocations=[];angular.forEach(savedLocs,function(savedLoc){var model=createModel(savedLoc);if(!!model){model.data.recentSearch=false;params.savedLocations.push(model)}})}};return params.savedLocations};$scope.saveRecentSearch=function(item){params.recentSearches=null;updateLocation(item,'recentSearch',true)};$scope.saveSavedLocation=function(item){updateLocation(item,'saveLocation',true)};$scope.updateSavedLocation=function(item){updateLocation(item,'updateLocation',true)};$scope.removeSavedLocation=function(item){updateLocation(item,'saveLocation',false)};$scope.removeRecentSearch=function(item){updateLocation(item,'recentSearch',false)};$scope.ensureUrlSlash=function(url){if(!url.match(/^\//))url='/'+url;return url.match(/\/$/)?url:url+='/'};$scope.validatePageUrl=function(url){var page=twcConstant.pageUrl[params.moduleId]['page'];url=url?url:'/weather/today/l/';if(page==='dynamic')twcConstant.pageUrl[params.moduleId]['page']=$scope.ensureUrlSlash(url)};$scope.landingPage=function(key,item){$scope.addToRecentSearch.apply($scope,[item,'deferLandingPage'])};$scope.deferLandingPage=function(key){var theKey=typeof key==='object'?key.getKey():key;location.href=twcConstant.pageUrl[params.moduleId]['page']+theKey};$scope.addToRecentSearch=function(item,callback){var key=item.getKey&&item.getKey()||item.getFullLocId&&item.getFullLocId();if(item&&!!item.data&&!$filter('twcFilter').getByProperty('key',key,$scope.getRecentSearches())&&!$filter('twcFilter').getByProperty('key',key,$scope.getSavedLocations())){var rs=$scope.getRecentSearches();customEvent.getEvent('locations_changed').progress(function(e){if(e.locations.length===10||e.locations.length>rs.length)$scope[callback](item)});$scope.saveRecentSearch(item)}else $scope[callback](item)};$scope.getLocationByZip=function(zip){var df=$q.defer();$scope.config=[{recordType:"xweb",recordName:params.xwebRecords.webLoc,locTypes:'4/US/'+zip,locale:params.titan_locale}];try{dsxclient.execute($scope.config).then(function(response){df.resolve(response)})}catch(e){logger.error(e.message);df.reject(e.message)};return df.promise};$scope.getLocationByLocId=function(locId){var df=$q.defer();$scope.config=[{recordType:"wxd",recordName:params.wxdRecords.loc,fullLocId:locId,locale:params.titan_locale}];try{dsxclient.execute($scope.config).then(function(response){df.resolve(response)})}catch(e){logger.error(e.message);df.reject(e.message)};return df.promise};$scope.tracking=function(from,track){if(from&&from.length>0)customEvent.getEvent('from-string-event').notify({settings:params.settings,fromStr:from});if(track&&track.length>0)customEvent.getEvent('track-string-event').notify({settings:params.settings,trackStr:track})};$scope.recentSearches=function(){return $scope.getRecentSearches()};$scope.resultType=function(){return params.resultType};$scope.getPresName=function(index){var item=$scope.results[index];return!!item.getFormattedName?item.getFormattedName($scope.$root.isMobile):''};$scope.hasResults=function(){if(!$scope.term){$scope.results=$scope.recentSearches();params.resultType=$scope.showRecentSearches()};return $scope.results&&$scope.results.length>0?true:false};$scope.selectItem=function(item,enter){var term=$scope.term;if(term.length>=params.minChar||term.length===0){if(enter===true&&!twcUtil.isNumeric(term)){customEvent.ifReady(['search-in-progress']).then(function(e){customEvent.removeEvent('search-in-progress');$scope.goSelectItem(e.item)})}else $scope.goSelectItem(item)}else if(term.length<=2){$scope.goSelectItem(item)}else customEvent.ifReady(['search-with-noresults']).then(function(e){customEvent.removeEvent('search-with-noresults');$scope.goSelectItem(e.item)})};$scope.search=function(term){params.resultType='Computing';var boostCountryCd=$scope.getBoostCountry(params.titan_locale);$scope.results=[{result:'Searching...'}];if(term&&term.length>=params.minChar&&!twcUtil.isNumeric(term)){var config=$scope.config[0];config.locTypes=params.locTypes;config.country={code:boostCountryCd,boost:true};config.term=term;config.locale=params.titan_locale;try{dsxclient.execute($scope.config,{pg:'0,'+params.resultLimit}).then(function(response){params.resultType='Search';var res=response.getModel({recordType:"xweb",recordName:params.xwebRecords.webLoc,locTypes:params.locTypes,term:term,locale:params.titan_locale,country:{code:boostCountryCd,boost:true}});if(res&&res.length>0){$scope.results=res.length>10?res.splice(0,10):res}else $scope.noResultError()})}catch(e){$scope.noResultError();logger.error(e.message)}}else if(twcUtil.isNumeric(term)&&term.length===5){if(params.locArr.indexOf('1')<0){$scope.noResultError()}else $scope.getLocationByZip(term).then(function(response){params.resultType='Search';var res=response.getModel({recordType:"xweb",recordName:params.xwebRecords.webLoc,locale:params.titan_locale,locTypes:'4/US/'+term});if(res&&res.length===1){$scope.results=res}else $scope.noResultError()})}else{params.resultType=$scope.showRecentSearches();if(term.length!==0&&$scope.results.length>0){params.resultType='NoResult';$scope.$evalAsync(function(){$scope.results=twcUtil.isNumeric(term)&&term.length===5?[]:[{result:params.noResult}]})}else if(term.length===0)$scope.results=$scope.getRecentSearches()}}.debounce(200)}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/base_search_controller/base_search_controller.controller.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_typeahead/twc_typeahead.directive.js. */
twc.shared.apps.directive('twcTypeahead',['$timeout','$log','$swipe','$rootScope','twcConstant','customEvent','twcUtil','aliases',function($timeout,$log,$swipe,$rootScope,twcConstant,customEvent,twcUtil,aliases){'use strict';var ascii=twcConstant.ascii;return{restrict:'EA',transclude:true,replace:true,templateUrl:function(element,attrs){var templatePath='/sites/all/modules/custom/angularmods/app/shared/twc_typeahead/templates/',device=$rootScope.isMobile?'nemo':'global',template=attrs.template,basicTemplate=(angular.element('html').hasClass('lt-ie9')||angular.element('html').hasClass('ie-9'))?'_twc_typeahead_ie8.html':'_twc_typeahead_basic.html';basicTemplate=template?template+'.html':basicTemplate;return attrs.template?templatePath+attrs.template+'.html':templatePath+device+basicTemplate},scope:{search:'&',term:'=',select:'&',items:'=',pattern:'@',formClass:'@',iconClass:'@',placeholderText:'@',validateClass:'@',tooltip:'@',inputClass:'@',containerClass:'@',hideSearchIcon:'='},controller:["$scope",function($scope){$scope.goSearch=function(){$scope.itemsHidden=false;$scope.search({term:$scope.term})};$scope.isHighLighted=function(){return!$scope.itemsHidden&&($scope.mouseOver||$scope.hasFocus)};this.get$scope=function(){return $scope};this.getActiveItem=function(){return $scope.activeItem};this.setActiveItem=function(item){$scope.activeItem=item||null};this.setDefaultActiveItem=function(){var items=$scope.items,initialActiveItem=items&&items[0];if(initialActiveItem){initialActiveItem.autoSelect=true;this.setActiveItem(initialActiveItem);$scope.$evalAsync(function(){$scope.itemsHidden=false})}else this.setActiveItem(null)};this.selectActiveItem=function(enter){var enterPressed=enter&&$scope.activeItem&&$scope.activeItem.autoSelect?enter:false;this.selectItem($scope.activeItem,enterPressed)};this.selectItem=function(item,enterPressed){if($scope.activeItem&&!$scope.activeItem.result){if($scope.input){$scope.input.focus();if(Modernizr.touch)$scope.input.blur()};$scope.hasFocus=true;$scope.itemsHidden=true};if(item&&item.data&&item.data.recentSearch)item.autoSelect=enterPressed=false;$scope.select({item:item,enter:enterPressed})};this.search=function(){$scope.search()};this.isItemActive=function(item){return $scope.activeItem===item};this.getActiveItemIndex=function(){return $scope.items.indexOf($scope.activeItem)};this.setNextItemActive=function(){this.setItemActiveAt(this.getActiveItemIndex()+1)};this.setPrevItemActive=function(){this.setItemActiveAt(this.getActiveItemIndex()-1)};this.setItemActiveAt=function(index){var maxIndex=$scope.items.length-1;if(index<0)index=maxIndex;if(index>maxIndex)index=0;var item=$scope.items[index];if(item){item.autoSelect=false;this.setActiveItem(item)}};this.isEmpty=function(){return!$scope.term};this.focusReset=function(flag){$scope.$evalAsync(function(){$scope.hasFocus=flag})};if(!$scope.items){$scope.items=[]}else this.setDefaultActiveItem()}],link:function(scope,element,attrs,controller){var input=element.find('form > input'),itemList=element.find('div.menu'),searchIcon=element.find('div.icon--search');if(attrs.containerClass&&attrs.containerClass==='input-base')scope.input=input
function validate(reset,enter){var valid=true,childScope,val;if(!scope.activeItem&&enter===true){childScope=scope.$$childHead?scope.$$childHead:scope;if(reset===true){valid=true}else{valid=scope.term||scope.term&&scope.term.length===0&&scope.$parent.getRecentSearches&&scope.$parent.getRecentSearches().length>0?true:false;input.blur()};childScope.$apply(function(){childScope.isValid=valid})}else if(scope.activeItem&&scope.activeItem.result)if(scope.validateClass&&scope.validateClass.length>0){childScope=scope.$$childHead?scope.$$childHead:scope;val=scope.term;if(val.length>0&&!aliases.specialty[val.toLowerCase()]&&scope.activeItem.result!=='Searching...'||val===scope.placeholderText){valid=reset!==true?false:true;childScope.$apply(function(){childScope.isValid=valid;if(!valid){scope.itemsHidden=true;input.blur()}})}};return valid}
function resetInputState(){scope.$apply(function(){scope.hasFocus=false});validate(true,false)};customEvent.getEvent("page-back-event").progress(function(){resetInputState()})
function focusReset(flag){controller.focusReset(flag)};input.bind('focus',function(){focusReset(true)});scope.$watch('visible',function(){if(element.hasClass('mobile'))input.focus();if(searchIcon.length===0){searchIcon=element.find('div.icon--search');searchIcon.length===0||searchIcon.bind('click',function(){if(input.val().length>0&&validate(false,false)){scope.$apply(function(){controller.selectActiveItem()})}else if(scope.activeItem&&scope.activeItem.result)scope.$apply(function(){scope.hasFocus=true;scope.itemsHidden=false})})}});scope.$watch('hasFocus',function(hasFocus){$rootScope.$broadcast('twcTypeahead.input.focus',hasFocus);if(hasFocus);});scope.$watch('itemsHidden',function(itemsHidden){});if(Modernizr.touch){input.bind('click',function(){input.focus();$rootScope.$broadcast('twcTypeahead.mobile.input.focus',scope.hasFocus)});customEvent.getEvent('touch-on-body-event').progress(function(e){if(!scope.$root.isMobile&&scope.itemsHidden===false&&scope.mouseOver===false)scope.$apply(function(){scope.hasFocus=false})})};input.bind('blur',function(){focusReset(false)});itemList.bind('mouseover',function(){scope.$apply(function(){scope.mouseOver=true})});itemList.bind('mouseleave',function(){scope.$apply(function(){scope.mouseOver=false})});input.bind('keyup',twcUtil.debounce(function(evt){if(evt.keyCode===ascii.CR){var timeout=controller.getActiveItem().data?0:scope.term.length<3?0:850;$timeout(function(){if(validate(false,true))scope.$apply(function(){controller.selectActiveItem(true)})},timeout)}else if(evt.keyCode===ascii.ESC)input.blur()},30));input.bind('keydown',function(evt){if(evt.keyCode===ascii.CR||evt.keyCode===ascii.ESC){evt.preventDefault()}else if(evt.keyCode===ascii.DOWN){evt.preventDefault();scope.$apply(function(){controller.setNextItemActive()})}else if(evt.keyCode===ascii.UP){evt.preventDefault();scope.$apply(function(){controller.setPrevItemActive()})}else validate(true,false)});scope.$watch('items',function(newItems,oldItems){if(oldItems!==newItems)controller.setDefaultActiveItem()});scope.$watch('isHighLighted()',function(hilite){if(hilite){itemList.css({display:'block',position:'absolute',width:input[0].offsetWidth})}else itemList.css('display','none')})}}}]).directive('twcTypeaheadItem',['$swipe','$log','$compile','customEvent',function($swipe,$log,$compile,customEvent){'use strict';return{require:'^twcTypeahead',transclude:'true',template:'<div ng-click="selectItem()" ng-class="{\'twc-typeahead-item-active\': isActive()}"><div ng-transclude></div></div>',link:function(scope,element,attrs,controller){var item=scope.$eval(attrs.twcTypeaheadItem);scope.isActive=function(){return controller.isItemActive(item)};scope.selectItem=function(){item.autoSelect=false;scope.$evalAsync(function(){controller.selectItem(item)});if(Modernizr.touch&&angular.element(element).hasClass('for-touch'))$compile(element)(scope)};if(Modernizr.touch)$swipe.bind(element,{start:function(){}});element.bind('mouseenter',function(){scope.$apply(function(){controller.setActiveItem(item)})});if(!controller.isEmpty()&&scope.$last){customEvent.removeEvent('search-in-progress');customEvent.getEvent('search-in-progress').resolve({item:controller.getActiveItem()})}}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_typeahead/twc_typeahead.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_input_error_state/twc_input_error_state.directive.js. */
twc.shared.apps.directive('twcInputErrorState',function(){return{restrict:'A',scope:{isValid:'@'},link:function(scope,element,attrs){var vclass=attrs.twcInputErrorState;scope.$watch('isValid',function(isValid){if(vclass)Boolean(isValid)?element.removeClass(vclass):element.addClass(vclass)})}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_input_error_state/twc_input_error_state.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_reference/twc_reference.directive.js. */
twc.shared.apps.directive('twcReferenceScope',function($rootScope){'use strict';return{restrict:'A',controller:function($scope){this.refScope=function(){return $scope.refScope}},link:function(scope,element,attrs,ctrl){scope.refScope=scope.$eval(attrs.twcReferenceScope)}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_reference/twc_reference.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_constant/twc_constant.constant.js. */
twc.shared.apps.constant('twcConstant',{locTypes:{Region:1003,State:1001,Country:1e3,Cities:1,Golf:5,Airports:9,Ski:11,Outdoor:13,Zips:4,Parks:19,Lakes:21},statesCodesToNames:[{name:'ALABAMA',abbreviation:'AL'},{name:'ALASKA',abbreviation:'AK'},{name:'AMERICAN SAMOA',abbreviation:'AS'},{name:'ARIZONA',abbreviation:'AZ'},{name:'ARKANSAS',abbreviation:'AR'},{name:'CALIFORNIA',abbreviation:'CA'},{name:'COLORADO',abbreviation:'CO'},{name:'CONNECTICUT',abbreviation:'CT'},{name:'DELAWARE',abbreviation:'DE'},{name:'DISTRICT OF COLUMBIA',abbreviation:'DC'},{name:'FEDERATED STATES OF MICRONESIA',abbreviation:'FM'},{name:'FLORIDA',abbreviation:'FL'},{name:'GEORGIA',abbreviation:'GA'},{name:'GUAM',abbreviation:'GU'},{name:'HAWAII',abbreviation:'HI'},{name:'IDAHO',abbreviation:'ID'},{name:'ILLINOIS',abbreviation:'IL'},{name:'INDIANA',abbreviation:'IN'},{name:'IOWA',abbreviation:'IA'},{name:'KANSAS',abbreviation:'KS'},{name:'KENTUCKY',abbreviation:'KY'},{name:'LOUISIANA',abbreviation:'LA'},{name:'MAINE',abbreviation:'ME'},{name:'MARSHALL ISLANDS',abbreviation:'MH'},{name:'MARYLAND',abbreviation:'MD'},{name:'MASSACHUSETTS',abbreviation:'MA'},{name:'MICHIGAN',abbreviation:'MI'},{name:'MINNESOTA',abbreviation:'MN'},{name:'MISSISSIPPI',abbreviation:'MS'},{name:'MISSOURI',abbreviation:'MO'},{name:'MONTANA',abbreviation:'MT'},{name:'NEBRASKA',abbreviation:'NE'},{name:'NEVADA',abbreviation:'NV'},{name:'NEW HAMPSHIRE',abbreviation:'NH'},{name:'NEW JERSEY',abbreviation:'NJ'},{name:'NEW MEXICO',abbreviation:'NM'},{name:'NEW YORK',abbreviation:'NY'},{name:'NORTH CAROLINA',abbreviation:'NC'},{name:'NORTH DAKOTA',abbreviation:'ND'},{name:'NORTHERN MARIANA ISLANDS',abbreviation:'MP'},{name:'OHIO',abbreviation:'OH'},{name:'OKLAHOMA',abbreviation:'OK'},{name:'OREGON',abbreviation:'OR'},{name:'PALAU',abbreviation:'PW'},{name:'PENNSYLVANIA',abbreviation:'PA'},{name:'PUERTO RICO',abbreviation:'PR'},{name:'RHODE ISLAND',abbreviation:'RI'},{name:'SOUTH CAROLINA',abbreviation:'SC'},{name:'SOUTH DAKOTA',abbreviation:'SD'},{name:'TENNESSEE',abbreviation:'TN'},{name:'TEXAS',abbreviation:'TX'},{name:'UTAH',abbreviation:'UT'},{name:'VERMONT',abbreviation:'VT'},{name:'VIRGIN ISLANDS',abbreviation:'VI'},{name:'VIRGINIA',abbreviation:'VA'},{name:'WASHINGTON',abbreviation:'WA'},{name:'WEST VIRGINIA',abbreviation:'WV'},{name:'WISCONSIN',abbreviation:'WI'},{name:'WYOMING',abbreviation:'WY'}],ascii:{TAB:9,CR:13,ESC:27,DOWN:40,UP:38,L:37,R:39,DEL:127,BS:8},pageUrl:{hdr:{page:"/weather/today/l/",enhance:"/search/enhancedlocalsearch?where="},video:{page:"/video/",enhance:"/search/enhancedlocalsearch?where="},"ap-main":{page:"/health/aches-pains/forecast/",enhance:"/search/enhancedlocalsearch?where="},"ap-fcst":{page:"/health/aches-pains/forecast/",enhance:"/search/enhancedlocalsearch?where="},"pollen-main":{page:"/health/pollen/forecast/",enhance:"/search/enhancedlocalsearch?where="},"pollen-fcst":{page:"/health/pollen/forecast/",enhance:"/search/enhancedlocalsearch?where="},"hg-main":{page:"/home-garden/forecast/",enhance:"/search/enhancedlocalsearch?where="},"hg-fcst":{page:"/home-garden/forecast/",enhance:"/search/enhancedlocalsearch?where="},"fish-main":{page:"/outlook/recreation/outdoors/fishing/",enhance:"/search/enhancedlocalsearch?where="},"fish-fcst":{page:"/outlook/recreation/outdoors/fishing/",enhance:"/search/enhancedlocalsearch?where="},"ski-main":{page:"/sports-rec/ski/forecast/",enhance:"/sports-rec/ski/results?where="},"ski-fcst":{page:"/sports-rec/ski/forecast/",enhance:"/sports-rec/ski/results?where="},"hp-countdown":{page:"dynamic",enhance:"/search/enhancedlocalsearch?where="},title_enhanced:{page:"dynamic",enhance:"/search/enhancedlocalsearch?where="},vertSearch:{page:"dynamic",enhance:"/search/enhancedlocalsearch?where="}},socialMedia:{facebook:{icon:'facebook',title:'Facebook Recommend'},twitter:{icon:'twitter',title:'Twitter Tweet'},googleplus:{icon:'google-plus',title:'Google Plus'},reddit:{icon:'reddit',title:'Post to Reddit'},pinterest:{icon:'pinterest',title:'Pinterest Pin'},email:{icon:'email',title:'Email Shares'},qq:{icon:'qzone',title:'QIt'},sina:{icon:'sina-weibo',title:'Sina'}},microdata:{url:'http://schema.org/',schema:{organization:{name:'Organization'},video:{name:'VideoObject'},image:{name:'ImageObject'},article:{name:'Article'}}},assetsUrl:"http://s.w-x.co/",oldAssetsIDomain:"http://i.imwx.com/",oldAssetsImageDomain:"http://image.weather.com/",sina:{icon:'sina-weibo',title:'Sina'}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_constant/twc_constant.constant.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_sponsor/twc_sponsor.directive.js. */
twc.shared.apps.directive('twcSponsor',['AdControl','twcUtil',function(AdControl,twcUtil){var directiveObj={scope:{targeting:'=',enableCorrelatorUpdate:'@'},link:function(scope,element,attrs){var unregister=scope.$watch(function trigger(){return attrs.on},function respond(trigger){if(!twcUtil.isEmpty(trigger))if(trigger==='never'){unregister()}else if(trigger==='clear'){element.empty()}else scope.$evalAsync(function(){AdControl.createOrRefreshSlot(attrs.id,scope.targeting||{},scope.enableCorrelatorUpdate)})},true)}};return directiveObj}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_sponsor/twc_sponsor.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/videoamp/lib/amp.premier/amp.premier.js. */
Array.prototype.indexOf||(Array.prototype.indexOf=function(c,a){if(void(0)===this||null===this)throw new TypeError('"this" is null or not defined');var b=this.length>>>0;a=+a||0;Infinity===Math.abs(a)&&(a=0);0>a&&(a+=b,0>a&&(a=0));for(;a<b;a++)if(this[a]===c)return a;return-1});Date.now||(Date.now=function(){return+new Date()});if(!Function.prototype.bind)Function.prototype.bind=function(e){function s(){};if(typeof this!=="function")throw new TypeError("Bind must be called on a function");var t=[].slice,n=t.call(arguments,1),r=this,i=function(){return r.apply(this instanceof s?this:e||{},n.concat(t.call(arguments)))};s.prototype=r.prototype;i.prototype=new s();return i};if(typeof JSON!=="object")JSON={};(function(){function f(n){return n<10?"0"+n:n};if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}};var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep
function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function")value=value.toJSON(key);if(typeof rep==="function")value=rep.call(holder,key,value);switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1)partial[i]=str(i,value)||"null";v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v};if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1)if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)}}else for(k in value)if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)};v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}};if(typeof JSON.stringify!=="function")JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1)indent+=" "}else if(typeof space==="string")indent=space;rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number"))throw new Error("JSON.stringify");return str("",{"":value})};if(typeof JSON.parse!=="function")JSON.parse=function(text,reviver){var j
function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object")for(k in value)if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else delete value[k]};return reviver.call(holder,key,value)};text=String(text);cx.lastIndex=0;if(cx.test(text))text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j};throw new SyntaxError("JSON.parse")}}());(function(n){function i(a,d){this.setNotifyMethod(a);this.setNotifyContext(d)}
function j(a,d,b){this.name=a;this.body=d;this.type=b}
function k(){}
function m(){}
function l(){this.subCommands=[];this.initializeMacroCommand()}
function g(a,d){this.mediatorName=a||this.constructor.NAME;this.viewComponent=d}
function h(a,d){this.proxyName=a||this.constructor.NAME;null!=d&&this.setData(d)}
function b(a){if(null!=b.instanceMap[a])throw Error(b.MULTITON_MSG);this.initializeNotifier(a);b.instanceMap[a]=this;this.initializeFacade()}
function c(a){if(null!=c.instanceMap[a])throw Error(c.MULTITON_MSG);this.multitonKey=a;c.instanceMap[this.multitonKey]=this;this.mediatorMap=[];this.observerMap=[];this.initializeView()}
function e(a){if(e.instanceMap[a])throw Error(e.MULTITON_MSG);this.multitonKey=a;e.instanceMap[a]=this;this.proxyMap=[];this.initializeModel()}
function f(a){if(null!=f.instanceMap[a])throw Error(f.MULTITON_MSG);this.multitonKey=a;f.instanceMap[this.multitonKey]=this;this.commandMap=[];this.initializeController()}
function p(a,d,b){for(var a=a.split("."),b=b||o.global,c,e,f=0,g=a.length;f<g;f++)c=b,e=a[f],b=null==b[e]?b[e]={}:b[e];return null==d?b:c[e]=d};null==n&&(n=window);if(!n.puremvc){i.prototype.setNotifyMethod=function(a){this.notify=a};i.prototype.setNotifyContext=function(a){this.context=a};i.prototype.getNotifyMethod=function(){return this.notify};i.prototype.getNotifyContext=function(){return this.context};i.prototype.notifyObserver=function(a){this.getNotifyMethod().call(this.getNotifyContext(),a)};i.prototype.compareNotifyContext=function(a){return a===this.context};i.prototype.notify=null;i.prototype.context=null;j.prototype.getName=function(){return this.name};j.prototype.setBody=function(a){this.body=a};j.prototype.getBody=function(){return this.body};j.prototype.setType=function(a){this.type=a};j.prototype.getType=function(){return this.type};j.prototype.toString=function(){var a="Notification Name: "+this.getName(),a=a+("\nBody:"+(null==this.body?"null":this.body.toString()));return a+="\nType:"+(null==this.type?"null":this.type)};j.prototype.name=null;j.prototype.type=null;j.prototype.body=null;k.prototype.sendNotification=function(a,d,b){var c=this.getFacade();c&&c.sendNotification(a,d,b)};k.prototype.initializeNotifier=function(a){this.multitonKey=""+a;this.facade=this.getFacade()};k.prototype.getFacade=function(){if(null==this.multitonKey)throw Error(k.MULTITON_MSG);return b.getInstance(this.multitonKey)};k.prototype.multitonKey=null;k.MULTITON_MSG="multitonKey for this Notifier not yet initialized!";m.prototype=new k();m.prototype.constructor=m;m.prototype.execute=function(){};l.prototype=new k();l.prototype.constructor=l;l.prototype.subCommands=null;l.prototype.initializeMacroCommand=function(){};l.prototype.addSubCommand=function(a){this.subCommands.push(a)};l.prototype.execute=function(a){for(;0<this.subCommands.length;){var d=new (this.subCommands.shift())();d.initializeNotifier(this.multitonKey);d.execute(a)}};g.NAME="Mediator";g.prototype=new k();g.prototype.constructor=g;g.prototype.getMediatorName=function(){return this.mediatorName};g.prototype.setViewComponent=function(a){this.viewComponent=a};g.prototype.getViewComponent=function(){return this.viewComponent};g.prototype.listNotificationInterests=function(){return[]};g.prototype.handleNotification=function(){};g.prototype.onRegister=function(){};g.prototype.onRemove=function(){};g.prototype.mediatorName=null;g.prototype.viewComponent=null;h.NAME="Proxy";h.prototype=new k();h.prototype.constructor=h;h.prototype.getProxyName=function(){return this.proxyName};h.prototype.setData=function(a){this.data=a};h.prototype.getData=function(){return this.data};h.prototype.onRegister=function(){};h.prototype.onRemove=function(){};h.prototype.proxyName=null;h.prototype.data=null;b.prototype.initializeFacade=function(){this.initializeModel();this.initializeController();this.initializeView()};b.getInstance=function(a){if(null==a)return null;null==b.instanceMap[a]&&(b.instanceMap[a]=new b(a));return b.instanceMap[a]};b.prototype.initializeController=function(){if(null==this.controller)this.controller=f.getInstance(this.multitonKey)};b.prototype.initializeModel=function(){if(null==this.model)this.model=e.getInstance(this.multitonKey)};b.prototype.initializeView=function(){if(null==this.view)this.view=c.getInstance(this.multitonKey)};b.prototype.registerCommand=function(a,d){this.controller.registerCommand(a,d)};b.prototype.removeCommand=function(a){this.controller.removeCommand(a)};b.prototype.hasCommand=function(a){return this.controller.hasCommand(a)};b.prototype.registerProxy=function(a){this.model.registerProxy(a)};b.prototype.retrieveProxy=function(a){return this.model.retrieveProxy(a)};b.prototype.removeProxy=function(a){var d=null;null!=this.model&&(d=this.model.removeProxy(a));return d};b.prototype.hasProxy=function(a){return this.model.hasProxy(a)};b.prototype.registerMediator=function(a){null!=this.view&&this.view.registerMediator(a)};b.prototype.retrieveMediator=function(a){return this.view.retrieveMediator(a)};b.prototype.removeMediator=function(a){var d=null;null!=this.view&&(d=this.view.removeMediator(a));return d};b.prototype.hasMediator=function(a){return this.view.hasMediator(a)};b.prototype.sendNotification=function(a,d,b){this.notifyObservers(new j(a,d,b))};b.prototype.notifyObservers=function(a){null!=this.view&&this.view.notifyObservers(a)};b.prototype.initializeNotifier=function(a){this.multitonKey=a};b.hasCore=function(a){return null!=b.instanceMap[a]};b.removeCore=function(a){null!=b.instanceMap[a]&&(e.removeModel(a),c.removeView(a),f.removeController(a),delete b.instanceMap[a])};b.prototype.controller=null;b.prototype.model=null;b.prototype.view=null;b.prototype.multitonKey=null;b.instanceMap=[];b.MULTITON_MSG="Facade instance for this Multiton key already constructed!";c.prototype.initializeView=function(){};c.getInstance=function(a){if(null==a)return null;null==c.instanceMap[a]&&(c.instanceMap[a]=new c(a));return c.instanceMap[a]};c.prototype.registerObserver=function(a,d){null!=this.observerMap[a]?this.observerMap[a].push(d):this.observerMap[a]=[d]};c.prototype.notifyObservers=function(a){if(null!=this.observerMap[a.getName()]){for(var d=this.observerMap[a.getName()],b=[],c,e=0;e<d.length;e++)c=d[e],b.push(c);for(e=0;e<b.length;e++)c=b[e],c.notifyObserver(a)}};c.prototype.removeObserver=function(a,d){for(var b=this.observerMap[a],c=0;c<b.length;c++)if(!0==b[c].compareNotifyContext(d)){b.splice(c,1);break};0==b.length&&delete this.observerMap[a]};c.prototype.registerMediator=function(a){if(null==this.mediatorMap[a.getMediatorName()]){a.initializeNotifier(this.multitonKey);this.mediatorMap[a.getMediatorName()]=a;var d=a.listNotificationInterests();if(0<d.length)for(var b=new i(a.handleNotification,a),c=0;c<d.length;c++)this.registerObserver(d[c],b);a.onRegister()}};c.prototype.retrieveMediator=function(a){return this.mediatorMap[a]};c.prototype.removeMediator=function(a){var d=this.mediatorMap[a];if(d){for(var b=d.listNotificationInterests(),c=0;c<b.length;c++)this.removeObserver(b[c],d);delete this.mediatorMap[a];d.onRemove()};return d};c.prototype.hasMediator=function(a){return null!=this.mediatorMap[a]};c.removeView=function(a){delete c.instanceMap[a]};c.prototype.mediatorMap=null;c.prototype.observerMap=null;c.instanceMap=[];c.prototype.multitonKey=null;c.MULTITON_MSG="View instance for this Multiton key already constructed!";e.prototype.initializeModel=function(){};e.getInstance=function(a){if(null==a)return null;null==e.instanceMap[a]&&(e.instanceMap[a]=new e(a));return e.instanceMap[a]};e.prototype.registerProxy=function(a){a.initializeNotifier(this.multitonKey);this.proxyMap[a.getProxyName()]=a;a.onRegister()};e.prototype.retrieveProxy=function(a){return this.proxyMap[a]};e.prototype.hasProxy=function(a){return null!=this.proxyMap[a]};e.prototype.removeProxy=function(a){var b=this.proxyMap[a];b&&(this.proxyMap[a]=null,b.onRemove());return b};e.removeModel=function(a){delete e.instanceMap[a]};e.prototype.proxyMap=null;e.instanceMap=[];e.MULTITON_MSG="Model instance for this Multiton key already constructed!";f.prototype.initializeController=function(){this.view=c.getInstance(this.multitonKey)};f.getInstance=function(a){if(null==a)return null;null==this.instanceMap[a]&&(this.instanceMap[a]=new this(a));return this.instanceMap[a]};f.prototype.executeCommand=function(a){var b=this.commandMap[a.getName()];null!=b&&(b=new b(),b.initializeNotifier(this.multitonKey),b.execute(a))};f.prototype.registerCommand=function(a,b){null==this.commandMap[a]&&this.view.registerObserver(a,new i(this.executeCommand,this));this.commandMap[a]=b};f.prototype.hasCommand=function(a){return null!=this.commandMap[a]};f.prototype.removeCommand=function(a){this.hasCommand(a)&&(this.view.removeObserver(a,this),this.commandMap[a]=null)};f.removeController=function(a){delete this.instanceMap[a]};f.prototype.view=null;f.prototype.commandMap=null;f.prototype.multitonKey=null;f.instanceMap=[];f.MULTITON_MSG="controller key for this Multiton key already constructed";var o={global:function(){return this}(),extend:function(a,b){if("function"!==typeof a)throw new TypeError("#extend- child should be Function");if("function"!==typeof b)throw new TypeError("#extend- parent should be Function");if(b!==a){var c=new Function();c.prototype=b.prototype;a.prototype=new c();return a.prototype.constructor=a}},decorate:function(a,b){for(var c in b)a[c]=b[c];return a}};n.puremvc={View:c,Model:e,Controller:f,SimpleCommand:m,MacroCommand:l,Facade:b,Mediator:g,Observer:i,Notification:j,Notifier:k,Proxy:h,define:function(a,b,c){a||(a={});var e=a.name,f=a.parent,g="function"===typeof f,h=a.scope||null;if("parent"in a&&!g)throw new TypeError("Class parent must be Function");if(a.hasOwnProperty("constructor")){if(a=a.constructor,"function"!==typeof a)throw new TypeError("Class constructor must be Function")}else a=g?function(){f.apply(this,arguments)}:new Function();g&&o.extend(a,f);if(b)g=a.prototype,o.decorate(g,b),g.constructor=a;c&&o.decorate(a,c);if(e){if("string"!==typeof e)throw new TypeError("Class name must be primitive string");p(e,a,h)};return a},declare:p}}})(this);var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof O.ActiveXObject!=D)try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){};return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3)return;if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body)))f();if(!J){if(typeof j.addEventListener!=D)j.addEventListener("DOMContentLoaded",f,false);if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top)(function(){if(J)return;try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return};f()})()};if(M.wk)(function(){if(J)return;if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return};f()})();s(f)}}()
function f(){if(J)return;try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return};J=true;var X=U.length;for(var Y=0;Y<X;Y++)U[Y]()}
function K(X){if(J){X()}else U[U.length]=X}
function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else if(typeof O.attachEvent!=D){i(O,"onload",Y)}else if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else O.onload=Y}
function h(){if(T){V()}else H()}
function V(){var X=j.getElementsByTagName("body")[0],aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else if(Y<10){Y++;setTimeout(arguments.callee,10);return};X.removeChild(aa);Z=null;H()})()}else H()}
function H(){var ag=o.length;if(ag>0)for(var af=0;af<ag;af++){var Y=o[af].id,ab=o[af].callbackFn,aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae)if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class"))ai.styleclass=ae.getAttribute("class");if(ae.getAttribute("align"))ai.align=ae.getAttribute("align");var ah={},X=ae.getElementsByTagName("param"),ac=X.length;for(var ad=0;ad<ac;ad++)if(X[ad].getAttribute("name").toLowerCase()!="movie")ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value");P(ai,ah,Y,ab)}else{p(ae);if(ab)ab(aa)}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z};ab(aa)}}}}
function z(aa){var X=null,Y=c(aa);if(Y&&Y.nodeName=="OBJECT")if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z)X=Z};return X}
function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}
function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X};aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310))aa.width="310";if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137))aa.height="137";j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else ab.flashvars=ac;if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else setTimeout(arguments.callee,10)})()};u(aa,ab,X)}}
function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else setTimeout(arguments.callee,10)})()}else Y.parentNode.replaceChild(g(Y),Y)}
function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++)if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8))aa.appendChild(ad[Z].cloneNode(true))}}};return aa}
function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312)return X;if(aa){if(typeof ai.id==D)ai.id=Y;if(M.ie&&M.win){var ah="";for(var ae in ai)if(ai[ae]!=Object.prototype[ae])if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else if(ae.toLowerCase()!="classid")ah+=" "+ae+'="'+ai[ae]+'"';var af="";for(var ad in ag)if(ag[ad]!=Object.prototype[ad])af+='<param name="'+ad+'" value="'+ag[ad]+'" />';aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai)if(ai[ac]!=Object.prototype[ac])if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else if(ac.toLowerCase()!="classid")Z.setAttribute(ac,ai[ac]);for(var ab in ag)if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie")e(Z,ab,ag[ab]);aa.parentNode.replaceChild(Z,aa);X=Z}};return X}
function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}
function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT")if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else setTimeout(arguments.callee,10)})()}else X.parentNode.removeChild(X)}
function b(Z){var Y=c(Z);if(Y){for(var X in Y)if(typeof Y[X]=="function")Y[X]=null;Y.parentNode.removeChild(Y)}}
function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){};return X}
function C(X){return j.createElement(X)}
function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}
function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}
function v(ac,Y,ad,ab){if(M.ie&&M.mac)return;var aa=j.getElementsByTagName("head")[0];if(!aa)return;var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null};if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0)n=j.styleSheets[j.styleSheets.length-1];G=X};if(M.ie&&M.win){if(n&&typeof n.addRule==r)n.addRule(ac,Y)}else if(n&&typeof j.createTextNode!=D)n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}
function w(Z,X){if(!m)return;var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else v("#"+Z,"visibility:"+Y)}
function L(Y){var Z=/[\\\"<>\.;]/,X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y};var d=function(){if(M.ie&&M.win)window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++)I[ab][0].detachEvent(I[ab][1],I[ab][2]);var Z=N.length;for(var aa=0;aa<Z;aa++)y(N[aa]);for(var Y in M)M[Y]=null;M=null;for(var X in swfobject)swfobject[X]=null;swfobject=null})}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else if(Z)Z({success:false,id:ab})},getObjectById:function(X){if(M.w3)return z(X)},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r)for(var al in af)aj[al]=af[al];aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r)for(var ak in ad)am[ak]=ad[ak];if(Z&&typeof Z===r)for(var ai in Z)if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else am.flashvars=ai+"="+Z[ai];if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah)w(ah,true);X.success=true;X.ref=an}else if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else w(ah,true);if(ac)ac(X)})}else if(ac)ac(X)},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else return undefined},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A())P(Z,aa,X,Y)},removeSWF:function(X){if(M.w3)y(X)},createCSS:function(aa,Z,Y,X){if(M.w3)v(aa,Z,Y,X)},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z))Z=Z.split("?")[1];if(aa==null)return L(Z);var Y=Z.split("&");for(var X=0;X<Y.length;X++)if(Y[X].substring(0,Y[X].indexOf("="))==aa)return L(Y[X].substring((Y[X].indexOf("=")+1)))};return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win)l.style.display="block"};if(E)E(B)};a=false}}}}();(function(){var global,version,_ref
function AkamaiSDKManager(){var legacyCheck,sdk,versions,_this=this;sdk=null;this.getSDK=function(){return sdk};this.setSDK=function(newSDK){var key,value;sdk=newSDK;legacyCheck();for(key in sdk){value=sdk[key];window[key]=value};return sdk};this.saveSDK=function(version,object){var key,value,_ref;if(!(object!=null)||!(version!=null)||version==="")return;if(!(object.main!=null))for(key in object){value=object[key];if(!((value!=null?value.VERSION:void(0))===version))continue;object.main=value;break};if((_ref=object.version)==null)object.version=version;versions.push(object);this[version]=object;return object};versions=[];this.getVersions=function(){return versions.slice()};this.getVersion=function(version){return this[version]};this.setVersion=function(version){sdk=this.getVersion(version);if(!(sdk!=null))return null;this.setSDK(sdk);return sdk};this.revert=function(){return this.setSDK(versions[0])};this.noConflict=function(){var current;current=this.getSDK();this.revert();return current};this.create=(function(){var Creator;Creator=function(cls,args){this.prototype=cls.prototype;return cls.apply(this,args)};return function(args){return new Creator(sdk.main,arguments)}})();legacyCheck=function(){var key,obj,value,_ref,_ref1;if((_ref=window.com)!=null?(_ref1=_ref.akamai)!=null?_ref1.amp:void(0):void(0))for(key in window){value=window[key];if((value===window.AMP||value===window.AMPremier)&&((value!=null?value.VERSION:void(0))!=null)&&value.VERSION!==""&&value.VERSION!==(sdk!=null?sdk.version:void(0))&&(!(_this[value.VERSION]!=null))){obj={};obj.main=value;obj.com=window.com;if(window.AMP)obj.AMP=window.AMP;if(window.AMPPremier)obj.AMPremier=window.AMPPremier;if(window.Utils)obj.Utils=window.Utils;if(window.QueryString)obj.QueryString=window.QueryString;if(window.QueryParams)obj.QueryParams=window.QueryParams;_this.saveSDK(value.VERSION,obj);break}}};legacyCheck()};if((_ref=window.AKAMAI_MEDIA_PLAYER)==null)window.AKAMAI_MEDIA_PLAYER=new AkamaiSDKManager();version='AMP Premier - Weather Channel v0.9.0.0004';if(!(window.AKAMAI_MEDIA_PLAYER[version]!=null)){global=window.AKAMAI_MEDIA_PLAYER[version]={};function __hasProp(prop){return{}["hasOwnProperty"](prop)};function __extends(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key]
function ctor(){this.constructor=child};ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};function __indexOf(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};function __bind(fn,me){return function(){return fn.apply(me,arguments)}};var Notifications,Notifications={STARTUP:"startup",LOAD:"load",PAUSE_REQUEST:"pauserequest",TOGGLE_PLAY_PAUSE:"togglePlayPause",CHANGE_PLAY_STATE:"chageplaystate",PLAY_STATE_CHANGE:"playstatechange",TOGGLE_FULL_SCREEN:"toggleFullScreen",CHANGE_DISPLAY_STATE:"chageDisplayState",DISPLAY_STATE_CHANGE:"displayStateChange",FULL_SCREEN_CHANGE:"fullscreenchange",DISABLE_FULL_SCREEN:"disableFullScreen",ENABLE_FULL_SCREEN:"enableFullScreen",LANGUAGE_CHANGE:"languageChange",TOGGLE_ACTIVE:"toggleActive",CHANGE_ACTIVE_STATE:"changeactivestate",ACTIVE_STATE_CHANGE:"activestatechange",CHANGE_MEDIA:"changeMedia",SET_MEDIA:"setmedia",UPDATE_DATA_BINDINGS:"updatedatabindings",CHANGE_VOLUME:"changevolume",CHANGE_MUTED:"changemuted",TOGGLE_MUTED:"togglemuted",SEEK:"seek",CHANGE_DURATION:"changeduration",CHANGE_AUTOPLAY:"changeAutoplay",CHANGE_LOOP:"changeLoop",PLAYBACK_CORE_CHANGE:"playbackCoreChange",CHANGE_PLAYBACK_CORE:"changePlaybackCore",UPDATE_PLAYBACK_CORE:"updatePlaybackCore",START:"start",END:"end",REPLAY:"replay",LOAD_FEED:"loadFeed",REGISTER_PLUGIN:"registerPlugin",REGISTER_PLUGINS:"registerPlugins",PLUGIN_REGISTERED:"pluginRegistered",ADD_LAYER:"addLayer",REMOVE_LAYER:"removeLayer",ADD_OVERLAY:"addOverlay",REMOVE_OVERLAY:"removeOverlay",ADD_CONTROL:"addControl",REMOVE_CONTROL:"removeControl",ADD_CONTROL_STATE:"addControlState",REMOVE_CONTROL_STATE:"removeControlState",ADD_APPLICATION_STATE:"addApplicationState",REMOVE_APPLICATION_STATE:"removeApplicationState",DISPATCH_EVENT:"dispatchEvent",CHANGE_PARAMS:"changeParams",ADD_CUE_POINTS:"addCuePoints",REMOVE_CUE_POINTS:"removeCuePoints",INITIALIZED:"initialized",DISABLE_VIDEO_EVENTS:"disableVideoEvents",ENABLE_VIDEO_EVENTS:"enableVideoEvents",REGISTER_PLAYBACK_CORE:"registerPlaybackCore",REMOVE_PLAYBACK_CORE:"removePlaybackCore",DISPLAY_TIME:"displaytime",IS_USER_ACTIVE:"isUserActive",LOADED_METADATA:"loadedmetadata",READY:"ready",ERROR:"error",ENDED:"ended",STARTED:"started",DURATION_CHANGE:"durationchange",SEEKING:"seeking",SEEKED:"seeked",TIME_UPDATE:"timeupdate",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",PROGRESS:"progress",MEDIA_CHANGE:"mediachange",WAITING:"waiting",PLAY:"play",PLAYING:"playing",PAUSE:"pause",PLAY_REQUEST:"playrequest",MEDIUM_CHANGE:"mediumchange",TEMPORAL_TYPE_CHANGE:"temporaltypechange",VOLUME_CHANGE:"volumechange",FAIL_OVER_ATTEMPT:"failoverattempt",PLAYBACK_TARGET_CHANGE:"playbacktargetchange",PLAYBACK_TARGET_AVAILABLE:"playbacktargetavailable",RECORD_CONTENT_CHANGE:"recordcontentchange",CHANGE_CONTENT:"changecontent",CONTENT_CHANGED:"contentchanged"};function Module(config,viewComponent){Module.__super__.constructor.call(this,this.getModuleName()+"-"+Date.now());this.logger=Logger;this.config=config;this.moduleMap={};this.viewComponent=viewComponent;this.initialize();this.moduleAPI=this.createAPI()};__extends(Module,puremvc.Facade);Module.prototype.logger=null;Module.prototype.config=null;Module.prototype.moduleName=null;Module.prototype.moduleMap=null;Module.prototype.viewComponent=null;Module.prototype.moduleAPI=null;Module.prototype.initialize=function(){this.createModel();this.createController();this.createView()};Module.prototype.createModel=function(){this.registerProxy(new ModuleProxy(this.config))};Module.prototype.createView=function(){};Module.prototype.createController=function(){};Module.prototype.createAPI=function(){return new ModuleAPI(this)};Module.prototype.getModuleName=function(){return this.moduleName};Module.prototype.getConfig=function(){return this.config};Module.prototype.hasModule=function(moduleName){return this.moduleMap[moduleName]!=null};Module.prototype.getModules=function(){var key,modules,value,_ref;modules={};_ref=this.moduleMap;for(key in _ref){value=_ref[key];modules[key]=value.module};return modules};Module.prototype.registerModule=function(module){var adaptor,api,moduleAPI,moduleName;moduleName=module.getModuleName();if(!(module!=null)||(this.moduleMap[moduleName]!=null))return;adaptor=new ModuleAdapter(module);this.moduleMap[moduleName]=adaptor;this.registerMediator(adaptor);api=this.getAPI();moduleAPI=module.getAPI();if((api!=null)&&(moduleAPI!=null))api[moduleName]=moduleAPI;module.onRegister()};Module.prototype.retrieveModule=function(moduleName){return this.moduleMap[moduleName].module};Module.prototype.removeModule=function(moduleName){var adaptor,api;adaptor=this.moduleMap[moduleName];if(!(adaptor!=null))return;delete this.moduleMap[moduleName];this.removeMediator(moduleName);api=this.getAPI();if((api!=null?api[moduleName]:void(0))!=null)delete api[moduleName];adaptor.module.onRemove();return adaptor.module};Module.prototype.getAPI=function(){return this.moduleAPI};Module.prototype.listNotificationInterests=function(){return[]};Module.prototype.listNotificationPublications=function(){return[]};Module.prototype.listNotificationEvents=function(){return[]};Module.prototype.getViewComponent=function(){return this.viewComponent};Module.prototype.setViewComponent=function(viewComponent){this.viewComponent=viewComponent;return viewComponent};Module.prototype.onRegister=function(){};Module.prototype.onRemove=function(){};Module.prototype.destroy=function(){var key;if(this.viewComponent!=null){this.viewComponent.innerHTML="";this.viewComponent.className=""};puremvc.Facade.removeCore(this.multitonKey);for(key in this){this[key]=null;delete this[key]}};function ModuleAPI(module){ModuleAPI.attachModuleDispatcher(module,new ModuleDispatcher(this))};ModuleAPI.attachModuleDispatcher=function(module,moduleDispatcher){var api,dispatcher;module.registerMediator(moduleDispatcher);dispatcher=moduleDispatcher.dispatcher;api=moduleDispatcher.api;api.addEventListener=dispatcher.addEventListener.bind(dispatcher);api.removeEventListener=dispatcher.removeEventListener.bind(dispatcher);api.dispatchEvent=dispatcher.dispatchEvent.bind(dispatcher);if(module.logger.enabled===true)api.getModule=function(){return module}};ModuleAPI.prototype.addEventListener=function(type,func,capture){};ModuleAPI.prototype.dispatchEvent=function(event){};ModuleAPI.prototype.removeEventListener=function(type,func,capture){};function ModuleProxy(data){this.config=data;ModuleProxy.__super__.constructor.call(this)};__extends(ModuleProxy,puremvc.Proxy);ModuleProxy.NAME="ModuleProxy";ModuleProxy.prototype.defaults=null;ModuleProxy.prototype.config=null;ModuleProxy.prototype.initializeNotifier=function(key){ModuleProxy.__super__.initializeNotifier.call(this,key);this.createData()};ModuleProxy.prototype.createData=function(){if(this.config!=null)this.setData(this.config)};ModuleProxy.prototype.getData=function(){return this.data};ModuleProxy.prototype.setData=function(data){var dflt,key,obj,value,_ref;obj={};_ref=this.defaults;for(key in _ref){dflt=_ref[key];value=key in data?data[key]:dflt;obj[key]=value};this.data=obj;return data};function InstallPlayer(viewComponent){var anchor,div,img,message;viewComponent.className=Namespace.PREFIX+"player";div=UI.create("install-flash",viewComponent);message=UI.create(null,div,"p","To view this page ensure that Adobe Flash Player version 10.2.0 or greater is installed.");anchor=UI.create(null,div,"a");anchor.href='http://www.adobe.com/go/getflashplayer';img=UI.create(null,anchor,"img");img.src="//www.adobe.com/images/shared/download_buttons/get_flash_player.gif";img.alt="Get Adobe Flash player"};InstallPlayer.prototype.getModules=function(){return[]};InstallPlayer.prototype.getAPI=function(){return{}};function ToggleActiveCommand(){ToggleActiveCommand.__super__.constructor.call(this)};__extends(ToggleActiveCommand,puremvc.SimpleCommand);ToggleActiveCommand.prototype.execute=function(notification){var appProxy,state;appProxy=this.facade.retrieveProxy(ApplicationStateProxy.NAME);state=appProxy.getActiveState()===ActiveState.ACTIVE?ActiveState.INACTIVE:ActiveState.ACTIVE;this.sendNotification(Notifications.CHANGE_ACTIVE_STATE,state)};function ToggleFullScreenCommand(){ToggleFullScreenCommand.__super__.constructor.call(this)};__extends(ToggleFullScreenCommand,puremvc.SimpleCommand);ToggleFullScreenCommand.prototype.execute=function(notification){var appProxy,state;appProxy=this.facade.retrieveProxy(ApplicationStateProxy.NAME);state=appProxy.getDisplayState()===DisplayState.FULL_SCREEN?DisplayState.NORMAL:DisplayState.FULL_SCREEN;this.sendNotification(Notifications.CHANGE_DISPLAY_STATE,state)};var ControlsMode={PERSISTENT:"persistent",NONE:"none"};function ChangeDisplayStateCommand(){ChangeDisplayStateCommand.__super__.constructor.call(this)};__extends(ChangeDisplayStateCommand,puremvc.SimpleCommand);ChangeDisplayStateCommand.interval=null;ChangeDisplayStateCommand.prototype.execute=function(notification){var core,fullscreen,playback,proxy,state,view,_this=this;state=notification.getBody();playback=this.facade.retrieveProxy(PlaybackProxy.NAME);core=playback.getCore();if(!(core!=null)||!core.webkitSupportsFullscreen)return;proxy=this.facade.retrieveProxy(ApplicationStateProxy.NAME);proxy.setDisplayState(state);view=this.facade.getViewComponent();fullscreen={};if(view.webkitRequestFullScreen!=null){fullscreen.enter=function(){return view.webkitRequestFullScreen()};fullscreen.exit=function(){return document.webkitCancelFullScreen()};fullscreen.event="onwebkitfullscreenchange";fullscreen.element="webkitFullscreenElement"}else if(view.requestFullscreen!=null){fullscreen.enter=function(){return view.requestFullscreen()};fullscreen.exit=function(){return document.cancelFullscreen()};fullscreen.event="onfullscreenchange";fullscreen.element="fullscreenElement"}else if(view.mozRequestFullScreen!=null){fullscreen.enter=function(){return view.mozRequestFullscreen()};fullscreen.exit=function(){return document.mozCancelFullScreen()};fullscreen.event="onmozfullscreenchange";fullscreen.element="mozFullscreenElement"}else if(core.webkitEnterFullscreen!=null){fullscreen.enter=function(){return core.webkitEnterFullscreen()};fullscreen.exit=function(){return core.webkitExitFullscreen()};fullscreen.event=null};if(state===DisplayState.FULL_SCREEN){if(fullscreen.event!=null){view[fullscreen.event]=function(event){if(!(document[fullscreen.element]!=null))return _this.sendNotification(Notifications.CHANGE_DISPLAY_STATE,DisplayState.NORMAL)}}else{clearInterval(ChangeDisplayStateCommand.interval);ChangeDisplayStateCommand.interval=setInterval(function(){if(core.webkitDisplayingFullscreen!==true){_this.sendNotification(Notifications.CHANGE_DISPLAY_STATE,DisplayState.NORMAL);return clearInterval(ChangeDisplayStateCommand.interval)}},100)};fullscreen.enter()}else if(state===DisplayState.NORMAL){fullscreen.exit();core[fullscreen.event]=null;clearInterval(ChangeDisplayStateCommand.interval)};setTimeout(this.sendNotification.bind(this,Notifications.FULL_SCREEN_CHANGE,state),100);this.sendNotification(Notifications.DISPATCH_EVENT,new Event("fullscreenchange",state===DisplayState.FULL_SCREEN))};function PlayerCommand(){PlayerCommand.__super__.constructor.call(this)};__extends(PlayerCommand,puremvc.SimpleCommand);PlayerCommand.prototype.applicationState=null;PlayerCommand.prototype.media=null;PlayerCommand.prototype.initializeNotifier=function(key){var target;PlayerCommand.__super__.initializeNotifier.call(this,key);target=this.facade.app||this.facade;this.applicationState=target.retrieveProxy(ApplicationStateProxy.NAME);this.media=target.retrieveProxy(MediaProxy.NAME)};function ChangeAutoplayCommand(){ChangeAutoplayCommand.__super__.constructor.call(this)};__extends(ChangeAutoplayCommand,puremvc.SimpleCommand);ChangeAutoplayCommand.prototype.execute=function(notification){var proxy;proxy=this.facade.retrieveProxy(ConfigurationProxy.NAME);proxy.setAutoplay(notification.getBody())};function ChangeLoopCommand(){ChangeLoopCommand.__super__.constructor.call(this)};__extends(ChangeLoopCommand,puremvc.SimpleCommand);ChangeLoopCommand.prototype.execute=function(notification){var proxy;proxy=this.facade.retrieveProxy(ConfigurationProxy.NAME);proxy.setLoop(notification.getBody())};function ChangeVolumeCommand(){ChangeVolumeCommand.__super__.constructor.call(this)};__extends(ChangeVolumeCommand,puremvc.SimpleCommand);ChangeVolumeCommand.prototype.execute=function(notification){var proxy;proxy=this.facade.retrieveProxy(PlaybackProxy.NAME);proxy.setVolume(notification.getBody())};function SeekCommand(){SeekCommand.__super__.constructor.call(this)};__extends(SeekCommand,puremvc.SimpleCommand);SeekCommand.prototype.execute=function(notification){var handler,mediaProxy,playbackProxy,time,video;time=notification.getBody();playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);if(time===0&&mediaProxy.getType()===Utils.mimeTypes.m3u8)time=0.25;video=this.facade.getVideo();if(video.readyState===0){handler=function(event){video.removeEventListener("loadedmetadata",handler,false);return playbackProxy.setCurrentTime(time)};video.addEventListener("loadedmetadata",handler,false)}else playbackProxy.setCurrentTime(time);this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.WAITING)};function SeekingCommand(){SeekingCommand.__super__.constructor.call(this)};__extends(SeekingCommand,puremvc.SimpleCommand);SeekingCommand.prototype.execute=function(notification){var app;app=this.facade.retrieveProxy(ApplicationStateProxy.NAME);app.setSeeking(true)};function SeekedCommand(){SeekedCommand.__super__.constructor.call(this)};__extends(SeekedCommand,puremvc.SimpleCommand);SeekedCommand.prototype.execute=function(notification){var app,proxy,src;proxy=this.facade.retrieveProxy(PlaybackProxy.NAME);src=proxy.getSrc();app=this.facade.retrieveProxy(ApplicationStateProxy.NAME);app.setSeeking(false)};function ReplayCommand(){ReplayCommand.__super__.constructor.call(this)};__extends(ReplayCommand,puremvc.SimpleCommand);ReplayCommand.prototype.execute=function(notification){var playbackProxy;playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);playbackProxy.setCurrentTime(0.25);this.sendNotification(Notifications.PLAY);this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PLAYING)};function EndCommand(){EndCommand.__super__.constructor.call(this)};__extends(EndCommand,puremvc.SimpleCommand);EndCommand.prototype.execute=function(notification){var playbackProxy,time;this.facade.logger.debug("EndCommand",notification);time=notification.getBody();playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);playbackProxy.pause();if(playbackProxy.getCurrentTime()!==playbackProxy.getDuration())playbackProxy.setCurrentTime(playbackProxy.getDuration())};function StartedCommand(){StartedCommand.__super__.constructor.call(this)};__extends(StartedCommand,puremvc.SimpleCommand);StartedCommand.prototype.execute=function(notification){var playbackProxy;this.facade.logger.debug("StartedCommand");playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);playbackProxy.setStarted(true)};function IsUserActiveCommand(){IsUserActiveCommand.__super__.constructor.call(this)};__extends(IsUserActiveCommand,puremvc.SimpleCommand);IsUserActiveCommand.prototype.execute=function(notification){var proxy;proxy=this.facade.retrieveProxy(ApplicationStateProxy.NAME);proxy.setIsUserActive(notification.getBody())};function WaitingCommand(){WaitingCommand.__super__.constructor.call(this)};__extends(WaitingCommand,puremvc.SimpleCommand);WaitingCommand.prototype.execute=function(notification){var appProxy;this.facade.logger.debug("WaitingCommand");appProxy=this.facade.retrieveProxy(ApplicationStateProxy.NAME);if(appProxy.getPlayState()!==PlayState.LOADING&&Utils.getMimeType(this.facade.getVideo().src)!==Utils.mimeTypes.mp4)this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.WAITING)};function ChangeMutedCommand(){ChangeMutedCommand.__super__.constructor.call(this)};__extends(ChangeMutedCommand,puremvc.SimpleCommand);ChangeMutedCommand.prototype.execute=function(notification){var proxy;proxy=this.facade.retrieveProxy(PlaybackProxy.NAME);proxy.setMuted(notification.getBody())};function CheckAuthorizationCommand(){CheckAuthorizationCommand.__super__.constructor.call(this)};__extends(CheckAuthorizationCommand,puremvc.SimpleCommand);CheckAuthorizationCommand.prototype.execute=function(notification){var media,proxy;this.facade.logger.debug("CheckAuthorizationCommand");proxy=this.facade.retrieveProxy(SecurityProxy.NAME);media=notification.getBody();proxy.setMedia(media);if(proxy.getAuthorized()===false){this.sendNotification(SecurityNotifications.AUTHORIZE,media)}else this.sendNotification(Notifications.MEDIA_CHANGE,media)};function AuthorizedCommand(){AuthorizedCommand.__super__.constructor.call(this)};__extends(AuthorizedCommand,puremvc.SimpleCommand);AuthorizedCommand.prototype.execute=function(notification){var mediaProxy,securityProxy,src;this.facade.logger.debug("AuthorizedCommand");mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);mediaProxy.authorized=true;securityProxy=this.facade.retrieveProxy(SecurityProxy.NAME);src=securityProxy.createURL(mediaProxy.getSrc());mediaProxy.setSrc(src);this.sendNotification(Notifications.MEDIA_CHANGE,mediaProxy.getData())};function InitializedCommand(){InitializedCommand.__super__.constructor.call(this)};__extends(InitializedCommand,puremvc.SimpleCommand);InitializedCommand.prototype.execute=function(notification){var proxy;this.facade.logger.debug("InitializedCommand");proxy=this.facade.retrieveProxy(PlaybackProxy.NAME);proxy.initialized=true};function DisableVideoEventsCommand(){DisableVideoEventsCommand.__super__.constructor.call(this)};__extends(DisableVideoEventsCommand,puremvc.SimpleCommand);DisableVideoEventsCommand.prototype.execute=function(notification){var events,handler,handlers,playbackProxy,_i,_len,_ref;this.facade.logger.debug("DisableVideoEventsCommand",notification.getBody());events=notification.getBody();playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);handlers=playbackProxy.getHandlers();for(_i=0,_len=handlers.length;_i<_len;_i++){handler=handlers[_i];if(_ref=handler.type,__indexOf.call(events,_ref)>=0)handler.unbind()}};function EnableVideoEventsCommand(){EnableVideoEventsCommand.__super__.constructor.call(this)};__extends(EnableVideoEventsCommand,puremvc.SimpleCommand);EnableVideoEventsCommand.prototype.execute=function(notification){var events,handler,handlers,playbackProxy,_i,_len,_ref;this.facade.logger.debug("EnableVideoEventsCommand",notification.getBody());events=notification.getBody();playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);handlers=playbackProxy.getHandlers();for(_i=0,_len=handlers.length;_i<_len;_i++){handler=handlers[_i];if(_ref=handler.type,__indexOf.call(events,_ref)>=0)handler.bind()}};function RegisterPlaybackCoreCommand(){RegisterPlaybackCoreCommand.__super__.constructor.call(this)};__extends(RegisterPlaybackCoreCommand,puremvc.SimpleCommand);RegisterPlaybackCoreCommand.prototype.execute=function(notification){var player;this.facade.logger.debug("RegisterPlaybackCoreCommand");player=this.facade.retrieveProxy(PlayerProxy.NAME);player.registerPlaybackCore(notification.getBody())};function PlaybackTargetChangeCommand(){PlaybackTargetChangeCommand.__super__.constructor.call(this)};__extends(PlaybackTargetChangeCommand,puremvc.SimpleCommand);PlaybackTargetChangeCommand.prototype.execute=function(notification){var note;this.facade.logger.debug("PlaybackTargetChangeCommand");note=notification.getBody().target==="amp"?Notifications.REMOVE_APPLICATION_STATE:Notifications.ADD_APPLICATION_STATE;this.sendNotification(note,"remote-playback")};function RecordContentChangeCommand(){RecordContentChangeCommand.__super__.constructor.call(this)};__extends(RecordContentChangeCommand,puremvc.SimpleCommand);RecordContentChangeCommand.prototype.execute=function(notification){var content,media;this.facade.logger.debug("RecordContentChangeCommand");media=this.facade.retrieveProxy(MediaProxy.NAME);content=notification.getBody();this.sendNotification(Notifications.CHANGE_CONTENT,{from:media.getData(),to:content});media.updateData(content);this.sendNotification(Notifications.UPDATE_DATA_BINDINGS);this.sendNotification(Notifications.CHANGE_CONTENT,media.getData())};function TimeUpdateCommand(){TimeUpdateCommand.__super__.constructor.call(this)};__extends(TimeUpdateCommand,puremvc.SimpleCommand);TimeUpdateCommand.prototype.execute=function(notification){var playbackCore;playbackCore=this.facade.retrieveProxy(PlayerProxy.NAME).getActivePlaybackCore();this.sendNotification(Notifications.DISPLAY_TIME,{currentTime:playbackCore.getCurrentTime(),duration:playbackCore.getDuration()})};function ToggleMutedCommand(){ToggleMutedCommand.__super__.constructor.call(this)};__extends(ToggleMutedCommand,puremvc.SimpleCommand);ToggleMutedCommand.prototype.execute=function(notification){var proxy;proxy=this.facade.retrieveProxy(PlaybackProxy.NAME);proxy.setMuted(!proxy.getMuted())};function ModuleMediator(viewComponent){if(this.cssPrefix==null)this.cssPrefix=Namespace.PREFIX;ModuleMediator.__super__.constructor.call(this,this.mediatorName,viewComponent)};__extends(ModuleMediator,puremvc.Mediator);ModuleMediator.prototype.config=null;ModuleMediator.prototype.cssPrefix=null;ModuleMediator.prototype.classList=null;ModuleMediator.prototype.initializeNotifier=function(key){var base;ModuleMediator.__super__.initializeNotifier.call(this,key);base=this.facade.app||this.facade;this.config=base.retrieveProxy(ModuleProxy.NAME);this.classList={prefix:this.cssPrefix,element:this.viewComponent,contains:function(className,element){var css,_ref;if(element==null)element=this.element;css=this.prefix+className;if(((_ref=element.classList)!=null?_ref.contains:void(0))!=null){return element.classList.contains(css)}else return element.className.indexOf(css)!==-1},add:function(className,element){var css,_ref;if(element==null)element=this.element;css=this.prefix+className;if(((_ref=element.classList)!=null?_ref.add:void(0))!=null){element.classList.add(css)}else if(!this.contains(className,element))if(element.className!==""){element.className+=" "+css}else element.className=css},remove:function(className,element){var css,regexp,_ref;if(element==null)element=this.element;css=this.prefix+className;if(((_ref=element.classList)!=null?_ref.remove:void(0))!=null){element.classList.remove(css)}else if(this.contains(className,element)){regexp=new RegExp(" ?"+css);element.className=element.className.replace(regexp,"")}},toggle:function(className,element){var _ref;if(element==null)element=this.element;if(((_ref=element.classList)!=null?_ref.toggle:void(0))!=null){return element.classList.toggle(this.prefix+className)}else if(this.contains(className,element)){return this.remome(className,element)}else return this.add(className,element)}}};function LocalizedMediator(viewComponent){LocalizedMediator.__super__.constructor.call(this,viewComponent)};__extends(LocalizedMediator,ModuleMediator);LocalizedMediator.prototype.localizationManager=null;LocalizedMediator.prototype.initializeNotifier=function(key){var target;LocalizedMediator.__super__.initializeNotifier.call(this,key);target=this.facade.app||this.facade;this.localizationManager=target.retrieveProxy(LocalizationProxy.NAME)};function ComponentMediator(componentName,componentType,parent,element){this.componentName=componentName!=null?componentName:this.componentName;this.componentType=componentType!=null?componentType:this.componentType;this.viewComponent=this.createViewComponent(parent,element);this.classList=this.viewComponent._classList;if(this.mediatorName==null)this.mediatorName=this.createMediatorName();ComponentMediator.__super__.constructor.call(this,this.viewComponent)};__extends(ComponentMediator,LocalizedMediator);ComponentMediator.prototype.componentName=null;ComponentMediator.prototype.componentType=null;ComponentMediator.prototype.classList=null;ComponentMediator.prototype.state=null;ComponentMediator.prototype.disabled=false;ComponentMediator.prototype.onRegister=function(){UI.bindEvents(this.viewComponent,this)};ComponentMediator.prototype.createViewComponent=function(parent,element){var type;type=this.getTypeList();return UI.create(type,parent,element)};ComponentMediator.prototype.createMediatorName=function(){var type;type=this.getTypeList();type.push("mediator");type.push(UI.createUID());return type.join("-")};ComponentMediator.prototype.getTypeList=function(){var type;type=[];if(this.componentName!=null)type.push(this.componentName);if(this.componentType!=null)type=type.concat(this.componentType);return type};ComponentMediator.prototype.create=function(type,parent,element,text){if(parent==null)parent=this;if(parent===false)parent=null;return UI.create(type,parent,element,text)};ComponentMediator.prototype.createText=function(type,text,parent,element){if(parent==null)parent=this;return UI.create(type,parent,element,text)};ComponentMediator.prototype.setState=function(value){if(value===this.state)return;if(this.state!=null)this.classList.remove(this.state);this.state=value;if(this.state!=null)this.classList.add(this.state);return value};ComponentMediator.prototype.getState=function(){return this.state};ComponentMediator.prototype.setDisabled=function(value){if(value===this.disabled)return;this.disabled=value;if(this.disabled){this.classList.add("disabled")}else this.classList.remove("disabled");return value};ComponentMediator.prototype.getDisabled=function(){return this.disabled};function OverlayMediator(){OverlayMediator.__super__.constructor.call(this,null,null,null,null)};__extends(OverlayMediator,ComponentMediator);OverlayMediator.prototype.componentType="overlay";OverlayMediator.prototype.onRegister=function(){OverlayMediator.__super__.onRegister.call(this);this.registerOverlay()};OverlayMediator.prototype.onRemove=function(){OverlayMediator.__super__.onRemove.call(this);this.removeOverlay()};OverlayMediator.prototype.registerOverlay=function(){this.sendNotification(Notifications.ADD_OVERLAY,this.viewComponent)};OverlayMediator.prototype.removeOverlay=function(){this.sendNotification(Notifications.REMOVE_OVERLAY,this.viewComponent)};function contextMenuMediator(){contextMenuMediator.__super__.constructor.call(this)};__extends(contextMenuMediator,OverlayMediator);contextMenuMediator.prototype.componentName="context-menu";contextMenuMediator.prototype.contextMenu=null;contextMenuMediator.prototype.onRegister=function(){var _this=this;contextMenuMediator.__super__.onRegister.call(this);EventHandler.create(this.facade.viewComponent,EventHandler.CONTEXTMENU,function(event){event.preventDefault();_this.contextMenuHandler(event);return false})};contextMenuMediator.prototype.contextMenuHandler=function(event){var contextItem,_this=this;if(this.contextMenu)this.removeContextMenu();this.contextMenu=UI.create("context-menu",document.body,"ul");contextItem=UI.create("context-item",this.contextMenu,"li",this.facade.parent.version);this.contextMenu.style.top=event.pageY+"px";this.contextMenu.style.left=event.pageX+"px";EventHandler.create(document.body,EventHandler.CLICK,function(event){_this.removeContextMenu(event);return false})};contextMenuMediator.prototype.removeContextMenu=function(event){try{EventHandler.clear(document.body,EventHandler.CLICK);document.body.removeChild(this.contextMenu);this.contextMenu=null}catch(_error){}};function EndSlateMediator(){EndSlateMediator.__super__.constructor.call(this)};__extends(EndSlateMediator,OverlayMediator);EndSlateMediator.prototype.componentName="end-slate";EndSlateMediator.prototype.onRegister=function(){if(this.config.getEndSlate()!=null)EndSlateMediator.__super__.onRegister.call(this)};EndSlateMediator.prototype.listNotificationInterests=function(){return[Notifications.MEDIA_CHANGE]};EndSlateMediator.prototype.handleNotification=function(notification){var endslate,html,media,src,viewComponent;switch(notification.getName()){case Notifications.MEDIA_CHANGE:media=notification.getBody();endslate=this.config.getEndSlate();viewComponent=this.getViewComponent();html="";if(endslate!=null){src=endslate.usePoster===true?media.poster:endslate.url;if((src!=null)&&src!=="")html="<img src=\""+src+"\" class=\"end-slate-image\" />"};viewComponent.innerHTML=html}};function WaitingOverlayMediator(){WaitingOverlayMediator.__super__.constructor.call(this)};__extends(WaitingOverlayMediator,OverlayMediator);WaitingOverlayMediator.prototype.componentName="waiting";WaitingOverlayMediator.prototype.bar=null;WaitingOverlayMediator.prototype.text=null;WaitingOverlayMediator.prototype.onRegister=function(){this.bar=this.create("waiting-bar");this.text=this.createText("waiting-text",this.localizationManager.getString(LocalizationConstants.MSG_BUFFERING));WaitingOverlayMediator.__super__.onRegister.call(this)};function LoadingOverlayMediator(){LoadingOverlayMediator.__super__.constructor.call(this)};__extends(LoadingOverlayMediator,OverlayMediator);LoadingOverlayMediator.prototype.componentName="loading";function LocalizationConstants(){};LocalizationConstants.MSG_LIVE="MSG_LIVE";LocalizationConstants.MSG_REPLAY="MSG_REPLAY";LocalizationConstants.MSG_BUFFERING="MSG_BUFFERING_TEXT";LocalizationConstants.MSG_CC="MSG_CC";LocalizationConstants.MSG_CC_TITLE="MSG_CC_TITLE";LocalizationConstants.MSG_CC_LANGUAGE="MSG_CC_LANGUAGE";LocalizationConstants.MSG_CC_PRESETS="MSG_CC_PRESETS";LocalizationConstants.MSG_CC_FONT="MSG_CC_FONT";LocalizationConstants.MSG_CC_EDGE="MSG_CC_EDGE";LocalizationConstants.MSG_CC_SIZE="MSG_CC_SIZE";LocalizationConstants.MSG_CC_SCROLL="MSG_CC_SCROLL";LocalizationConstants.MSG_CC_COLOR="MSG_CC_COLOR";LocalizationConstants.MSG_CC_BACKGROUND="MSG_CC_BACKGROUND";LocalizationConstants.MSG_CC_EDGE="MSG_CC_EDGE";LocalizationConstants.MSG_CC_WINDOW="MSG_CC_WINDOW";LocalizationConstants.MSG_CC_OPACITY="MSG_CC_OPACITY";LocalizationConstants.MSG_CC_SHOW_ADVANCED="MSG_CC_SHOW_ADVANCED";LocalizationConstants.MSG_CC_HIDE_ADVANCED="MSG_CC_HIDE_ADVANCED";LocalizationConstants.MSG_CC_RESET="MSG_CC_RESET";LocalizationConstants.MSG_CC_CANCEL="MSG_CC_CANCEL";LocalizationConstants.MSG_CC_APPLY="MSG_CC_APPLY";LocalizationConstants.MSG_SECONDS="MSG_SECONDS";LocalizationConstants.MSG_RECOMMENDATIONS_TITLE="MSG_RECOMMENDATIONS_TITLE";LocalizationConstants.MSG_NEXT_VIDEO="MSG_NEXT_VIDEO";LocalizationConstants.MSG_NEXT_AD="MSG_NEXT_AD";function ReplayOverlayMediator(){ReplayOverlayMediator.__super__.constructor.call(this)};__extends(ReplayOverlayMediator,OverlayMediator);ReplayOverlayMediator.prototype.componentName="replay";ReplayOverlayMediator.prototype.replay=null;ReplayOverlayMediator.prototype.icon=null;ReplayOverlayMediator.prototype.label=null;ReplayOverlayMediator.prototype.onRegister=function(){this.replay=this.create("replay-button");this.replay.onclick=this.onclick.bind(this);this.icon=this.create("replay-icon",this.replay);this.label=this.createText("replay-label",this.localizationManager.getString(LocalizationConstants.MSG_REPLAY),this.replay);ReplayOverlayMediator.__super__.onRegister.call(this)};ReplayOverlayMediator.prototype.onclick=function(event){event.stopImmediatePropagation();this.sendNotification(Notifications.REPLAY);return false};function ChangePlaybackCoreCommand(){ChangePlaybackCoreCommand.__super__.constructor.call(this)};__extends(ChangePlaybackCoreCommand,PlayerCommand);ChangePlaybackCoreCommand.prototype.execute=function(notification){var core,handlers,mediaProxy,oldCore,playbackProxy,video,_this=this;this.facade.logger.debug("ChangePlaybackCoreCommand");video=notification.getBody();playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);core=video.getViewComponent();oldCore=this.facade.getVideo();this.facade.setVideo(core);if(oldCore!=null)EventHandler.clear(oldCore);handlers=[];handlers.push(EventHandler.create(core,"timeupdate",function(event){return _this.sendNotification(Notifications.TIME_UPDATE,event.target.currentTime)}));handlers.push(EventHandler.create(core,"durationchange",function(event){_this.facade.logger.debug("Playback core: durationchange: "+event.target.duration);if(/Android 4/.test(navigator.userAgent)&&event.target.src.indexOf(".m3u8")!==-1)return;_this.sendNotification(Notifications.CHANGE_DURATION,event.target.duration)}));handlers.push(EventHandler.create(core,"playing",function(event){_this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PLAYING);_this.sendNotification(Notifications.PLAYING)}));handlers.push(EventHandler.create(core,"play",function(event){}));handlers.push(EventHandler.create(core,"pause",function(event){if(event.target.readyState>0)_this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PAUSED)}));handlers.push(EventHandler.create(core,Notifications.LOADED_DATA,function(event){_this.sendNotification(Notifications.LOADED_DATA)}));handlers.push(EventHandler.create(core,"waiting",function(event){_this.sendNotification(Notifications.WAITING)}));handlers.push(EventHandler.create(core,"seeking",function(event){_this.sendNotification(Notifications.SEEKING)}));handlers.push(EventHandler.create(core,"seeked",function(event){_this.sendNotification(Notifications.SEEKED);if(_this.applicationState.getDevice()==="desktop"&&/mp4$/.test(event.target.src))_this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PLAYING)}));handlers.push(EventHandler.create(core,"ended",function(event){_this.sendNotification(Notifications.ENDED)}));handlers.push(EventHandler.create(core,"progress",function(event){var buffered;try{video=event.target;buffered=video.buffered;_this.sendNotification(Notifications.PROGRESS,buffered.end(buffered.length-1)/video.duration)}catch(error){}}));handlers.push(EventHandler.create(core,"error",function(event){_this.sendNotification(Notifications.ERROR,event.target.error)}));handlers.push(EventHandler.create(core,Notifications.LOAD_START,function(event){_this.sendNotification(Notifications.LOAD_START)}));handlers.push(EventHandler.create(core,"canplay",function(event){_this.sendNotification(Notifications.CAN_PLAY)}));handlers.push(EventHandler.create(core,"canplaythrough",function(event){_this.sendNotification(Notifications.CAN_PLAY_THROUGH);_this.sendNotification(Notifications.PROGRESS,mediaProxy.getDuration())}));handlers.push(EventHandler.create(core,"loadedmetadata",function(event){_this.sendNotification(Notifications.ENABLE_FULL_SCREEN);_this.sendNotification(Notifications.LOADED_METADATA);if(/Android 4/.test(navigator.userAgent)&&event.target.src.indexOf(".m3u8")!==-1)return;_this.sendNotification(Notifications.CHANGE_DURATION,core.duration)}));this.sendNotification(Notifications.DISABLE_FULL_SCREEN);playbackProxy.setVideo(core);playbackProxy.setHandlers(handlers);this.sendNotification(Notifications.PLAYBACK_CORE_CHANGE,video)};function ChangeActiveStateCommand(){ChangeActiveStateCommand.__super__.constructor.call(this)};__extends(ChangeActiveStateCommand,puremvc.SimpleCommand);ChangeActiveStateCommand.prototype.execute=function(notification){var config,proxy,state;config=this.facade.retrieveProxy(ConfigurationProxy.NAME);state=config.getControls().mode!==ControlsMode.PERSISTENT?notification.getBody():ActiveState.ACTIVE;proxy=this.facade.retrieveProxy(ApplicationStateProxy.NAME);proxy.setActiveState(state)};function DataBoundConfigurationProxy(data){DataBoundConfigurationProxy.__super__.constructor.call(this,data)};__extends(DataBoundConfigurationProxy,ModuleProxy);DataBoundConfigurationProxy.NAME=ModuleProxy.NAME;DataBoundConfigurationProxy.prototype.bindings=null;DataBoundConfigurationProxy.prototype.configurationName=null;DataBoundConfigurationProxy.prototype.configurationData=null;DataBoundConfigurationProxy.prototype.contextName=null;DataBoundConfigurationProxy.prototype.contextData=null;DataBoundConfigurationProxy.prototype.value=null;DataBoundConfigurationProxy.prototype.getConfigurationName=function(){return this.configurationName};DataBoundConfigurationProxy.prototype.getConfigurationData=function(){return this.configurationData.value||{}};DataBoundConfigurationProxy.prototype.getContextName=function(){return this.contextName};DataBoundConfigurationProxy.prototype.getContextData=function(){return this.contextData};DataBoundConfigurationProxy.prototype.onRegister=function(){var base;base=this.facade.app||this.facade;if(!(this.configurationName!=null))this.configurationName=this.facade.moduleName;this.bindings=base.retrieveProxy(DataBindingProxy.NAME);this.bindings.registerConfiguration(this)};DataBoundConfigurationProxy.prototype.setData=function(data){var key,value,_ref;this.data={};_ref=this.defaults;for(key in _ref){value=_ref[key];this.data[key]=key in data?data[key]:value};this.configurationData=new TokenizedObject(this.data);return this.data};DataBoundConfigurationProxy.prototype.getValue=function(key){var _ref;this.bindings.update();this.value[key]=(_ref=this.configurationData.data[key])!=null?_ref.compile(this.bindings.getData()):void(0);return this.value[key]};DataBoundConfigurationProxy.prototype.compile=function(context,suppressErrors){if(suppressErrors==null)suppressErrors=false;if(!(this.configurationData!=null))return null;if(!(context!=null))context=this.bindings.getData();if((this.contextName!=null)&&(this.contextData!=null)){context=Utils.clone(context);context[this.contextName]=this.contextData};this.configurationData.compile(context,suppressErrors);this.value=this.configurationData.value;return this.configurationData.value};var AdNotifications={BREAK_START:"adsbreakstart",BREAK_END:"adsbreakend",AD_CONTAINER_CREATED:"adscontainercreated",AD_LOADED:"adsloaded",AD_STARTED:"adsstarted",AD_TIME_UPDATE:"adstimeupdate",AD_TIME_REMAINING:"adstimeremaining",AD_DURATION_CHANGE:"adsdurationchange",AD_ENDED:"adsended",AD_ERROR:"adserror",AD_PLAY:"adsplay",AD_PAUSE:"adspause",AD_COMPANION:"adscompanion",FIRST_QUARTILE:"adsfirstquartile",MIDPOINT:"adsmidpoint",THIRD_QUARTILE:"adsthirdquartile",LOG:"adslog",REQUEST:"adsrequest"};function AdCommand(){AdCommand.__super__.constructor.call(this)};__extends(AdCommand,PlayerCommand);AdCommand.prototype.ads=null;AdCommand.prototype.appState=null;AdCommand.prototype.initializeNotifier=function(key){AdCommand.__super__.initializeNotifier.call(this,key);this.ads=this.facade.retrieveProxy(ModuleProxy.NAME);this.appState=this.facade.retrieveProxy(ApplicationStateProxy.NAME)};function AdStartCommand(){AdStartCommand.__super__.constructor.call(this)};__extends(AdStartCommand,puremvc.MacroCommand);AdStartCommand.prototype.ads=null;AdStartCommand.prototype.initializeNotifier=function(key){AdStartCommand.__super__.initializeNotifier.call(this,key);this.ads=this.facade.retrieveProxy(AdProxy.NAME)};AdStartCommand.prototype.initializeMacroCommand=function(){this.addSubCommand(PlayRequestCommand)};AdStartCommand.prototype.execute=function(notification){var initialized,playback;AdStartCommand.__super__.execute.call(this,notification);this.facade.logger.debug("AdStartCommand");playback=this.facade.app.retrieveProxy(PlaybackProxy.NAME);initialized=playback.initialized;if(initialized===false)this.facade.app.sendNotification(Notifications.INITIALIZED);if(initialized===false||!this.facade.isFullscreenDevice())this.facade.app.video.load();this.ads.start();this.facade.app.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PLAYING)};function AdPlayCommand(){AdPlayCommand.__super__.constructor.call(this)};__extends(AdPlayCommand,AdCommand);AdPlayCommand.prototype.execute=function(notification){this.facade.logger.debug("AdPlayCommand");if(this.ads.getStarted()===false){this.sendNotification(Notifications.START,true);return};this.ads.play();this.facade.app.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PLAYING)};function AdPauseCommand(){AdPauseCommand.__super__.constructor.call(this)};__extends(AdPauseCommand,AdCommand);AdPauseCommand.prototype.execute=function(notification){this.facade.logger.debug("AdPauseCommand");this.ads.pause();this.facade.app.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PAUSED)};function AdTogglePlayPauseCommand(){AdTogglePlayPauseCommand.__super__.constructor.call(this)};__extends(AdTogglePlayPauseCommand,AdCommand);AdTogglePlayPauseCommand.prototype.execute=function(notification){var note;this.facade.logger.debug("AdTogglePlayPauseCommand");if(this.ads.getPaused()||this.ads.getStarted()===false){note=Notifications.PLAY}else note=Notifications.PAUSE;this.sendNotification(note,true)};function AdVolumeChangeCommand(){AdVolumeChangeCommand.__super__.constructor.call(this)};__extends(AdVolumeChangeCommand,AdCommand);AdVolumeChangeCommand.prototype.execute=function(notification){this.facade.logger.debug("AdVolumeChangeCommand");this.ads.setVolume(notification.getBody())};function EndedCommand(){EndedCommand.__super__.constructor.call(this)};__extends(EndedCommand,puremvc.SimpleCommand);EndedCommand.prototype.execute=function(notification){var config;this.facade.logger.debug("EndedCommand",notification);config=this.facade.retrieveProxy(ConfigurationProxy.NAME);if(config.getLoop()===true){this.sendNotification(Notifications.REPLAY)}else{this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.ENDED);this.sendNotification(Notifications.CHANGE_ACTIVE_STATE,ActiveState.ACTIVE)}};function StartCommand(){StartCommand.__super__.constructor.call(this)};__extends(StartCommand,puremvc.SimpleCommand);StartCommand.prototype.execute=function(notification){var mediaProxy,playbackProxy;this.facade.logger.debug("StartCommand");playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);if(encodeURI(mediaProxy.getSrc())!==playbackProxy.getSrc())this.sendNotification(Notifications.UPDATE_PLAYBACK_CORE);this.sendNotification(Notifications.DISPLAY_TIME,{currentTime:0,duration:mediaProxy.getDuration()});this.sendNotification(Notifications.STARTED,notification.getBody());this.sendNotification(Notifications.PLAY,notification.getBody());this.sendNotification(Notifications.CHANGE_ACTIVE_STATE,ActiveState.INACTIVE)};function PlayCommand(){PlayCommand.__super__.constructor.call(this)};__extends(PlayCommand,puremvc.MacroCommand);PlayCommand.prototype.initializeMacroCommand=function(){this.addSubCommand(PlayRequestCommand)};PlayCommand.prototype.execute=function(notification){var mediaProxy,playbackProxy,userInitiated;this.facade.logger.debug("PlayCommand");PlayCommand.__super__.execute.call(this,notification);userInitiated=notification.getBody();mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);if(userInitiated&&playbackProxy.initialized!==true)this.sendNotification(Notifications.INITIALIZED);if(playbackProxy.initialized!==true||(!mediaProxy.getSrc()&&!mediaProxy.getSource()))return;if(!playbackProxy.getStarted()){this.sendNotification(Notifications.START)}else playbackProxy.play()};function PauseCommand(){PauseCommand.__super__.constructor.call(this)};__extends(PauseCommand,puremvc.SimpleCommand);PauseCommand.prototype.execute=function(notification){var playbackProxy;playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);playbackProxy.pause();this.sendNotification(Notifications.CHANGE_ACTIVE_STATE,ActiveState.ACTIVE)};function TogglePlayPauseCommand(){TogglePlayPauseCommand.__super__.constructor.call(this)};__extends(TogglePlayPauseCommand,puremvc.SimpleCommand);TogglePlayPauseCommand.prototype.execute=function(notification){var appStateProxy,note,playbackProxy;this.facade.logger.debug("TogglePlayPauseCommand");appStateProxy=this.facade.retrieveProxy(ApplicationStateProxy.NAME);playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);switch(appStateProxy.getPlayState()){case PlayState.ENDED:note=Notifications.REPLAY;break;case PlayState.PAUSED:note=playbackProxy.getStarted()?Notifications.PLAY:Notifications.START;break;case PlayState.READY:note=Notifications.START;break;case PlayState.PLAYING:note=Notifications.PAUSE;break;case PlayState.WAITING:if(appStateProxy.facade.getVideo().paused===true){note=Notifications.PLAY}else note=Notifications.PAUSE};this.sendNotification(note,true)};function AdContentEndedCommand(){AdContentEndedCommand.__super__.constructor.call(this)};__extends(AdContentEndedCommand,AdCommand);AdContentEndedCommand.prototype.execute=function(notification){this.facade.logger.debug("AdContentEndedCommand");this.ads.contentEnded()};function AdContentStartedCommand(){AdContentStartedCommand.__super__.constructor.call(this)};__extends(AdContentStartedCommand,AdCommand);AdContentStartedCommand.prototype.execute=function(notification){this.facade.logger.debug("AdContentStartedCommand");this.ads.contentStarted()};function PluginProxy(config){PluginProxy.__super__.constructor.call(this,config)};__extends(PluginProxy,DataBoundConfigurationProxy);PluginProxy.NAME=ModuleProxy.NAME;PluginProxy.prototype.enabled=true;PluginProxy.prototype.loaded=false;PluginProxy.prototype.plugin=null;PluginProxy.prototype.load=function(loaded){var script,_this=this;script=this.getScript();if((script!=null)&&script!==""){Utils.loadAMPScript(script,function(){_this.loaded=true;if(typeof loaded==="function")loaded(true)})}else{this.loaded=false;if(typeof loaded==="function")loaded(false)}};PluginProxy.prototype.getLoaded=function(){return this.loaded};PluginProxy.prototype.getScript=function(){var plugin,script;plugin=this.getConfigurationData().plugin;script=plugin!=null?plugin.js||plugin:"";return script};PluginProxy.prototype.setEnabled=function(value){this.enabled=value;return value};PluginProxy.prototype.getEnabled=function(){return this.enabled};PluginProxy.prototype.createPlugin=function(){};PluginProxy.prototype.initialize=function(){this.plugin=this.createPlugin()};PluginProxy.prototype.error=function(err){this.facade.logger.error("[AMP "+(this.facade.getModuleName().toUpperCase())+" Error]",err)};function AdProxy(config){AdProxy.__super__.constructor.call(this,config)};__extends(AdProxy,PluginProxy);AdProxy.NAME=PluginProxy.NAME;AdProxy.prototype.inprogress=false;AdProxy.prototype.paused=false;AdProxy.prototype.started=false;AdProxy.prototype.loadedMetadata=false;AdProxy.prototype.adVO=null;AdProxy.prototype.contextName="ad";AdProxy.prototype.getContextData=function(){return this.adVO||{}};AdProxy.prototype.setLoadedMetadata=function(value){this.loadedMetadata=value;return value};AdProxy.prototype.getLoadedMetadata=function(){return this.loadedmetadata};AdProxy.prototype.setCompanions=function(value){this.adVO.companions=value;this.sendNotification(AdNotifications.AD_COMPANION,this.adVO);return value};AdProxy.prototype.getCompanions=function(){var _ref;return(_ref=this.adVO)!=null?_ref.companions:void(0)};AdProxy.prototype.getInProgress=function(){return this.inprogress};AdProxy.prototype.setInProgress=function(value){return this.inprogress=value};AdProxy.prototype.getStarted=function(){return this.started};AdProxy.prototype.setStarted=function(value){this.started=value;return value};AdProxy.prototype.getPaused=function(){return this.paused};AdProxy.prototype.setPaused=function(value){this.paused=value;return value};AdProxy.prototype.play=function(){this.setPaused(false)};AdProxy.prototype.pause=function(){this.setPaused(true)};AdProxy.prototype.breakStart=function(){};AdProxy.prototype.breakEnd=function(){this.setInProgress(false);this.reset()};AdProxy.prototype.error=function(err,breakEnd){var msg;if(breakEnd==null)breakEnd=true;msg=(typeof err.getMessage==="function"?err.getMessage():void(0))||err.message;this.facade.logger.error("[AMP AD ERROR]",""+msg+" Skipping ad content.",err);if(this.adVO==null)this.adVO={};this.adVO.error=err;this.sendNotification(AdNotifications.AD_ERROR,this.adVO);if(breakEnd===true)this.sendNotification(AdNotifications.BREAK_END)};AdProxy.prototype.engage=function(media){if(this.getEnabled()===false)return;this.setStarted(false);if(this.getInProgress()){this.reset();this.facade.app.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"ad-mode")};this.engageAds()};AdProxy.prototype.engageAds=function(){this.facade.app.removeCommand(Notifications.START);this.facade.app.removeCommand(Notifications.PLAY);this.facade.app.removeCommand(Notifications.PAUSE);this.facade.app.removeCommand(Notifications.ENDED);this.facade.app.removeCommand(UserNotifications.PLAY);this.facade.app.removeCommand(UserNotifications.PAUSE);this.facade.app.removeCommand(UserNotifications.TOGGLE_PLAY_PAUSE);if(this.facade.isFullscreenDevice())this.facade.app.removeCommand(Notifications.CHANGE_DURATION);this.facade.removeCommand(Notifications.STARTED);this.facade.removeCommand(Notifications.ENDED);this.facade.registerCommand(Notifications.START,AdStartCommand);this.facade.registerCommand(Notifications.PLAY,AdPlayCommand);this.facade.registerCommand(Notifications.PAUSE,AdPauseCommand);this.facade.registerCommand(UserNotifications.PLAY,AdPlayCommand);this.facade.registerCommand(UserNotifications.PAUSE,AdPauseCommand);this.facade.registerCommand(UserNotifications.TOGGLE_PLAY_PAUSE,AdTogglePlayPauseCommand);this.facade.registerCommand(Notifications.VOLUME_CHANGE,AdVolumeChangeCommand)};AdProxy.prototype.reset=function(){this.facade.removeCommand(Notifications.START);this.facade.removeCommand(Notifications.PLAY);this.facade.removeCommand(Notifications.PAUSE);this.facade.removeCommand(UserNotifications.PLAY);this.facade.removeCommand(UserNotifications.PAUSE);this.facade.removeCommand(UserNotifications.TOGGLE_PLAY_PAUSE);this.facade.removeCommand(Notifications.VOLUME_CHANGE);this.facade.app.registerCommand(Notifications.START,StartCommand);this.facade.app.registerCommand(Notifications.PLAY,PlayCommand);this.facade.app.registerCommand(Notifications.PAUSE,PauseCommand);this.facade.app.registerCommand(Notifications.ENDED,EndedCommand);this.facade.app.registerCommand(UserNotifications.PLAY,PlayCommand);this.facade.app.registerCommand(UserNotifications.PAUSE,PauseCommand);this.facade.app.registerCommand(UserNotifications.TOGGLE_PLAY_PAUSE,TogglePlayPauseCommand);if(this.facade.isFullscreenDevice())this.facade.app.registerCommand(Notifications.CHANGE_DURATION,ChangeDurationCommand);this.facade.registerCommand(Notifications.STARTED,AdContentStartedCommand);this.facade.registerCommand(Notifications.ENDED,AdContentEndedCommand)};AdProxy.prototype.start=function(){if(this.getEnabled()===false){this.sendNotification(AdNotifications.BREAK_END);return false};this.setStarted(true);return true};AdProxy.prototype.contentPlay=function(){this.facade.app.sendNotification(Notifications.PLAY,true)};AdProxy.prototype.contentPause=function(){this.facade.app.video.pause()};AdProxy.prototype.contentStarted=function(){};AdProxy.prototype.contentEnded=function(){};AdProxy.prototype.setVolume=function(value){};AdProxy.prototype.getVolume=function(){};function PlayerAPI(module,dispatcher){ModuleAPI.attachModuleDispatcher(module,new PlayerDispatcher(this,dispatcher));this.getContainer=function(){return module.getViewComponent()};this.getVideo=function(){return module.getVideo()};this.getConfig=function(){return module.getConfig()};this.destroy=function(){return module.destroy()}};__extends(PlayerAPI,ModuleAPI);PlayerAPI.prototype.getContainer=function(){};PlayerAPI.prototype.getVideo=function(){};PlayerAPI.prototype.getConfig=function(){};PlayerAPI.prototype.evaluateBinding=function(binding){};PlayerAPI.prototype.canPlayType=function(type){};PlayerAPI.prototype.load=function(){};PlayerAPI.prototype.play=function(){};PlayerAPI.prototype.replay=function(){};PlayerAPI.prototype.pause=function(){};PlayerAPI.prototype.end=function(){};PlayerAPI.prototype.setParams=function(value){};PlayerAPI.prototype.getParams=function(){};PlayerAPI.prototype.setAutoplay=function(value){};PlayerAPI.prototype.getAutoplay=function(){};PlayerAPI.prototype.setLoop=function(value){};PlayerAPI.prototype.getLoop=function(){};PlayerAPI.prototype.setMuted=function(value){};PlayerAPI.prototype.getMuted=function(){};PlayerAPI.prototype.mute=function(){return this.setMuted(true)};PlayerAPI.prototype.unmute=function(){return this.setMuted(false)};PlayerAPI.prototype.setMedia=function(value){};PlayerAPI.prototype.getMedia=function(){};PlayerAPI.prototype.setCurrentTime=function(value){};PlayerAPI.prototype.getCurrentTime=function(){};PlayerAPI.prototype.getDuration=function(){};PlayerAPI.prototype.setSrc=function(value){};PlayerAPI.prototype.getSrc=function(){};PlayerAPI.prototype.setSource=function(value){};PlayerAPI.prototype.getSource=function(){};PlayerAPI.prototype.setVolume=function(value){};PlayerAPI.prototype.getVolume=function(){};PlayerAPI.prototype.getSeeking=function(){};PlayerAPI.prototype.getPaused=function(){};PlayerAPI.prototype.getEnded=function(){};PlayerAPI.prototype.enterFullScreen=function(){};PlayerAPI.prototype.exitFullScreen=function(){};PlayerAPI.prototype.destroy=function(){};PlayerAPI.prototype.recordContentChange=function(content){};function HTMLPlayerAPI(module,dispatcher){var bindings,config,media,params,player;HTMLPlayerAPI.__super__.constructor.call(this,module,dispatcher);player=module;media=player.retrieveProxy(MediaProxy.NAME);bindings=player.retrieveProxy(DataBindingProxy.NAME);config=player.retrieveProxy(ConfigurationProxy.NAME);params=player.retrieveProxy(ParamsProxy.NAME);this.evaluateBinding=bindings.evaluateBinding.bind(bindings);this.recordContentChange=function(content){player.sendNotification(Notifications.RECORD_CONTENT_CHANGE,content)};this.canPlayType=function(type){return player.retrieveProxy(PlaybackProxy.NAME).canPlayType(type)};this.load=function(){player.sendNotification(Notifications.LOAD)};this.play=function(){player.sendNotification(Notifications.PLAY,true)};this.replay=function(){player.sendNotification(Notifications.REPLAY)};this.pause=function(){player.sendNotification(Notifications.PAUSE)};this.end=function(){player.sendNotification(Notifications.END)};this.setParams=function(value){player.sendNotification(Notifications.CHANGE_PARAMS,value);return value};this.getParams=params.getData.bind(params);this.setAutoplay=function(value){player.sendNotification(Notifications.CHANGE_AUTOPLAY,value);return value};this.getAutoplay=config.getAutoplay.bind(config);this.setLoop=function(value){player.sendNotification(Notifications.CHANGE_LOOP,value);return value};this.getLoop=config.getLoop.bind(config);this.setMuted=function(value){player.sendNotification(Notifications.CHANGE_MUTED,value);return value};this.getMuted=function(){return player.retrieveProxy(PlaybackProxy.NAME).getMuted()};this.setMedia=function(value){player.sendNotification(Notifications.SET_MEDIA,value);return value};this.getMedia=media.getData.bind(media);this.setCurrentTime=function(value){player.sendNotification(Notifications.SEEK,value);return value};this.getCurrentTime=function(){return player.retrieveProxy(PlaybackProxy.NAME).getCurrentTime()};this.getDuration=media.getDuration.bind(media);this.setSrc=function(value){player.sendNotification(Notifications.SET_MEDIA,{src:value});return value};this.getSrc=function(){return player.retrieveProxy(PlaybackProxy.NAME).getSrc()};this.setSource=function(value){player.sendNotification(Notifications.SET_MEDIA,{source:value});return value};this.getSource=media.getSource.bind(media);this.setVolume=function(value){player.sendNotification(Notifications.CHANGE_VOLUME,value);return value};this.getVolume=function(){return player.retrieveProxy(PlaybackProxy.NAME).getVolume()};this.getSeeking=function(){return player.retrieveProxy(PlaybackProxy.NAME).getSeeking()};this.getPaused=function(){return player.retrieveProxy(PlaybackProxy.NAME).getPaused()};this.getEnded=function(){return player.retrieveProxy(PlaybackProxy.NAME).getEnded()};this.enterFullScreen=function(){player.sendNotification(Notifications.CHANGE_DISPLAY_STATE,DisplayState.FULL_SCREEN)};this.exitFullScreen=function(){player.sendNotification(Notifications.CHANGE_DISPLAY_STATE,DisplayState.NORMAL)}};__extends(HTMLPlayerAPI,PlayerAPI);function Player(config,viewComponent,dispatcher){this.dispatcher=dispatcher;Player.__super__.constructor.call(this,config,viewComponent)};__extends(Player,Module);Player.prototype.moduleName="amp";Player.prototype.playerType=null;Player.prototype.dispatcher=null;Player.prototype.config=null;Player.prototype.video=null;Player.prototype.parent=null;Player.prototype.getVideo=function(){return this.video};Player.prototype.setVideo=function(video){this.video=video;return video};Player.prototype.getPlayerType=function(){return this.playerType};Player.prototype.createPlugins=function(){var def,init,key,plugin,plugins,type,value,_ref;plugins=[];type=this.getPlayerType();_ref=AMP.plugins;for(key in _ref){value=_ref[key];if(!(key in this.config))continue;init=this.config[key];if(!(init!=null)||init.enabled===false)continue;def=value[type];if(!(def!=null)){this.logger.debug("Plugin could not be found: "+key);continue};plugin=new def(this,init);plugins.push(plugin)};this.sendNotification(PluginNotifications.REGISTER_PLUGINS,plugins);return plugins};Player.prototype.createVideo=function(){return null};Player.prototype.initialize=function(){Player.__super__.initialize.call(this);this.video=this.createVideo();this.createPlugins()};Player.prototype.listNotificationEvents=function(){return Player.__super__.listNotificationEvents.call(this).concat([Notifications.READY,Notifications.LOAD_START,Notifications.TIME_UPDATE,Notifications.DURATION_CHANGE,Notifications.ERROR,Notifications.LOADED_METADATA,Notifications.WAITING,Notifications.SEEKING,Notifications.SEEKED,Notifications.ENDED,Notifications.PROGRESS,Notifications.CAN_PLAY,Notifications.CAN_PLAY_THROUGH,Notifications.PAUSE,Notifications.PLAY,Notifications.PLAYING,Notifications.STARTED,Notifications.PLAY_REQUEST,Notifications.MEDIUM_CHANGE,Notifications.TEMPORAL_TYPE_CHANGE,Notifications.MEDIA_CHANGE,Notifications.VOLUME_CHANGE,Notifications.FAIL_OVER_ATTEMPT,Notifications.PLAYBACK_TARGET_AVAILABLE,Notifications.PLAYBACK_TARGET_CHANGE,Notifications.PLAY_STATE_CHANGE,SecurityNotifications.AUTHORIZE,SecurityNotifications.AUTHORIZED])};function HTMLPlayer(config,viewComponent,dispatcher){HTMLPlayer.__super__.constructor.call(this,config,viewComponent,dispatcher)};__extends(HTMLPlayer,Player);HTMLPlayer.prototype.playerType="html";HTMLPlayer.prototype.createAPI=function(){return new HTMLPlayerAPI(this,this.dispatcher)};HTMLPlayer.prototype.createVideo=function(){var video,viewComponent;video=new VideoMediator("html5","video");viewComponent=video.getViewComponent();if(viewComponent.dataset==null)viewComponent.dataset={};this.sendNotification(Notifications.CHANGE_PLAYBACK_CORE,video);return viewComponent};HTMLPlayer.prototype.createModel=function(){var appState,bindings,playbackProxy;bindings=new DataBindingProxy();this.registerProxy(bindings);this.registerProxy(new SecurityProxy());this.registerProxy(new ConfigurationProxy(this.config));this.registerProxy(new LocalizationProxy(this.config));appState=new ApplicationStateProxy();this.registerProxy(appState);appState.setRenderMode(RenderMode.HTML);playbackProxy=new PlaybackProxy();this.registerProxy(playbackProxy);this.registerProxy(new MediaProxy());this.registerProxy(new PlayerProxy(playbackProxy));this.registerProxy(new ParamsProxy(this.config.params));bindings.initialize()};HTMLPlayer.prototype.createView=function(){var app,overlay,_ref;app=this.getViewComponent();this.registerMediator(new PlayerMediator("html5",app));this.registerMediator(new PluginAdapter());this.registerMediator(new VideoLayerMediator());this.registerMediator(new PosterMediator());overlay=new OverlayLayerMediator();this.registerMediator(overlay);this.registerMediator(new LoadingOverlayMediator());this.registerMediator(new contextMenuMediator());this.registerMediator(new WaitingOverlayMediator());this.registerMediator(new ReplayOverlayMediator());this.registerMediator(new EndSlateMediator());if(((_ref=this.config.titlebar)!=null?_ref.enabled:void(0))===true)this.registerMediator(new TitleBarMediator());this.registerMediator(new ErrorLayerMediator())};HTMLPlayer.prototype.createController=function(){this.registerCommand(Notifications.PLAY,PlayCommand);this.registerCommand(Notifications.PAUSE,PauseCommand);this.registerCommand(Notifications.CHANGE_PLAY_STATE,ChangePlayStateCommand);this.registerCommand(Notifications.TOGGLE_FULL_SCREEN,ToggleFullScreenCommand);this.registerCommand(Notifications.CHANGE_DISPLAY_STATE,ChangeDisplayStateCommand);this.registerCommand(Notifications.TOGGLE_ACTIVE,ToggleActiveCommand);this.registerCommand(Notifications.CHANGE_ACTIVE_STATE,ChangeActiveStateCommand);this.registerCommand(Notifications.CHANGE_MEDIA,ChangeMediaCommand);this.registerCommand(Notifications.MEDIA_CHANGE,MediaChangeCommand);this.registerCommand(Notifications.SET_MEDIA,SetMediaCommand);this.registerCommand(Notifications.UPDATE_DATA_BINDINGS,UpdateDataBindingsCommand);this.registerCommand(Notifications.CHANGE_PLAYBACK_CORE,ChangePlaybackCoreCommand);this.registerCommand(Notifications.UPDATE_PLAYBACK_CORE,UpdatePlaybackCoreCommand);this.registerCommand(Notifications.START,StartCommand);this.registerCommand(Notifications.STARTED,StartedCommand);this.registerCommand(Notifications.SEEK,SeekCommand);this.registerCommand(Notifications.SEEKING,SeekingCommand);this.registerCommand(Notifications.SEEKED,SeekedCommand);this.registerCommand(Notifications.CHANGE_VOLUME,ChangeVolumeCommand);this.registerCommand(Notifications.CHANGE_MUTED,ChangeMutedCommand);this.registerCommand(Notifications.CHANGE_AUTOPLAY,ChangeAutoplayCommand);this.registerCommand(Notifications.CHANGE_LOOP,ChangeLoopCommand);this.registerCommand(Notifications.END,EndCommand);this.registerCommand(Notifications.ENDED,EndedCommand);this.registerCommand(Notifications.REPLAY,ReplayCommand);this.registerCommand(Notifications.ERROR,ErrorCommand);this.registerCommand(Notifications.READY,ReadyCommand);this.registerCommand(Notifications.WAITING,WaitingCommand);this.registerCommand(Notifications.CHANGE_DURATION,ChangeDurationCommand);this.registerCommand(Notifications.CHANGE_PARAMS,ChangeParamsCommand);this.registerCommand(Notifications.IS_USER_ACTIVE,IsUserActiveCommand);this.registerCommand(SecurityNotifications.CHECK_AUTHORIZATION,CheckAuthorizationCommand);this.registerCommand(SecurityNotifications.AUTHORIZED,AuthorizedCommand);this.registerCommand(SecurityNotifications.SET_KEY,SecuritySetKeyCommand);this.registerCommand(SecurityNotifications.SET_TOKEN,SecuritySetTokenCommand);this.registerCommand(Notifications.INITIALIZED,InitializedCommand);this.registerCommand(Notifications.ENABLE_VIDEO_EVENTS,EnableVideoEventsCommand);this.registerCommand(Notifications.DISABLE_VIDEO_EVENTS,DisableVideoEventsCommand);this.registerCommand(Notifications.REGISTER_PLAYBACK_CORE,RegisterPlaybackCoreCommand);this.registerCommand(UserNotifications.TOGGLE_PLAY_PAUSE,TogglePlayPauseCommand);this.registerCommand(UserNotifications.SEEK,SeekCommand);this.registerCommand(Notifications.PLAYBACK_TARGET_CHANGE,PlaybackTargetChangeCommand);this.registerCommand(Notifications.RECORD_CONTENT_CHANGE,RecordContentChangeCommand);this.registerCommand(Notifications.TIME_UPDATE,TimeUpdateCommand);this.registerCommand(Notifications.TOGGLE_MUTED,ToggleMutedCommand)};function XMLUtils(){};XMLUtils.createTextContent=function(xml,text){var node;node=/[\&<>]/.test(text)?xml.createCDATASection(text):xml.createTextNode(text);return node};XMLUtils.updateTextContent=function(node,str){var text;text=XMLUtils.createTextContent(node.ownerDocument,str);node.removeChild(node.childNodes[0]);node.appendChild(text);return node};XMLUtils.serialize=function(xml){var serializer;if(!(xml!=null))return;if(typeof xml==="string")return xml;try{serializer=new XMLSerializer();return serializer.serializeToString(xml)}catch(err1){try{serializer=document.implementation.createLSSerializer();return xmlSerializer.writeToString(xml)}catch(err3){try{return xml.xml}catch(err2){}}}};XMLUtils.parse=function(text){var parser,xmlDoc;if(window.DOMParser){parser=new DOMParser();xmlDoc=parser.parseFromString(text,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(text)};return xmlDoc};function FlashMediaProxy(){FlashMediaProxy.__super__.constructor.call(this,this.constructor.NAME,{})};__extends(FlashMediaProxy,puremvc.Proxy);FlashMediaProxy.NAME="FlashMediaProxy";FlashMediaProxy.prototype.getSrc=function(){return this.data.src};FlashMediaProxy.prototype.setSrc=function(value){this.data.src=value;return value};function SecuritySetTokenCommand(){SecuritySetTokenCommand.__super__.constructor.call(this)};__extends(SecuritySetTokenCommand,puremvc.SimpleCommand);SecuritySetTokenCommand.prototype.execute=function(notification){var proxy,token;proxy=this.facade.retrieveProxy(SecurityProxy.NAME);token=notification.getBody();proxy.setToken(token);proxy.setAuthorized(true)};function SecuritySetKeyCommand(){SecuritySetKeyCommand.__super__.constructor.call(this)};__extends(SecuritySetKeyCommand,puremvc.SimpleCommand);SecuritySetKeyCommand.prototype.execute=function(notification){var key,proxy;proxy=this.facade.retrieveProxy(SecurityProxy.NAME);key=notification.getBody();proxy.setKey(key)};function LocalizationWrapper(app,config){this.app=app;this.config=config;LocalizationWrapper.__super__.constructor.call(this,this.constructor.NAME);this.proxy=new LocalizationProxy(this.config);this.app.registerProxy(this.proxy)};__extends(LocalizationWrapper,puremvc.Mediator);LocalizationWrapper.prototype.player=null;LocalizationWrapper.prototype.config=null;LocalizationWrapper.prototype.proxy=null;LocalizationWrapper.NAME="LocalizationWrapper";LocalizationWrapper.prototype.getString=function(key){return this.proxy.getString(key)};LocalizationWrapper.prototype.listNotificationInterests=function(){return[FlashNotifications.CREATE_FLASH_VARS,FlashNotifications.CREATE_XML]};LocalizationWrapper.prototype.handleNotification=function(notification){var application,body,config,element,flashvars,key,lang,locale,locales,name,prop,text,value,xml,_ref;LocalizationWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.CREATE_FLASH_VARS:flashvars=body.flashvars;config=body.config;if(config.language!=null)flashvars.locale_setting=config.language;break;case FlashNotifications.CREATE_XML:xml=body.xml;application=xml.getElementsByTagName("application")[0];locales=xml.getElementsByTagName("locales")[0];if(!(locales!=null)){locales=xml.createElement("locales");application.appendChild(locales)};_ref=this.config.locales;for(lang in _ref){locale=_ref[lang];element=xml.createElement("locale");element.setAttribute("id",lang);locales.appendChild(element);for(key in locale){value=locale[key];prop=xml.createElement("property");prop.setAttribute("key",key);text=XMLUtils.createTextContent(xml,value);prop.appendChild(text);element.appendChild(prop)}}}};function VideoMediator(componentName,viewComponent){this.mediatorName="#@{getComponentType()}-mediator";VideoMediator.__super__.constructor.call(this,componentName,null,null,viewComponent)};__extends(VideoMediator,ComponentMediator);VideoMediator.prototype.componentType="video";function LayerMediator(){LayerMediator.__super__.constructor.call(this)};__extends(LayerMediator,ComponentMediator);LayerMediator.prototype.componentType="layer";LayerMediator.prototype.onRegister=function(){LayerMediator.__super__.onRegister.call(this);this.registerLayer()};LayerMediator.prototype.onRemove=function(){LayerMediator.__super__.onRemove.call(this);this.removeLayer()};LayerMediator.prototype.registerLayer=function(){this.sendNotification(Notifications.ADD_LAYER,this.viewComponent)};LayerMediator.prototype.removeLayer=function(){this.sendNotification(Notifications.REMOVE_LAYER,this.viewComponent)};function VideoLayerMediator(){VideoLayerMediator.__super__.constructor.call(this)};__extends(VideoLayerMediator,LayerMediator);VideoLayerMediator.prototype.componentName="video";VideoLayerMediator.prototype.video=null;VideoLayerMediator.prototype.listNotificationInterests=function(){return[Notifications.PLAYBACK_CORE_CHANGE]};VideoLayerMediator.prototype.handleNotification=function(notification){var body,name,viewComponent,_ref,_ref1;name=notification.getName();body=notification.getBody();switch(name){case Notifications.PLAYBACK_CORE_CHANGE:viewComponent=(_ref=this.video)!=null?typeof _ref.getViewComponent==="function"?_ref.getViewComponent():void(0):void(0);if(viewComponent!=null)this.viewComponent.removeChild(viewComponent);this.video=body;viewComponent=(_ref1=this.video)!=null?typeof _ref1.getViewComponent==="function"?_ref1.getViewComponent():void(0):void(0);if(viewComponent!=null)this.viewComponent.appendChild(viewComponent)}};function PlayerMediator(componentName,viewComponent){this.componentName=componentName;this.layers=[];PlayerMediator.__super__.constructor.call(this,null,null,null,viewComponent)};__extends(PlayerMediator,ComponentMediator);PlayerMediator.prototype.componentType="player";PlayerMediator.prototype.core=null;PlayerMediator.prototype.medium=null;PlayerMediator.prototype.layers=null;PlayerMediator.prototype.ready=false;PlayerMediator.prototype.onRegister=function(){var device;PlayerMediator.__super__.onRegister.call(this);device=Utils.getDevice();if((device!=null))this.classList.add(device)};PlayerMediator.prototype.listNotificationInterests=function(){return[Notifications.DISPLAY_STATE_CHANGE,Notifications.ACTIVE_STATE_CHANGE,Notifications.PLAY_STATE_CHANGE,Notifications.ADD_APPLICATION_STATE,Notifications.REMOVE_APPLICATION_STATE,Notifications.MEDIUM_CHANGE,Notifications.DURATION_CHANGE,Notifications.TEMPORAL_TYPE_CHANGE,Notifications.ADD_LAYER,Notifications.REMOVE_LAYER,Notifications.READY]};PlayerMediator.prototype.handleNotification=function(notification){var body,layer,name,newState,oldState,state,states,_i,_len,_ref;name=notification.getName();body=notification.getBody();switch(name){case Notifications.ACTIVE_STATE_CHANGE:case Notifications.PLAY_STATE_CHANGE:case Notifications.DISPLAY_STATE_CHANGE:case Notifications.MEDIUM_CHANGE:states=body;newState=states.newState;oldState=states.oldState;if((oldState!=null)&&this.classList.contains(oldState))this.classList.remove(oldState);if(newState!=null)this.classList.add(newState);break;case Notifications.ADD_APPLICATION_STATE:state=body;this.classList.add(state);break;case Notifications.REMOVE_APPLICATION_STATE:state=body;this.classList.remove(state);break;case Notifications.TEMPORAL_TYPE_CHANGE:if(body==="live"){this.sendNotification(Notifications.ADD_APPLICATION_STATE,"live")}else this.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"live");break;case Notifications.DURATION_CHANGE:if(body>3600){this.sendNotification(Notifications.ADD_APPLICATION_STATE,"long-form")}else this.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"long-form");break;case Notifications.ADD_LAYER:this.addLayer(body);break;case Notifications.REMOVE_LAYER:this.removeLayer(body);break;case Notifications.READY:this.ready=true;_ref=this.layers;for(_i=0,_len=_ref.length;_i<_len;_i++){layer=_ref[_i];if(!this.viewComponent.contains(layer))this.viewComponent.appendChild(layer)}}};PlayerMediator.prototype.addLayer=function(layer){this.layers.push(layer);if(this.ready)this.viewComponent.appendChild(layer)};PlayerMediator.prototype.removeLayer=function(layer){var index;if(this.viewComponent.contains(layer))this.viewComponent.removeChild(layer);index=this.layers.indexOf(layer);if(index>=0)this.layers.splice(index,1)};function FlashPlayerMediator(viewComponent){FlashPlayerMediator.__super__.constructor.call(this,this.type,viewComponent)};__extends(FlashPlayerMediator,PlayerMediator);FlashPlayerMediator.NAME="FlashPlayerMediator";FlashPlayerMediator.prototype.type="flash";FlashPlayerMediator.prototype.addLayer=function(layer){FlashPlayerMediator.__super__.addLayer.call(this,layer);if(layer.className.indexOf("video")!==-1&&!this.viewComponent.contains(layer))this.viewComponent.appendChild(layer)};var MediaAnalyticsNotifications={SET_DIMENSIONS:"mediaanalytics:setDimensions"},AISNotifications={START_AUTHENTICATION:"startAuthentication",AUTHENTICATED:"aisauthenticated",AUTHENTICATING:"aisathenticating",AUTHENTICATION_COMPLETE:"authenticationComplete",CHOOSE_AUTH_PROVIDER:"chooseAuthProvider",CHOOSE_PLAY_OPTIONS:"choosePlayOptions",LAUNCH_IDP_LOGIN:"launchIDPLogin"};function AISCommand(){AISCommand.__super__.constructor.call(this)};__extends(AISCommand,puremvc.SimpleCommand);AISCommand.prototype.getProxy=function(){return this.facade.retrieveProxy(AISProxy.NAME)};function AISPauseCommand(){AISPauseCommand.__super__.constructor.call(this)};__extends(AISPauseCommand,AISCommand);AISPauseCommand.prototype.execute=function(notification){var proxy;this.facade.logger.debug("AISPauseCommand");proxy=this.getProxy();proxy.vcsSet(proxy.currentTime)};function AISEndedCommand(){AISEndedCommand.__super__.constructor.call(this)};__extends(AISEndedCommand,AISCommand);AISEndedCommand.prototype.execute=function(notification){this.facade.logger.debug("AISEndedCommand");this.getProxy().vcsSet(0)};function Cookies(){};Cookies.setCookie=function(name,value,days,path,domain){var expires;value=escape(value);if(days!=null){expires=new Date();expires.setDate(expires.getDate()+days);value+="; expires="+expires.toUTCString()};if(domain!=null)value+="; domain="+domain;if(path!=null)value+="; path="+path;return document.cookie=name+"="+value};Cookies.getCookie=function(name){var cookie,cookies,index,key,value,_i,_len;cookies=document.cookie.split(";");for(_i=0,_len=cookies.length;_i<_len;_i++){cookie=cookies[_i];index=cookie.indexOf("=");key=cookie.substr(0,index).replace(/^\s+|\s+$/g,"");value=unescape(cookie.substr(index+1));if(key===name)return value}};Cookies.deleteCookie=function(name){return this.setCookie(name,"",-1)};function AISTimeUpdateCommand(){AISTimeUpdateCommand.__super__.constructor.call(this)};__extends(AISTimeUpdateCommand,AISCommand);AISTimeUpdateCommand.prototype.execute=function(notification){var currentTime,proxy;proxy=this.getProxy();currentTime=Math.floor(notification.getBody());if(currentTime!==0&&currentTime%30===0&&currentTime!==proxy.currentTime)proxy.vcsSet(currentTime);proxy.currentTime=currentTime};function AISProxy(config){AISProxy.__super__.constructor.call(this,config)};__extends(AISProxy,PluginProxy);AISProxy.NAME=ModuleProxy.NAME;AISProxy.prototype.client=null;AISProxy.prototype.currentTime=null;AISProxy.prototype.idps=null;AISProxy.prototype.idp=null;AISProxy.prototype.token=null;AISProxy.prototype.authz=null;AISProxy.prototype.defaults={plugin:null,platformID:null,resourceID:null,contentID:null,responseTargets:null,logos:{base:null,group:null,key:"full"}};AISProxy.prototype.getScript=function(){return this.value.plugin};AISProxy.prototype.initialize=function(){this.client=window.ais_client;this.client.setLogging(this.facade.logger.enabled);this.client.setPlatformId(this.value.platformID);this.client.setUseCache(!/MSIE [7-8]/.test(navigator.userAgent));this.client.assignhandler('bounce',this.bounceHandler.bind(this));this.client.assignhandler('chooser',this.chooserHandler.bind(this));this.client.assignhandler('init',this.initHandler.bind(this));this.client.assignhandler('authz_query',this.authz_queryHandler.bind(this));this.client.assignhandler('identity',this.identityHandler.bind(this));this.client.assignhandler('logout_result',this.logoutHandler.bind(this));this.client.assignhandler('vcs',this.vcsHandler.bind(this));window.onunload=function(){}};AISProxy.prototype.authorize=function(){this.authz=null;this.token=null;this.disengage();this.sendNotification(AISNotifications.START_AUTHENTICATION)};AISProxy.prototype.authorized=function(token){if(token==null)token=this.token;this.engage();this.sendNotification(AISNotifications.AUTHENTICATION_COMPLETE);this.sendNotification(SecurityNotifications.AUTHORIZED,token)};AISProxy.prototype.play=function(time){this.sendNotification(Notifications.INITIALIZED);this.sendNotification(Notifications.PLAY);if(time!=null)return this.sendNotification(Notifications.SEEK,time)};AISProxy.prototype.engage=function(){this.facade.registerCommand(Notifications.TIME_UPDATE,AISTimeUpdateCommand);this.facade.registerCommand(Notifications.PAUSE,AISPauseCommand);this.facade.registerCommand(Notifications.ENDED,AISEndedCommand)};AISProxy.prototype.disengage=function(){this.facade.removeCommand(Notifications.TIME_UPDATE);this.facade.removeCommand(Notifications.PAUSE);this.facade.removeCommand(Notifications.ENDED)};AISProxy.prototype.logout=function(){var height,method,target,width,_ref;method=((_ref=this.idp.window_display)!=null?_ref.method:void(0))||"redirect";target=this.getTarget(method);this.setRedirect(method);switch(method){case"redirect":window.open(this.client.logoutFormat(target),"_top");break;case"popup":width=this.idp.window_display.width||320;height=this.idp.window_display.height||240;window.open(this.client.logoutFormat(target),'ais_popup','width='+width+',height='+height)}};AISProxy.prototype.bounce=function(resource){this.client.bounce()};AISProxy.prototype.init=function(resource){this.client.init()};AISProxy.prototype.choose=function(){this.client.chooser()};AISProxy.prototype.resourceAccess=function(resource){if(resource==null)resource=this.value.resourceID;this.client.resourceAccess(resource)};AISProxy.prototype.vcsSet=function(time){time=Utils.formatTimecode(time);return this.client.vcsSet(this.value.contentID,time)};AISProxy.prototype.bounceHandler=function(type,resp){var auth;auth=resp.authenticated.toString()==='true';if(auth===false){this.sendNotification(Notifications.DISPATCH_EVENT,new Event("authenticationfailed"));this.choose()}else if(auth===true)this.init()};AISProxy.prototype.initHandler=function(type,resp){var key,key2,value,value2,_ref;this.facade.logger.debug(type,resp);this.idp=resp.idps;this.facade.idps={};_ref=resp.idps;for(key in _ref){value=_ref[key];this.facade.idps.key=key;for(key2 in value){value2=value[key2];this.facade.idps[key2]=value2};break};for(key in resp){value=resp[key];if(key!=="idps"&&(value!=null))this.facade[key]=value};this.facade.idps.logo=this.value.logos.base+this.facade.idps.logos[this.value.logos.key];this.facade.app.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"authenticating");this.sendNotification(AISNotifications.AUTHENTICATED,this.facade.idps);this.resourceAccess(this.value.resourceID)};AISProxy.prototype.chooserHandler=function(type,resp){this.facade.logger.debug(type,resp.authenticated);this.facade.sendNotification(Notifications.ADD_APPLICATION_STATE,"authenticating");resp.possible_idps=this.idps=this.sort(resp.possible_idps,'value','display_name');this.sendNotification(AISNotifications.CHOOSE_AUTH_PROVIDER,resp)};AISProxy.prototype.launchIDPLogin=function(idp_platform_id){var height,idp,method,target,width,_ref;this.sendNotification(AISNotifications.AUTHENTICATING,true);idp=this.idps[idp_platform_id];method=((_ref=idp.window_display)!=null?_ref.method:void(0))||"redirect";target=this.getTarget(method);this.setRedirect(method);switch(method){case"redirect":window.open(this.client.loginFormat(idp_platform_id,target),"_top");break;case"popup":method=idp.window_display.method||"popup";width=idp.window_display.width||320;height=idp.window_display.height||240;window.open(this.client.loginFormat(idp_platform_id,target),'ais_popup','width='+width+',height='+height)}};AISProxy.prototype.identityHandler=function(type,resp){var aisuid;this.facade.logger.debug(type,resp);aisuid=resp.identity['attributes']['aisuid']};AISProxy.prototype.authz_queryHandler=function(type,resp){var auth,dimensions,resource;this.facade.logger.debug(type,resp);auth=resp.authorization.toString()==="true";if(auth===false){this.sendNotification(SecurityNotifications.AUTHORIZATION_FAILED);this.authorize()}else if(auth===true){this.authz=resp;dimensions={mvpdName:this.facade.idps.name,viewerId:this.client.aisuid,"std:viewerId":this.client.aisuid};this.facade.app.sendNotification(MediaAnalyticsNotifications.SET_DIMENSIONS,dimensions);this.facade.viewerId=this.client.aisuid;resource=resp.resource;if(resource!=null)this.facade.resource=resource;this.token="hdnea="+resp.security_token;this.sendNotification(SecurityNotifications.SET_KEY,"hdnea=");this.sendNotification(SecurityNotifications.SET_TOKEN,resp.security_token);this.sendNotification(AISNotifications.AUTHENTICATING,false);if(this.value.contentID!=null){this.client.vcsGet(this.value.contentID)}else this.authorized(this.token)}};AISProxy.prototype.logoutHandler=function(type,resp){top.location.href=top.location.href};AISProxy.prototype.vcsHandler=function(type,resp){if(resp.operation==='get')if(resp.ph_pos==='00:00:00'||resp.ph_pos==="00:00"){this.client.vcsSet(this.value.contentID,resp.ph_pos);this.authorized(this.token)}else this.sendNotification(AISNotifications.CHOOSE_PLAY_OPTIONS,Utils.flattenTimecode(resp.ph_pos))};AISProxy.prototype.sort=function(obj,sortType,valueName){var data,index,item,key,returnObj,value,_i,_len;returnObj={};data=[];index=0;for(key in obj){value=obj[key];data[index]={key:key,value:value[valueName]};index++};data.sort(function(a,b){var valueA,valueB;valueA=sortType==='value'?a.value.toLowerCase():a.key.toLowercase();valueB=sortType==='value'?b.value.toLowerCase():b.key.toLowercase();if(valueA<valueB){return-1}else if(valueA>valueB){return 1}else return 0});for(index=_i=0,_len=data.length;_i<_len;index=++_i){item=data[index];returnObj[item.key]=obj[item.key]};return returnObj};AISProxy.prototype.setRedirect=function(method){var devToken,domain,loc;try{devToken=/\/dev\./;loc=window.top.location.href||window.top.location;domain=devToken.test(loc)?loc.replace(devToken,"/"):null;Cookies.setCookie(this.getTarget(method),loc,1,"/",domain)}catch(error){}};AISProxy.prototype.getTarget=function(method){if(method==null)method="redirect";return this.value.responseTargets[method]};function PlaybackProxy(){PlaybackProxy.__super__.constructor.call(this,PlaybackProxy.NAME);this.data={core:null,muted:false,started:false,volume:1,handlers:null};if(Utils.getDevice()==="desktop")this.initialized=true};__extends(PlaybackProxy,puremvc.Proxy);PlaybackProxy.NAME="PlaybackProxy";PlaybackProxy.prototype.data=null;PlaybackProxy.prototype.initialized=false;PlaybackProxy.prototype.getCore=function(){return this.facade.getVideo()};PlaybackProxy.prototype.getStarted=function(){return this.data.started};PlaybackProxy.prototype.setStarted=function(value){this.data.started=value;return value};PlaybackProxy.prototype.getHandlers=function(){return this.data.handlers};PlaybackProxy.prototype.setHandlers=function(value){var handler,_i,_len,_ref;if(this.data.handlers!=null){_ref=this.data.handlers;for(_i=0,_len=_ref.length;_i<_len;_i++){handler=_ref[_i];handler.clear()}};this.data.handlers=value;return value};PlaybackProxy.prototype.getVideo=function(){return this.data.core};PlaybackProxy.prototype.setVideo=function(value){if(value===this.data.core)return;this.data.core=value;return this.data.core};PlaybackProxy.prototype.canPlayType=function(mimeType){var canPlay;canPlay=this.data.core.canPlayType(mimeType)||"";if((/Android 4\.[1-9]/.test(navigator.userAgent)||/Silk\/3/.test(navigator.userAgent))&&mimeType===Utils.mimeTypes.m3u8)canPlay="maybe";return canPlay};PlaybackProxy.prototype.getPaused=function(){return this.data.core.paused};PlaybackProxy.prototype.getEnded=function(){return this.data.core.ended};PlaybackProxy.prototype.getSeeking=function(){return this.data.core.seeking};PlaybackProxy.prototype.getCurrentTime=function(){var _ref;return(_ref=this.data.core)!=null?_ref.currentTime:void(0)};PlaybackProxy.prototype.setCurrentTime=function(value){if(!this.data.core||value===this.data.core.currentTime)return;return this.data.core.currentTime=Utils.clamp(value,0,this.getDuration())};PlaybackProxy.prototype.getSrc=function(){return this.data.core.src};PlaybackProxy.prototype.setSrc=function(value){if(!(value!=null)||value==="")this.sendNotification(Notifications.ERROR,"The value of src is not supported: "+value);this.data.started=false;this.data.core.src=value;return value};PlaybackProxy.prototype.getVolume=function(){return this.data.core.volume};PlaybackProxy.prototype.setVolume=function(value){if((0<=value&&value<=1)&&value!==this.data.core.volume)this.sendNotification(Notifications.VOLUME_CHANGE,this.data.core.volume=value);return value};PlaybackProxy.prototype.getMuted=function(){return this.data.muted};PlaybackProxy.prototype.setMuted=function(value){var volume;this.data.muted=value;if(this.data.muted===true){this.data.volume=this.getVolume();volume=0}else volume=this.data.volume;this.sendNotification(Notifications.CHANGE_VOLUME,volume);return value};PlaybackProxy.prototype.getDuration=function(){var _ref;return(_ref=this.data.core)!=null?_ref.duration:void(0)};PlaybackProxy.prototype.play=function(){if(!this.data.started)this.data.started=true;this.data.core.play()};PlaybackProxy.prototype.pause=function(){this.data.core.pause()};PlaybackProxy.prototype.load=function(){this.data.core.load()};PlaybackProxy.prototype.end=function(){if(!this.data.core)return;this.data.core.currentTime=this.data.core.duration};function FlashAuthorizedCommand(){FlashAuthorizedCommand.__super__.constructor.call(this)};__extends(FlashAuthorizedCommand,puremvc.SimpleCommand);FlashAuthorizedCommand.prototype.execute=function(notification){var mediaProxy,securityProxy,src;this.facade.logger.debug("FlashAuthorizedCommand");mediaProxy=this.facade.retrieveProxy(FlashMediaProxy.NAME);securityProxy=this.facade.retrieveProxy(SecurityProxy.NAME);src=mediaProxy.getSrc()||"";if(src.indexOf(".smil")===-1)src=securityProxy.createURL(src);mediaProxy.setSrc(src);this.facade.video.authenticationComplete({media:mediaProxy.getData()})};function PlaybackCoreProxy(supportedTypes){this.supportedTypes=!(supportedTypes!=null)?[]:supportedTypes;PlaybackCoreProxy.__super__.constructor.call(this)};__extends(PlaybackCoreProxy,PlaybackProxy);PlaybackCoreProxy.prototype.supportedTypes=null;PlaybackCoreProxy.prototype.src=null;PlaybackCoreProxy.prototype.playbackCoreName=null;PlaybackCoreProxy.prototype.getPlaybackCoreName=function(){return this.playbackCoreName};PlaybackCoreProxy.prototype.getSupportedTypes=function(){return this.supportedTypes};PlaybackCoreProxy.prototype.setSupportedTypes=function(types){this.supportedTypes=types;return types};PlaybackCoreProxy.prototype.getSrc=function(){return this.src};PlaybackCoreProxy.prototype.setSrc=function(value){var mediaProxy,type;if(!(value!=null)||value==="")this.facade.sendNotification(Notifications.ERROR,"The value of src is not supported: "+value);this.src=value;mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);type=mediaProxy.getType();this.createPlayer(type);return value};PlaybackCoreProxy.prototype.createPlayer=function(type){};PlaybackCoreProxy.prototype.canPlayType=function(mimeType){if(this.getSupportedTypes().indexOf(mimeType)!==-1)return"maybe";return""};function FlashPlaybackProxy(player){this.player=player;FlashPlaybackProxy.__super__.constructor.call(this)};__extends(FlashPlaybackProxy,PlaybackCoreProxy);FlashPlaybackProxy.NAME=PlaybackProxy.NAME;FlashPlaybackProxy.prototype.player=null;FlashPlaybackProxy.prototype.initialized=true;FlashPlaybackProxy.prototype.playbackCoreName="flash";FlashPlaybackProxy.prototype.supportedTypes=["video/mp4","video/x-flv","video/f4m","application/smil","application/smil+xml"];FlashPlaybackProxy.prototype.getPaused=function(){return this.player.getPaused()};FlashPlaybackProxy.prototype.getEnded=function(){return this.player.getEnded()};FlashPlaybackProxy.prototype.getSeeking=function(){return this.player.getSeeking()};FlashPlaybackProxy.prototype.getCurrentTime=function(){return this.player.getCurrentTime()};FlashPlaybackProxy.prototype.setCurrentTime=function(value){this.player.setCurrentTime(value);return value};FlashPlaybackProxy.prototype.getSrc=function(){return this.player.getSrc()};FlashPlaybackProxy.prototype.setSrc=function(value){this.player.setSrc(value);return value};FlashPlaybackProxy.prototype.getVolume=function(){return this.player.getVolume()};FlashPlaybackProxy.prototype.setVolume=function(value){this.player.setVolume(value);return value};FlashPlaybackProxy.prototype.getMuted=function(){return this.player.getMuted()};FlashPlaybackProxy.prototype.setMuted=function(value){this.player.setMuted(value);return value};FlashPlaybackProxy.prototype.getDuration=function(value){return this.player.getDuration()};FlashPlaybackProxy.prototype.play=function(){this.player.play()};FlashPlaybackProxy.prototype.pause=function(){this.player.pause()};FlashPlaybackProxy.prototype.load=function(){this.player.load()};FlashPlaybackProxy.prototype.end=function(){this.player.end()};function ModuleDispatcher(api,dispatcher){this.api=api;this.dispatcher=dispatcher!=null?dispatcher:new EventDispatcher(this.api);ModuleDispatcher.__super__.constructor.call(this,null,this)};__extends(ModuleDispatcher,puremvc.Mediator);ModuleDispatcher.NAME="ModuleDispatcher";ModuleDispatcher.prototype.dispatcher=null;ModuleDispatcher.prototype.api=null;ModuleDispatcher.prototype.onRegister=function(){var dispatchEvent,_this=this;dispatchEvent=this.dispatcher.dispatchEvent;this.dispatcher.dispatchEvent=function(event){_this.log(_this.getMessage(event),event);dispatchEvent(event)}};ModuleDispatcher.prototype.listNotificationInterests=function(){return[Notifications.DISPATCH_EVENT].concat(this.facade.listNotificationEvents())};ModuleDispatcher.prototype.handleNotification=function(notification){var body,name;name=notification.getName();body=notification.getBody();if(name===Notifications.DISPATCH_EVENT){this.dispatchEvent(body)}else this.dispatchEvent(this.createEvent(this.getType(name),body))};ModuleDispatcher.prototype.createEvent=function(type,data){return new Event(type,data)};ModuleDispatcher.prototype.dispatchEvent=function(event){this.dispatcher.dispatchEvent(event)};ModuleDispatcher.prototype.getType=function(type){return type.replace(new RegExp("^"+(this.facade.getModuleName())),"")};ModuleDispatcher.prototype.getMessage=function(event){return"["+(this.facade.getModuleName().toUpperCase())+" EVENT]"};ModuleDispatcher.prototype.log=function(message,event){if((message!=null)&&(event!=null))if(event.data!=null){this.facade.logger.log(message,event.type,event,event.data)}else this.facade.logger.log(message,event.type,event)};var FlashAdNotifications={BREAK_START:"adComponentBreakInitiated",BREAK_END:"adComponentBreakComplete",AD_LOADED:"adComponentLoaded",AD_STARTED:"adComponentAdBegin",AD_TIME_UPDATE:"adComponentPlaybackProgress",AD_TIME_REMAINING:"adComponentTimeElapsed",AD_DURATION_CHANGE:"addurationchange",AD_ENDED:"adComponentAdComplete",AD_ERROR:"adComponentInitFailed",AD_PLAY:"adComponentPlaybackResumed",AD_PAUSE:"adComponentPlaybackPaused",AD_LOG:"adComponentLog",AD_COMPANION:"adComponentCompanion",AD_PLAYBACK_FAILED:"adComponentPlaybackFailed",AD_PLAYBACK_TERMINATED:"adComponentPlaybackTerminated",AD_MEDIA_LOADED:"adComponentMediaLoaded",AD_CLICKED:"adComponentClicked",AD_FIRST_QUARTILE:"adComponentFirstQuartile",AD_MIDPOINT:"adComponentMidpoint",AD_THIRD_QUARTILE:"adComponentThirdQuartile",AD_REQUEST:"adComponentAdsRequest"},FlashNotifications={READY:"jsApiReady",RESET:"mediaPlayerReset",LOADING:"mediaPlayerLoading",PLAYER_ERROR:"mediaPlayerError",MEDIA_ERROR:"mediaError",ERROR_STREAM_NOT_FOUND:"mediaPlayerErrorStreamNotFound",CAPABILITY_CHANGE:"mediaPlayerCapabilityChange",PLAYBACK_OPEN:"mediaPlayerPlaybackOpen",PLAYING:"mediaPlayerPlaying",ENDED:"mediaPlayerPlaybackSequenceComplete",PAUSED:"mediaPlayerPaused",BUFFERING:"mediaPlayerBuffering",DURATION_CHANGE:"mediaPlayerDurationChange",TIME_UPDATE:"mediaPlayerPlayheadUpdate",SEEKING_CHANGE:"mediaPlayerSeekingChange",ERROR:"error",VOLUME_CHANGE:"mediaPlayerVolumeChanged",PLAY_STATE_CHANGE:"mediaPlayerPlayStateChange",STATE_CHANGE:"mediaPlayerStateChange",CAPTION_DATA_CHANGE:"mediaPlayerCaptiondataChange",FAIL_OVER_ATTEMPT:"mediaPlayerFailoverAttempt",ELEMENT_EVENT:"mediaPlayerElementEvent",PLAY:"mediaPlayerResumeOrPausePlayback",APPLICATION_STATE_CHANGE:"mediaPlayerApplicationStateChange",INITIALIZED:"mediaPlayerInitialized",LOAD_STATE_READY:"mediaLoadStateReady",LOAD_STATE_LOADING:"mediaLoadStateLoading",FULLSCREEN_CHANGE:"mediaPlayerFullscreenChange",AUTHORIZE:"mediaPlayerAuthenticate",CAPTIONING_REQUEST:"mediaPlayerCaptioningRequest",CAPTION_LANG_CHANGE:"mediaPlayerCaptionLangChange",RECOMMENDATIONS_LOADED:"mediaPlayerRecommendationsLoaded",RECOMMENDATION_SELECTED:"mediaPlayerRecommendationSelected",SHARE:"mediaPlayerShare",SHARE_REQUEST:"mediaPlayerShareRequest",AUTO_ADVANCE:"mediaPlayerAutoAdvance",CREATE_FLASH_VARS:"createFlashVars",CREATE_XML:"createXML",FLASH_CREATED:"flashCreated",PLAY_REQUEST:"mediaPlayerPlaybackSequenceInitiated",FEED_LOADED:"mediaPlayerFeedLoaded"};function PlayerDispatcher(api,dispatcher){PlayerDispatcher.__super__.constructor.call(this,api,dispatcher)};__extends(PlayerDispatcher,ModuleDispatcher);PlayerDispatcher.NAME="PlayerDispatcher";PlayerDispatcher.prototype.dispatchEvent=function(event){event.player=this.facade.parent;this.dispatcher.dispatchEvent(event)};PlayerDispatcher.prototype.getMessage=function(event){if(event.type==="timeupdate"||event.type==="progress")return;return PlayerDispatcher.__super__.getMessage.call(this,event)};function FlashPlayerDispatcher(api,dispatcher){FlashPlayerDispatcher.__super__.constructor.call(this,api,dispatcher)};__extends(FlashPlayerDispatcher,PlayerDispatcher);FlashPlayerDispatcher.NAME="FlashPlayerDispatcher";FlashPlayerDispatcher.prototype.getMessage=function(event){if(event.type===FlashNotifications.TIME_UPDATE||event.type===FlashNotifications.CAPTION_DATA_CHANGE||event.type===FlashAdNotifications.AD_TIME_UPDATE||event.type===FlashAdNotifications.AD_TIME_REMAINING||event.type===FlashNotifications.ELEMENT_EVENT)return;return FlashPlayerDispatcher.__super__.getMessage.call(this,event)};function FlashPlayerAPI(player,dispatcher){ModuleAPI.attachModuleDispatcher(player,new FlashPlayerDispatcher(this,dispatcher));this.getContainer=function(){return player.getViewComponent()};this.getVideo=function(){return player.getVideo()};this.getConfig=function(){return player.getConfig()};this.destroy=function(){return player.destroy()};this.getFlashXML=function(){var str,xml;str=unescape(player.flashvars.settings_xml);xml=XMLUtils.parse(str);xml.toString=function(){return str};return xml};this.getFlashVars=function(){return player.flashvars};this.evaluateBinding=function(str){return player.video.evaluateBinding(str)};this.recordContentChange=function(content){return player.video.recordContentChange(content)};this.canPlayType=function(mimeType){if(__indexOf.call(Utils.flashTypes,mimeType)>=0){return"maybe"}else return""};this.replay=function(){player.video.replay()};this.pause=function(){player.video.pause()};this.end=function(){player.video.stopPlayer()};this.getCurrentTime=function(value){return player.video.getCurrentTime()};this.setCurrentTime=function(value){player.video.jumpToTime(value);return value};this.getParams=function(){return player.video.getParams()};this.setParams=function(value){player.video.setParams(value);return value};this.getVolume=function(){return player.video.getVolume()};this.setVolume=function(value,scope){player.video.setVolume(value,scope||"");return value};this.getDuration=function(){return player.video.getDuration()};this.enterFullScreen=function(){player.video.enterFullScreen()};this.exitFullScreen=function(){player.video.exitFullScreen()};this.setMedia=player.setMedia.bind(player);this.getMedia=player.getMedia.bind(player);this.load=player.load.bind(player);this.play=player.play.bind(player);this.setMuted=player.setMuted.bind(player);this.getMuted=player.getMuted.bind(player);this.getSrc=player.getSrc.bind(player);this.setSrc=player.setSrc.bind(player);this.setAutoplay=player.setAutoplay.bind(player);this.getAutoplay=player.getAutoplay.bind(player);this.getMedium=player.getMedium.bind(player);this.setMedium=player.setMedium.bind(player);this.setSource=player.setSource.bind(player);this.getSource=player.getSource.bind(player);this.getSeeking=player.getSeeking.bind(player);this.getPaused=player.getPaused.bind(player);this.getEnded=player.getEnded.bind(player)};__extends(FlashPlayerAPI,PlayerAPI);FlashPlayerAPI.prototype.getFlashXML=function(){};FlashPlayerAPI.prototype.getFlashVars=function(){};function FlashPlayer(config,viewComponent,dispatcher){var attributes,expressInstallSWF,flash,params,swf,swfs,version,_ref,_this=this;this.flashObjectID+=Date.now();this.plugins={};FlashPlayer.__super__.constructor.call(this,config,viewComponent,dispatcher);this.debug=/debug\=true/.test(location.search);this.media={};flash=this.config.flash||{};swfs=((_ref=flash["static"])!=null?_ref.enabled:void(0))===true?flash["static"]:flash;swf=this.debug&&(swfs.debug!=null)?swfs.debug:swfs.swf||"amp.swf";version=flash.version||"10.1";expressInstallSWF=flash.expressInstallSWF||"playerProductInstall.swf";params=this.createParams(flash);attributes=this.createAttributes(flash);this.flashvars=this.createFlashVars(flash);if(!(this.flashvars.settings_url!=null))this.flashvars.settings_xml=this.createXML(this.config);swfobject.embedSWF(swf,this.flashObjectID,"100%","100%",version,expressInstallSWF,this.flashvars,params,attributes,function(obj){_this.createdHandler(obj)})};__extends(FlashPlayer,Player);FlashPlayer.prototype.playerType="flash";FlashPlayer.prototype.flashObjectID="flashObject";FlashPlayer.prototype.playState=null;FlashPlayer.prototype.loaded=false;FlashPlayer.prototype.flashvars=null;FlashPlayer.prototype.seeking=false;FlashPlayer.prototype.paused=false;FlashPlayer.prototype.ended=false;FlashPlayer.prototype.media=null;FlashPlayer.prototype.muted=false;FlashPlayer.prototype.plugins=null;FlashPlayer.prototype.debug=false;FlashPlayer.prototype.started=false;FlashPlayer.prototype.createAPI=function(){return new FlashPlayerAPI(this,this.dispatcher)};FlashPlayer.prototype.createModel=function(){this.registerProxy(new DataBindingProxy());this.registerProxy(new SecurityProxy());this.registerProxy(new FlashMediaProxy());this.registerProxy(new FlashPlaybackProxy(this))};FlashPlayer.prototype.createView=function(){this.registerMediator(new FlashPlayerMediator(this.getViewComponent()));this.registerMediator(new VideoLayerMediator());this.registerMediator(new OverlayLayerMediator());this.registerMediator(new LocalizationWrapper(this,this.config))};FlashPlayer.prototype.createController=function(){this.registerCommand(SecurityNotifications.AUTHORIZED,FlashAuthorizedCommand);this.registerCommand(SecurityNotifications.SET_TOKEN,SecuritySetTokenCommand);this.registerCommand(SecurityNotifications.SET_KEY,SecuritySetKeyCommand)};FlashPlayer.prototype.createVideo=function(){var video,viewComponent;video=new VideoMediator("flash","div");viewComponent=video.getViewComponent();viewComponent.id=viewComponent.name=this.flashObjectID;this.sendNotification(Notifications.PLAYBACK_CORE_CHANGE,video);return viewComponent};FlashPlayer.prototype.createParams=function(flash){var params;params={allowFullScreen:true,allowScriptAccess:"always",wmode:"direct",bgColor:"#000000"};if(flash.params!=null){if(flash.params.allowFullScreen!=null)params.allowFullScreen=flash.params.allowFullScreen;if(flash.params.allowScriptAccess!=null)params.allowScriptAccess=flash.params.allowScriptAccess;if(flash.params.wmode!=null)params.wmode=flash.params.wmode;if(flash.params.bgColor!=null)params.bgColor=flash.params.bgColor};if(params.wmode==="direct"&&/MSIE/.test(navigator.userAgent))params.wmode="transparent";return params};FlashPlayer.prototype.getModules=function(){return this.plugins};FlashPlayer.prototype.createPlugins=function(){var def,key,register,_ref;_ref=AMP.plugins;for(key in _ref){register=_ref[key];if(!((key in this.config)&&!(this.config[key].enabled===false)))continue;def=register[this.getPlayerType()];if(!(def!=null)){this.logger.debug("Plugin could not be found: "+key);continue};try{this.plugins[key]=new def(this,this.config[key]);this.registerMediator(this.plugins[key]);this.logger.debug("Plugin loaded: "+key)}catch(error){this.error("Flash Plugin Load Error ("+key+")",error);continue}}};FlashPlayer.prototype.createAttributes=function(flash){var attributes;attributes={id:this.flashObjectID,name:this.flashObjectID};if(flash.attributes!=null){if(flash.attributes.id!=null)attributes.id=flash.attributes.id;if(flash.attributes.name!=null)attributes.name=flash.attributes.name};return attributes};FlashPlayer.prototype.createFlashVars=function(flash){var flashvars,key,value,_ref,_ref1,_ref2,_ref3;flashvars={};if(this.config.autoplay!=null)flashvars.auto_play=this.config.autoplay;if(((_ref=this.config.controls)!=null?_ref.displaySceneMarkers:void(0))!=null)flashvars.displaySceneMarkers=this.config.controls.displaySceneMarkers;if((this.config.rules!=null))Utils.mergeRules(this.config.rules);flashvars.hinting_rules=escape(JSON.stringify(Utils.rules));if(this.config.media!=null){if(this.config.media.src!=null){this.setSrc(this.config.media.src);flashvars.video_url=escape(this.config.media.src)};if((this.config.media.source!=null)&&this.config.media.source.length>0){this.setSource(this.config.media.source);flashvars.video_url=escape(this.media.src)};if(this.config.media.medium!=null){this.setMedium(this.config.media.medium);flashvars.medium=this.config.media.medium};if(this.config.media.title!=null)flashvars.title=escape(this.config.media.title);if(this.config.media.poster!=null)flashvars.poster=escape(this.config.media.poster);if(this.config.media.temporalType!=null)flashvars.temporalType=this.config.media.temporalType};if(this.getMedium()==="audio"){flashvars.controls=true;flashvars.auto_hide=-1};if(((_ref1=this.config.ima)!=null?(_ref2=_ref1.overlay)!=null?_ref2.delay:void(0):void(0))!=null)flashvars.overlay_ad_delay=this.config.ima.overlay.delay;if(this.config.volume!=null)flashvars.volume=Utils.clamp(this.config.volume,0,1);if((this.config.target!=null))flashvars.external_target=this.config.target;if((this.config.name!=null))flashvars.core_player_name=this.config.name;if((this.config.domain!=null))flashvars.embed_domain=flashvars.domain=this.config.domain;flashvars.auto_replay=this.config.loop===true;if((this.config.ticker!=null)&&this.config.ticker.enabled!==false){if(this.config.ticker.url!=null)flashvars.ticker_text_url=this.config.ticker.url;if(this.config.ticker.interval!=null)flashvars.ticker_polling_interval=this.config.ticker.interval;if(this.config.ticker.speed!=null)flashvars.ticker_speed=this.config.ticker.speed};if(this.config.fullscreen!=null)flashvars.fullscreen_enabled=this.config.fullscreen.enabled!==false;if(this.config.titlebar!=null)flashvars.titlebar_enabled=this.config.titlebar.enabled!==false;if(this.config.params!=null)flashvars.params=escape(JSON.stringify(this.config.params));if(this.config.version!=null)flashvars.context_menu_label=this.config.version;flashvars.show_play_button_overlay=false;flashvars.auto_play_list=false;flashvars.next_video_timer=0;if(flashvars.context_menu_mode==null)flashvars.context_menu_mode=this.debug===true?"long":"short";this.sendNotification(FlashNotifications.CREATE_FLASH_VARS,{flashvars:flashvars,config:this.config});if(flash.vars!=null){_ref3=flash.vars;for(key in _ref3){value=_ref3[key];flashvars[key]=value}};return flashvars};FlashPlayer.prototype.createXML=function(config){var app,clss,plugin,plugins,staticConfig,str,url,xml,_i,_j,_len,_len1;xml=XMLUtils.parse(config.flash.xml);this.sendNotification(FlashNotifications.CREATE_XML,{config:config,xml:xml});plugins=xml.getElementsByTagName("plugin");staticConfig=config.flash["static"];if((staticConfig!=null?staticConfig.enabled:void(0))===true&&(staticConfig.plugins!=null)){for(_i=0,_len=plugins.length;_i<_len;_i++){plugin=plugins[_i];if(!((clss=staticConfig.plugins[plugin.getAttribute("id")])!=null))continue;plugin.setAttribute("type","static");XMLUtils.updateTextContent(plugin,clss)}}else if(this.debug===true)for(_j=0,_len1=plugins.length;_j<_len1;_j++){plugin=plugins[_j];if(!(plugin.getAttribute("id")==="AkamaiAdvancedStreamingPlugin"))continue;url=plugin.textContent||plugin.text;XMLUtils.updateTextContent(plugin,url.replace("AkamaiAdvancedStreamingPlugin.swf","AkamaiAdvancedStreamingPlugin-logging.swf"))};str=XMLUtils.serialize(xml);app=str.match(/<application>[\w\W\s\S\d\D]*<\/application>/)[0]||str;app=app.replace(/[\n\r\t]/g,"");return escape(app)};FlashPlayer.prototype.createdHandler=function(obj){var _this=this;this.video=obj.ref;this.video.className="video";this.video.eventHandler=function(eventName,body){return _this.eventHandler(eventName,body)};this.sendNotification(FlashNotifications.FLASH_CREATED);if(this.getMedium()!=null)this.setMedium(this.media.medium)};FlashPlayer.prototype.eventHandler=function(eventName,body){var error,event,state,type;try{switch(eventName){case FlashNotifications.INITIALIZED:type=state="ready";break;case FlashNotifications.RESET:if(!(body!=null))state="ready";this.started=false;break;case FlashNotifications.LOADING:type="loadstart";break;case FlashNotifications.PLAYER_ERROR:type=state="error";break;case FlashNotifications.MEDIA_ERROR:type=state="error";break;case FlashNotifications.ERROR_STREAM_NOT_FOUND:type=state="error";break;case FlashNotifications.CAPABILITY_CHANGE:event=body.type;if(event==="canPlayChange"&&body.enabled===true){type="canplay";this.loaded=true}else if(event==="canSeekChange"&&body.enabled===true){type="canplaythrough"}else if(event==="temporalChange"&&body.enabled===true)type="loadedmetadata";break;case FlashNotifications.PLAYBACK_OPEN:type="started";this.started=true;break;case FlashNotifications.PLAYING:if(!this.started)this.sendNotification(Notifications.PLAY,body);type=state="playing";this.ended=false;this.paused=false;break;case FlashNotifications.PLAY_REQUEST:type="playrequest";break;case FlashNotifications.PLAY:if(this.playState!=="paused"&&this.started)type="play";break;case FlashNotifications.ENDED:type=state="ended";this.ended=true;break;case FlashNotifications.PAUSED:type="pause";state="paused";this.paused=true;break;case FlashNotifications.BUFFERING:if(this.className!=="ended")type=state="waiting";break;case FlashNotifications.DURATION_CHANGE:if(!isNaN(body.time)){type="durationchange";body=body.time};break;case FlashNotifications.VOLUME_CHANGE:type="volumechange";break;case FlashNotifications.TIME_UPDATE:type="timeupdate";break;case FlashNotifications.SEEKING_CHANGE:type=body.seeking?"seeking":"seeked";this.seeking=body.seeking;break;case FlashNotifications.FULLSCREEN_CHANGE:type="fullscreenchange";body=body.displayState==="fullScreen";break;case FlashNotifications.FAIL_OVER_ATTEMPT:type="failoverattempt";body=body;break;case FlashNotifications.ERROR:eventName=null};if((eventName!=null)&&eventName!==type){this.sendNotification(Notifications.DISPATCH_EVENT,{type:eventName,data:body,player:this.parent});this.sendNotification(eventName,body)};if(type!=null){if(type==="error"){error=body.error||body;this.error("Flash Error",error)};this.sendNotification(type,body)};if(state!=null)this.setPlayState(state)}catch(error){this.error("Flash Event Error",error)}};FlashPlayer.prototype.error=function(msg,error){this.logger.error("[AMP ERROR] "+msg+":",error)};FlashPlayer.prototype.setPlayState=function(state){var states;if(state===this.playState)return;states={newState:state,oldState:this.playState};this.playState=state;this.sendNotification(Notifications.PLAY_STATE_CHANGE,states);return state};FlashPlayer.prototype.setMedia=function(value){if(value===this.media)return;this.media=value;if(this.playState!=null)this.setPlayState("ready");if(value.src!=null)this.setSrc(value.src);if((value.source!=null)&&value.source.length>0)this.setSource(value.source);this.sendNotification(Notifications.MEDIA_CHANGE,value);this.loaded=true;this.video.loadURL(this.media.src,value);return value};FlashPlayer.prototype.getMedia=function(){return this.media};FlashPlayer.prototype.load=function(){this.loaded=true;this.video.loadURL(this.media.src)};FlashPlayer.prototype.play=function(){if(!this.loaded){this.load();return};this.video.unpause()};FlashPlayer.prototype.setMuted=function(value){this.muted=value;try{if(value===true){this.video.mute()}else this.video.unmute()}catch(error){this.error("Flash muted error",error)};return value};FlashPlayer.prototype.getMuted=function(){return this.muted};FlashPlayer.prototype.getSrc=function(value){return this.video.getURL()};FlashPlayer.prototype.setSrc=function(value){this.media.src=value;this.loaded=false;this.setMedium(Utils.getMimeType(value));return value};FlashPlayer.prototype.setAutoplay=function(value){this.video.setPlayerProperty("autoplay",value);return value};FlashPlayer.prototype.getAutoplay=function(){return this.video.getPlayerProperty("autoplay")};FlashPlayer.prototype.getMedium=function(){return this.media.medium};FlashPlayer.prototype.setMedium=function(value){var newState,oldState;if(value===this.media.medium)return;if((this.media.medium!=null)&&(this.media.medium!=null))oldState="medium-"+this.media.medium;newState=this.media.medium=/audio/.test(value)?"audio":"video";this.sendNotification(Notifications.MEDIUM_CHANGE,{newState:"medium-"+newState,oldState:oldState});return value};FlashPlayer.prototype.setSource=function(value){var item,_this=this;if(!(value!=null)||value.length<1)return;this.media.source=value;this.loaded=false;item=Utils.selectSource(value,function(type){return _this.canPlayType(type)});if(((item!=null?item.src:void(0))!=null)&&item.src!==""){this.setSrc(item.src);if(typeof type!=="undefined"&&type!==null)this.setMedium(type)}else throw new Error("No valid source could be found");return value};FlashPlayer.prototype.getSource=function(value){return this.media.source};FlashPlayer.prototype.getSeeking=function(){return this.seeking};FlashPlayer.prototype.getPaused=function(){return this.paused};FlashPlayer.prototype.getEnded=function(){return this.ended};FlashPlayer.prototype.getFlashXML=function(){return XMLUtils.parse(this.getConfigXMLString())};FlashPlayer.prototype.getFlashVars=function(){return this.flashvars};FlashPlayer.prototype.evaluateBinding=function(str){return this.video.evaluateBinding(str)};FlashPlayer.prototype.canPlayType=function(mimeType){if(__indexOf.call(Utils.flashTypes,mimeType)>=0){return"maybe"}else return""};FlashPlayer.prototype.replay=function(){this.video.replay()};FlashPlayer.prototype.pause=function(){this.video.pause()};FlashPlayer.prototype.end=function(){this.video.stopPlayer()};FlashPlayer.prototype.getCurrentTime=function(value){return this.video.getCurrentTime()};FlashPlayer.prototype.setCurrentTime=function(value){this.video.jumpToTime(value);return value};FlashPlayer.prototype.getParams=function(){return this.video.getParams()};FlashPlayer.prototype.setParams=function(value){this.video.setParams(value);return value};FlashPlayer.prototype.getVolume=function(){return this.video.getVolume()};FlashPlayer.prototype.setVolume=function(value){this.video.setVolume(value);return value};FlashPlayer.prototype.getDuration=function(){return this.video.getDuration()};FlashPlayer.prototype.enterFullScreen=function(){this.video.enterFullScreen()};FlashPlayer.prototype.exitFullScreen=function(){this.video.exitFullScreen()};function ModuleAdapter(module){this.module=module;ModuleAdapter.__super__.constructor.call(this,module.getModuleName(),this)};__extends(ModuleAdapter,puremvc.Mediator);ModuleAdapter.prototype.module=null;ModuleAdapter.prototype.mediator=null;ModuleAdapter.prototype.initializeNotifier=function(key){var publications,_this=this;ModuleAdapter.__super__.initializeNotifier.call(this,key);publications=this.module.listNotificationPublications();if(publications!=null){this.mediator=new puremvc.Mediator(this.facade.getModuleName());this.mediator.listNotificationInterests=function(){return publications};this.mediator.handleNotification=function(notification){_this.facade.sendNotification(notification.getName(),notification.getBody(),notification.getType())}}};ModuleAdapter.prototype.onRegister=function(){if(this.mediator!=null)this.module.registerMediator(this.mediator)};ModuleAdapter.prototype.onRemove=function(){if(this.mediator!=null)this.module.removeMeditator(this.mediator)};ModuleAdapter.prototype.listNotificationInterests=function(){return this.module.listNotificationInterests()};ModuleAdapter.prototype.handleNotification=function(notification){this.module.sendNotification(notification.getName(),notification.getBody(),notification.getType())};function IEvent(){};IEvent.prototype.type;var PluginNotifications={REGISTER_PLUGINS:"registerPlugins",PLUGIN_REGISTERED:"pluginRegistered"};function EventHandler(target,type,handler){var _ref;this.target=target;this.type=type;this.handler=handler;this.trigger=__bind(this.trigger,this);EventHandler.instances.push(this);this.types=[];if(_ref=this.type,__indexOf.call(EventHandler.EVENTS,_ref)>=0){if(Utils.isTouchDevice()){this.types.push(EventHandler.TOUCH_EVENTS[this.type]);if(this.type===EventHandler.TOUCH_EVENTS[1])this.types.push(EventHandler.TOUCH_EVENTS[4])}else this.types.push(EventHandler.MOUSE_EVENTS[this.type])}else if(this.type instanceof Array){this.types=this.type}else this.types.push(this.type);this.bind()};EventHandler.PRESS=0;EventHandler.RELEASE=1;EventHandler.MOVE=2;EventHandler.CLICK=3;EventHandler.CONTEXTMENU=4;EventHandler.EVENTS=[EventHandler.PRESS,EventHandler.RELEASE,EventHandler.MOVE,EventHandler.CLICK,EventHandler.CONTEXTMENU];EventHandler.MOUSE_EVENTS=["mousedown","mouseup","mousemove","click","contextmenu"];EventHandler.TOUCH_EVENTS=["touchstart","touchend","touchmove","click","touchcancel"];EventHandler.instances=[];EventHandler.create=function(target,type,handler){return new EventHandler(target,type,handler)};EventHandler.bind=function(target,type){var i,instance,_i,_len,_ref;_ref=EventHandler.instances;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){instance=_ref[i];if(!(instance.target===target))continue;if((type!=null)&&instance.type!==type)continue;instance.bind()}};EventHandler.unbind=function(target,type){var i,instance,_i,_len,_ref;_ref=EventHandler.instances;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){instance=_ref[i];if(!(instance.target===target))continue;if((type!=null)&&instance.type!==type)continue;instance.unbind()}};EventHandler.clear=function(target,type){var i,instance,_i,_len,_ref;_ref=EventHandler.instances;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){instance=_ref[i];if(!((instance!=null?instance.target:void(0))===target))continue;if((type!=null)&&instance.type!==type)continue;instance.clear();EventHandler.instances.splice(i,1)}};EventHandler.prototype.types=null;EventHandler.prototype.bind=function(){var type,_i,_len,_ref;_ref=this.types;for(_i=0,_len=_ref.length;_i<_len;_i++){type=_ref[_i];if(this.target.addEventListener!=null){this.target.addEventListener(type,this.trigger,false)}else if(this.target.attachEvent!=null)this.target.attachEvent("on"+type,this.trigger)}};EventHandler.prototype.unbind=function(){var type,_i,_len,_ref;_ref=this.types;for(_i=0,_len=_ref.length;_i<_len;_i++){type=_ref[_i];if(this.target.removeEventListener!=null){this.target.removeEventListener(type,this.trigger)}else if(this.target.attachEvent!=null)this.target.removeEvent("on"+type,this.trigger)}};EventHandler.prototype.clear=function(){this.unbind();this.target=null;this.handler=null;this.type=null;this.types=null};EventHandler.prototype.trigger=function(event){this.handler(event)};function DataBindingContext(){DataBindingContext.__super__.constructor.call(this);if(this.contextName==null)this.contextName=this.constructor.NAME};__extends(DataBindingContext,puremvc.Proxy);DataBindingContext.prototype.contextName=null;DataBindingContext.prototype.contextData=null;DataBindingContext.prototype.getContextName=function(){return this.contextName};DataBindingContext.prototype.getContextData=function(){return this.contextData};function PlayRequestCommand(){PlayRequestCommand.__super__.constructor.call(this)};__extends(PlayRequestCommand,puremvc.SimpleCommand);PlayRequestCommand.prototype.execute=function(notification){this.sendNotification(Notifications.PLAY_REQUEST)};function PluginDispatcher(api){PluginDispatcher.__super__.constructor.call(this,api)};__extends(PluginDispatcher,ModuleDispatcher);PluginDispatcher.prototype.dispatchEvent=function(event){event.player=this.facade.app.parent;this.dispatcher.dispatchEvent(event)};PluginDispatcher.prototype.getMessage=function(event){return PluginDispatcher.__super__.getMessage.call(this,event).replace("[","["+(this.facade.app.getModuleName().toUpperCase())+" ")};function LocalizationProxy(init){var key,lang;LocalizationProxy.__super__.constructor.call(this);if(init!=null){if(init.language!=null)this.data.language=init.language;if(init.locales!=null)for(lang in init.locales)if(this.data.locales[lang]!=null){for(key in init.locales[lang])this.data.locales[lang][key]=init.locales[lang][key]}else this.data.locales[lang]=init.locales[lang]};this.setLocale(this.data.language)};__extends(LocalizationProxy,DataBindingContext);LocalizationProxy.NAME="LocalizationProxy";LocalizationProxy.prototype.contextName="l10n";LocalizationProxy.prototype.data={language:navigator.language||navigator.browserLanguage,locales:{en:{MSG_LIVE:"LIVE",MSG_REPLAY:"Replay",MSG_BUFFERING:"buffering...",MSG_CC:"CC",MSG_CC_TITLE:"Captions",MSG_CC_LANGUAGE:"Track :",MSG_CC_PRESETS:"Presets :",MSG_CC_FONT:"Font :",MSG_CC_EDGE:"Edge :",MSG_CC_SIZE:"Size :",MSG_CC_SCROLL:"Scroll :",MSG_CC_COLOR:"Color :",MSG_CC_BACKGROUND:"Background :",MSG_CC_WINDOW:"Window :",MSG_CC_OPACITY:"Opacity :",MSG_CC_SHOW_ADVANCED:"Show Advanced Settings",MSG_CC_HIDE_ADVANCED:"Hide Advanced Settings",MSG_CC_RESET:"Default",MSG_CC_CANCEL:"Cancel",MSG_CC_APPLY:"Apply",MSG_NEXT_VIDEO:"Video starts in: ",MSG_NEXT_AD:"Next ad starts in: ",MSG_CLOSE:"close",MSG_EN:"English",MSG_ES:"Spanish",MSG_DE:"German",MSG_FR:"French",MSG_IT:"Italian",MSG_RU:"Russian"}}};LocalizationProxy.prototype.locale=null;LocalizationProxy.prototype.getContextData=function(){return this.locale};LocalizationProxy.prototype.getLanguage=function(){return this.data.language};LocalizationProxy.prototype.setLanguage=function(value){this.data.language=value;this.setLocale(value);this.sendNotification(Notifications.LANGUAGE_CHANGED,value);return value};LocalizationProxy.prototype.setLocale=function(value){this.locale=this.data.locales[value];if(!(this.locale!=null))this.locale=this.data.locales[value.substring(0,2)];return value};LocalizationProxy.prototype.getLocales=function(){return this.data.locales};LocalizationProxy.prototype.setLocales=function(value){this.data.locales=value;return value};LocalizationProxy.prototype.getString=function(key){var locale;locale=this.locale||this.data.locales.en;return locale[key]||""};LocalizationProxy.prototype.getLanguageString=function(lang){var key,str;if(typeof lang!=="string"||!(lang!=null)||lang==="")return"";key="MSG_"+(lang.toUpperCase());str=this.getString(key);if(str===""){lang=lang.split("-").shift();key="MSG_"+(lang.toUpperCase());str=this.getString(key)};return str};var SecurityNotifications={CHECK_AUTHORIZATION:"checkAuthorization",AUTHORIZATION_FAILED:"authorizationfailed",AUTHORIZE:"authorize",AUTHORIZED:"authorized",SET_TOKEN:"settoken",SET_KEY:"setkey"};function SecurityProxy(){SecurityProxy.__super__.constructor.call(this,this.constructor.NAME,{});this.setupHDN1()};__extends(SecurityProxy,puremvc.Proxy);SecurityProxy.NAME="SecurityProxy";SecurityProxy.prototype.setupHDN1=function(){var _this=this;return window.retrieveToken=function(guid,url){var token;_this.facade.logger.debug("HDN1: Token Requested",guid,url);token=_this.getToken();if(token!=null){_this.facade.video.tokenRetrievalSuccess("&primaryToken="+token)}else _this.sendNotification(SecurityNotifications.AUTHORIZE);return true}};SecurityProxy.prototype.getKey=function(){return this.data.key};SecurityProxy.prototype.setKey=function(value){this.data.key=value;return value};SecurityProxy.prototype.getToken=function(){return this.data.token};SecurityProxy.prototype.setToken=function(value){this.data.token=value;return value};SecurityProxy.prototype.getSecret=function(){var secret;if(!(this.data.token!=null))return null;secret="";if(this.data.key!=null)secret+=this.data.key;secret+=this.data.token;return secret};SecurityProxy.prototype.createURL=function(url){var secret;secret=this.getSecret();if(secret!=null){url+=!/\?/.test(url)?"?":"&";url+=secret};return url};SecurityProxy.prototype.getAuthorized=function(){return this.data.authorized};SecurityProxy.prototype.setAuthorized=function(value){this.data.authorized=value;return value};SecurityProxy.prototype.getProvider=function(){return this.data.provider};SecurityProxy.prototype.setProvider=function(value){this.data.provider=value;return value};function ChangePlayStateCommand(){ChangePlayStateCommand.__super__.constructor.call(this)};__extends(ChangePlayStateCommand,puremvc.SimpleCommand);ChangePlayStateCommand.prototype.execute=function(notification){var app,state;app=this.facade.retrieveProxy(ApplicationStateProxy.NAME);state=notification.getBody();app.setPlayState(state)};function MediaChangeCommand(){MediaChangeCommand.__super__.constructor.call(this)};__extends(MediaChangeCommand,puremvc.SimpleCommand);MediaChangeCommand.prototype.execute=function(notification){var autoStart,configProxy,media,playbackProxy;this.facade.logger.debug("MediaChangeCommand",notification.getBody());media=notification.getBody();this.sendNotification(Notifications.UPDATE_PLAYBACK_CORE,false);playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);configProxy=this.facade.retrieveProxy(ConfigurationProxy.NAME);autoStart=playbackProxy.initialized&&(configProxy.getAutoplay()||media.autoplay===true);if(autoStart===true)this.sendNotification(Notifications.START)};function UpdatePlaybackCoreCommand(){UpdatePlaybackCoreCommand.__super__.constructor.call(this)};__extends(UpdatePlaybackCoreCommand,puremvc.SimpleCommand);UpdatePlaybackCoreCommand.prototype.execute=function(notification){var load,mediaProxy,playbackProxy,player,src;this.facade.logger.debug("UpdatePlaybackCoreCommand");mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);player=this.facade.retrieveProxy(PlayerProxy.NAME);player.setPlaybackType(mediaProxy.getType());playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);src=mediaProxy.getSrc();if((src!=null)&&src!==""&&src!=="undefined"){playbackProxy.setSrc(src);load=notification.getBody()!=null?notification.getBody():true;if(load===true)playbackProxy.load()}};function ChangeDurationCommand(){ChangeDurationCommand.__super__.constructor.call(this)};__extends(ChangeDurationCommand,puremvc.SimpleCommand);ChangeDurationCommand.prototype.execute=function(notification){var duration,mediaProxy;this.facade.logger.debug("ChangeDurationCommand",notification.getBody());duration=notification.getBody();mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);if(mediaProxy.getDuration()===duration)return;mediaProxy.setDuration(duration)};function ErrorCommand(){ErrorCommand.__super__.constructor.call(this)};__extends(ErrorCommand,puremvc.SimpleCommand);ErrorCommand.prototype.execute=function(notification){var core,playbackProxy;playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);core=playbackProxy.getCore();EventHandler.clear(core);this.facade.logger.error("[AMP ERROR]",notification.getBody());this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.ERROR)};function ReadyCommand(){ReadyCommand.__super__.constructor.call(this)};__extends(ReadyCommand,puremvc.SimpleCommand);ReadyCommand.prototype.execute=function(notification){var media,volume,_ref,_ref1;this.facade.logger.debug("ReadyCommand");volume=(_ref=this.facade.config)!=null?_ref.volume:void(0);if(volume!=null)this.sendNotification(Notifications.CHANGE_VOLUME,volume);this.sendNotification(Notifications.CHANGE_DISPLAY_STATE,DisplayState.NORMAL);this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.READY);this.sendNotification(Notifications.CHANGE_ACTIVE_STATE,ActiveState.ACTIVE);media=(_ref1=this.facade.config)!=null?_ref1.media:void(0);if(media!=null)this.sendNotification(Notifications.SET_MEDIA,media)};function UpdateDataBindingsCommand(){UpdateDataBindingsCommand.__super__.constructor.call(this)};__extends(UpdateDataBindingsCommand,puremvc.SimpleCommand);UpdateDataBindingsCommand.prototype.execute=function(notification){var bindings,body;this.facade.logger.debug("UpdateDataBindingsCommand");body=notification.getBody()||{};bindings=this.facade.retrieveProxy(DataBindingProxy.NAME);bindings.compile(body.contexts,body.suppressErrors)};function ChangeParamsCommand(){ChangeParamsCommand.__super__.constructor.call(this)};__extends(ChangeParamsCommand,puremvc.SimpleCommand);ChangeParamsCommand.prototype.execute=function(notification){var params,proxy;this.facade.logger.debug("ChangeParamsCommand",notification.getBody());params=notification.getBody();proxy=this.facade.retrieveProxy(ParamsProxy.NAME);proxy.setData(params);this.sendNotification(Notifications.UPDATE_DATA_BINDINGS,{suppressErrors:true})};function SetMediaCommand(){SetMediaCommand.__super__.constructor.call(this)};__extends(SetMediaCommand,puremvc.SimpleCommand);SetMediaCommand.prototype.execute=function(notification){var media,mediaProxy;media=notification.getBody();this.facade.logger.debug("SetMediaCommand",media);this.sendNotification(Notifications.CHANGE_MEDIA,media);mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);media=mediaProxy.getData();if(mediaProxy.authorized===true)this.sendNotification(Notifications.MEDIA_CHANGE,media)};function ChangeMediaCommand(){ChangeMediaCommand.__super__.constructor.call(this)};__extends(ChangeMediaCommand,puremvc.SimpleCommand);ChangeMediaCommand.prototype.execute=function(notification){var media,mediaProxy;this.facade.logger.debug("ChangeMediaCommand",notification.getBody());media=notification.getBody();mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);this.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.READY);this.sendNotification(Notifications.CHANGE_ACTIVE_STATE,ActiveState.ACTIVE);try{mediaProxy.setData(media)}catch(error){this.sendNotification(Notifications.ERROR,error.message)};this.sendNotification(Notifications.UPDATE_DATA_BINDINGS);this.sendNotification(SecurityNotifications.AUTHORIZE)};function OverlayLayerMediator(){OverlayLayerMediator.__super__.constructor.call(this)};__extends(OverlayLayerMediator,LayerMediator);OverlayLayerMediator.prototype.componentName="overlays";OverlayLayerMediator.NAME="OverlayLayerMediator";OverlayLayerMediator.prototype.createMediatorName=function(){return OverlayLayerMediator.NAME};OverlayLayerMediator.prototype.listNotificationInterests=function(){return[Notifications.ADD_OVERLAY,Notifications.REMOVE_OVERLAY]};OverlayLayerMediator.prototype.handleNotification=function(notification){var name,overlay;name=notification.getName();overlay=notification.getBody();switch(name){case Notifications.ADD_OVERLAY:this.viewComponent.appendChild(overlay);break;case Notifications.REMOVE_OVERLAY:this.viewComponent.removeChild(overlay)}};function PosterMediator(){PosterMediator.__super__.constructor.call(this)};__extends(PosterMediator,LayerMediator);PosterMediator.prototype.componentName="poster";PosterMediator.prototype.poster=null;PosterMediator.prototype.clickHandler=null;PosterMediator.prototype.onRegister=function(){this.poster=this.create("poster-content");this.poster.onclick=this.onclick.bind(this);PosterMediator.__super__.onRegister.call(this)};PosterMediator.prototype.onclick=function(event){event.stopImmediatePropagation();event.preventDefault();this.sendNotification(UserNotifications.TOGGLE_PLAY_PAUSE,true);return false};PosterMediator.prototype.listNotificationInterests=function(){return[Notifications.CHANGE_MEDIA]};PosterMediator.prototype.handleNotification=function(notification){var html,src;switch(notification.getName()){case Notifications.CHANGE_MEDIA:src=notification.getBody().poster;html=(src!=null)&&src!==""?"<img src=\""+src+"\" class=\""+this.cssPrefix+"poster-image\" />":"";this.poster.innerHTML=html}};function ErrorLayerMediator(){ErrorLayerMediator.__super__.constructor.call(this)};__extends(ErrorLayerMediator,LayerMediator);ErrorLayerMediator.prototype.message=null;ErrorLayerMediator.prototype.componentName="error";ErrorLayerMediator.prototype.onRegister=function(){ErrorLayerMediator.__super__.onRegister.call(this);this.message=this.create("error-message")};ErrorLayerMediator.prototype.listNotificationInterests=function(){return[Notifications.ERROR]};ErrorLayerMediator.prototype.handleNotification=function(notification){var error,msg;switch(notification.getName()){case Notifications.ERROR:error=notification.getBody();msg="Error: ";switch(error.code){case MediaError.MEDIA_ERR_ABORTED:msg+="Media was aborted.";break;case MediaError.MEDIA_ERR_DECODE:msg+="Decode Error.";break;case MediaError.MEDIA_ERR_NETWORK:msg+="Network Error.";break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:msg+="Source not supported.";break;default:msg+=error};this.message.textContent=msg}};function TitleBarMediator(){TitleBarMediator.__super__.constructor.call(this)};__extends(TitleBarMediator,OverlayMediator);TitleBarMediator.prototype.componentName="title-bar";TitleBarMediator.prototype.title=null;TitleBarMediator.prototype.description=null;TitleBarMediator.prototype.onRegister=function(){this.title=this.create("title-text");this.description=this.create("description-text");TitleBarMediator.__super__.onRegister.call(this)};TitleBarMediator.prototype.listNotificationInterests=function(){return[Notifications.CHANGE_MEDIA]};TitleBarMediator.prototype.handleNotification=function(notification){var metadata,title;switch(notification.getName()){case Notifications.CHANGE_MEDIA:metadata=notification.getBody();title=metadata.title;if(!(title!=null)||title===""||title==="undefined"){this.classList.add("hidden")}else{this.title.innerHTML=title;this.description.innerHTML=metadata.description?metadata.description:"";this.classList.remove("hidden")}}};function PluginAPI(plugin){ModuleAPI.attachModuleDispatcher(plugin,new PluginDispatcher(this));this.getConfig=function(){return plugin.getConfig()}};__extends(PluginAPI,ModuleAPI);PluginAPI.prototype.getConfig=function(){};var Namespace={PREFIX:"akamai-"};function Plugin(app,config){this.app=app;this.logger=this.app.logger;Plugin.__super__.constructor.call(this,config)};__extends(Plugin,Module);Plugin.NAME="Plugin";Plugin.prototype.app=null;Plugin.prototype.initialize=function(){this.createModel();this.createController()};Plugin.prototype.createAPI=function(){return new PluginAPI(this)};Plugin.prototype.onRegister=function(){var proxy;proxy=this.retrieveProxy(PluginProxy.NAME);if(((proxy!=null?proxy.getLoaded:void(0))!=null)&&!proxy.getLoaded()){proxy.load(this.registered.bind(this))}else this.registered()};Plugin.prototype.registered=function(){var _ref;this.createView();if((_ref=this.retrieveProxy(PluginProxy.NAME))!=null)if(typeof _ref.initialize==="function")_ref.initialize();this.sendNotification(PluginNotifications.PLUGIN_REGISTERED,this)};Plugin.prototype.listNotificationPublications=function(){var key,notes,value;notes=[Notifications.ADD_LAYER,Notifications.REMOVE_LAYER,Notifications.ADD_OVERLAY,Notifications.REMOVE_OVERLAY,Notifications.ADD_APPLICATION_STATE,Notifications.REMOVE_APPLICATION_STATE,Notifications.IS_USER_ACTIVE];return notes.concat((function(){var _results;_results=[];for(key in PluginNotifications){value=PluginNotifications[key];_results.push(value)};return _results})())};function PluginAdapter(){this.plugins=[];this.registered=[];PluginAdapter.__super__.constructor.call(this,this.constructor.NAME,{})};__extends(PluginAdapter,puremvc.Mediator);PluginAdapter.NAME="PluginAdapter";PluginAdapter.prototype.plugins=null;PluginAdapter.prototype.registered=null;PluginAdapter.prototype.onRegister=function(){return PluginAdapter.__super__.onRegister.call(this)};PluginAdapter.prototype.listNotificationInterests=function(){return[PluginNotifications.REGISTER_PLUGINS,PluginNotifications.PLUGIN_REGISTERED]};PluginAdapter.prototype.handleNotification=function(notification){var body,name,plugin,_i,_len,_ref;name=notification.getName();body=notification.getBody();switch(name){case PluginNotifications.REGISTER_PLUGINS:this.plugins=body;_ref=this.plugins;for(_i=0,_len=_ref.length;_i<_len;_i++){plugin=_ref[_i];this.facade.registerModule(plugin)};break;case PluginNotifications.PLUGIN_REGISTERED:this.registered.push(body);this.facade.logger.debug("Plugin Registered: "+body.constructor.NAME);if(this.registered.length===this.plugins.length)this.sendNotification(Notifications.READY,this.facade.config)}};function ClassList(element){this.element=element};ClassList.prototype.element=null;ClassList.prototype.prefix=Namespace.PREFIX;ClassList.prototype.contains=function(className){return this.constructor.contains(className,this.element,this.prefix)};ClassList.prototype.add=function(className){this.constructor.add(className,this.element,this.prefix)};ClassList.prototype.remove=function(className){this.constructor.remove(className,this.element,this.prefix)};ClassList.prototype.toggle=function(className){return this.constructor.contains(className,this.element,this.prefix)};ClassList.contains=function(className,element,prefix){var css,_ref;if(prefix==null)prefix="";css=prefix+className;if(((_ref=element.classList)!=null?_ref.contains:void(0))!=null){return element.classList.contains(css)}else return element.className.indexOf(css)!==-1};ClassList.add=function(className,element,prefix){var css,_ref;if(prefix==null)prefix="";css=prefix+className;if(((_ref=element.classList)!=null?_ref.add:void(0))!=null){element.classList.add(css)}else if(!this.contains(className,element))if(element.className!==""){element.className+=" "+css}else element.className=css};ClassList.remove=function(className,element,prefix){var css,regexp,_ref;if(prefix==null)prefix="";css=prefix+className;if(((_ref=element.classList)!=null?_ref.remove:void(0))!=null){element.classList.remove(css)}else if(this.contains(className,element)){regexp=new RegExp(" ?"+css);element.className=element.className.replace(regexp,"")}};ClassList.toggle=function(className,element,prefix){var css,_ref;if(prefix==null)prefix="";css=prefix+className;if(((_ref=element.classList)!=null?_ref.toggle:void(0))!=null){element.classList.toggle(this.prefix+className)}else if(this.contains(className,element)){this.remome(className,element)}else this.add(className,element)};var UserNotifications={TOGGLE_PLAY_PAUSE:"usertogglePlayPause",PLAY:"userplay",PAUSE:"userpause",SEEK:"userseek"};function UI(){};UI.create=function(type,parent,element,text){var classList,item,viewComponent,_i,_len;if(element==null)element="div";if(typeof element==="string")element=document.createElement(element);classList=new ClassList(element);if(type!=null){if(typeof type==="string")type=[type];for(_i=0,_len=type.length;_i<_len;_i++){item=type[_i];classList.add(item)}};element._classList=classList;if(text!=null)if(element.innerText!=null){element.innerText=text}else element.textContent=text;if(parent!=null){if(parent.getViewComponent!=null)viewComponent=parent.getViewComponent();if(viewComponent!=null)parent=viewComponent;parent.appendChild(element)};return element};UI.bindEvents=function(element,handlers,exceptions){var key,value;if(exceptions==null)exceptions=["onRemove","onRegister"];for(key in handlers){value=handlers[key];if(!(__indexOf.call(exceptions,key)>=0)&&/^on/.test(key)&&((value!=null?value.bind:void(0))!=null))element[key]=value.bind(handlers)}};UI.createUID=function(base){var date,len,max,rand;if(base==null)base=16;date=Date.now();len=2;max=base*len-1;rand=Math.round(Math.random()*max+base);return(rand.toString(16)+date.toString(16)).toUpperCase()};function ITokenized(){};ITokenized.prototype.data=null;ITokenized.prototype.value=null;ITokenized.prototype.source=null;ITokenized.prototype.parse=function(data){};ITokenized.prototype.compile=function(context,suppressErrors){if(context==null)context={};if(suppressErrors==null)suppressErrors=false};function DataBindingProxy(){DataBindingProxy.__super__.constructor.call(this,this.constructor.NAME,{});this.data={};this.contextMap={};this.configurationMap={}};__extends(DataBindingProxy,puremvc.Proxy);DataBindingProxy.NAME="DataBindingProxy";DataBindingProxy.prototype.contextMap=null;DataBindingProxy.prototype.configurationMap=null;DataBindingProxy.prototype.paramsProxy=null;DataBindingProxy.prototype.initialize=function(){this.paramsProxy=this.facade.retrieveProxy(ParamsProxy.NAME);this.registerContext(this.facade.retrieveProxy(MediaProxy.NAME));this.registerContext(this.facade.retrieveProxy(LocalizationProxy.NAME));this.registerContext(this.facade.retrieveProxy(PlayerProxy.NAME));return this.update()};DataBindingProxy.prototype.registerContext=function(context){if(!(context!=null))return;this.contextMap[context.getContextName()]=context};DataBindingProxy.prototype.retrieveContext=function(name){return this.contextMap[name]};DataBindingProxy.prototype.removeContext=function(name){var context;context=this.contextMap[name];delete this.contextMap[name];return context};DataBindingProxy.prototype.registerConfiguration=function(config){if(!(config!=null))return;this.configurationMap[config.getConfigurationName()]=config;config.compile(this.context,true)};DataBindingProxy.prototype.retrieveConfiguration=function(name){return this.configurationMap[name]};DataBindingProxy.prototype.removeConfiguration=function(name){var config;config=this.configurationMap[name];delete this.configurationMap[name];return config};DataBindingProxy.prototype.evaluateBinding=function(str){var tokenizedObject;tokenizedObject=new TokenizedValue(str);tokenizedObject.compile(this.data);return tokenizedObject.value};DataBindingProxy.prototype.update=function(contexts){var context,key,name,value,_ref,_ref1;this.data.now=Date.now();_ref=this.contextMap;for(name in _ref){context=_ref[name];if((contexts!=null?typeof contexts.indexOf==="function"?contexts.indexOf(name):void(0):void(0))===-1)continue;this.data[name]=context.getContextData()};this.paramsProxy.compile(this.data);_ref1=this.paramsProxy.value;for(key in _ref1){value=_ref1[key];this.data[key]=value};return this.data};DataBindingProxy.prototype.compile=function(contexts,suppressErrors){var config,context,name,paramsName,_ref;if(suppressErrors==null)suppressErrors=false;this.update(contexts);context=Utils.clone(this.data);paramsName=this.paramsProxy.getConfigurationName();_ref=this.configurationMap;for(name in _ref){config=_ref[name];if(name!==paramsName)config.compile(context,suppressErrors)}};function TokenizedBase(source){if(source!=null)this.parse(source)};__extends(TokenizedBase,ITokenized);TokenizedBase.prototype.data=null;TokenizedBase.prototype.value=null;TokenizedBase.prototype.source=null;TokenizedBase.prototype.parse=function(source){var value;if(source instanceof Array){value=new TokenizedArray(source)}else if(source instanceof Object){value=new TokenizedObject(source)}else value=new TokenizedValue(source);return value};function TokenizedArray(data){TokenizedArray.__super__.constructor.call(this,data)};__extends(TokenizedArray,TokenizedBase);TokenizedArray.prototype.parse=function(data){var index,token,_i,_len;this.data=[];for(index=_i=0,_len=data.length;_i<_len;index=++_i){token=data[index];this.data[index]=TokenizedArray.__super__.parse.call(this,token)};return this.data};TokenizedArray.prototype.compile=function(context,suppressErrors){var index,token,_i,_len,_ref;if(context==null)context={};if(suppressErrors==null)suppressErrors=false;this.value=[];_ref=this.data;for(index=_i=0,_len=_ref.length;_i<_len;index=++_i){token=_ref[index];try{this.value[index]=token.compile(context,suppressErrors)}catch(error){this.value[index]=null;if(!suppressErrors)Logger.error(error)}};return this.value};function TokenizationError(msg){this.message=TokenizationError.MESSAGE+msg};__extends(TokenizationError,Error);TokenizationError.MESSAGE="Tokenization Error: Could not find token value for: ";function Literal(source){Literal.__super__.constructor.call(this,source)};__extends(Literal,TokenizedBase);Literal.prototype.parse=function(data){this.source=this.data=this.value=data;return data};Literal.prototype.compile=function(context,suppressErrors){if(context==null)context=null;if(suppressErrors==null)suppressErrors=false;return this.value};function Token(source){Token.__super__.constructor.call(this,source)};__extends(Token,TokenizedBase);Token.prototype.exec=null;Token.prototype.parse=function(source){this.source=this.data=source;this.exec=new Function("context",'var value; with(context){value = '+this.data+';}return value;');return this.data};Token.prototype.compile=function(context,suppressErrors){if(context==null)context={};if(suppressErrors==null)suppressErrors=false;if(!(this.exec!=null))return this.value;try{this.value=this.exec(context)}catch(error){this.value=null;if(!suppressErors)throw new TokenizationError(this.data)};return this.value};function TokenizedValue(source){this.token=new RegExp(this.tokenStart.source+"([^#]*)"+this.tokenEnd.source,"g");TokenizedValue.__super__.constructor.call(this,source)};__extends(TokenizedValue,TokenizedBase);TokenizedValue.prototype.exec=null;TokenizedValue.prototype.tokenStart=/#{/;TokenizedValue.prototype.tokenEnd=/}/;TokenizedValue.prototype.token=null;TokenizedValue.prototype.parse=function(source){var piece,pieces,placeholder,spacer,temp,token,tokens,_i,_len;this.source=source;this.data=[];if(this.token.test(this.source)){tokens=[];placeholder="<<>>";spacer=null;temp=this.source.replace(this.token,function(match,token,offset,string){tokens.push(token);spacer=placeholder;if((0<offset&&offset<string.length-match.length))spacer+=placeholder;return spacer});pieces=temp.split(placeholder);token=0;for(_i=0,_len=pieces.length;_i<_len;_i++){piece=pieces[_i];if(piece===""&&tokens[token]){this.data.push(new Token(tokens[token]));token++}else if(piece!=="")this.data.push(new Literal(piece))};if(this.data.length===1)this.data=this.data[0]}else this.data=new Literal(source);return this.data};TokenizedValue.prototype.compile=function(context,suppressErrors){var token,_i,_len,_ref;if(context==null)context={};if(suppressErrors==null)suppressErrors=false;if(!(this.data!=null))return this.value;try{if(this.data instanceof ITokenized){this.value=this.data.compile(context,suppressErrors)}else{this.value="";_ref=this.data;for(_i=0,_len=_ref.length;_i<_len;_i++){token=_ref[_i];this.value+=token.compile(context,suppressErrors)}}}catch(error){this.value=null;if(!suppressErrors)throw new TokenizationError(this.source)};return this.value};function TokenizedObject(source){TokenizedObject.__super__.constructor.call(this,source)};__extends(TokenizedObject,TokenizedBase);TokenizedObject.prototype.parse=function(source){var key,token;this.source=source;this.data={};for(key in source){token=source[key];this.data[key]=TokenizedObject.__super__.parse.call(this,token)};return this.data};TokenizedObject.prototype.compile=function(context,suppressErrors){var key,value,_ref;if(context==null)context={};if(suppressErrors==null)suppressErrors=false;this.value={};_ref=this.data;for(key in _ref){value=_ref[key];try{this.value[key]=value.compile(context,suppressErrors)}catch(error){this.value[key]=null;Logger.error(error)}};return this.value};function ExternalPlaybackProxy(){ExternalPlaybackProxy.__super__.constructor.call(this)};__extends(ExternalPlaybackProxy,puremvc.Proxy);ExternalPlaybackProxy.NAME="PlaybackProxy";ExternalPlaybackProxy.prototype.src=null;ExternalPlaybackProxy.prototype.canPlayType=function(mimeType){return mimeType==="external"};ExternalPlaybackProxy.prototype.getSrc=function(){return this.src};ExternalPlaybackProxy.prototype.setSrc=function(value){if(!(value!=null)||value==="")this.sendNotification(Notifications.ERROR,"The value of src is not supported: "+value);if(value!==this.src)this.src=value;return value};ExternalPlaybackProxy.prototype.play=function(){window.open(this.getSrc(),"_blank")};ExternalPlaybackProxy.prototype.load=function(){};ExternalPlaybackProxy.prototype.setVolume=function(){};function ParamsProxy(data){ParamsProxy.__super__.constructor.call(this,data)};__extends(ParamsProxy,DataBoundConfigurationProxy);ParamsProxy.NAME="ParamsProxy";ParamsProxy.prototype.defaults={};ParamsProxy.prototype.configurationName="params";ParamsProxy.prototype.setData=function(data){var key,value,_ref;this.data=((_ref=this.configurationData)!=null?_ref.source:void(0))||{};for(key in data){value=data[key];this.data[key]=data[key]};this.configurationData=new TokenizedObject(this.data);return this.data};function ExternalPlayerAPI(module,dispatcher){var player;ExternalPlayerAPI.__super__.constructor.call(this,module,dispatcher);player=module;this.evaluateBinding=function(str){var _ref;return(_ref=player.retrieveProxy(DataBindingProxy.NAME))!=null?_ref.evaluateBinding(str):void(0)};this.canPlayType=function(mimeType){return"maybe"};this.play=function(){player.sendNotification(Notifications.PLAY)};this.setParams=function(value){player.sendNotification(Notifications.CHANGE_PARAMS,value);return value};this.getParams=function(){return player.retrieveProxy(ParamsProxy.NAME).getData()};this.setAutoplay=function(value){return false};this.getAutoplay=function(){return false};this.setLoop=function(value){return false};this.getLoop=function(){return false};this.setMuted=function(value){return false};this.getMuted=function(){return false};this.setMedia=function(value){player.sendNotification(Notifications.SET_MEDIA,value);return value};this.getMedia=function(value){var _ref;return(_ref=player.retrieveProxy(MediaProxy.NAME))!=null?_ref.getData():void(0)};this.setCurrentTime=function(value){return 0};this.getCurrentTime=function(value){return 0};this.getDuration=function(value){return player.retrieveProxy(MediaProxy.NAME).getDuration()};this.setSrc=function(value){player.sendNotification(Notifications.SET_MEDIA,{src:value});return value};this.getSrc=function(value){return player.retrieveProxy(MediaProxy.NAME).getSrc()};this.setSource=function(value){player.sendNotification(Notifications.SET_MEDIA,{source:value});return value};this.getSource=function(){return player.retrieveProxy(MediaProxy.NAME).getSource()};this.setVolume=function(value){return value};this.getVolume=function(value){return 1};this.getSeeking=function(){return false};this.getPaused=function(){return false};this.getEnded=function(){return false}};__extends(ExternalPlayerAPI,PlayerAPI);function ExternalPlayCommand(){ExternalPlayCommand.__super__.constructor.call(this)};__extends(ExternalPlayCommand,puremvc.MacroCommand);ExternalPlayCommand.prototype.initializeMacroCommand=function(){return this.addSubCommand(PlayRequestCommand)};ExternalPlayCommand.prototype.execute=function(notification){var playbackProxy;this.facade.logger.debug("PlayCommand");ExternalPlayCommand.__super__.execute.call(this,notification);playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);playbackProxy.play()};var DisplayState={NORMAL:"normal",FULL_SCREEN:"full-screen"},RenderMode={FLASH:"flash",HTML:"html"},ActiveState={ACTIVE:"active",INACTIVE:"inactive"},PlayState={READY:"ready",PLAYING:"playing",PAUSED:"paused",ENDED:"ended",LOADING:"loading",WAITING:"waiting",SEEKING:"seeking",ERROR:"error"};function ApplicationStateProxy(){ApplicationStateProxy.__super__.constructor.call(this);this.device=Utils.getDevice()};__extends(ApplicationStateProxy,puremvc.Proxy);ApplicationStateProxy.NAME="ApplicationStateProxy";ApplicationStateProxy.prototype.displayState=null;ApplicationStateProxy.prototype.playState=null;ApplicationStateProxy.prototype.renderMode=null;ApplicationStateProxy.prototype.activeState=null;ApplicationStateProxy.prototype.seeking=false;ApplicationStateProxy.prototype.isUserActive=false;ApplicationStateProxy.prototype.device=null;ApplicationStateProxy.prototype.getDisplayState=function(){return this.displayState};ApplicationStateProxy.prototype.setDisplayState=function(value){var oldState;if(value===oldState)return;oldState=this.displayState;this.displayState=value;this.sendNotification(Notifications.DISPLAY_STATE_CHANGE,{oldState:oldState,newState:this.displayState})};ApplicationStateProxy.prototype.getPlayState=function(){return this.playState};ApplicationStateProxy.prototype.setPlayState=function(value){var oldState;if(value===this.playState)return;if(this.seeking===true)switch(value){case PlayState.PLAYING:case PlayState.READY:this.seeking=false;break;default:return};oldState=this.playState;this.playState=value;this.sendNotification(Notifications.PLAY_STATE_CHANGE,{oldState:oldState,newState:this.playState})};ApplicationStateProxy.prototype.getDevice=function(){return this.device};ApplicationStateProxy.prototype.getSeeking=function(){return this.seeking};ApplicationStateProxy.prototype.setSeeking=function(value){if(value!==this.seeking)this.seeking=value};ApplicationStateProxy.prototype.getIsUserActive=function(){return this.isUserActive};ApplicationStateProxy.prototype.setIsUserActive=function(value){if(value!==this.isUserActive)this.isUserActive=value};ApplicationStateProxy.prototype.getRenderMode=function(){return this.renderMode};ApplicationStateProxy.prototype.setRenderMode=function(value){if(value!==this.renderMode)this.renderMode=value};ApplicationStateProxy.prototype.getMedium=function(){return this.medium};ApplicationStateProxy.prototype.setMedium=function(value){var oldState;if(value===this.medium)return;oldState=this.medium!=null?"medium-"+this.medium:this.medium;this.medium=value;this.sendNotification(Notifications.MEDIUM_CHANGE,{oldState:oldState,newState:"medium-"+this.medium})};ApplicationStateProxy.prototype.getActiveState=function(){return this.activeState};ApplicationStateProxy.prototype.setActiveState=function(value){var oldState;if(value===this.activeState)return;oldState=this.activeState;this.activeState=value;this.sendNotification(Notifications.ACTIVE_STATE_CHANGE,{oldState:oldState,newState:this.activeState})};function ConfigurationProxy(config){ConfigurationProxy.__super__.constructor.call(this,config)};__extends(ConfigurationProxy,ModuleProxy);ConfigurationProxy.NAME=ModuleProxy.NAME;ConfigurationProxy.prototype.defaults={name:null,autoplay:false,loop:false,controls:{},fullscreen:null,target:"_blank",domain:null,endslate:null,version:null};ConfigurationProxy.prototype.setData=function(data){if(data.rules!=null)Utils.mergeRules(data.rules);return ConfigurationProxy.__super__.setData.call(this,data)};ConfigurationProxy.prototype.getAutoplay=function(){return this.data.autoplay};ConfigurationProxy.prototype.setAutoplay=function(value){return this.data.autoplay=value};ConfigurationProxy.prototype.getLoop=function(){return this.data.loop};ConfigurationProxy.prototype.setLoop=function(value){return this.data.loop=value};ConfigurationProxy.prototype.getEndSlate=function(){return this.data.endslate};ConfigurationProxy.prototype.setEndSlate=function(value){return this.data.endslate=value};ConfigurationProxy.prototype.getDomain=function(){return this.data.domain};ConfigurationProxy.prototype.setDomain=function(value){return this.data.domain=value};ConfigurationProxy.prototype.getTarget=function(){return this.data.target};ConfigurationProxy.prototype.setTarget=function(value){return this.data.target=value};ConfigurationProxy.prototype.getName=function(){return this.data.name};ConfigurationProxy.prototype.setName=function(value){return this.data.name=value};ConfigurationProxy.prototype.getVersion=function(){return this.data.version};ConfigurationProxy.prototype.getControls=function(){return this.data.controls};ConfigurationProxy.prototype.setControls=function(value){return this.data.controls=value};ConfigurationProxy.prototype.getFullscreen=function(){return this.data.fullscreen};ConfigurationProxy.prototype.setFullscreen=function(value){return this.data.fullscreen=value};function PlayerProxy(defaultPlaybackCore){this.defaultPlaybackCore=defaultPlaybackCore;PlayerProxy.__super__.constructor.call(this);this.playbackCoreMap={}};__extends(PlayerProxy,DataBindingContext);PlayerProxy.NAME="PlayerProxy";PlayerProxy.prototype.contextName="player";PlayerProxy.prototype.playbackCoreMap=null;PlayerProxy.prototype.defaultPlaybackCore=null;PlayerProxy.prototype.activePlaybackCore=null;PlayerProxy.prototype.getActivePlaybackCore=function(){return this.activePlaybackCore};PlayerProxy.prototype.registerPlaybackCore=function(core){if(!(core!=null))return;this.playbackCoreMap[core.getPlaybackCoreName()]=core};PlayerProxy.prototype.retrievePlaybackCore=function(name){return this.playbackCoreMap[name]};PlayerProxy.prototype.removePlaybackCore=function(name){var core;core=this.playbackCoreMap[name];delete this.playbackCoreMap[name];return core};PlayerProxy.prototype.setPlaybackType=function(type){var core,name,playbackCore,playbackProxy,_ref;playbackCore=this.defaultPlaybackCore;_ref=this.playbackCoreMap;for(name in _ref){core=_ref[name];if(core.canPlayType(type)!==""){playbackCore=core;break}};playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);if(playbackProxy!==playbackCore){this.facade.removeProxy(PlaybackProxy.NAME);this.facade.registerProxy(playbackCore);playbackCore.setData(playbackProxy.getData())};this.activePlaybackCore=playbackCore;return type};PlayerProxy.prototype.canPlayType=function(type){var canPlay,core,name,_ref;_ref=this.playbackCoreMap;for(name in _ref){core=_ref[name];canPlay=core.canPlayType(type);if(canPlay!=="")return canPlay};canPlay=this.defaultPlaybackCore.canPlayType(type);return canPlay};PlayerProxy.prototype.getContextData=function(){var configProxy,element,mediaProxy,playbackProxy;configProxy=this.facade.retrieveProxy(ConfigurationProxy.NAME);playbackProxy=this.facade.retrieveProxy(PlaybackProxy.NAME);mediaProxy=this.facade.retrieveProxy(MediaProxy.NAME);element=this.facade.getViewComponent();return{width:element.offsetWidth,height:element.offsetHeight,mode:"html5",autoplay:configProxy.getAutoplay(),domain:configProxy.getDomain(),name:configProxy.getName(),currentTime:playbackProxy.getCurrentTime(),duration:playbackProxy.getDuration(),version:configProxy.getVersion(),timecode:{duration:Utils.formatTimecode(mediaProxy.getDuration()),currentTime:Utils.formatTimecode(playbackProxy.getCurrentTime())}}};function MediaProxy(){this.data={metadata:{}};MediaProxy.__super__.constructor.call(this)};__extends(MediaProxy,DataBindingContext);MediaProxy.NAME="MediaProxy";MediaProxy.prototype.contextName="media";MediaProxy.prototype.data=null;MediaProxy.prototype.authorized=true;MediaProxy.prototype.getContextData=function(){return{width:this.getWidth(),height:this.getHeight(),title:this.getTitle(),description:this.getDescription(),src:this.getSrc(),duration:this.getDuration(),guid:this.getGUID(),isLive:this.getIsLive(),metadata:this.getMetadata(),temporalType:this.getTemporalType(),poster:this.getPoster(),category:this.getCategory()}};MediaProxy.prototype.setData=function(value){var _ref;this.data.autoplay=value.autoplay;this.data.type=value.type;if(value.source!=null)this.setSource(value.source);if(value.src!=null)this.setSrc(value.src);this.data.title=value.title;if(value.duration!=null)this.setDuration(value.duration);this.data.poster=value.poster;this.data.guid=value.guid;this.data.link=value.link;this.data.embed=value.embed;this.data.width=value.width;this.data.height=value.height;this.data.category=value.category;this.data.description=value.description;this.data.status=value.status||{};if(((_ref=this.data.status)!=null?_ref.state:void(0))==="blocked")this.authorized=false;this.data.category=value.category;this.data.metadata=value.metadata||{};if(value.isLive!=null)this.setIsLive(value.isLive);if(value.temporalType!=null){this.setTemporalType(value.temporalType)}else this.setTemporalType("vod");if(value.medium!=null)this.setMedium(value.medium);if(value.pubDate!=null)this.setPubDate(value.pubDate);return value};MediaProxy.prototype.updateData=function(data){var key,value;for(key in data){value=data[key];if(key in this.data)this.data[key]=value}};MediaProxy.prototype.getGUID=function(){return this.data.guid};MediaProxy.prototype.setGUID=function(value){return this.data.guid=value};MediaProxy.prototype.getLink=function(){return this.data.link};MediaProxy.prototype.setLint=function(value){return this.data.link=value};MediaProxy.prototype.getEmbed=function(){return this.data.embed};MediaProxy.prototype.setEmbed=function(value){return this.data.embed=value};MediaProxy.prototype.getAutoplay=function(){return this.data.autoplay};MediaProxy.prototype.setAutoplay=function(value){return this.data.autoplay=value};MediaProxy.prototype.getPubDate=function(){return this.data.pubDate};MediaProxy.prototype.setPubDate=function(value){return this.data.pubDate=value};MediaProxy.prototype.getCategory=function(){return this.data.category};MediaProxy.prototype.setCategory=function(value){return this.data.category=value};MediaProxy.prototype.getSrc=function(){return this.data.src};MediaProxy.prototype.setSrc=function(value){this.data.src=value;if((this.data.src!=null)&&!(this.data.type!=null))return this.setType(Utils.getMimeType(this.data.src))};MediaProxy.prototype.getType=function(){return this.data.type};MediaProxy.prototype.setType=function(value){var medium;this.data.type=value;medium=/audio/.test(this.data.type)?"audio":"video";return this.setMedium(medium)};MediaProxy.prototype.getMedium=function(){return this.data.medium};MediaProxy.prototype.setMedium=function(value){if(value===this.data.medium)return;this.data.medium=value;return this.facade.retrieveProxy(ApplicationStateProxy.NAME).setMedium(value)};MediaProxy.prototype.getMetadata=function(){return this.data.metadata};MediaProxy.prototype.setMetadata=function(value){return this.data.metadata=value};MediaProxy.prototype.getSource=function(){return this.data.source};MediaProxy.prototype.setSource=function(value){var item,playerProxy,_this=this;if(!(value!=null)||value.length<1)return;this.data.source=value;playerProxy=this.facade.retrieveProxy(PlayerProxy.NAME);item=Utils.selectSource(value,function(type){return playerProxy.canPlayType(type)});if(((item!=null?item.src:void(0))!=null)&&item.src!==""){this.setSrc(item.src);return this.setType(item.type)}else throw new Error("No valid source could be found")};MediaProxy.prototype.getTrack=function(){return this.data.track};MediaProxy.prototype.setTrack=function(value){return this.data.track=value};MediaProxy.prototype.getTitle=function(){return this.data.title};MediaProxy.prototype.setTitle=function(value){return this.data.title=value};MediaProxy.prototype.getWidth=function(){return this.data.width};MediaProxy.prototype.setWidth=function(value){return this.data.width=value};MediaProxy.prototype.getHeight=function(){return this.data.height};MediaProxy.prototype.setHeight=function(value){return this.data.height=value};MediaProxy.prototype.getDescription=function(){return this.data.description};MediaProxy.prototype.setDescription=function(value){return this.data.description=value};MediaProxy.prototype.getCategory=function(){return this.data.category};MediaProxy.prototype.setCategory=function(value){return this.data.category=value};MediaProxy.prototype.getDuration=function(value){return this.data.duration};MediaProxy.prototype.setDuration=function(value){if(value===0)return;if(value!==this.data.duration){this.data.duration=value;this.sendNotification(Notifications.DURATION_CHANGE,value)};if(value===Infinity)return this.setTemporalType("live")};MediaProxy.prototype.getPoster=function(value){return this.data.poster};MediaProxy.prototype.setPoster=function(value){return this.data.poster=value};MediaProxy.prototype.getIsLive=function(){return this.data.isLive};MediaProxy.prototype.setIsLive=function(value){if(value!==this.data.isLive)return this.data.isLive=value};MediaProxy.prototype.getTemporalType=function(){return this.data.temporalType};MediaProxy.prototype.setTemporalType=function(value){if(value!==this.data.temporalType){this.data.temporalType=value;return this.sendNotification(Notifications.TEMPORAL_TYPE_CHANGE,value)}};function ExternalMediaProxy(){ExternalMediaProxy.__super__.constructor.call(this)};__extends(ExternalMediaProxy,MediaProxy);ExternalMediaProxy.NAME="MediaProxy";ExternalMediaProxy.prototype.setSource=function(value){if(!(value!=null)||value.length<1)return;value=value.filter(function(item){return item.type==="external"});return ExternalMediaProxy.__super__.setSource.call(this,value)};function ExternalPlayer(config,viewComponent,dispatcher){ExternalPlayer.__super__.constructor.call(this,config,viewComponent,dispatcher)};__extends(ExternalPlayer,Player);ExternalPlayer.prototype.playerType="external";ExternalPlayer.prototype.createAPI=function(){return new ExternalPlayerAPI(this,this.dispatcher)};ExternalPlayer.prototype.createModel=function(){var playbackProxy;this.registerProxy(new LocalizationProxy(this.config));this.registerProxy(new ApplicationStateProxy());playbackProxy=new ExternalPlaybackProxy();this.registerProxy(new PlayerProxy(playbackProxy));this.registerProxy(new DataBindingProxy());this.registerProxy(new ConfigurationProxy(this.config));this.registerProxy(playbackProxy);this.registerProxy(new ExternalMediaProxy());this.registerProxy(new ParamsProxy(this.config.params))};ExternalPlayer.prototype.createView=function(){var app,errorslate,overlay,_this=this;app=this.getViewComponent();this.registerMediator(new PlayerMediator("external",app));this.registerMediator(new PluginAdapter());overlay=new OverlayLayerMediator();this.registerMediator(overlay);EventHandler.create(overlay.viewComponent,EventHandler.CLICK,function(){return _this.sendNotification(Notifications.TOGGLE_ACTIVE)});this.registerMediator(new PosterMediator());this.registerMediator(new TitleBarMediator());errorslate=new ErrorLayerMediator();this.viewComponent.appendChild(errorslate.getViewComponent());this.registerMediator(errorslate)};ExternalPlayer.prototype.createController=function(){this.registerCommand(Notifications.UPDATE_DATA_BINDINGS,UpdateDataBindingsCommand);this.registerCommand(Notifications.UPDATE_DATA_BINDINGS,UpdatePlaybackCoreCommand);this.registerCommand(UserNotifications.TOGGLE_PLAY_PAUSE,ExternalPlayCommand);this.registerCommand(Notifications.PLAY,ExternalPlayCommand);this.registerCommand(Notifications.CHANGE_PLAY_STATE,ChangePlayStateCommand);this.registerCommand(Notifications.SET_MEDIA,SetMediaCommand);this.registerCommand(Notifications.CHANGE_MEDIA,ChangeMediaCommand);this.registerCommand(Notifications.MEDIA_CHANGE,MediaChangeCommand);this.registerCommand(Notifications.ERROR,ErrorCommand);this.registerCommand(Notifications.READY,ReadyCommand);this.registerCommand(Notifications.CHANGE_PARAMS,ChangeParamsCommand)};function URLVariables(uri){if(uri!=null)this.decode(uri)};URLVariables.decode=function(uri){var results;if(uri!=null){results={};uri=uri.replace(/^[^?]*\?/,"");uri.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function($0,$1,$2,$3){results[decodeURIComponent($1)]=decodeURIComponent($3)})};return results};URLVariables.encode=function(obj){var key,str,value;str=[];for(key in obj){value=obj[key];if(value!=null)str.push(""+(encodeURIComponent(key))+"="+(encodeURIComponent(value)))};return str.join("&")};URLVariables.prototype.decode=function(uri){var key,results,value;if(uri!=null){results=URLVariables.decode(uri);for(key in results){value=results[key];this[key]=value}};return results};URLVariables.prototype.encode=function(){return URLVariables.encode(this)};function EventDispatcher(target){var listeners;if(target==null)target=this;listeners={};this.addEventListener=function(type,func){if(func){if(!(listeners[type]!=null))listeners[type]=[];listeners[type].push(func)}};this.dispatchEvent=function(event){var handler,handlers,listener,_i,_len;handlers=listeners[event.type];listener=target["on"+event.type];event.target=target;if(listener!=null)listener.apply(this,[event]);if(handlers!=null)for(_i=0,_len=handlers.length;_i<_len;_i++){handler=handlers[_i];handler.apply(target,[event])}};this.removeEventListener=function(type,func){var handlers,index;if(type in listeners){handlers=listeners[type];index=handlers.indexOf(func);if(index!==-1)return handlers.splice(index,1)}}};EventDispatcher.prototype.addEventListener=function(type,func,capture){};EventDispatcher.prototype.dispatchEvent=function(event){};EventDispatcher.prototype.removeEventListener=function(type,func,capture){};function FeedVO(){this.item=[];this.metadata={}};FeedVO.prototype.title=null;FeedVO.prototype.link=null;FeedVO.prototype.description=null;FeedVO.prototype.category=null;FeedVO.prototype.pubDate=null;FeedVO.prototype.language=null;FeedVO.prototype.ttl=null;FeedVO.prototype.item=null;FeedVO.prototype.metadata=null;function MediaVO(){this.metadata={}};MediaVO.prototype.src=null;MediaVO.prototype.source=null;MediaVO.prototype.title=null;MediaVO.prototype.description=null;MediaVO.prototype.link=null;MediaVO.prototype.guid=null;MediaVO.prototype.pubDate=null;MediaVO.prototype.poster=null;MediaVO.prototype.thumbnail=null;MediaVO.prototype.embed=null;MediaVO.prototype.category=null;MediaVO.prototype.type=null;MediaVO.prototype.medium=null;MediaVO.prototype.duration=null;MediaVO.prototype.track=null;MediaVO.prototype.metadata=null;MediaVO.prototype.scenes=null;function Alarm(date,label){var alarm,timeout,_this=this;this.date=date;this.label=label!=null?label:this.label;Alarm.__super__.constructor.call(this);timeout=null;this.engage=function(time){var delta;if(time==null)time=Date.now();delta=this.date.getTime()-time;if(delta<0)throw new Error("Alarm date has past.");if(delta>2147483647)throw new Error("Invalid alarm date.");this.disengage();timeout=setTimeout(alarm,delta)};this.disengage=function(){clearTimeout(timeout)};alarm=function(){_this.dispatchEvent({type:"alarm",label:_this.label})}};__extends(Alarm,EventDispatcher);Alarm.prototype.date=null;Alarm.prototype.label="alarm";Alarm.prototype.engage=function(time){};Alarm.prototype.disengage=function(){};function MRSSHelper(){};MRSSHelper.prototype.getFeed=function(url,onload,onerror){return Utils.getJson(url,onload,onerror)};MRSSHelper.prototype.getMediaNode=function(item,name,checkItem){var base,mediaContent,mediaName,node;if(checkItem==null)checkItem=true;mediaName="media-"+name;base=item['media-group']||item;mediaContent=base['media-content'];if((mediaContent!=null)&&(mediaContent[mediaName]!=null)){node=mediaContent[mediaName]}else if(base[mediaName]!=null){node=base[mediaName]}else if(item[mediaName]!=null){node=item[mediaName]}else if((item[name]!=null)&&checkItem)node=item[name];return node};MRSSHelper.prototype.createEmbed=function(item){var embed,embedVO,param,_i,_len,_ref;try{embed=this.getMediaNode(item,"embed");if(!(embed!=null))return embedVO;embedVO={};embedVO.url=embed["@attributes"].url;embedVO.width=embed["@attributes"].width;embedVO.height=embed["@attributes"].height;embedVO.params={};if(!(embed["media-param"]instanceof Array))embed["media-param"]=[embed["media-param"]];_ref=embed["media-param"];for(_i=0,_len=_ref.length;_i<_len;_i++){param=_ref[_i];embedVO.params[param["@attributes"].name]=param["#text"]}}catch(error){Logger.error("[AMP Feed Parse Error] embed parse error: "+error.message,error)};return embedVO};MRSSHelper.prototype.createFeed=function(json){var channel,feedVO,item,items,key,mediaVO,value,_i,_len;try{channel=json.channel;feedVO=new FeedVO();if(channel!=null){feedVO.title=channel.title;feedVO.description=channel.description;feedVO.language=channel.language;feedVO.category=channel.category;feedVO.pubDate=new Date(Date.parse(channel.pubDate));feedVO.ttl=channel.ttl;items=channel.item instanceof Array?channel.item:[channel.item];for(_i=0,_len=items.length;_i<_len;_i++){item=items[_i];mediaVO=this.createMedia(item);feedVO.item.push(mediaVO)};for(key in channel){value=channel[key];if(!(key in feedVO))feedVO.metadata[key]=value}}}catch(error){Logger.error("[AMP Feed Parse Error] feed parse error: "+error.message,error)};return feedVO};MRSSHelper.prototype.createMedia=function(item){var atts,category,content,key,label,mediaContent,mediaVO,node,source,track,value,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2;try{mediaVO=new MediaVO();mediaContent=this.getMediaNode(item,'content');if(mediaContent instanceof Array){mediaVO.source=[];for(_i=0,_len=mediaContent.length;_i<_len;_i++){content=mediaContent[_i];source={src:content['@attributes'].url,type:content['@attributes'].type};category=content["media-category"];if(category!=null){atts=category["@attributes"];if(atts.schema==="http://mrss.akamai.com/user_agent_hint"){label=atts.label||category["#text"];if((label!=null)&&label!==""){if(source.rules==null)source.rules=[];source.rules.push(label)}}};mediaVO.source.push(source);mediaVO.medium=content['@attributes'].medium;mediaVO.duration=parseFloat(content['@attributes'].duration)}}else{mediaVO.type=mediaContent['@attributes'].type;mediaVO.src=mediaContent['@attributes'].url;mediaVO.medium=mediaContent['@attributes'].medium;mediaVO.duration=parseFloat(mediaContent['@attributes'].duration)};mediaVO.guid=item.guid;mediaVO.title=this.getMediaNode(item,"title");mediaVO.link=item.link;mediaVO.description=this.getMediaNode(item,"description");mediaVO.pubDate=new Date(Date.parse(item.pubDate));mediaVO.thumbnail=mediaVO.poster=(_ref=this.getMediaNode(item,'thumbnail'))!=null?(_ref1=_ref['@attributes'])!=null?_ref1.url:void(0):void(0);mediaVO.embed=this.createEmbed(item);mediaVO.scenes=(_ref2=this.getMediaNode(item,"scenes"))!=null?_ref2['media-scene']:void(0);node=this.getMediaNode(item,"status",false);if(node!=null)mediaVO.status={state:node['@attributes'].state,reason:node['@attributes'].reason};mediaVO.category=item.category;if(!(mediaVO.category instanceof Array))mediaVO.category=[mediaVO.category];node=this.getMediaNode(item,"category",false);if(node!=null)for(_j=0,_len1=node.length;_j<_len1;_j++){category=node[_j];if((category["#text"]!=null)&&category["#text"]!=="")mediaVO.category.push(category["#text"])};if(mediaVO.category!=null)mediaVO.category.sort(function(a,b){a=a.toLowerCase();b=b.toLowerCase();if(a>b){return 1}else if(a<b){return-1}else return 0});node=this.getMediaNode(item,"subTitle");if(node!=null){if(mediaVO.track==null)mediaVO.track=[];if(!(node instanceof Array))node=[node];for(_k=0,_len2=node.length;_k<_len2;_k++){track=node[_k];if(track["@attributes"]!=null)mediaVO.track.push({src:track["@attributes"].href,type:track["@attributes"].type,kind:"captioning",srclang:track["@attributes"].lang||"en"})}};category=item.category;if(!(category instanceof Array))category=[category];mediaVO.isLive=item.temporalType==="live"||((category!=null)&&category.join(",").indexOf("live_stream")!==-1);mediaVO.temporalType=mediaVO.isLive?"live":"ondemand";for(key in item){value=item[key];if(!(key in mediaVO))mediaVO.metadata[key]=value}}catch(error){Logger.error("[AMP Feed Parse Error] media parse error: "+error.message,error)};return mediaVO};function Clock(url,sync,interval){var clientTime,serverDate,serverTime,syncEnd,syncStart,syncTime,tick,timeout,_this=this;this.url=url;if(sync==null)sync=true;this.interval=interval!=null?interval:1e3;Clock.__super__.constructor.call(this);clientTime=0;serverTime=0;serverDate=null;syncStart=0;syncEnd=0;syncTime=0;timeout=null;this.sync=function(){var xhr,_this=this;xhr=Utils.getXHR();xhr.onreadystatechange=function(event){try{switch(xhr.readyState){case 1:clientTime=Date.now();break;case 2:if(xhr.status>=400)throw new Error("Sync error ("+xhr.status+"): "+_this.url);syncEnd=Date.now();syncTime=syncEnd-syncStart;serverDate=xhr.getResponseHeader("Date");if(serverDate!=null){serverTime=Date.parse(serverDate);_this.offset=clientTime-serverTime}else _this.offset=0;_this.dispatchEvent({type:"sync",time:_this.now()})}}catch(error){_this.offset=0;_this.dispatchEvent({type:"error",error:error,xhr:xhr})}};xhr.onerror=function(event){_this.offset=0;_this.dispatchEvent({type:"error",error:event,xhr:xhr})};syncStart=Date.now();xhr.open("HEAD",this.url,true);xhr.send()};this.start=function(){this.stop();this.running=true;tick();timeout=setInterval(tick,this.interval)};this.stop=function(){this.running=false;clearInterval(timeout);timeout=null};tick=function(){_this.dispatchEvent({type:"tick",time:_this.now()})};if(sync===true&&(this.url!=null))this.sync()};__extends(Clock,EventDispatcher);Clock.prototype.url=null;Clock.prototype.interval=1e3;Clock.prototype.running=false;Clock.prototype.offset=0;Clock.prototype.now=function(){return Date.now()-this.offset};Clock.prototype.sync=function(){};Clock.prototype.start=function(){};Clock.prototype.stop=function(){};function Logger(){};Logger.enabled=false;Logger.enable=function(enabled){if(enabled==null)enabled=/debug\=true/.test(location.search.toLowerCase());this.enabled=enabled;if(!this.enabled)this.log=this.trace=this.debug=this.info=this.warn=this.error=this.fatal=function(){};return enabled};Logger.log=function(){try{console.log.apply(console,arguments)}catch(error){}};Logger.trace=function(){try{console.trace.apply(console,arguments)}catch(error){}};Logger.debug=function(){try{console.log.apply(console,arguments)}catch(error){this.log.apply(this,arguments)}};Logger.info=function(){try{console.info.apply(console,arguments)}catch(error){}};Logger.warn=function(){try{console.warn.apply(console,arguments)}catch(error){}};Logger.error=function(){try{console.error.apply(console,arguments)}catch(error){this.log.apply(this,arguments)}};Logger.fatal=function(){try{console.fatal.apply(console,arguments)}catch(error){}};function Event(type,details){this.type=type;if(details!=null)this.data=this.details=details};Event.prototype.type=null;Event.prototype.target=null;Event.prototype.data=null;Event.prototype.details=null;function XHR(){XHR.__super__.constructor.call(this,this)};__extends(XHR,EventDispatcher);XHR.prototype.xhr=null;XHR.prototype.headers=null;XHR.prototype.response=null;XHR.prototype.responseXML=null;XHR.prototype.responseText=null;XHR.prototype.responseType=null;XHR.prototype.withCredentials=false;XHR.prototype.readyState=0;XHR.prototype.status=null;XHR.prototype.open=function(method,url){var xdr,xhr,_this=this;try{xhr=new XMLHttpRequest()}catch(error){xhr=new window.ActiveXObject("Microsoft.XMLHTTP")};if(XHR.isCORS(url))if(Object.prototype.hasOwnProperty.call(xhr,"withCredentials")){try{xhr.withCredentials=this.withCredentials}catch(error){Logger.warn("[AMP XHR WARNING]","withCredentials not properly supported in this browser.",error)}}else if(typeof XDomainRequest!=="undefined"){xdr=true;xhr=new XDomainRequest()};if(xhr!=null){if(xdr)xhr.onload=function(event){if(typeof xhr.onreadystatechange==='function'){xhr.readyState=4;xhr.status=200;if(xhr.contentType.match(/\/xml/)){xhr.responseXML=new ActiveXObject('Microsoft.XMLDOM');xhr.responseXML.async=false;xhr.responseXML.loadXML(xhr.responseText)};xhr.onreadystatechange.call(xhr,event,false)}};xhr.onreadystatechange=function(event){var _ref,_ref1;_this.readyState=xhr.readyState;_this.dispatchEvent(new Event("readystatechange",xhr));if(xhr.readyState===4){_this.status=xhr.status;if((199<(_ref=_this.status)&&_ref<400)||_this.status===0){if(xhr.responseText==null)xhr.responseText=xhr.text;_this.responseText=xhr.responseText;if((xhr.responseXML!=null)&&((_ref1=xhr.responseXML.childNodes)!=null?_ref1.length:void(0))>0){_this.response=_this.responseXML=xhr.responseXML;_this.responseType="document"}else try{_this.response=JSON.parse(xhr.responseText);_this.responseType="json"}catch(error){_this.response=xhr.responseText;_this.responseType="text"};_this.dispatchEvent(new Event("load",_this))}else if(_this.status!==0)_this.dispatchEvent(new Event("error",_this))}};try{if(typeof xhr.onerror!=="undefined")xhr.onerror=function(event){_this.dispatchEvent(new Event("error",_this))}}catch(error){};xhr.open(method,url)};this.xhr=xhr};XHR.prototype.send=function(data){var key,value,_ref;if(this.headers!=null){_ref=this.headers;for(key in _ref){value=_ref[key];if((key!=null)&&(value!=null))this.xhr.setRequestHeader(key,value)}};this.xhr.send(data)};XHR.prototype.setRequestHeader=function(key,value){if(!(key!=null)||!(value!=null))return;if(this.headers==null)this.headers={};this.headers[key]=value};XHR.prototype.setRequestHeaders=function(headers){this.headers=headers;return headers};XHR.prototype.getResponseHeader=function(name){var _ref;return(_ref=this.xhr)!=null?typeof _ref.getResponseHeader==="function"?_ref.getResponseHeader(name):void(0):void(0)};XHR.prototype.getAllResponseHeaders=function(){var _ref;return(_ref=this.xhr)!=null?typeof _ref.getAllResponseHeaders==="function"?_ref.getAllResponseHeaders():void(0):void(0)};XHR.isCORS=function(url){var hostname,parser,port,protocol;parser=document.createElement('a');parser.href=url;hostname=parser.hostname!==""?parser.hostname:location.hostname;port=parser.port!=="0"?parser.port:location.port;protocol=parser.protocol!==":"?parser.protocol:location.protocol;return location.protocol!==protocol||location.hostname!==hostname||location.port!==port&&!(location.port===""&&port==="80")};function QueryString(){};QueryString.construct=function(){var key,value,vars;vars=URLVariables.decode(window.location.search);for(key in vars){value=vars[key];QueryString[key]=value};return true};QueryString.constructed=QueryString.construct();QueryString.serialize=function(obj,prefix){var k,p,str,v;str=[];for(p in obj){v=obj[p];if(!(v!=null))continue;k=(prefix?prefix+"["+p+"]":p);str.push((typeof v==="object"?this.serialize(v,k):encodeURIComponent(k)+"="+encodeURIComponent(v)))};return str.join("&")};function IEventDispatcher(){};IEventDispatcher.prototype.addEventListener=function(type,func,capture){};IEventDispatcher.prototype.dispatchEvent=function(event){};IEventDispatcher.prototype.removeEventListener=function(type,func,capture){};function Utils(){};Utils.blankImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjI2QkJDQTBCMzQ4MTFFMUFERDJBRkRGQUQwNTcxRTIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NjI2QkJDQTFCMzQ4MTFFMUFERDJBRkRGQUQwNTcxRTIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowODg4NjdFQkIzNDgxMUUxQUREMkFGREZBRDA1NzFFMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowODg4NjdFQ0IzNDgxMUUxQUREMkFGREZBRDA1NzFFMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pu0++ecAAAAGUExURf///wAAAFXC034AAAABdFJOUwBA5thmAAAADElEQVR42mJgAAgwAAACAAFPbVnhAAAAAElFTkSuQmCC";Utils.flashTypes=["video/mp4","video/x-flv","video/f4m","application/smil","application/smil+xml"];Utils.mimeTypes={mp4:"video/mp4",flv:"video/x-flv",f4m:"video/f4m",smil:"application/smil",m3u8:"application/x-mpegURL",mp3:"audio/mpeg",json:"application/json",txt:"text/plain",xml:"application/xml",ogv:"video/ogg",webm:"video/webm",mpd:"application/dash+xml",ism:"application/vnd.ms-sstr+xml"};Utils.rules={flashTablets:{label:"Android 2 & 3 or Kindle Fire 1",regexp:"Android [23]|Silk\/1"},html5Phones:{label:"iPhone",regexp:"iPhone"},html5Tablets:{label:"HTML5 Tablets",regexp:"iPad|Android 4|Silk\/2"},desktop:{label:"Desktop",regexp:"^((?!iPad|iPhone|Android|BlackBerry|PlayBook|Silk).)*$"}};Utils.playbackModes={HTML:"html",AUTO:"auto",FLASH:"flash",NONE:"none",EXTERNAL:"external"};Utils.getPlaybackMode=function(mode){var key,valid,value,_ref,_ref1;if(mode==null)mode=((_ref=QueryString.mode)!=null?_ref.toLowerCase():void(0))||this.playbackModes.AUTO;valid=false;_ref1=this.playbackModes;for(key in _ref1){value=_ref1[key];if(value===mode){valid=true;break}};if(!valid)mode=this.playbackModes.AUTO;if(mode!==this.playbackModes.AUTO){if(mode===this.playbackModes.FLASH&&!this.hasFlash())mode=this.playbackModes.NONE;return mode};if(!this.hasFlash())mode=this.supportsHTML5Video()?this.playbackModes.HTML:this.playbackModes.NONE;if(mode===this.playbackModes.AUTO)mode=this.isHTML5()?this.playbackModes.HTML:this.playbackModes.FLASH;return mode};Utils.mergeRules=function(rules){var id,rule,_results;_results=[];for(id in rules){rule=rules[id];_results.push(Utils.rules[id]=rule)};return _results};Utils.checkRules=function(rules){var id,regExp,rule,_i,_len;if((rules!=null)&&rules.length>0)for(_i=0,_len=rules.length;_i<_len;_i++){id=rules[_i];if(!(rule=Utils.rules[id]))continue;regExp=new RegExp(rule.regexp);if(regExp.test(navigator.userAgent))return true};return false};Utils.selectSource=function(sources,canPlayType){var item,_i,_j,_len,_len1;for(_i=0,_len=sources.length;_i<_len;_i++){item=sources[_i];if(Utils.checkRules(item.rules))return item};for(_j=0,_len1=sources.length;_j<_len1;_j++){item=sources[_j];if(canPlayType(item.type||Utils.getMimeType(item.src))!=="")return item};return null};Utils.getMimeType=function(file){return this.mimeTypes[Utils.getFileExtension(file)]};Utils.selectTrack=function(tracks,kind){var item,track,_i,_len;for(_i=0,_len=tracks.length;_i<_len;_i++){item=tracks[_i];if(!(item.kind===kind))continue;track=item;break};return track};Utils.isIPhone=function(){return/iPhone/.test(navigator.platform)||/iPhone/.test(navigator.userAgent)};Utils.isIPad=function(){return/iPad/.test(navigator.platform)||/iPad/.test(navigator.userAgent)};Utils.isAndroid4=function(){return/Android 4/.test(navigator.userAgent)};Utils.isKindleFireHD=function(){return/Silk\/2/.test(navigator.userAgent)};Utils.isKindleFire=function(){return/Silk\/1/.test(navigator.userAgent)};Utils.isBlackBerry=function(){return/BlackBerry;|PlayBook|BB10/.test(navigator.userAgent)};Utils.isFirefoxOS=function(){return/\(Mobile;.*Firefox\//.test(navigator.userAgent)};Utils.supportsHTML5Video=function(){var video;video=document.createElement("video");return video.canPlayType!=null};Utils.isHTML5=function(){return this.isIOS()||this.isAndroid4()||this.isKindleFireHD()||this.isBlackBerry()||this.isFirefoxOS()};Utils.isIOS=function(){var iOSRegEx,isIOS;iOSRegEx=/iPad|iPhone|iPod/i;return isIOS=iOSRegEx.test(navigator.platform)||iOSRegEx.test(navigator.userAgent)};Utils.hasFlash=function(){return swfobject.hasFlashPlayerVersion("1")};Utils.isFullscreenDevice=function(){return this.isKindleFireHD()||this.isIPhone()};Utils.getDevice=function(){var device;device=null;if(this.isIPhone()){device="iphone"}else if(this.isIPad()){device="ipad"}else if(/Android/.test(navigator.userAgent)){device="android"}else if(this.isKindleFireHD()){device="kindlefirehd"}else if(this.isKindleFire()){device="kindlefire"}else if(/Mac|Win32/.test(navigator.platform))device="desktop";return device};Utils.xmlToJson=function(xml){var attribute,child,element,index,nodeName,obj,_i,_j,_len,_len1,_ref,_ref1;obj={};if(xml.nodeType===9)xml=xml.firstChild;if(xml.nodeType===1){if(xml.attributes.length>0){obj["@attributes"]={};_ref=xml.attributes;for(index=_i=0,_len=_ref.length;_i<_len;index=++_i){attribute=_ref[index];obj["@attributes"][attribute.nodeName]=attribute.nodeValue}}}else if(xml.nodeType===3||xml.nodeType===4)obj=xml.nodeValue;if(xml.hasChildNodes()){_ref1=xml.childNodes;for(index=_j=0,_len1=_ref1.length;_j<_len1;index=++_j){child=_ref1[index];if(child.nodeType===3&&!/\S/.test(child.nodeValue))continue;nodeName=child.nodeName.replace(/:/,"-");element=this.xmlToJson(child);if(!(element["@attributes"]!=null)&&(element["#text"]!=null))element=element["#text"];if(!(obj[nodeName]!=null)){obj[nodeName]=element}else{if(!(obj[nodeName]instanceof Array))obj[nodeName]=[obj[nodeName]];obj[nodeName].push(element)}}};return obj};Utils.getXHR=function(){return new XHR()};Utils.get=function(url,client,headers){var xhr;if(client==null)client={};if(headers==null)headers=null;xhr=Utils.getXHR();if(client!=null){if(client.withCredentials!=null)xhr.withCredentials=client.withCredentials;if(client.onload!=null)xhr.onload=client.onload;if(client.onerror!=null)xhr.onerror=client.onerror};xhr.open("GET",url);if(headers!=null)xhr.setRequestHeaders(headers);xhr.send();return xhr};Utils.send=function(url,data,client,headers){var xhr;if(client==null)client={};if(headers==null)headers={"Content-Type":"String"};xhr=Utils.getXHR();if(client.onload!=null)xhr.onload=client.onload;if(client.onerror!=null)xhr.onerror=client.onerror;xhr.open("POST",url);if(headers!=null)xhr.setRequestHeaders(headers);xhr.send(data);return xhr};Utils.loadAMPScript=function(src,onload){return this.loadScript(src,onload,this.getAMPParent())};Utils.getAMPParent=function(src,onload){var head,script;script=this.getAMPScriptTag();if(script!=null)return script.parentNode;head=document.getElementsByTagName("head");if((head!=null?head[0]:void(0))!=null)return head[0]};Utils.getAMPScriptTag=function(){var script,scripts,_i,_len;scripts=document.getElementsByTagName("script");for(_i=0,_len=scripts.length;_i<_len;_i++){script=scripts[_i];if(/amp(\..*)?\.js/.test(script.src))return script};return null};Utils.loadScript=function(src,onload,parent){var head,script;head=parent||document.getElementsByTagName("head")[0];script=document.createElement("script");script.type='text/javascript';if(onload!=null)if(script.addEventListener){script.onload=function(event){this.onload=null;onload()}}else if(script.readyState)script.onreadystatechange=function(event){if(this.readyState==='loaded'||this.readyState==='complete'){this.onreadystatechange=null;onload()}};script.src=src;head.appendChild(script);return script};Utils.loadStyleSheet=function(href){var head,link;head=document.getElementsByTagName("head")[0];link=document.createElement("link");link.rel="stylesheet";link.type='text/css';link.href=href;return head.appendChild(link)};Utils.read=function(url,client,type,headers){var text,xhr;if(client==null)client={};if(type==null)type="";if(headers==null)headers=[];try{xhr=this.get(url,client,headers);text=xhr.responseText||xhr.text;if(type===Utils.mimeTypes.json){return JSON.parse(text)}else if((type===Utils.mimeTypes.xml)&&(xhr.responseXML!=null)){return xhr.responseXML}else return text}catch(error){if(typeof console!=="undefined"&&console!==null)if(typeof console.error==="function")console.error("Read Error: ",error);return null}};Utils.getFileExtension=function(url){return url.split('.').pop().replace(/\?.*/,"")};Utils.getResponseHeader=function(url,header,client){var xhr;if(client==null)client={};xhr=Utils.getXHR();if(client.onerror!=null)xhr.onerror=client.onerror;xhr.open("HEAD",url,false);xhr.send();return xhr.getResponseHeader(header)};Utils.getResponseHeaders=function(url,headers,client){var header,results,xhr,_i,_len;if(client==null)client={};xhr=Utils.getXHR();if(client.onerror!=null)xhr.onerror=client.onerror;xhr.open("HEAD",url,false);xhr.send();results={};if(!(headers!=null))return xhr.getAllResponseHeaders();for(_i=0,_len=headers.length;_i<_len;_i++){header=headers[_i];results[header]=xhr.getResponseHeader(header)};return results};Utils.isTouch=null;Utils.isTouchDevice=function(){if(!(this.isTouch!=null))try{document.createEvent("TouchEvent");this.isTouch=true}catch(error){this.isTouch=false};return this.isTouch};Utils.clamp=function(value,min,max){if(value<min)value=min;if(value>max)value=max;return value};Utils.beacon=function(url){var beaconImg;beaconImg=document.getElementById("beaconId");if(!(beaconImg!=null)){beaconImg=document.createElement("img");beaconImg.setAttribute("id","beaconId");beaconImg.setAttribute("height",0);beaconImg.setAttribute("width",0);document.body.appendChild(beaconImg);beaconImg.style.display="none"};beaconImg.setAttribute("src",url);return beaconImg};Utils.getElementOffset=function(element){var offset;offset={left:0,top:0};if(element.offsetParent){offset.left=element.offsetLeft;offset.top=element.offsetTop;while((element=element.offsetParent)){offset.left+=element.offsetLeft;offset.top+=element.offsetTop}};return offset};Utils.override=function(base,overrides,clone){var key,value;if(clone==null)clone=true;if(!(base!=null))return overrides;if(!(overrides!=null))return base;if(clone===true){base=Utils.clone(base);overrides=Utils.clone(overrides)};for(key in overrides){value=overrides[key];if(typeof value==="object"){if(base[key]==null)base[key]=value instanceof Array?[]:{};base[key]=Utils.override(base[key],value,false)}else base[key]=value};return base};Utils.clone=function(obj,deepCopy){var clone,item,k,key,v,value,_i,_len;if(deepCopy==null)deepCopy=true;if(typeof obj!=="object"){clone=obj}else{if(obj instanceof Array){clone=[]}else clone={};for(key in obj){value=obj[key];if(typeof value==="object"&&deepCopy===true){if(value instanceof Array){clone[key]=[];for(_i=0,_len=value.length;_i<_len;_i++){item=value[_i];clone[key].push(this.clone(item))}}else{clone[key]={};for(k in value){v=value[k];clone[key][k]=this.clone(v)}}}else clone[key]=value}};return clone};Utils.formatTimecode=function(time,duration){var strTime;time=parseInt(time);if(isNaN(time))return"00:00";strTime=Utils.formatZeroFill(time%60);time=parseInt(time/60);strTime=Utils.formatZeroFill(time%60)+":"+strTime;time=parseInt(time/60);if(time>0)strTime=Utils.formatZeroFill(time)+":"+strTime;if(duration>=3600&&strTime.length===5)strTime="00:"+strTime;return strTime};Utils.formatZeroFill=function(time){var str;str=time.toString();if(time<10)str="0"+str;return str};Utils.flattenTimecode=function(timeCode,framerate){var ms,parts,pieces,time;if(framerate==null)framerate=30;if(!(timeCode!=null)||timeCode==="")return NaN;pieces=timeCode.split(":");ms=0;if(pieces.length===4){ms=parseInt(pieces.pop())/framerate}else if(pieces.length===3){pieces[2]=pieces[2].replace(",",".");if(pieces[2].indexOf(".")!==-1)parts=pieces[2].split(".");if((parts!=null?parts.length:void(0))>1){pieces[2]=parts[0];ms=parseInt(parts[1])/1e3}};time=parseInt(pieces.pop());while(pieces.length>0)time+=Math.pow(60,pieces.length)*parseInt(pieces.shift());return time+ms};Utils.cacheBust=function(url,key,value){var op;if(key==null)key="cacheBust";if(value==null)value=Date.now();op=url.indexOf('?')===-1?"?":"&";return url+op+key+"="+value};Utils.formatStyleName=function(styleName){return styleName.replace(/([A-Z])/,"-$1").toLowerCase()};Utils.trim=function(str){var trim;trim=str.replace(/^\s*(.*)/,"$1");return trim.replace(/(.*)\s*$/,"$1")};Utils.getJson=function(url,onload,onerror){var xhr;xhr=Utils.getXHR();xhr.open("GET",url);xhr.onload=function(event){var feed;if(xhr.responseType==="document"){feed=Utils.xmlToJson(xhr.responseXML)}else feed=xhr.response;if(typeof onload==="function")onload(feed)};xhr.onerror=function(event){if(typeof onerror==="function")onerror(event)};xhr.send();return xhr};Utils.getSource=function(url,onload,onerror){var feedloadedHandler,mode;mode=Utils.getPlaybackMode();feedloadedHandler=function(feed){var canPlayType,helper,source,_ref;helper=new MRSSHelper();feed=helper.createFeed(feed);if((feed!=null?(_ref=feed.item)!=null?_ref.length:void(0):void(0))>0){canPlayType=function(type){if((mode==="flash"&&Utils.flashTypes.indexOf(type)!==-1)||(mode==="html"&&Utils.flashTypes.indexOf(type)===-1)){return"maybe"}else return""};source=Utils.selectSource(feed.item[0].source,canPlayType)};if(typeof onload==="function")onload(source)};Utils.getJson(url,feedloadedHandler,onerror)};Utils.trackMouse=function(){try{document.addEventListener("mousemove",this.mouseTracker)}catch(error){document.attachEvent("mousemove",this.mouseTracker)}};Utils.mouseTracker=function(event){Utils.clientX=event.clientX;Utils.clientY=event.clientY;Utils.pageX=event.pageX;Utils.pageY=event.pageY};Utils.isMouseOverElement=function(element){if(!(element!=null))return false;return element.contains(document.elementFromPoint(Utils.clientX,Utils.clientY))};function ControlsProxy(config){ControlsProxy.__super__.constructor.call(this,config)};__extends(ControlsProxy,ModuleProxy);ControlsProxy.NAME=ModuleProxy.NAME;ControlsProxy.prototype.defaults={mode:"auto",autoHide:3};ControlsProxy.prototype.timeout=null;ControlsProxy.prototype.appState=null;ControlsProxy.prototype.controls=null;ControlsProxy.prototype.interactiveElement=null;ControlsProxy.prototype.initializeNotifier=function(key){ControlsProxy.__super__.initializeNotifier.call(this,key);this.appState=this.facade.app.retrieveProxy(ApplicationStateProxy.NAME);this.controls=this.facade.retrieveMediator(ApplicationStateProxy.NAME)};ControlsProxy.prototype.initialize=function(){var _this=this;if(this.config.mode!=null)this.changeMode(this.config.mode);this.interactiveElement=this.facade.app.retrieveMediator(OverlayLayerMediator.NAME).getViewComponent();if(Utils.getDevice()==="desktop"){EventHandler.create(this.interactiveElement,"mouseenter",function(){_this.stop();_this.sendNotification(Notifications.CHANGE_ACTIVE_STATE,ActiveState.ACTIVE)});EventHandler.create(this.interactiveElement,"mouseleave",function(){_this.start()})}else EventHandler.create(this.interactiveElement,EventHandler.CLICK,function(){_this.sendNotification(Notifications.TOGGLE_ACTIVE)})};ControlsProxy.prototype.setMode=function(value){if(this.data.mode===value)return value;this.changeMode(value);return value};ControlsProxy.prototype.changeMode=function(value){if(this.data.mode==="auto")this.stop();this.facade.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"controls-"+this.data.mode);this.data.mode=value;this.facade.sendNotification(Notifications.ADD_APPLICATION_STATE,"controls-"+this.data.mode)};ControlsProxy.prototype.getMode=function(){return this.data.mode};ControlsProxy.prototype.setAutoHide=function(value){this.data.autoHide=value;return value};ControlsProxy.prototype.getAutoHide=function(){return this.data.autoHide};ControlsProxy.prototype.start=function(){this.stop();if(this.data.mode!=="auto")return;this.timeout=setTimeout(this.hide.bind(this),this.data.autoHide*1e3)};ControlsProxy.prototype.stop=function(){clearTimeout(this.timeout);this.timeout=null};ControlsProxy.prototype.hide=function(){if(this.data.mode!=="auto")return;if((this.appState.getIsUserActive()===true||Utils.isMouseOverElement(this.facade.viewComponent))&&this.appState.getDisplayState()!==DisplayState.FULL_SCREEN){this.start();return};this.facade.sendNotification(Notifications.CHANGE_ACTIVE_STATE,ActiveState.INACTIVE)};function ButtonMediator(label,parent,element,componentName,onclick){this.onclick=onclick!=null?onclick:this.onclick;ButtonMediator.__super__.constructor.call(this,componentName,null,parent,element);this.icon=this.create("icon");if(label!=null)this.label=this.createText("label",label)};__extends(ButtonMediator,ComponentMediator);ButtonMediator.prototype.componentType="button";ButtonMediator.prototype.icon=null;ButtonMediator.prototype.label=null;ButtonMediator.prototype.onclick=null;function FullScreenMediator(parent){FullScreenMediator.__super__.constructor.call(this,null,parent)};__extends(FullScreenMediator,ButtonMediator);FullScreenMediator.prototype.componentName="full-screen";FullScreenMediator.prototype.onRegister=function(){FullScreenMediator.__super__.onRegister.call(this);this.sendNotification(Notifications.ADD_CONTROL_STATE,this.componentName+"-enabled")};FullScreenMediator.prototype.onclick=function(event){event.stopImmediatePropagation();this.sendNotification(Notifications.TOGGLE_FULL_SCREEN);return false};FullScreenMediator.prototype.listNotificationInterests=function(){return[Notifications.DISABLE_FULL_SCREEN,Notifications.ENABLE_FULL_SCREEN]};FullScreenMediator.prototype.handleNotification=function(notification){var body,name;name=notification.getName();body=notification.getBody();switch(name){case Notifications.DISABLE_FULL_SCREEN:this.setDisabled(true);break;case Notifications.ENABLE_FULL_SCREEN:this.setDisabled(false)}};function PluginWrapper(player,config){this.player=player;this.config=config;PluginWrapper.__super__.constructor.call(this);this.dispatcher=new EventDispatcher(this)};__extends(PluginWrapper,puremvc.Mediator);PluginWrapper.NAME="PluginWrapper";PluginWrapper.prototype.player=null;PluginWrapper.prototype.config=null;PluginWrapper.prototype.dispatcher=null;PluginWrapper.prototype.createFlashVars=null;PluginWrapper.prototype.createXML=null;PluginWrapper.prototype.getAPI=function(){return this};PluginWrapper.prototype.addEventListener=function(type,func){this.dispatcher.addEventListener(type,func)};PluginWrapper.prototype.dispatchEvent=function(event){if(event.type!=="timeupdate"&&event.type!=="timeremaining")this.player.logger.log("[AMP "+(this.constructor.NAME.replace('Wrapper','').toUpperCase())+" EVENT]",event.type,event.data,event);event.player=this.player.parent;this.dispatcher.dispatchEvent(event)};PluginWrapper.prototype.removeEventListener=function(type,func){this.dispatcher.removeEventListener(type,func)};PluginWrapper.prototype.createElement=function(xml,id,parent){var element;element=xml.createElement("element");element.setAttribute("id",id);if(!(parent!=null))parent=this.getControls(xml).controls;if(parent!=null)parent.appendChild(element);return element};PluginWrapper.prototype.createProperty=function(xml,key,value,parent){var property,text,val;property=xml.createElement("property");property.setAttribute("key",key);if(parent!=null)parent.appendChild(property);if(value!=null)if(typeof value==="object"&&!(value instanceof Array)){for(key in value){val=value[key];this.createProperty(xml,key,val,property)}}else{text=XMLUtils.createTextContent(xml,value.toString());property.appendChild(text)};return property};PluginWrapper.prototype.getControls=function(xml){var controls,element,elements,id,_i,_len;elements=xml.getElementsByTagName("element");if((elements!=null?elements.length:void(0))<1)return null;controls={};for(_i=0,_len=elements.length;_i<_len;_i++){element=elements[_i];id=element.getAttribute("id");controls[id]=element};return controls};PluginWrapper.prototype.hasControls=function(xml){var _ref;return((_ref=this.getControls(xml))!=null?_ref.controls:void(0))!=null};PluginWrapper.prototype.listNotificationInterests=function(){return[FlashNotifications.CREATE_FLASH_VARS,FlashNotifications.CREATE_XML]};PluginWrapper.prototype.handleNotification=function(notification){var body,name;name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.CREATE_FLASH_VARS:if(typeof this.createFlashVars==="function")this.createFlashVars(body.flashvars);break;case FlashNotifications.CREATE_XML:if(typeof this.createXML==="function")this.createXML(body.xml)}};function ControlsPlayCommand(){ControlsPlayCommand.__super__.constructor.call(this)};__extends(ControlsPlayCommand,puremvc.SimpleCommand);ControlsPlayCommand.prototype.execute=function(notification){var controls;this.facade.logger.debug("ControlsPlayCommand");controls=this.facade.retrieveProxy(ControlsProxy.NAME);controls.start()};function ControlsPauseCommand(){ControlsPauseCommand.__super__.constructor.call(this)};__extends(ControlsPauseCommand,puremvc.SimpleCommand);ControlsPauseCommand.prototype.execute=function(notification){var controls;this.facade.logger.debug("ControlsPauseCommand");controls=this.facade.retrieveProxy(ControlsProxy.NAME);controls.stop()};function ControlsActiveStateChangeCommand(){ControlsActiveStateChangeCommand.__super__.constructor.call(this)};__extends(ControlsActiveStateChangeCommand,puremvc.SimpleCommand);ControlsActiveStateChangeCommand.prototype.execute=function(notification){var app,body,controls;this.facade.logger.debug("ControlsActiveStateChangeCommand");controls=this.facade.retrieveProxy(ControlsProxy.NAME);app=this.facade.app.retrieveProxy(ApplicationStateProxy.NAME);body=notification.getBody();if(body.newState===ActiveState.ACTIVE&&app.getPlayState()!==PlayState.READY&&Utils.getDevice()!=="desktop")controls.start()};function ControlsAdBreakStartCommand(){ControlsAdBreakStartCommand.__super__.constructor.call(this)};__extends(ControlsAdBreakStartCommand,puremvc.SimpleCommand);ControlsAdBreakStartCommand.prototype.execute=function(notification){this.facade.logger.debug("ControlsAdBreakStartCommand");this.facade.app.getVideo().controls=false};function ControlsAdBreakEndCommand(){ControlsAdBreakEndCommand.__super__.constructor.call(this)};__extends(ControlsAdBreakEndCommand,puremvc.SimpleCommand);ControlsAdBreakEndCommand.prototype.execute=function(notification){this.facade.logger.debug("ControlsAdBreakEndCommand");this.facade.app.getVideo().controls=true};function ControlsChangeMediaCommand(){ControlsChangeMediaCommand.__super__.constructor.call(this)};__extends(ControlsChangeMediaCommand,puremvc.SimpleCommand);ControlsChangeMediaCommand.prototype.execute=function(notification){var media,src;this.facade.logger.debug("ControlsChangeMediaCommand");media=notification.getBody();src=media.poster;if((src!=null)&&src!=="")this.facade.app.getVideo().poster=src};function ControlsWrapper(player,config){ControlsWrapper.__super__.constructor.call(this,player,config)};__extends(ControlsWrapper,PluginWrapper);ControlsWrapper.NAME="ControlsWrapper";ControlsWrapper.prototype.mode="auto";ControlsWrapper.prototype.autoHide=5;ControlsWrapper.prototype.listNotificationInterests=function(){return ControlsWrapper.__super__.listNotificationInterests.apply(this,arguments).concat([Notifications.MEDIUM_CHANGE])};ControlsWrapper.prototype.handleNotification=function(notification){var body,mode,name;ControlsWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case Notifications.MEDIUM_CHANGE:mode=/audio/.test(body)?"persistent":this.mode;this.setMode(mode)}};ControlsWrapper.prototype.createFlashVars=function(flashvars){if(this.config.mode!=null)this.mode=flashvars.controls_mode=this.config.mode;return flashvars};ControlsWrapper.prototype.createXML=function(xml){var controls,element,elements,view,_i,_len;view=xml.getElementsByTagName("view")[0];elements=xml.getElementsByTagName("element");controls=null;for(_i=0,_len=elements.length;_i<_len;_i++){element=elements[_i];if(!(element.getAttribute("id")==="controls"))continue;controls=element;break};if(!(controls!=null)){controls=xml.createElement("element");controls.setAttribute("id","controls");view.appendChild(controls)};if(controls.attributes["autoHideDelay"]!=null){this.autoHide=controls.getAttribute("autoHideDelay")}else if(this.config.autoHide!=null){this.autoHide=this.config.autoHide;controls.setAttribute("autoHideDelay",this.config.autoHide)};return xml};ControlsWrapper.prototype.getMode=function(){return this.mode};ControlsWrapper.prototype.setMode=function(value){if(value===this.mode)return;try{this.mode=value;this.player.video.setPlayerProperty("controlsMode",value)}catch(error){this.facade.logger.error("Controls Error:",error)};return value};ControlsWrapper.prototype.getAutoHide=function(){return this.autoHide};function SliderMediator(parent,direction){this.direction=direction!=null?direction:this.direction;SliderMediator.__super__.constructor.call(this,null,null,parent)};__extends(SliderMediator,ComponentMediator);SliderMediator.prototype.componentType="slider";SliderMediator.prototype.trackView=null;SliderMediator.prototype.handleView=null;SliderMediator.prototype.valueView=null;SliderMediator.prototype.startCapView=null;SliderMediator.prototype.endCapView=null;SliderMediator.prototype.min=0;SliderMediator.prototype.max=1;SliderMediator.prototype.value=0;SliderMediator.prototype.dragging=false;SliderMediator.prototype.direction="vertical";SliderMediator.prototype.pressHandler=null;SliderMediator.prototype.releaseHandler=null;SliderMediator.prototype.moveHandler=null;SliderMediator.prototype.clickHandler=null;SliderMediator.prototype.onRegister=function(){SliderMediator.__super__.onRegister.call(this);this.startCapView=this.create("start-cap");this.endCapView=this.create("end-cap");this.trackView=this.create("track");this.valueView=this.create("value",this.trackView);this.handleView=this.create("handle",this.trackView);this.pressHandler=EventHandler.create(this.handleView,EventHandler.PRESS,this.handlePressHandler.bind(this));this.releaseHandler=EventHandler.create(window,EventHandler.RELEASE,this.handleReleaseHandler.bind(this));this.releaseHandler.unbind();this.moveHandler=EventHandler.create(window,EventHandler.MOVE,this.updateHandler.bind(this));this.moveHandler.unbind();this.clickHandler=EventHandler.create(this.trackView,EventHandler.CLICK,this.updateHandler.bind(this))};SliderMediator.prototype.setDirection=function(value){this.direction=value;return value};SliderMediator.prototype.getDirection=function(){return this.direction};SliderMediator.prototype.setValue=function(value){this.updateValue(value);return value};SliderMediator.prototype.getValue=function(){return this.value};SliderMediator.prototype.setDragging=function(value){if(value===this.dragging)return;this.dragging=value;this.sendNotification(Notifications.IS_USER_ACTIVE,this.dragging);return this.dragging};SliderMediator.prototype.getDragging=function(){return this.dragging};SliderMediator.prototype.updateValue=function(value){var handle;this.value=Utils.clamp(value,this.min,this.max);if(this.direction==="vertical"){value="height";handle="bottom"}else{value="width";handle="left"};this.valueView.style[value]=this.handleView.style[handle]=""+(this.value*100)+"%"};SliderMediator.prototype.calculateValue=function(pos){var offset,slider;if(this.getDirection()==="vertical"){slider=this.viewComponent.offsetHeight;offset=Utils.getElementOffset(this.viewComponent).top+slider;pos=-(pos.y-offset)}else{slider=this.viewComponent.offsetWidth;offset=Utils.getElementOffset(this.viewComponent).left;pos=pos.x-offset};return Utils.clamp(pos/slider,0,1)};SliderMediator.prototype.handlePressHandler=function(event){this.moveHandler.bind();this.releaseHandler.bind();this.setDragging(true);event.stopImmediatePropagation();return false};SliderMediator.prototype.handleReleaseHandler=function(event){this.moveHandler.unbind();this.releaseHandler.unbind();this.setDragging(false);event.stopImmediatePropagation();return false};SliderMediator.prototype.updateHandler=function(event){var pos;event.stopImmediatePropagation();pos={x:event.clientX||event.targetTouches[0].screenX,y:event.clientY||event.targetTouches[0].screenY};this.setValue(this.calculateValue(pos));return false};var PanelNotifications={ADD_PANEL:"addPanel",REMOVE_PANEL:"removePanel",OPEN_PANEL:"openPanel",CLOSE_PANEL:"closePanel",TOGGLE_PANEL:"togglePanel",CLOSE_ALL_PANELS:"closeAllPanels"};function TimeDisplayMediator(parent){TimeDisplayMediator.__super__.constructor.call(this,null,null,parent)};__extends(TimeDisplayMediator,ComponentMediator);TimeDisplayMediator.prototype.componentName="time-display";TimeDisplayMediator.prototype.duration=null;TimeDisplayMediator.prototype.currentTimeDisplay=null;TimeDisplayMediator.prototype.separatorDisplay=null;TimeDisplayMediator.prototype.durationDisplay=null;TimeDisplayMediator.prototype.liveDisplay=null;TimeDisplayMediator.prototype.onRegister=function(){TimeDisplayMediator.__super__.onRegister.call(this);this.liveDisplay=this.createText("live-display",this.localizationManager.getString(LocalizationConstants.MSG_LIVE));this.currentTimeDisplay=this.createText("current-time-display","00:00",this,"span");this.separatorDisplay=this.createText("separator-display"," / ",this,"span");this.durationDisplay=this.createText("duration-display","00:00",this,"span")};TimeDisplayMediator.prototype.listNotificationInterests=function(){return[Notifications.PLAY,Notifications.DURATION_CHANGE,Notifications.ENDED,Notifications.DISPLAY_TIME]};TimeDisplayMediator.prototype.handleNotification=function(notification){var body,name;name=notification.getName();body=notification.getBody();switch(name){case Notifications.PLAY:this.updateDuration();break;case Notifications.DURATION_CHANGE:this.duration=body;this.updateCurrentTime();this.updateDuration();break;case Notifications.ENDED:this.updateCurrentTime(this.duration);this.updateDuration();break;case Notifications.DISPLAY_TIME:this.updateCurrentTime(body.currentTime,body.duration);this.updateDuration(body.duration)}};TimeDisplayMediator.prototype.updateCurrentTime=function(currentTime,duration){if(currentTime==null)currentTime=this.currentTime;if(duration==null)duration=this.duration;this.currentTimeDisplay.textContent=Utils.formatTimecode(currentTime,duration)};TimeDisplayMediator.prototype.updateDuration=function(duration){if(duration==null)duration=this.duration;this.durationDisplay.textContent=Utils.formatTimecode(duration)};function PanelsMediator(parent){this.panels=[];this.closeHandler=this.mouseupHandler.bind(this);PanelsMediator.__super__.constructor.call(this,null,null,parent)};__extends(PanelsMediator,ComponentMediator);PanelsMediator.prototype.componentName="panels";PanelsMediator.prototype.activePanel=null;PanelsMediator.prototype.panels=null;PanelsMediator.prototype.closeHandler=null;PanelsMediator.prototype.listNotificationInterests=function(){var key,value;return((function(){var _results;_results=[];for(key in PanelNotifications){value=PanelNotifications[key];_results.push(value)};return _results})()).concat([])};PanelsMediator.prototype.handleNotification=function(notification){var body,name;name=notification.getName();body=notification.getBody();switch(name){case PanelNotifications.ADD_PANEL:this.addPanel(body);break;case PanelNotifications.REMOVE_PANEL:this.removePanel(body);break;case PanelNotifications.OPEN_PANEL:this.openPanel(body);break;case PanelNotifications.CLOSE_PANEL:this.closePanel(body);break;case PanelNotifications.CLOSE_ALL_PANELS:this.closeAllPanels(body);break;case PanelNotifications.TOGGLE_PANEL:this.togglePanel(body)}};PanelsMediator.prototype.addPanel=function(panel){this.panels.push(panel);this.viewComponent.appendChild(panel.getViewComponent())};PanelsMediator.prototype.removePanel=function(panel){this.panels.splice(this.panels.indexOf(panel),1);this.viewComponent.removeChild(panel.getViewComponent())};PanelsMediator.prototype.openPanel=function(panel){if(panel===this.activePanel||!(panel!=null))return;this.closeAllPanels();this.activePanel=panel;this.activePanel.classList.add("active");if(Utils.getDevice()!=="desktop")this.sendNotification(Notifications.IS_USER_ACTIVE,true);document.addEventListener("mouseup",this.closeHandler)};PanelsMediator.prototype.closePanel=function(panel){panel.classList.remove("active");if(this.activePanel!=null){this.activePanel=null;if(Utils.getDevice()!=="desktop")this.sendNotification(Notifications.IS_USER_ACTIVE,false);document.removeEventListener("mouseup",this.closeHandler)}};PanelsMediator.prototype.togglePanel=function(panel){if(panel===this.activePanel){this.closePanel(panel)}else this.openPanel(panel)};PanelsMediator.prototype.closeAllPanels=function(){var panel,_i,_len,_ref;_ref=this.panels;for(_i=0,_len=_ref.length;_i<_len;_i++){panel=_ref[_i];this.closePanel(panel)}};PanelsMediator.prototype.mouseupHandler=function(event){var button,element,panel;element=document.elementFromPoint(event.clientX,event.clientY);panel=this.activePanel.getViewComponent();button=this.activePanel.control.getViewComponent();if(element!==panel&&panel.contains(element)===false&&element!==button&&button.contains(element)===false)this.closeAllPanels()};function ProgressMediator(parent){ProgressMediator.__super__.constructor.call(this,parent,"horizontal")};__extends(ProgressMediator,SliderMediator);ProgressMediator.prototype.componentName="progress";ProgressMediator.prototype.bufferValue=null;ProgressMediator.prototype.scrubTime=null;ProgressMediator.prototype.scrubTimeSeparator=null;ProgressMediator.prototype.cuePoints=null;ProgressMediator.prototype.duration=0;ProgressMediator.prototype.isLive=false;ProgressMediator.prototype.previewData={src:null,previewWidth:null,previewHeight:null,imgWidth:null,imgHeight:null,count:null};ProgressMediator.prototype.onRegister=function(){ProgressMediator.__super__.onRegister.call(this);this.bufferValue=this.create("buffer-value",false);this.trackView.insertBefore(this.bufferValue,this.trackView.lastChild);this.cuePoints=this.create("cue-points",this.trackView);this.scrubTimeSeparator=this.create("scrub-time-separator",this.trackView);this.scrubTime=this.create("scrub-time",this.trackView);this.thumbPreview=this.create("thumb-preview")};ProgressMediator.prototype.listNotificationInterests=function(){return[Notifications.ENDED,Notifications.MEDIA_CHANGE,Notifications.DURATION_CHANGE,Notifications.PROGRESS,Notifications.ADD_CUE_POINTS,Notifications.REMOVE_CUE_POINTS,Notifications.DISPLAY_TIME]};ProgressMediator.prototype.handleNotification=function(notification){var body,cue,cuePoint,cues,name,value,_i,_len,_ref,_ref1;name=notification.getName();body=notification.getBody();switch(name){case Notifications.MEDIA_CHANGE:this.isLive=body.temporalType==="live";this.updateValue(0);this.bufferValue.style.width="0%";this.updatePreview(body.metadata);break;case Notifications.PROGRESS:value=Utils.clamp(body/this.duration*100,0,100);this.bufferValue.style.width=value+"%";break;case Notifications.DURATION_CHANGE:this.duration=body;break;case Notifications.ENDED:this.updateValue(1.0);break;case Notifications.ADD_CUE_POINTS:if(((_ref=this.facade.app.config)!=null?(_ref1=_ref.controls)!=null?_ref1.displaySceneMarkers:void(0):void(0))!=null)if(this.facade.app.config.controls.displaySceneMarkers===false)return;this.removeCuePoints();cues=body;for(_i=0,_len=cues.length;_i<_len;_i++){cue=cues[_i];if(!(cue!==0&&cue!==-1))continue;cuePoint=this.create("cue-point",this.cuePoints);cuePoint.style.left=(cue/this.duration*100)+"%"};break;case Notifications.REMOVE_CUE_POINTS:this.removeCuePoints();break;case Notifications.DISPLAY_TIME:this.updateValue(body.currentTime/body.duration,body.duration)}};ProgressMediator.prototype.updatePreview=function(metadata){var img,_this=this;this.previewData.src=metadata.previewThumbnailSrc;this.previewData.previewHeight=metadata.previewThumbnailHeight;this.previewData.previewWidth=metadata.previewThumbnailWidth;this.previewData.count=metadata.previewThumbnailCount;img=new Image();if(this.previewData.src)img.src=this.previewData.src;EventHandler.create(img,"load",function(event){event.stopImmediatePropagation();_this.previewData.imgWidth=event.target.width;_this.previewData.imgHeight=event.target.height;return false});if(this.previewData.src)this.thumbPreview.style.backgroundImage="url("+this.previewData.src+")";this.thumbPreview.style.width=this.previewData.previewWidth+"px";this.thumbPreview.style.height=this.previewData.previewHeight+"px"};ProgressMediator.prototype.removeCuePoints=function(){if(!(this.cuePoints!=null))return;this.cuePoints.innerHTML=""};ProgressMediator.prototype.setValue=function(value){var playbackCore;ProgressMediator.__super__.setValue.call(this,value);playbackCore=this.facade.app.retrieveProxy(PlayerProxy.NAME).getActivePlaybackCore();this.sendNotification(UserNotifications.SEEK,value*playbackCore.getDuration())};ProgressMediator.prototype.updateValue=function(percent,duration){if(duration==null)duration=this.duration;if(this.isLive===true)percent=1;if(isNaN(percent)===true)percent=0;ProgressMediator.__super__.updateValue.call(this,percent);if(this.getDragging()===true)this.scrubTime.textContent=Utils.formatTimecode(this.value*duration);this.scrubTime.style.left=this.scrubTimeSeparator.style.left=""+((this.value*100).toFixed(2))+"%";this.previewInterval=this.duration/this.previewData.count;this.previewImgIndex=Math.floor(this.value*duration/this.previewInterval);this.previewRow=Math.floor((this.previewImgIndex*this.previewData.previewWidth)/this.previewData.imgWidth);this.xpos="-"+this.previewData.previewWidth*this.previewImgIndex+"px ";this.ypos="-"+this.previewData.previewHeight*this.previewRow.toFixed(0)+"px ";this.thumbPreview.style.backgroundPosition=this.xpos+this.ypos;this.thumbPreview.style.left=""+(((this.value*100)-18).toFixed(2))+"%"};ProgressMediator.prototype.handlePressHandler=function(event){ProgressMediator.__super__.handlePressHandler.call(this,event);this.classList.add("scrubbing")};ProgressMediator.prototype.handleReleaseHandler=function(event){ProgressMediator.__super__.handleReleaseHandler.call(this,event);this.classList.remove("scrubbing")};function PlayPauseMediator(parent){PlayPauseMediator.__super__.constructor.call(this,null,parent)};__extends(PlayPauseMediator,ButtonMediator);PlayPauseMediator.prototype.componentName="play-pause";PlayPauseMediator.prototype.onclick=function(event){event.stopImmediatePropagation();event.preventDefault();this.sendNotification(UserNotifications.TOGGLE_PLAY_PAUSE);return false};function AMPConfig(){AMPConfig.__super__.constructor.call(this)};__extends(AMPConfig,EventDispatcher);AMPConfig.UNINITIALIZED=0;AMPConfig.LOADING=1;AMPConfig.LOADED=2;AMPConfig.AMP_DEFAULTS="amp-defaults";AMPConfig.getConfigURL=function(){var script,src,vars;script=Utils.getAMPScriptTag();if(script!=null){src=script.src;if(src.indexOf("?")!==-1){vars=URLVariables.decode(src);if(vars[this.AMP_DEFAULTS]!=null)return vars[this.AMP_DEFAULTS]}};return null};AMPConfig.parseModule=function(xml){var child,childNodes,count,i,k,node,obj,_i,_len;obj={};i=0;childNodes=xml.childNodes;count=childNodes.length;k=0;node=null;child=null;for(_i=0,_len=childNodes.length;_i<_len;_i++){node=childNodes[_i];if((node!=null?node.nodeType:void(0))===1)obj[node.nodeName]=this.parseItem(node)};return obj};AMPConfig.parseItem=function(node){var child,children,type,value,_i,_len;type=(""+(node.getAttribute('type'))).toLowerCase();value=node.textContent||node.text||node.innerText;if(type!=="object"&&type!=="array"&&/#\{.*\}/.test(value))return value;switch(type){case"object":value=this.parseModule(node);break;case"array":value=[];children=node.childNodes;for(_i=0,_len=children.length;_i<_len;_i++){child=children[_i];if(child.nodeType!==1)continue;value.push(this.parseItem(child))};break;case"boolean":value=value.toLowerCase()==="true";break;case"number":value=parseFloat(value)};return value};AMPConfig.loadHead=function(data,onload){var count,element,head,link,links,loadScript,loaded,next,scripts,_i,_len;head=Utils.getAMPParent();loadScript=function(script){var element;element=document.createElement("script");element.type='text/javascript';element.src=script;if(element.addEventListener){element.addEventListener("load",next,false)}else if(element.readyState)element.onreadystatechange=next;head.appendChild(element)};next=function(){loaded++;if(loaded<count){return loadScript(scripts[loaded])}else return typeof onload==="function"?onload():void(0)};if((data.links!=null)&&data.links.length>0){links=data.links;for(_i=0,_len=links.length;_i<_len;_i++){link=links[_i];element=document.createElement("link");element.rel="stylesheet";element.type='text/css';element.href=link;head.appendChild(element)}};if((data.scripts!=null)&&data.scripts.length>0){scripts=data.scripts;loaded=-1;count=scripts.length;next()}else if(typeof onload==="function")onload()};AMPConfig.prototype.url=null;AMPConfig.prototype.data=null;AMPConfig.prototype.xml=null;AMPConfig.prototype.readyState=AMPConfig.UNINITIALIZED;AMPConfig.prototype.loaded=false;AMPConfig.prototype.loadURL=function(url,withCredentials){var xhr,_this=this;if(withCredentials==null)withCredentials=false;if(!(url!=null)){url=AMPConfig.getConfigURL();if(!(url!=null))return};this.url=url;this.setReadyState(AMPConfig.LOADING);xhr=Utils.get(url,{withCredentials:withCredentials,onload:function(event){var data,firstChild,xmlhttp;xmlhttp=event.data;if(xmlhttp.responseType==="document"){_this.xml=xmlhttp.responseXML;firstChild=_this.xml.firstChild.nodeType!==7?_this.xml.firstChild:_this.xml.childNodes[1];data=AMPConfig.parseModule(firstChild)}else data=xmlhttp.response;_this.loadModule(data)},onerror:function(event){_this.dispatchEvent(new Event("error",event));Logger.error(event)}})};AMPConfig.prototype.loadModule=function(data){var _this=this;if(data.head!=null){AMPConfig.loadHead(data.head,function(){_this.loadData(data.config)})}else this.loadData(data.config)};AMPConfig.prototype.loadData=function(data){this.data=data;this.setReadyState(AMPConfig.LOADED)};AMPConfig.prototype.load=function(resource,withCredentials){if(withCredentials==null)withCredentials=false;if(typeof resource==="object"){this.loadModule(resource)}else if((!(resource!=null))||(typeof resource==="string"))this.loadURL(resource,withCredentials)};AMPConfig.prototype.setReadyState=function(state){this.readyState=state;this.dispatchEvent(new Event("readystatechange",state));if(state===AMPConfig.LOADED&&!this.loaded){this.loaded=true;this.dispatchEvent(new Event("load",this.data))}};function ControlsMediator(){ControlsMediator.__super__.constructor.call(this)};__extends(ControlsMediator,LayerMediator);ControlsMediator.prototype.componentName="controls";ControlsMediator.prototype.activeControlPanel=null;ControlsMediator.prototype.controlBar=null;ControlsMediator.prototype.panels=null;ControlsMediator.prototype.onRegister=function(){var separator;ControlsMediator.__super__.onRegister.call(this);this.facade.viewComponent=this.viewComponent;this.controlBar=this.create("control-bar");this.facade.registerMediator(new PanelsMediator(this.viewComponent));this.facade.registerMediator(new PlayPauseMediator(this.controlBar));this.facade.registerMediator(new TimeDisplayMediator(this.controlBar));this.facade.registerMediator(new ProgressMediator(this.controlBar));separator=this.create("separator",this.controlBar)};ControlsMediator.prototype.listNotificationInterests=function(){return[Notifications.READY,Notifications.ADD_CONTROL,Notifications.REMOVE_CONTROL,Notifications.ADD_CONTROL_STATE,Notifications.REMOVE_CONTROL_STATE]};ControlsMediator.prototype.handleNotification=function(notification){var body,name,_ref;name=notification.getName();body=notification.getBody();switch(name){case Notifications.READY:if(((_ref=body.fullscreen)!=null?_ref.enabled:void(0))!==false)this.facade.registerMediator(new FullScreenMediator(this.controlBar));break;case Notifications.ADD_CONTROL_STATE:this.classList.add(body);break;case Notifications.REMOVE_CONTROL_STATE:this.classList.remove(body);break;case Notifications.ADD_CONTROL:this.controlBar.appendChild(body);break;case Notifications.REMOVE_CONTROL:this.controlBar.removeChild(body)}};function ControlsAPI(module){var controls;ControlsAPI.__super__.constructor.call(this,module);controls=module.retrieveProxy(ControlsProxy.NAME);this.setMode=controls.setMode.bind(controls);this.getMode=controls.getMode.bind(controls);this.setAutoHide=controls.setAutoHide.bind(controls);this.getAutoHide=controls.getAutoHide.bind(controls)};__extends(ControlsAPI,PluginAPI);ControlsAPI.prototype.setMode=function(value){};ControlsAPI.prototype.getMode=function(){};ControlsAPI.prototype.setAutoHide=function(value){};ControlsAPI.prototype.getAutoHide=function(){};function AMP(container,config,readyHandler){var api,debug,dispatcher,initialize,player,startup,version,_this=this;if(typeof container==="string")container=document.getElementById(container);Utils.trackMouse();player=null;api=null;version=null;dispatcher=new EventDispatcher(this);this.addEventListener=function(type,func,capture){dispatcher.addEventListener(type,func,capture)};this.dispatchEvent=function(event){event.player=this;dispatcher.dispatchEvent(event)};this.removeEventListener=function(type,func,capture){dispatcher.removeEventListener(type,func,capture)};if(readyHandler!=null)this.addEventListener("ready",readyHandler);initialize=function(){var xhr;if(typeof config==="string"){xhr=Utils.get(config);config=JSON.parse(xhr.responseText)};if(AMP.defaults.readyState!==AMPConfig.LOADED){if((AMPConfig.getConfigURL()!=null)&&(AMP.defaults.readyState===AMPConfig.UNINITIALIZED))AMP.loadDefaults();AMP.defaults.addEventListener("load",function(event){startup()});return};startup()};startup=function(){var feature,key,value,_ref;if((AMP.defaults.data!=null))config=Utils.override(AMP.defaults.data,config);_this.version=_this.getVersion();config.mode=Utils.getPlaybackMode(config.mode);if(config.version==null)config.version=_this.version;if(container.dataset==null)container.dataset={};container.dataset.version=_this.version;Logger.log(_this.version);switch(config.mode){case"html":player=_this.createHTMLPlayer(config,container,dispatcher);break;case"flash":player=_this.createFlashPlayer(config,container,dispatcher);break;case"external":player=_this.createExternalPlayer(config,container,dispatcher);break;case"none":player=_this.createInstallPlayer(container)};player.parent=_this;api=typeof player.getAPI==="function"?player.getAPI():void(0);if(api!=null)for(key in api){value=api[key];if(!(_this[key]!=null))_this[key]=value};_ref=player.getModules();for(key in _ref){value=_ref[key];api=typeof value.getAPI==="function"?value.getAPI():void(0);_this[key]=api||value;feature=typeof value.getFeatureName==="function"?value.getFeatureName():void(0);if(feature!=null)_this[feature]=_this[key]};try{container.amp=_this}catch(error){Logger.error(error)}};debug=(config!=null?config.debug:void(0))!=null?config.debug:/debug\=true/.test(location.search.toLowerCase());Logger.enable(debug);if(debug===true&&((config!=null?config["debugger"]:void(0))!=null)){AMP.loadDebugger(config["debugger"],initialize)}else initialize()};AMP.prototype.getVersion=function(){return this.constructor.VERSION};AMP.prototype.createFlashPlayer=function(config,container,dispatcher){return new FlashPlayer(config,container,dispatcher)};AMP.prototype.createHTMLPlayer=function(config,container,dispatcher){return new HTMLPlayer(config,container,dispatcher)};AMP.prototype.createExternalPlayer=function(config,container,dispatcher){return new ExternalPlayer(config,container,dispatcher)};AMP.prototype.createInstallPlayer=function(container){return new InstallPlayer(container)};AMP.VERSION='AMP Premier - Weather Channel v0.9.0.0004';AMP.defaults=new AMPConfig();AMP.plugins=[];AMP.loadDefaults=function(url,withCredentials){if(withCredentials==null)withCredentials=false;this.defaults.load(url,withCredentials)};AMP.loadDebugger=function(url,onload){Utils.loadAMPScript(url,function(){if(onload!=null)setTimeout(onload,1e3)})};AMP.getPlaybackMode=function(){return Utils.getPlaybackMode()};AMP.registerPlugin=function(id,mode,plugin){var _base;if((_base=this.plugins)[id]==null)_base[id]={};this.plugins[id][mode]=plugin};function PlayOverlayWrapper(){return PlayOverlayWrapper.__super__.constructor.apply(this,arguments)};__extends(PlayOverlayWrapper,PluginWrapper);PlayOverlayWrapper.NAME="PlayOverlayWrapper";PlayOverlayWrapper.prototype.createFlashVars=function(flashvars){flashvars.show_play_button_overlay=this.config.enabled!=null?this.config.enabled:true;return flashvars};AMP.registerPlugin("playoverlay","flash",PlayOverlayWrapper);function PlayOverlayMediator(){PlayOverlayMediator.__super__.constructor.call(this)};__extends(PlayOverlayMediator,OverlayMediator);PlayOverlayMediator.prototype.componentName="play";PlayOverlayMediator.prototype.onclick=function(event){event.stopImmediatePropagation();event.preventDefault();this.sendNotification(UserNotifications.TOGGLE_PLAY_PAUSE);return false};function MediaAnalyticsProxy(config){MediaAnalyticsProxy.__super__.constructor.call(this,config)};__extends(MediaAnalyticsProxy,PluginProxy);MediaAnalyticsProxy.NAME=ModuleProxy.NAME;MediaAnalyticsProxy.prototype.defaults={config:null,dimensions:null,plugin:{js:"http://79423.analytics.edgesuite.net/html5/akamaihtml5-min.js"}};MediaAnalyticsProxy.prototype.getLoaded=function(){return window.setAkamaiMediaAnalyticsData!=null};MediaAnalyticsProxy.prototype.initialize=function(){try{window.akamaiSetVideoObject(this.facade.app.getVideo())}catch(error){this.facade.logger.error("[AMP MEDIA ANALYTICS ERROR]","Could not set video tag",error)}};MediaAnalyticsProxy.prototype.setDimensions=function(value){var dimensions,key,val;dimensions=this.configurationData.source.dimensions;for(key in value){val=value[key];if(val!=null)dimensions[key]=val};this.configurationData.parse(this.configurationData.source);this.applyDimensions(dimensions);return value};MediaAnalyticsProxy.prototype.applyDimensions=function(dimensions){var key,value;if(!(window.setAkamaiMediaAnalyticsData!=null))return;try{for(key in dimensions){value=dimensions[key];setAkamaiMediaAnalyticsData(key,value)}}catch(error){this.facade.logger.error("[AMP MEDIA ANALYTICS ERROR]","Could not set dimensions:",error)}};MediaAnalyticsProxy.prototype.setMedia=function(media){var dimensions,_ref;if(((_ref=media.mediaanalytics)!=null?_ref.dimensions:void(0))!=null){dimensions=Utils.override(this.value.dimensions,media.mediaanalytics.dimensions)}else dimensions=this.value.dimensions;this.applyDimensions(dimensions);return media};MediaAnalyticsProxy.prototype.udpateMedia=function(media){if(typeof akamaiHandleTitleSwitch==="function")akamaiHandleTitleSwitch(media);return media};function ControlsPlugin(app,config){ControlsPlugin.__super__.constructor.call(this,app,config)};__extends(ControlsPlugin,Plugin);ControlsPlugin.NAME="ControlsPlugin";ControlsPlugin.prototype.moduleName="controls";ControlsPlugin.prototype.initialize=function(){if(this.config["native"]===true){this.app.getVideo().controls=true;this.app.sendNotification(Notifications.ADD_APPLICATION_STATE,"controls-native");this.registerCommand(Notifications.CHANGE_MEDIA,ControlsChangeMediaCommand);this.registerCommand(AdNotifications.BREAK_START,ControlsAdBreakStartCommand);this.registerCommand(AdNotifications.BREAK_END,ControlsAdBreakEndCommand);this.createAPI=this.createView=function(){};return}else ControlsPlugin.__super__.initialize.call(this)};ControlsPlugin.prototype.createController=function(){this.registerCommand(Notifications.PLAY,ControlsPlayCommand);this.registerCommand(Notifications.PAUSE,ControlsPauseCommand);this.registerCommand(Notifications.ACTIVE_STATE_CHANGE,ControlsActiveStateChangeCommand)};ControlsPlugin.prototype.createModel=function(){this.registerProxy(new ControlsProxy(this.config))};ControlsPlugin.prototype.createAPI=function(){return new ControlsAPI(this)};ControlsPlugin.prototype.createView=function(){this.registerMediator(new ControlsMediator())};ControlsPlugin.prototype.listNotificationInterests=function(){var key,value;return((function(){var _results;_results=[];for(key in PanelNotifications){value=PanelNotifications[key];_results.push(value)};return _results})()).concat([Notifications.MEDIA_CHANGE,Notifications.TIME_UPDATE,Notifications.DURATION_CHANGE,Notifications.PROGRESS,Notifications.ENDED,Notifications.ADD_CUE_POINTS,Notifications.REMOVE_CUE_POINTS,Notifications.DISABLE_FULL_SCREEN,Notifications.ENABLE_FULL_SCREEN,Notifications.READY,Notifications.ADD_CONTROL,Notifications.REMOVE_CONTROL,Notifications.ADD_CONTROL_STATE,Notifications.REMOVE_CONTROL_STATE,Notifications.ACTIVE_STATE_CHANGE,Notifications.PLAY,Notifications.PAUSE,AdNotifications.BREAK_START,AdNotifications.BREAK_END,Notifications.CHANGE_MEDIA,Notifications.DISPLAY_TIME])};ControlsPlugin.prototype.listNotificationPublications=function(){return ControlsPlugin.__super__.listNotificationPublications.call(this).concat([Notifications.CHANGE_ACTIVE_STATE,Notifications.TOGGLE_FULL_SCREEN,UserNotifications.TOGGLE_PLAY_PAUSE,UserNotifications.SEEK,Notifications.TOGGLE_ACTIVE])};AMP.registerPlugin("controls","html",ControlsPlugin);AMP.registerPlugin("controls","flash",ControlsWrapper);AMP.registerPlugin("controls","external",ControlsPlugin);function MediaAnalyticsWrapper(player,config){MediaAnalyticsWrapper.__super__.constructor.call(this,player,config)};__extends(MediaAnalyticsWrapper,PluginWrapper);MediaAnalyticsWrapper.NAME="MediaAnalyticsWrapper";MediaAnalyticsWrapper.prototype.listNotificationInterests=function(){return MediaAnalyticsWrapper.__super__.listNotificationInterests.call(this).concat([Notifications.MEDIA_CHANGE,MediaAnalyticsNotifications.SET_DIMENSIONS])};MediaAnalyticsWrapper.prototype.createFlashVars=function(flashvars){var dimensions,key,value,_ref,_ref1;dimensions=(_ref=this.player.config)!=null?(_ref1=_ref.media)!=null?_ref1.mediaanalytics:void(0):void(0);if(dimensions!=null)for(key in dimensions){value=dimensions[key];flashvars["report_"+key]=value};return flashvars};MediaAnalyticsWrapper.prototype.createXML=function(xml){var application,dimensions,element,key,metrics,path,value,vendor,_ref,_ref1;application=xml.getElementsByTagName("application")[0];metrics=xml.getElementsByTagName("metrics")[0];if(!(metrics!=null)){metrics=xml.createElement("metrics");application.appendChild(metrics)};vendor=xml.createElement("vendor");vendor.setAttribute("id","akamai");metrics.appendChild(vendor);if(this.config.config!=null){element=xml.createElement("property");element.setAttribute("key","MEDIA_ANALYTICS_BEACON");element.appendChild(XMLUtils.createTextContent(xml,this.config.config));vendor.appendChild(element);path=((_ref=this.config.plugin)!=null?_ref.swf:void(0))||"http://79423.analytics.edgesuite.net/csma/plugin/csma.swf";element=xml.createElement("property");element.setAttribute("key","MEDIA_ANALYTICS_PLUGIN_PATH");element.appendChild(XMLUtils.createTextContent(xml,path));vendor.appendChild(element)};if(this.config.dimensions!=null){dimensions=xml.createElement("property");dimensions.setAttribute("key","dimensions");vendor.appendChild(dimensions);_ref1=this.config.dimensions;for(key in _ref1){value=_ref1[key];element=xml.createElement("property");element.setAttribute("key",key);element.appendChild(XMLUtils.createTextContent(xml,value));dimensions.appendChild(element)}};return xml};MediaAnalyticsWrapper.prototype.handleNotification=function(notification){var body,key,media,name,value,_ref,_ref1;MediaAnalyticsWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case Notifications.MEDIA_CHANGE:media=body;if(((_ref=media.mediaanalytics)!=null?_ref.dimensions:void(0))!=null){media.dimensions=[];_ref1=media.mediaanalytics.dimensions;for(key in _ref1){value=_ref1[key];media.dimensions.push({key:key,value:value})}};break;case MediaAnalyticsNotifications.SET_DIMENSIONS:this.setDimensions(body)}};MediaAnalyticsWrapper.prototype.setDimensions=function(value){this.player.video.setPlayerProperty("maDimensions",value);return value};function PluginCommand(){PluginCommand.__super__.constructor.call(this)};__extends(PluginCommand,puremvc.SimpleCommand);PluginCommand.prototype.config=null;PluginCommand.prototype.plugin=null;PluginCommand.prototype.initializeNotifier=function(key){PluginCommand.__super__.initializeNotifier.call(this,key);return this.config=this.plugin=this.facade.retrieveProxy(ModuleProxy.NAME)};function MediaAnalyticsAdBreakStartCommand(){MediaAnalyticsAdBreakStartCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsAdBreakStartCommand,puremvc.SimpleCommand);MediaAnalyticsAdBreakStartCommand.prototype.execute=function(notification){this.facade.logger.debug("MediaAnalyticsAdBreakStartCommand");this.facade.app.getVideo().dataset.isad=true};function MediaAnalyticsAdBreakEndCommand(){MediaAnalyticsAdBreakEndCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsAdBreakEndCommand,puremvc.SimpleCommand);MediaAnalyticsAdBreakEndCommand.prototype.execute=function(notification){this.facade.logger.debug("MediaAnalyticsAdBreakEndCommand");this.facade.app.getVideo().dataset.isad=false};function MediaAnalyticsAdLoadedCommand(){MediaAnalyticsAdLoadedCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsAdLoadedCommand,puremvc.SimpleCommand);MediaAnalyticsAdLoadedCommand.prototype.execute=function(notification){var adObject,adVO;this.facade.logger.debug("MediaAnalyticsAdLoadedCommand");try{adVO=notification.getBody();adObject={adDuration:adVO.duration,adPartnerId:adVO.partner,adTitle:adVO.title,adId:adVO.id};if(typeof akamaiHandleAdLoaded==="function")akamaiHandleAdLoaded(adObject)}catch(error){this.facade.logger.error("[AMP MEDIA ANALYTICS ERROR]",error)}};function MediaAnalyticsAdStartCommand(){MediaAnalyticsAdStartCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsAdStartCommand,PluginCommand);MediaAnalyticsAdStartCommand.prototype.execute=function(notification){this.facade.logger.debug("MediaAnalyticsAdStartCommand");try{if(typeof akamaiHandleAdStarted==="function")akamaiHandleAdStarted()}catch(error){this.facade.logger.error("[AMP MEDIA ANALYTICS ERROR]",error)}};function MediaAnalyticsAdTimeUpdateCommand(){MediaAnalyticsAdTimeUpdateCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsAdTimeUpdateCommand,PluginCommand);MediaAnalyticsAdTimeUpdateCommand.prototype.execute=function(notification){var core,percent;core=notification.getBody();percent=Math.round(core.currentTime/core.duration*100);try{if(percent>=25&&proxy.percent<25){this.facade.logger.debug("MediaAnalytics: First Quartile");if(typeof akamaiHandleAdFirstQuartile==="function")akamaiHandleAdFirstQuartile()}else if(percent>=50&&proxy.percent<50){this.facade.logger.debug("MediaAnalytics: Second Quartile");if(typeof akamaiHandleAdMidpoint==="function")akamaiHandleAdMidpoint()}else if(percent>=75&&proxy.percent<75){this.facade.logger.debug("MediaAnalytics: Third Quartile");if(typeof akamaiHandleAdThirdQuartile==="function")akamaiHandleAdThirdQuartile()}}catch(error){this.facade.logger.error("[AMP MEDIA ANALYTICS ERROR]",error)};this.config.percent=percent};function MediaAnalyticsAdEndCommand(){MediaAnalyticsAdEndCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsAdEndCommand,puremvc.SimpleCommand);MediaAnalyticsAdEndCommand.prototype.execute=function(notification){this.facade.logger.debug("MediaAnalyticsAdEndCommand");try{if(typeof akamaiHandleAdCompleted==="function")akamaiHandleAdCompleted()}catch(error){this.facade.logger.error("[AMP MEDIA ANALYTICS ERROR]",error)};this.facade.app.getVideo().dataset.isad=true};function MediaAnalyticsSetDimensionsCommand(){MediaAnalyticsSetDimensionsCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsSetDimensionsCommand,PluginCommand);MediaAnalyticsSetDimensionsCommand.prototype.execute=function(notification){var dimensions;this.facade.logger.debug("MediaAnalyticsSetDimensionsCommand");dimensions=notification.getBody();this.config.setDimensions(dimensions)};function MediaAnalyticsContentChangedCommand(){MediaAnalyticsContentChangedCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsContentChangedCommand,PluginCommand);MediaAnalyticsContentChangedCommand.prototype.execute=function(notification){this.facade.logger.debug("MediaAnalyticsContentChangedCommand");this.config.updatedMedia(notification.getBody())};function MediaAnalyticsChangeMediaCommand(){MediaAnalyticsChangeMediaCommand.__super__.constructor.call(this)};__extends(MediaAnalyticsChangeMediaCommand,PluginCommand);MediaAnalyticsChangeMediaCommand.prototype.execute=function(notification){var media;this.facade.logger.debug("MediaAnalyticsChangeMediaCommand");media=notification.getBody();this.config.setMedia(media)};function MediaAnalyticsAPI(module){MediaAnalyticsAPI.__super__.constructor.call(this,module);this.setDimensions=function(value){module.retrieveProxy(MediaAnalyticsProxy.NAME).setDimensions(value);return value}};__extends(MediaAnalyticsAPI,PluginAPI);MediaAnalyticsAPI.prototype.setDimensions=function(value){};function PlayOverlayPlugin(app,config){PlayOverlayPlugin.__super__.constructor.call(this,app,config)};__extends(PlayOverlayPlugin,Plugin);PlayOverlayPlugin.NAME="PlayOverlayPlugin";PlayOverlayPlugin.prototype.moduleName="playoverlay";PlayOverlayPlugin.prototype.createModel=function(){};PlayOverlayPlugin.prototype.createView=function(){this.registerMediator(new PlayOverlayMediator())};PlayOverlayPlugin.prototype.listNotificationPublications=function(){return PlayOverlayPlugin.__super__.listNotificationPublications.call(this).concat([UserNotifications.TOGGLE_PLAY_PAUSE])};AMP.registerPlugin("playoverlay","html",PlayOverlayPlugin);AMP.registerPlugin("playoverlay","external",PlayOverlayPlugin);var EventManagementNotifications={EVENT_STATE_CHANGED:"eventStateChanged"};function Poller(url,interval,type,headers){this.url=url;this.interval=interval!=null?interval:1e4;this.type=type!=null?type:null;this.headers=headers!=null?headers:null;Poller.__super__.constructor.call(this)};__extends(Poller,EventDispatcher);Poller.prototype.timeout=null;Poller.prototype.interval=null;Poller.prototype.url=null;Poller.prototype.lastModified=null;Poller.prototype.contentLenght=null;Poller.prototype.data=null;Poller.prototype.text=null;Poller.prototype.type=null;Poller.prototype.headers=null;Poller.prototype.useHeadRequest=true;Poller.prototype.xhr=null;Poller.prototype.start=function(){if((this.url!=null)&&this.url!=="")this.poll()};Poller.prototype.poll=function(){var xhr,_this=this;xhr=Utils.getXHR();if(!this.useHeadRequest){this.updateData()}else{xhr.onload=function(event){var contentLength,lastModified;if(xhr.status===304){_this.invoke();return};lastModified=xhr.getResponseHeader("Last-Modified");contentLength=xhr.getResponseHeader("Content-Length");if((!(lastModified!=null)&&!(contentLength!=null))||((lastModified!=null)&&lastModified!==_this.lastModified)||((contentLength!=null)&&contentLength!==_this.contentLength)){_this.lastModified=lastModified;_this.contentLength=contentLength;_this.updateData()}else _this.invoke()};xhr.onerror=function(event){_this.error(event)};xhr.open("HEAD",Utils.cacheBust(this.url),false);this.applyHeaders();if(this.lastModified!=null)xhr.setRequestHeader("If-Modified-Since",this.lastModified);xhr.send()}};Poller.prototype.applyHeaders=function(){if(!(this.headers!=null))return;this.xhr.setRequestHeaders(this.headers)};Poller.prototype.updateData=function(){var xhr,_this=this;xhr=Utils.getXHR();xhr.open("GET",Utils.cacheBust(this.url),true);xhr.onload=function(event){var text;text=xhr.responseText;_this.setText(text);_this.invoke()};xhr.onerror=function(event){_this.error(event)};this.applyHeaders();return xhr.send()};Poller.prototype.setText=function(value){var data;if(value!==this.text){this.text=value;data=this.text;if(this.type===Utils.mimeTypes.json)try{data=this.xhr.response}catch(error){data=this.text};this.setData(data)};return value};Poller.prototype.setData=function(value){if(value!==this.data){this.data=value;this.dispatchEvent(new Event("datachanged",this.data))};return value};Poller.prototype.error=function(error){Logger.error(event);this.stop()};Poller.prototype.invoke=function(){var _this=this;this.stop();this.timeout=setTimeout(function(){_this.poll()},this.interval)};Poller.prototype.stop=function(){clearTimeout(this.timeout)};function EventManagementWrapper(){return EventManagementWrapper.__super__.constructor.apply(this,arguments)};__extends(EventManagementWrapper,PluginWrapper);EventManagementWrapper.NAME="EventManagementWrapper";EventManagementWrapper.prototype.createFlashVars=function(flashvars){if(this.config.enabled!=null)flashvars.eventmanagementstates_enabled=this.config.enabled;if(this.config.url!=null)flashvars.eventmanagementstates_status_url=this.config.url;if(this.config.interval!=null)flashvars.eventmanagementstates_status_interval=this.config.interval;return flashvars};EventManagementWrapper.prototype.createXML=function(xml){var application,eventmanagementstates,node,property,state,states,_i,_len,_ref;application=xml.getElementsByTagName("application")[0];eventmanagementstates=xml.getElementsByTagName("eventmanagementstates");if(!(eventmanagementstates!=null)||eventmanagementstates.length===0){eventmanagementstates=xml.createElement("eventmanagementstates");application.appendChild(eventmanagementstates)}else eventmanagementstates=eventmanagementstates[0];states=xml.createElement("states");eventmanagementstates.appendChild(states);_ref=this.config.states;for(_i=0,_len=_ref.length;_i<_len;_i++){state=_ref[_i];node=xml.createElement("state");states.appendChild(node);property=xml.createElement("property");property.setAttribute("key","ID");property.appendChild(XMLUtils.createTextContent(xml,state.id));node.appendChild(property);property=xml.createElement("property");property.setAttribute("key","POSTER_SRC");property.appendChild(XMLUtils.createTextContent(xml,state.poster));node.appendChild(property);if(state.url!=null){property=xml.createElement("property");property.setAttribute("key","URL");property.appendChild(XMLUtils.createTextContent(xml,state.url));node.appendChild(property)}};return xml};function EventManagementMediator(){EventManagementMediator.__super__.constructor.call(this)};__extends(EventManagementMediator,OverlayMediator);EventManagementMediator.prototype.componentName="event-management";EventManagementMediator.prototype.poster=null;EventManagementMediator.prototype.onRegister=function(){this.classList.add("hidden");this.poster=this.create("event-poster",false,"img");EventManagementMediator.__super__.onRegister.call(this)};EventManagementMediator.prototype.listNotificationInterests=function(){return[EventManagementNotifications.EVENT_STATE_CHANGED]};EventManagementMediator.prototype.handleNotification=function(notification){var state;switch(notification.getName()){case EventManagementNotifications.EVENT_STATE_CHANGED:state=notification.getBody();if(state.id!=="on"){if(state.poster!=null){this.poster.src=state.poster;this.viewComponent.appendChild(this.poster)};this.classList.remove("hidden");this.sendNotification(Notifications.PAUSE);this.sendNotification(Notifications.CHANGE_DISPLAY_STATE,DisplayState.NORMAL)}else{if(this.viewComponent.contains(this.poster))this.viewComponent.removeChild(this.poster);this.classList.add("hidden")}}};function EventManagementPlayCommand(){EventManagementPlayCommand.__super__.constructor.call(this)};__extends(EventManagementPlayCommand,puremvc.SimpleCommand);EventManagementPlayCommand.prototype.execute=function(notification){var eventManagementProxy,_ref;this.facade.logger.debug("EventManagementPlayCommand");eventManagementProxy=this.facade.retrieveProxy(EventManagementProxy.NAME);if(((_ref=eventManagementProxy.getState())!=null?_ref.id:void(0))!==EventManagementProxy.ON.id)this.sendNotification(Notifications.PAUSE)};function EventManagementProxy(config){var _this=this;EventManagementProxy.__super__.constructor.call(this,config);this.poller=new Poller();this.poller.ondatachanged=function(event){var id,state,_i,_len,_ref;id=event.data;if(id==="on"){state=EventManagementProxy.ON}else{_ref=_this.data.states;for(_i=0,_len=_ref.length;_i<_len;_i++){state=_ref[_i];if(state.id===id)break}};if(state!=null)return _this.setState(state)}};__extends(EventManagementProxy,ModuleProxy);EventManagementProxy.NAME=ModuleProxy.NAME;EventManagementProxy.ON={id:"on"};EventManagementProxy.prototype.defaults={url:null,interval:null,states:null,enabled:false};EventManagementProxy.prototype.poller=null;EventManagementProxy.prototype.state=null;EventManagementProxy.prototype.initialize=function(){if(this.data.enabled===true){this.setURL(this.data.url);this.setInterval(this.data.interval);this.poller.start()}};EventManagementProxy.prototype.setURL=function(value){this.data.url=this.poller.url=value;return value};EventManagementProxy.prototype.getURL=function(){return this.data.url};EventManagementProxy.prototype.getInterval=function(){return this.data.interval};EventManagementProxy.prototype.setInterval=function(value){this.data.interval=this.poller.interval=value*1e3;return value};EventManagementProxy.prototype.setState=function(value){this.state=value;this.sendNotification(EventManagementNotifications.EVENT_STATE_CHANGED,value);return value};EventManagementProxy.prototype.getState=function(){return this.state};function MediaAnalyticsPlugin(app,config){MediaAnalyticsPlugin.__super__.constructor.call(this,app,config)};__extends(MediaAnalyticsPlugin,Plugin);MediaAnalyticsPlugin.NAME="MediaAnalyticsPlugin";MediaAnalyticsPlugin.prototype.moduleName="mediaanalytics";MediaAnalyticsPlugin.prototype.createModel=function(){this.registerProxy(new MediaAnalyticsProxy(this.config))};MediaAnalyticsPlugin.prototype.createController=function(){this.registerCommand(Notifications.MEDIA_CHANGE,MediaAnalyticsChangeMediaCommand);this.registerCommand(AdNotifications.BREAK_START,MediaAnalyticsAdBreakStartCommand);this.registerCommand(AdNotifications.BREAK_END,MediaAnalyticsAdBreakEndCommand);this.registerCommand(AdNotifications.AD_LOADED,MediaAnalyticsAdLoadedCommand);this.registerCommand(AdNotifications.AD_STARTED,MediaAnalyticsAdStartCommand);this.registerCommand(AdNotifications.AD_TIME_UPDATE,MediaAnalyticsAdTimeUpdateCommand);this.registerCommand(AdNotifications.AD_ENDED,MediaAnalyticsAdEndCommand);this.registerCommand(MediaAnalyticsNotifications.SET_DIMENSIONS,MediaAnalyticsSetDimensionsCommand);this.registerCommand(Notifications.CONTENT_CHANGED,MediaAnalyticsContentChangedCommand)};MediaAnalyticsPlugin.prototype.createAPI=function(){return new MediaAnalyticsAPI(this)};MediaAnalyticsPlugin.prototype.onRegister=function(){window.AKAMAI_MEDIA_ANALYTICS_CONFIG_FILE_PATH=this.config.config;MediaAnalyticsPlugin.__super__.onRegister.call(this)};MediaAnalyticsPlugin.prototype.listNotificationInterests=function(){return[Notifications.MEDIA_CHANGE,AdNotifications.BREAK_START,AdNotifications.BREAK_END,AdNotifications.AD_LOADED,AdNotifications.AD_STARTED,AdNotifications.AD_TIME_UPDATE,AdNotifications.AD_ENDED,MediaAnalyticsNotifications.SET_DIMENSIONS,Notifications.CONTENT_CHANGED]};AMP.registerPlugin("mediaanalytics","html",MediaAnalyticsPlugin);AMP.registerPlugin("mediaanalytics","flash",MediaAnalyticsWrapper);function BrandingWrapper(){return BrandingWrapper.__super__.constructor.apply(this,arguments)};__extends(BrandingWrapper,PluginWrapper);BrandingWrapper.NAME="BrandingWrapper";BrandingWrapper.prototype.createFlashVars=function(flashvars){if(this.config.id!=null)flashvars.branding=this.config.id;return flashvars};BrandingWrapper.prototype.createXML=function(xml){var backgroundImage,controls,element,elements,id,logo,logoId,style,_i,_len,_ref;if(((_ref=this.config)!=null?_ref.logo:void(0))!=null){logoId="logoOverlay";backgroundImage="background-image: url('"+this.config.logo+"');";elements=xml.getElementsByTagName("element");for(_i=0,_len=elements.length;_i<_len;_i++){element=elements[_i];id=element.getAttribute("id");if(id===logoId){logo=element}else if(id==="controls")controls=element};if(!(logo!=null)){logo=xml.createElement("element");logo.setAttribute("id",logoId);logo.setAttribute("style","width: 150px; height: 53px; right: 15px; top: 15px; opacity: 0.5; "+backgroundImage);controls.appendChild(logo)}else{style=logo.getAttribute("style");if(style.indexOf("background-image:")!==-1){style=style.replace(/background-image: [A-Za-z0-9_\-\.\/\\;\(\)"']+/,backgroundImage)}else style=backgroundImage+style;logo.setAttribute("style",style)}};return xml};function BrandingMediator(){BrandingMediator.__super__.constructor.call(this)};__extends(BrandingMediator,OverlayMediator);BrandingMediator.prototype.componentName="branding";BrandingMediator.prototype.logo=null;BrandingMediator.prototype.text=null;BrandingMediator.prototype.container=null;BrandingMediator.prototype.onRegister=function(){this.container=this.create("branding-container");this.logo=this.create(["branding-image","hidden"],this.container,"img");this.text=this.create("branding-text",this.container);BrandingMediator.__super__.onRegister.call(this)};BrandingMediator.prototype.listNotificationInterests=function(){return[Notifications.READY]};BrandingMediator.prototype.handleNotification=function(notification){var branding,href;switch(notification.getName()){case Notifications.READY:branding=notification.getBody().branding;if(!(branding!=null))return;if(branding.logo!=null){this.logo.src=branding.logo;this.classList.remove("hidden",this.logo)}else this.classList.add("hidden",this.logo);href=this.config.getDomain();if((href!=null)&&href.indexOf("http")!==0){href=location.protocol+"//"+href;this.text.innerHTML='<span>View all <a href="'+href+'" target="'+this.config.getTarget()+'">'+this.config.getDomain()+'</a> videos.'}}};function BrandingProxy(config){BrandingProxy.__super__.constructor.call(this,config)};__extends(BrandingProxy,ModuleProxy);BrandingProxy.NAME=ModuleProxy.NAME;BrandingProxy.prototype.defaults={id:null,title:null,link:null,logo:null,target:null};BrandingProxy.prototype.getID=function(){return this.data.id};BrandingProxy.prototype.setID=function(value){return this.data.id=value};BrandingProxy.prototype.getTarget=function(){return this.data.target};BrandingProxy.prototype.setTarget=function(value){return this.data.target=value};BrandingProxy.prototype.getTitle=function(){return this.data.title};BrandingProxy.prototype.setTitle=function(value){return this.data.title=value};BrandingProxy.prototype.getLink=function(){return this.data.link};BrandingProxy.prototype.setLink=function(value){return this.data.link=value};BrandingProxy.prototype.getLogo=function(){return this.data.logo};BrandingProxy.prototype.setLogo=function(value){return this.data.logo=value};var FeedNotifications={LOAD_FEED:"loadFeed",FEED_CHANGED:"feedChanged",FEED_LOADED:"feedLoaded"};function EventManagementPlugin(app,config){EventManagementPlugin.__super__.constructor.call(this,app,config)};__extends(EventManagementPlugin,Plugin);EventManagementPlugin.NAME="EventManagementPlugin";EventManagementPlugin.prototype.moduleName="eventmanagement";EventManagementPlugin.prototype.createModel=function(){this.registerProxy(new EventManagementProxy(this.config))};EventManagementPlugin.prototype.createController=function(){this.registerCommand(Notifications.PLAY,EventManagementPlayCommand)};EventManagementPlugin.prototype.createView=function(){this.registerMediator(new EventManagementMediator())};EventManagementPlugin.prototype.listNotificationInterests=function(){return[Notifications.PLAY]};EventManagementPlugin.prototype.listNotificationPublications=function(){return EventManagementPlugin.__super__.listNotificationPublications.call(this).concat([Notifications.CHANGE_DISPLAY_STATE,Notifications.PAUSE,EventManagementNotifications.EVENT_STATE_CHANGED])};EventManagementPlugin.prototype.listNotificationEvents=function(){return[EventManagementNotifications.EVENT_STATE_CHANGED]};AMP.registerPlugin("eventmanagement","html",EventManagementPlugin);AMP.registerPlugin("eventmanagement","flash",EventManagementWrapper);function FeedProxy(config){FeedProxy.__super__.constructor.call(this,config);this.helper=new MRSSHelper()};__extends(FeedProxy,ModuleProxy);FeedProxy.NAME=ModuleProxy.NAME;FeedProxy.prototype.defaults={url:null,data:null};FeedProxy.prototype.feed=null;FeedProxy.prototype.helper=null;FeedProxy.prototype.setURL=function(value){var _this=this;this.data.url=value;this.helper.getFeed(value,function(feed){_this.sendNotification(FeedNotifications.CHANGE_FEED,feed)},function(error){Logger.error("[AMP Feed Load Error]",value,error)});return value};FeedProxy.prototype.getURL=function(){return this.data.url};FeedProxy.prototype.setFeedData=function(value){this.data.data=value;this.feed=this.helper.createFeed(value);this.sendNotification(FeedNotifications.FEED_CHANGED,this.feed);this.sendNotification(Notifications.DISPATCH_EVENT,new Event("loaded",value));return value};FeedProxy.prototype.getFeedData=function(){return this.data.data};FeedProxy.prototype.invoke=function(){if((this.data.url!=null)&&this.data.url!==""){this.sendNotification(FeedNotifications.LOAD_FEED,this.data.url)}else if(this.data.data!=null)this.sendNotification(FeedNotifications.CHANGE_FEED,this.data.data)};function LoadFeedCommand(){LoadFeedCommand.__super__.constructor.call(this)};__extends(LoadFeedCommand,puremvc.SimpleCommand);LoadFeedCommand.prototype.execute=function(notification){var feedProxy;this.facade.logger.debug("LoadFeedCommand",notification.getBody());feedProxy=this.facade.retrieveProxy(FeedProxy.NAME);feedProxy.setURL(notification.getBody())};function ChangeFeedCommand(){ChangeFeedCommand.__super__.constructor.call(this)};__extends(ChangeFeedCommand,puremvc.SimpleCommand);ChangeFeedCommand.prototype.execute=function(notification){var feedProxy;this.facade.logger.debug("ChangeFeedCommand",notification.getBody());feedProxy=this.facade.retrieveProxy(FeedProxy.NAME);feedProxy.setFeedData(notification.getBody())};function FeedChangedCommand(){FeedChangedCommand.__super__.constructor.call(this)};__extends(FeedChangedCommand,puremvc.SimpleCommand);FeedChangedCommand.prototype.execute=function(notification){var feed,mediaVO;this.facade.logger.debug("FeedChangedCommand",notification.getBody());this.facade.app.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.READY);feed=notification.getBody();mediaVO=feed.item[0];this.facade.app.sendNotification(Notifications.SET_MEDIA,mediaVO)};function FeedInitializedCommand(){FeedInitializedCommand.__super__.constructor.call(this)};__extends(FeedInitializedCommand,puremvc.SimpleCommand);FeedInitializedCommand.prototype.execute=function(notification){var feedProxy;this.facade.logger.debug("FeedInitializedCommand");feedProxy=this.facade.retrieveProxy(FeedProxy.NAME);feedProxy.invoke()};function FeedAPI(module){var proxy;FeedAPI.__super__.constructor.call(this,module);proxy=module.retrieveProxy(FeedProxy.NAME);this.setURL=function(value){module.sendNotification(FeedNotifications.LOAD_FEED,value);return value};this.getURL=proxy.getURL.bind(proxy);this.setData=function(value){module.sendNotification(FeedNotifications.CHANGE_FEED,value);return value};this.getData=proxy.getFeedData.bind(proxy)};__extends(FeedAPI,PluginAPI);FeedAPI.prototype.setURL=function(value){};FeedAPI.prototype.getURL=function(){};FeedAPI.prototype.setData=function(value){};FeedAPI.prototype.getData=function(){};function FeedWrapper(player,config){if(config==null)config={};FeedWrapper.__super__.constructor.call(this,player,config);if(config.url!=null)this.url=config.url;if(config.data!=null)this.data=config.data;this.player.load=function(){}};__extends(FeedWrapper,PluginWrapper);FeedWrapper.NAME="FeedWrapper";FeedWrapper.prototype.url=null;FeedWrapper.prototype.data=null;FeedWrapper.prototype.updateData=true;FeedWrapper.prototype.createFlashVars=function(flashvars){if((this.url!=null)&&this.url!=="")flashvars.data_feed_url=escape(this.url)};FeedWrapper.prototype.listNotificationInterests=function(){return FeedWrapper.__super__.listNotificationInterests.apply(this,arguments).concat([FlashNotifications.READY,FlashNotifications.FEED_LOADED])};FeedWrapper.prototype.handleNotification=function(notification){var body,name,type,_this=this;FeedWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.FEED_LOADED:if(this.updateData===false){this.updateData=true}else this.data=JSON.parse(body);type="loaded";body=this.data;this.sendNotification(FeedNotifications.FEED_CHANGED,this.data);break;case FlashNotifications.READY:if(this.data!=null){setTimeout(function(){_this.setData(_this.data)},25)}else if((this.url!=null)&&this.url!=="")this.sendNotification(FeedNotifications.LOAD_FEED,this.url)};if(type!=null)this.dispatchEvent(new Event(type,body))};FeedWrapper.prototype.setURL=function(value){if((value!=null)&&value!==""){this.url=value;this.player.video.playFile(this.url,this.player.getAutoplay());this.sendNotification(FeedNotifications.LOAD_FEED,this.url)};return value};FeedWrapper.prototype.getURL=function(){return this.url};FeedWrapper.prototype.setData=function(value){this.data=value;this.updateData=false;this.player.video.playFile(this.data,this.player.getAutoplay());return value};FeedWrapper.prototype.getData=function(){return this.data};function BrandingPlugin(app,config){BrandingPlugin.__super__.constructor.call(this,app,config)};__extends(BrandingPlugin,Plugin);BrandingPlugin.NAME="BrandingPlugin";BrandingPlugin.prototype.moduleName="branding";BrandingPlugin.prototype.createModel=function(){this.registerProxy(new BrandingProxy(this.config))};BrandingPlugin.prototype.createView=function(){this.registerMediator(new BrandingMediator())};BrandingPlugin.prototype.onRegister=function(){if(this.config.id!=null)this.sendNotification(Notifications.ADD_APPLICATION_STATE,"branding-"+this.config.id);BrandingPlugin.__super__.onRegister.call(this)};BrandingPlugin.prototype.listNotificationInterests=function(){return[Notifications.READY]};AMP.registerPlugin("branding","html",BrandingPlugin);AMP.registerPlugin("branding","flash",BrandingWrapper);AMP.registerPlugin("branding","external",BrandingPlugin);var FeatureNotifications={REGISTER_FEATURE:"registerfeature"};function Feature(app,config){Feature.__super__.constructor.call(this,app,config)};__extends(Feature,Plugin);Feature.NAME="Feature";Feature.prototype.featureName=null;Feature.prototype.getFeatureName=function(){return this.featureName};Feature.prototype.registerFeature=function(){if(this.getFeatureName()!=null)this.app.sendNotification(FeatureNotifications.REGISTER_FEATURE,this)};Feature.prototype.onRegister=function(){this.registerFeature();Feature.__super__.onRegister.call(this)};Feature.prototype.listNotificationPublications=function(){return Feature.__super__.listNotificationPublications.call(this).concat([FeatureNotifications.REGISTER_FEATURE])};function FeedPlugin(app,config){FeedPlugin.__super__.constructor.call(this,app,config)};__extends(FeedPlugin,Plugin);FeedPlugin.NAME="FeedPlugin";FeedPlugin.prototype.moduleName="feed";FeedPlugin.prototype.createModel=function(){this.registerProxy(new FeedProxy(this.config))};FeedPlugin.prototype.createController=function(){FeedPlugin.__super__.createController.call(this);this.registerCommand(Notifications.READY,FeedInitializedCommand);this.registerCommand(FeedNotifications.LOAD_FEED,LoadFeedCommand);this.registerCommand(FeedNotifications.CHANGE_FEED,ChangeFeedCommand);this.registerCommand(FeedNotifications.FEED_CHANGED,FeedChangedCommand)};FeedPlugin.prototype.createAPI=function(){return new FeedAPI(this)};FeedPlugin.prototype.listNotificationInterests=function(){return FeedPlugin.__super__.listNotificationInterests.call(this).concat([Notifications.READY])};FeedPlugin.prototype.listNotificationPublications=function(){var key,value;return FeedPlugin.__super__.listNotificationPublications.call(this).concat((function(){var _results;_results=[];for(key in FeedNotifications){value=FeedNotifications[key];_results.push(value)};return _results})())};AMP.registerPlugin("feed","html",FeedPlugin);AMP.registerPlugin("feed","flash",FeedWrapper);function AdDispatcher(events){AdDispatcher.__super__.constructor.call(this,events)};__extends(AdDispatcher,PluginDispatcher);AdDispatcher.prototype.getType=function(type){return AdDispatcher.__super__.getType.call(this,type.replace(/^ads/,""))};AdDispatcher.prototype.getMessage=function(event){if(event.type==="timeupdate"||event.type==="timeremaining")return;return AdDispatcher.__super__.getMessage.call(this,event)};function AdMediator(){AdMediator.__super__.constructor.call(this)};__extends(AdMediator,OverlayMediator);AdMediator.prototype.duration=null;AdMediator.prototype.currentTime=null;AdMediator.prototype.container=null;AdMediator.prototype.banner=null;AdMediator.prototype.text=null;AdMediator.prototype.adText=null;AdMediator.prototype.bg=null;AdMediator.prototype.totalAds=null;AdMediator.prototype.adPosition=null;AdMediator.prototype.adContainerRequired=true;AdMediator.prototype.componentName="ads";AdMediator.prototype.onRegister=function(){if(this.adContainerRequired)this.container=this.create("ad-container");this.banner=this.create("ad-banner");this.bg=this.create("ad-text-bg",this.banner);this.adText=this.create("ad-text-title",this.banner);this.text=this.create("ad-text",this.banner);if(this.adContainerRequired)this.viewComponent.container=this.container;AdMediator.__super__.onRegister.call(this);this.sendNotification(AdNotifications.AD_CONTAINER_CREATED,this.viewComponent);this.facade.setViewComponent(this.viewComponent)};AdMediator.prototype.listNotificationInterests=function(){return[AdNotifications.BREAK_START,AdNotifications.BREAK_END,AdNotifications.AD_TIME_REMAINING,AdNotifications.AD_STARTED]};AdMediator.prototype.handleNotification=function(notification){var adVO,duration,msg,time;switch(notification.getName()){case AdNotifications.BREAK_START:this.sendNotification(Notifications.DISPLAY_TIME,{currentTime:0,duration:0});break;case AdNotifications.BREAK_END:this.text.textContent="";this.adText.textContent="";break;case AdNotifications.AD_TIME_REMAINING:time=notification.getBody();if((this.totalAds!=null)&&this.totalAds>0&&(this.adPosition!=null)&&this.adPosition!==this.totalAds){msg=time>0?""+(this.localizationManager.getString(LocalizationConstants.MSG_NEXT_AD))+(Utils.formatTimecode(time)):""}else msg=time>0?""+(this.localizationManager.getString(LocalizationConstants.MSG_NEXT_VIDEO))+(Utils.formatTimecode(time)):"";this.text.textContent=msg;duration=this.facade.retrieveProxy(ModuleProxy.NAME).adVO.duration;time=duration-time;this.sendNotification(Notifications.DISPLAY_TIME,{currentTime:time,duration:duration});break;case AdNotifications.AD_STARTED:adVO=notification.getBody();this.totalAds=adVO.totalAds;this.adPosition=adVO.position;msg="Ad "+adVO.position+" of "+adVO.totalAds;if((adVO.position!=null)&&(adVO.totalAds!=null)&&adVO.position!==0)this.adText.textContent=msg}};function AdMediaChangeCommand(){AdMediaChangeCommand.__super__.constructor.call(this)};__extends(AdMediaChangeCommand,AdCommand);AdMediaChangeCommand.prototype.execute=function(notification){var media;this.facade.logger.debug("AdMediaChangeCommand");if(this.ads.getEnabled()===false)return;media=notification.getBody();this.ads.setLoadedMetadata(false);this.ads.engage(media)};function AdLoadedCommand(){AdLoadedCommand.__super__.constructor.call(this)};__extends(AdLoadedCommand,AdCommand);AdLoadedCommand.prototype.execute=function(notification){this.facade.logger.debug("AdLoadedCommand");this.sendNotification(Notifications.UPDATE_DATA_BINDINGS,{contexts:[this.ads.getContextName()]})};function AdBreakStartCommand(){AdBreakStartCommand.__super__.constructor.call(this)};__extends(AdBreakStartCommand,AdCommand);AdBreakStartCommand.prototype.execute=function(notification){this.facade.logger.debug("AdBreakStartCommand");this.facade.app.sendNotification(Notifications.ADD_APPLICATION_STATE,"ad-mode");if(this.applicationState.getDevice()!=="desktop")this.facade.app.sendNotification(Notifications.DISABLE_FULL_SCREEN);this.ads.breakStart()};function AdBreakEndCommand(){AdBreakEndCommand.__super__.constructor.call(this)};__extends(AdBreakEndCommand,AdCommand);AdBreakEndCommand.prototype.execute=function(notification){this.facade.logger.debug("AdBreakEndCommand");this.ads.breakEnd();this.facade.app.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"ad-mode");if(this.applicationState.getDevice()!=="desktop")this.facade.app.sendNotification(Notifications.ENABLE_FULL_SCREEN)};function AdLoadedMetadataCommand(){AdLoadedMetadataCommand.__super__.constructor.call(this)};__extends(AdLoadedMetadataCommand,AdCommand);AdLoadedMetadataCommand.prototype.execute=function(notification){this.facade.logger.debug("AdLoadedMetadataCommand");this.ads.setLoadedMetadata(true)};function AdVO(id,title,duration,position,type,partner,advertiser,companions,request,metadata,totalAds){this.id=id;this.title=title;this.duration=duration;this.position=position;this.type=type;this.partner=partner;this.advertiser=advertiser;this.companions=companions;this.request=request;this.metadata=metadata;this.totalAds=totalAds};AdVO.prototype.id=null;AdVO.prototype.title=null;AdVO.prototype.duration=NaN;AdVO.prototype.position=NaN;AdVO.prototype.totalAds=NaN;AdVO.prototype.type=null;AdVO.prototype.partner=null;AdVO.prototype.advertiser=null;AdVO.prototype.companions=null;AdVO.prototype.metadata=null;AdVO.prototype.request=null;AdVO.prototype.error=null;function AdsAPI(module){var proxy;ModuleAPI.attachModuleDispatcher(module,new AdDispatcher(this));this.getConfig=function(){return plugin.getConfig()};proxy=module.retrieveProxy(AdProxy.NAME);this.setEnabled=proxy.setEnabled.bind(proxy);this.getEnabled=proxy.getEnabled.bind(proxy);this.getInProgress=proxy.getInProgress.bind(proxy);this.getStarted=proxy.getStarted.bind(proxy);this.getPaused=proxy.getPaused.bind(proxy);this.getCompanions=proxy.getCompanions.bind(proxy)};__extends(AdsAPI,PluginAPI);AdsAPI.prototype.setEnabled=function(value){};AdsAPI.prototype.getEnabled=function(){};AdsAPI.prototype.getInProgress=function(){};AdsAPI.prototype.getStarted=function(){};AdsAPI.prototype.getPaused=function(){};AdsAPI.prototype.getCompanions=function(){};function AuditudeProxy(config){AuditudeProxy.__super__.constructor.call(this,config)};__extends(AuditudeProxy,AdProxy);AuditudeProxy.NAME=AdProxy.NAME;AuditudeProxy.prototype.defaults={plugin:null,videoId:null,defaultId:null,domain:null,zoneId:null,companion:null,userData:null,params:null};AuditudeProxy.prototype.key="auditude";AuditudeProxy.prototype.session=null;AuditudeProxy.prototype.options=null;AuditudeProxy.prototype.initialize=function(){var _this=this;this.options={controls:false,auditudeHandlesChapterBreaks:false,style:{backgroundColor:'#000',width:this.facade.app.video.clientWidth,height:this.facade.app.video.clientHeight},handlers:{play:function(){_this.facade.logger.debug('ad play')},timeupdate:function(event,audPlayer,video){_this.facade.sendNotification(AdNotifications.AD_TIME_REMAINING,video.duration-video.currentTime)},error:function(err){_this.facade.logger.debug('ad error:',err);_this.error()},pause:function(){_this.facade.logger.debug('ad pause')},loadedmetadata:function(evt,player,video){_this.facade.logger.debug('ad loadedmetadata')},end:function(){_this.facade.logger.debug('ad end')}}};try{this.plugin=this.createPlugin();this.plugin.subscribe(aud.events.init_complete,function(event,plugin){_this.facade.logger.debug('init_complete:',event,plugin);try{_this.plugin.publish(aud.notifications.break_begin)}catch(err){_this.error(err)}});this.plugin.subscribe(aud.events.init_failed,function(event,plugin){_this.error(event)});this.plugin.subscribe(aud.events.break_begin,function(event,plugin){_this.facade.logger.debug('break_begin:',event,plugin);_this.sendNotification(AdNotifications.BREAK_START)});this.plugin.subscribe(aud.events.pause_playback,function(event,plugin){_this.facade.logger.debug('pause_playback: '+event+", "+plugin);_this.contentPause(event,plugin)});this.plugin.subscribe(aud.events.resume_playback,function(event,plugin){_this.facade.logger.debug('resume_playback: ',event,plugin);_this.contentPlay(event,plugin)});this.plugin.subscribe(aud.events.linear_ad_begin,function(event,plugin,ctx){var id,title,xml;_this.facade.logger.debug('linear ad begin:',event,plugin,ctx);xml=plugin._xmlDoc.querySelector("ad[id]");if(xml!=null)id=xml.getAttribute("id");xml=plugin._xmlDoc.querySelector("inLine[adTitle]");if(xml!=null)title=xml.getAttribute("adTitle");_this.adVO=new AdVO(id,title,ctx.asset.duration,1,"preroll","auditude",null,ctx.banners,null,ctx);_this.sendNotification(AdNotifications.AD_LOADED,_this.adVO);_this.sendNotification(AdNotifications.AD_DURATION_CHANGE,_this.adVO);_this.facade.app.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PLAYING);_this.sendNotification(AdNotifications.AD_PLAY);_this.setInProgress(true);_this.setCompanions(ctx.banners);_this.session=ctx.session;_this.sendNotification(AdNotifications.AD_STARTED)});this.plugin.subscribe(aud.events.linear_ad_end,function(event,plugin,ctx){_this.facade.logger.debug('linear ad end:',event,plugin,ctx);_this.sendNotification(AdNotifications.AD_ENDED)});this.plugin.subscribe(aud.events.break_end,function(event,plugin){_this.facade.logger.debug('break_end:',event,plugin);_this.sendNotification(AdNotifications.BREAK_END)});this.plugin.subscribe(aud.events.non_linear_ad_begin,function(event,plugin,ctx){_this.facade.logger.debug('non linear ad begin');_this.setCompanions(ctx.banners)});this.plugin.subscribe(aud.events.non_linear_ad_end,function(event,plugin,ctx){_this.facade.logger.debug('non linear ad end')})}catch(err){this.error(err)}};AuditudeProxy.prototype.createPlugin=function(){return aud.html5.AdPlayer(this.facade.container.container,null,this.value.domain,this.value.zoneId,this.options)};AuditudeProxy.prototype.start=function(){var defaultId,id,key,params,userData,value,_ref;if(AuditudeProxy.__super__.start.call(this)===false)return false;try{params=this.value.params||{};userData="";if(this.value.userData!=null){_ref=this.value.userData;for(key in _ref){value=_ref[key];userData+=""+key+"="+value+";"}};if(params.userData!=null)userData+=params.userData;if(userData!=="")params.userData=userData;id=this.value.videoId+"";if(this.value.defaultId!=null){defaultId=this.value.defaultId+"";id=id!=null?[id,defaultId]:defaultId};this.facade.logger.log("Auditude init: ",id,params);this.plugin.init(id,params)}catch(err){this.error(err)}};AuditudeProxy.prototype.play=function(){AuditudeProxy.__super__.play.call(this);this.session.notifyResume()};AuditudeProxy.prototype.pause=function(){AuditudeProxy.__super__.pause.call(this);this.session.notifyPause()};AuditudeProxy.prototype.breakStart=function(){};AuditudeProxy.prototype.setCompanions=function(ads){var ad,banner,companions,slot,_i,_j,_len,_len1;if(!(ads!=null)||ads.length<1)return;companions=[];for(_i=0,_len=ads.length;_i<_len;_i++){ad=ads[_i];companions.push({data:ad.data,type:ad.resourceType,width:parseInt(ad.width),height:parseInt(ad.height),metadata:ad})};AuditudeProxy.__super__.setCompanions.call(this,companions);if(!(this.value.companion!=null))return;banner=this.value.companion;slot=document.getElementById(banner.id);if(!(slot!=null))return;for(_j=0,_len1=ads.length;_j<_len1;_j++){ad=ads[_j];if(!(banner.width===parseInt(ad.width)&&banner.height===parseInt(ad.height)))continue;slot.innerHTML=ad.data;break}};AuditudeProxy.prototype.contentStarted=function(){this.plugin.publish(aud.notifications.video_playback_started)};AuditudeProxy.prototype.contentEnded=function(){this.plugin.publish(aud.notifications.video_playback_complete)};function AuditudeFullscreenProxy(config){AuditudeFullscreenProxy.__super__.constructor.call(this,config)};__extends(AuditudeFullscreenProxy,AuditudeProxy);AuditudeFullscreenProxy.NAME=AuditudeProxy.NAME;AuditudeFullscreenProxy.prototype.createPlugin=function(){return aud.html5.AdPlayer(this.facade.app.video,null,this.value.domain,this.value.zoneId,this.options)};AuditudeFullscreenProxy.prototype.engage=function(media){AuditudeFullscreenProxy.__super__.engage.call(this,media);this.sendNotification(Notifications.DISABLE_VIDEO_EVENTS,["ended"])};AuditudeFullscreenProxy.prototype.reset=function(media){AuditudeFullscreenProxy.__super__.reset.call(this,media);this.sendNotification(Notifications.ENABLE_VIDEO_EVENTS,["ended"])};AuditudeFullscreenProxy.prototype.play=function(){AuditudeFullscreenProxy.__super__.play.call(this);this.facade.app.video.play()};AuditudeFullscreenProxy.prototype.pause=function(){AuditudeFullscreenProxy.__super__.pause.call(this);this.facade.app.video.pause()};AuditudeFullscreenProxy.prototype.contentPause=function(){this.facade.app.video.pause()};function AdWrapper(player,init){AdWrapper.__super__.constructor.call(this,player,init)};__extends(AdWrapper,PluginWrapper);AdWrapper.NAME="AdWrapper";AdWrapper.prototype.enabled=true;AdWrapper.prototype.paused=false;AdWrapper.prototype.started=false;AdWrapper.prototype.adVO=null;AdWrapper.prototype.getFeatureName=function(){return"ads"};AdWrapper.prototype.getInProgress=function(){return this.player.video.getPlayerProperty("adInProgress")};AdWrapper.prototype.getStarted=function(){return this.started};AdWrapper.prototype.getPaused=function(){return this.paused};AdWrapper.prototype.getCompanions=function(){var _ref;return(_ref=this.adVO)!=null?_ref.companions:void(0)};AdWrapper.prototype.setEnabled=function(value){this.enabled=value;this.player.video.setPlayerProperty("adsEnabled",value);return value};AdWrapper.prototype.getEnabled=function(){return this.enabled};AdWrapper.prototype.enable=function(){this.setEnabled(true)};AdWrapper.prototype.disable=function(){this.setEnabled(false)};AdWrapper.prototype.createFlashVars=function(flashvars){flashvars.core_ads_enabled=true;return flashvars};AdWrapper.prototype.listNotificationInterests=function(){var key,value;return AdWrapper.__super__.listNotificationInterests.call(this).concat((function(){var _results;_results=[];for(key in FlashAdNotifications){value=FlashAdNotifications[key];_results.push(value)};return _results})())};AdWrapper.prototype.handleNotification=function(notification){var body,name,target,type;AdWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();this.adVO=this.createAdVO(body);target=this;switch(name){case FlashAdNotifications.BREAK_START:type="breakstart";break;case FlashAdNotifications.BREAK_END:type="breakend";break;case FlashAdNotifications.AD_LOADED:case FlashAdNotifications.AD_MEDIA_LOADED:type="loaded";this.start=false;break;case FlashAdNotifications.AD_STARTED:type="started";this.started=true;this.sendNotification(Notifications.ADD_APPLICATION_STATE,"ad-mode");break;case FlashAdNotifications.AD_TIME_UPDATE:case FlashAdNotifications.AD_TIME_REMAINING:type="timeupdate";break;case FlashAdNotifications.AD_ERROR:case FlashAdNotifications.AD_PLAYBACK_FAILED:type="error";this.start=false;this.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"ad-mode");break;case FlashAdNotifications.AD_ENDED:case FlashAdNotifications.AD_PLAYBACK_TERMINATED:type="ended";this.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"ad-mode");break;case FlashAdNotifications.AD_CLICKED:type="clicked";break;case FlashAdNotifications.AD_COMPANION:type="companion";if((this.adVO!=null)&&(body!=null))this.adVO.companions=body;break;case FlashAdNotifications.AD_PAUSE:type="pause";target=this.player.getAPI();this.paused=true;this.player.setPlayState("paused");break;case FlashAdNotifications.AD_PLAY:type="playing";target=this.player.getAPI();this.paused=true;this.player.setPlayState("playing");target.dispatchEvent(new Event("play",body));break;case FlashAdNotifications.AD_LOG:type="log";break;case FlashAdNotifications.AD_FIRST_QUARTILE:type="firstquartile";break;case FlashAdNotifications.AD_MIDPOINT:type="midpoint";break;case FlashAdNotifications.AD_THIRD_QUARTILE:type="thirdquartile";break;case FlashAdNotifications.AD_REQUEST:type="request"};if(type!=null)target.dispatchEvent(new Event(type,this.adVO))};AdWrapper.prototype.createAdVO=function(ad){if(!(ad!=null))return null;return new AdVO(ad.id,ad.title,ad.duration,ad.podIndex,ad.podPosition,ad.adPlatform,null,null,ad.requestURL,ad)};function AuditudeWrapper(){return AuditudeWrapper.__super__.constructor.apply(this,arguments)};__extends(AuditudeWrapper,AdWrapper);AuditudeWrapper.NAME="AuditudeWrapper";AuditudeWrapper.prototype.createFlashVars=function(flashvars){if((this.config.companion!=null))flashvars.ad_partner_companion_size=""+this.config.companion.width+"x"+this.config.companion.height;return flashvars};AuditudeWrapper.prototype.createXML=function(xml){var admedia,application,companion,companions,ids,prop,props,vendor,_i,_j,_len,_len1,_ref;application=xml.getElementsByTagName("application")[0];admedia=xml.getElementsByTagName("admedia")[0];if(!(admedia!=null)){admedia=xml.createElement("admedia");application.appendChild(admedia)};vendor=xml.createElement("vendor");vendor.setAttribute("id","auditude");admedia.appendChild(vendor);props=[{value:this.config.domain,key:"AUDITUDE_DOMAIN"},{value:this.config.videoId,key:"AUDITUDE_MEDIA_ID"},{value:this.config.defaultId,key:"AUDITUDE_DEFAULT_MEDIA_ID"},{value:this.config.zoneId,key:"AUDITUDE_ZONE_ID"},{value:this.config.prerollId,key:"AUDITUDE_PREROLL_MEDIA_ID"},{value:this.config.midrollId,key:"AUDITUDE_MIDROLL_MEDIA_ID"},{value:this.config.audienceManagerURL,key:"AUDITUDE_AUDIENCE_MGR_URL"},{value:this.config.version,key:"AUDITUDE_VERSION"}];for(_i=0,_len=props.length;_i<_len;_i++){prop=props[_i];if(prop.value!=null)this.createProperty(xml,prop.key,prop.value,vendor)};if(this.config.position!=null)vendor.setAttribute("position",this.config.position);if(this.config.companions!=null){companions=[];ids=[];_ref=this.config.companions;for(_j=0,_len1=_ref.length;_j<_len1;_j++){companion=_ref[_j];companions.push(companion.width+"x"+companion.height);ids.push(companion.id)};this.createProperty(xml,"AUDITUDE_COMPANION_SIZE",companions.join(","),vendor);this.createProperty(xml,"AUDITUDE_COMPANION_ID",companions.join(","),vendor)};if(this.config.params!=null)this.createProperty(xml,"AUDITUDE_PARAMS",this.config.params,vendor);if(this.config.userData!=null)this.createProperty(xml,"AUDITUDE_USER_DATA",this.config.userData,vendor);return xml};function AdPlugin(app,config){AdPlugin.__super__.constructor.call(this,app,config)};__extends(AdPlugin,Feature);AdPlugin.NAME="AdPlugin";AdPlugin.prototype.container=null;AdPlugin.prototype.featureName="ads";AdPlugin.prototype.createModel=function(){if(this.isFullscreenDevice()){this.registerProxy(this.createFullscreenProxy())}else this.registerProxy(this.createProxy())};AdPlugin.prototype.createController=function(){this.registerCommand(Notifications.CHANGE_MEDIA,AdMediaChangeCommand);this.registerCommand(Notifications.LOADED_METADATA,AdLoadedMetadataCommand);this.registerCommand(AdNotifications.BREAK_START,AdBreakStartCommand);this.registerCommand(AdNotifications.AD_LOADED,AdLoadedCommand);this.registerCommand(AdNotifications.BREAK_END,AdBreakEndCommand)};AdPlugin.prototype.createView=function(){return this.registerMediator(new AdMediator())};AdPlugin.prototype.createAPI=function(){return new AdsAPI(this)};AdPlugin.prototype.isFullscreenDevice=function(){return Utils.isFullscreenDevice()};AdPlugin.prototype.createProxy=function(){};AdPlugin.prototype.createFullscreenProxy=function(){};AdPlugin.prototype.registered=function(){var bindings;AdPlugin.__super__.registered.call(this);bindings=this.app.retrieveProxy(DataBindingProxy.NAME);bindings.registerContext(this.retrieveProxy(AdProxy.NAME))};AdPlugin.prototype.listNotificationInterests=function(){return[Notifications.CHANGE_MEDIA,Notifications.LOADED_METADATA,Notifications.PLAY,Notifications.PAUSE,Notifications.START,Notifications.STARTED,Notifications.ENDED,Notifications.READY,Notifications.VOLUME_CHANGE,Notifications.FULL_SCREEN_CHANGE,UserNotifications.PLAY,UserNotifications.PAUSE,UserNotifications.TOGGLE_PLAY_PAUSE]};AdPlugin.prototype.listNotificationPublications=function(){var key,value;return AdPlugin.__super__.listNotificationPublications.call(this).concat((function(){var _results;_results=[];for(key in AdNotifications){value=AdNotifications[key];_results.push(value)};return _results})()).concat([Notifications.PLAY_REQUEST,Notifications.DISABLE_VIDEO_EVENTS,Notifications.ENABLE_VIDEO_EVENTS,Notifications.UPDATE_DATA_BINDINGS,Notifications.DISPLAY_TIME,Notifications.ADD_CUE_POINTS,Notifications.DISABLE_FULL_SCREEN,Notifications.UPDATE_PLAYBACK_CORE])};AdPlugin.prototype.listNotificationEvents=function(){var key,value;return AdPlugin.__super__.listNotificationEvents.call(this).concat((function(){var _results;_results=[];for(key in AdNotifications){value=AdNotifications[key];_results.push(value)};return _results})())};var AutoAdvanceNotifications={TIME_UPDATE:"autoadvancetimeupdate",START:"autoadvancestart",STOP:"autoadvancestop",ADVANCE:"autoadvanceadvance"};function AutoAdvanceWrapper(player,config){if(config==null)config={};AutoAdvanceWrapper.__super__.constructor.call(this,player,config);if(config.interval!=null)this.interval=config.interval;if(config.handler!=null)this.handler=config.handler};__extends(AutoAdvanceWrapper,PluginWrapper);AutoAdvanceWrapper.NAME="AutoAdvanceWrapper";AutoAdvanceWrapper.prototype.interval=null;AutoAdvanceWrapper.prototype.handler=null;AutoAdvanceWrapper.prototype.getInterval=function(){return this.interval};AutoAdvanceWrapper.prototype.setInterval=function(value){return this.interval=value};AutoAdvanceWrapper.prototype.getHandler=function(){return this.handler};AutoAdvanceWrapper.prototype.setHandler=function(value){return this.handler=value};AutoAdvanceWrapper.prototype.listNotificationInterests=function(){return[FlashNotifications.CREATE_FLASH_VARS,FlashNotifications.AUTO_ADVANCE]};AutoAdvanceWrapper.prototype.handleNotification=function(notification){var body,flashvars,name,type,_base;name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.CREATE_FLASH_VARS:flashvars=body.flashvars;if(this.interval!=null){flashvars.next_video_timer=this.interval;flashvars.auto_play_list=true};break;case FlashNotifications.AUTO_ADVANCE:if(typeof(_base=this.config).handler==="function")_base.handler();type="advance"};if(type!=null)this.dispatchEvent(new Event(type))};function AutoAdvanceProxy(config){AutoAdvanceProxy.__super__.constructor.call(this,config)};__extends(AutoAdvanceProxy,ModuleProxy);AutoAdvanceProxy.NAME=ModuleProxy.NAME;AutoAdvanceProxy.prototype.defaults={interval:15,handler:null};AutoAdvanceProxy.prototype.currentTime=0;AutoAdvanceProxy.prototype.timeout=null;AutoAdvanceProxy.prototype.start=function(){var _this=this;this.currentTime=this.data.interval;this.timeout=setInterval(function(){_this.updateTime()},1e3);this.sendNotification(AutoAdvanceNotifications.TIME_UPDATE,this.currentTime)};AutoAdvanceProxy.prototype.stop=function(){clearInterval(this.timeout)};AutoAdvanceProxy.prototype.updateTime=function(){this.currentTime--;this.sendNotification(AutoAdvanceNotifications.TIME_UPDATE,this.currentTime);if(this.currentTime<=0){this.stop();this.sendNotification(AutoAdvanceNotifications.ADVANCE,this.data.handler)}};function AutoAdvanceStartCommand(){AutoAdvanceStartCommand.__super__.constructor.call(this)};__extends(AutoAdvanceStartCommand,puremvc.SimpleCommand);AutoAdvanceStartCommand.prototype.execute=function(notification){var proxy;this.sendNotification(Notifications.ADD_APPLICATION_STATE,"autoadvance-mode");proxy=this.facade.retrieveProxy(AutoAdvanceProxy.NAME);proxy.start()};function AutoAdvanceAdvanceCommand(){AutoAdvanceAdvanceCommand.__super__.constructor.call(this)};__extends(AutoAdvanceAdvanceCommand,puremvc.SimpleCommand);AutoAdvanceAdvanceCommand.prototype.execute=function(notification){var handler,proxy;proxy=this.facade.retrieveProxy(AutoAdvanceProxy.NAME);handler=notification.getBody();if((handler!=null))if(typeof handler==="string"){eval(""+handler+"()")}else if(typeof handler==="function")handler();this.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"autoadvance-mode")};function AutoAdvanceEndedCommand(){AutoAdvanceEndedCommand.__super__.constructor.call(this)};__extends(AutoAdvanceEndedCommand,puremvc.SimpleCommand);AutoAdvanceEndedCommand.prototype.execute=function(notification){var data,proxy;proxy=this.facade.retrieveProxy(AutoAdvanceProxy.NAME);data=proxy.getData();if(data.interval!=null)this.sendNotification(AutoAdvanceNotifications.START)};function AutoAdvanceStopCommand(){AutoAdvanceStopCommand.__super__.constructor.call(this)};__extends(AutoAdvanceStopCommand,puremvc.SimpleCommand);AutoAdvanceStopCommand.prototype.execute=function(notification){var proxy;proxy=this.facade.retrieveProxy(AutoAdvanceProxy.NAME);proxy.stop()};function RecommendationVO(guid,link,title,description,thumbnail,duration,pubDate,target,metadata){this.guid=guid;this.link=link;this.title=title;this.description=description;this.thumbnail=thumbnail;this.duration=duration;this.pubDate=pubDate;this.target=target;this.metadata=metadata!=null?metadata:{}};RecommendationVO.prototype.guid=null;RecommendationVO.prototype.link=null;RecommendationVO.prototype.title=null;RecommendationVO.prototype.description=null;RecommendationVO.prototype.thumbnail=null;RecommendationVO.prototype.duration=null;RecommendationVO.prototype.pubDate=null;RecommendationVO.prototype.target=null;RecommendationVO.prototype.metadata=null;var RecommendationsNotifications={RECOMMENDATIONS_LOADED:"recommendationsloaded",RECOMMENDATION_SELECTED:"recommendationsselected"};function AutoAdvanceMediator(){AutoAdvanceMediator.__super__.constructor.call(this)};__extends(AutoAdvanceMediator,OverlayMediator);AutoAdvanceMediator.prototype.componentName="autoadvance";AutoAdvanceMediator.prototype.text=null;AutoAdvanceMediator.prototype.onRegister=function(){this.text=this.create("autoadvance-text");AutoAdvanceMediator.__super__.onRegister.call(this)};AutoAdvanceMediator.prototype.listNotificationInterests=function(){return[AutoAdvanceNotifications.TIME_UPDATE]};AutoAdvanceMediator.prototype.handleNotification=function(notification){var time;switch(notification.getName()){case AutoAdvanceNotifications.TIME_UPDATE:time=notification.getBody();this.text.textContent=""+(this.localizationManager.getString('MSG_NEXT_VIDEO'))+" "+time+" "+(this.localizationManager.getString('MSG_SECONDS'))}};function RecommendationsWrapper(player,config){if(config==null)config={};RecommendationsWrapper.__super__.constructor.call(this,player,config);if(config.url!=null)this.url=config.url;if(config.target!=null)this.target=config.target};__extends(RecommendationsWrapper,PluginWrapper);RecommendationsWrapper.NAME="RecommendationsWrapper";RecommendationsWrapper.prototype.url=null;RecommendationsWrapper.prototype.target=null;RecommendationsWrapper.prototype.recommendations=null;RecommendationsWrapper.prototype.getFeatureName=function(){return"recommendations"};RecommendationsWrapper.prototype.getData=function(){return this.recommendations};RecommendationsWrapper.prototype.setData=function(value){return this.recommendations=value};RecommendationsWrapper.prototype.getTarget=function(){var _ref,_ref1;return this.target||((_ref=this.player)!=null?(_ref1=_ref.config)!=null?_ref1.target:void(0):void(0))};RecommendationsWrapper.prototype.getURL=function(){return this.url};RecommendationsWrapper.prototype.createFlashVars=function(flashvars){flashvars.recommendations_partner="mrss";if(this.config.target!=null)flashvars.external_target=this.config.target};RecommendationsWrapper.prototype.createXML=function(xml){var application,recommendations,vendor;application=xml.getElementsByTagName("application")[0];recommendations=xml.getElementsByTagName("recommendations")[0];if(!(recommendations!=null)){recommendations=xml.createElement("recommendations");application.appendChild(recommendations)};vendor=xml.createElement("vendor");vendor.setAttribute("id","mrss");recommendations.appendChild(vendor);this.createProperty(xml,"RECOMMENDATIONS_MRSS_URL",this.url,vendor)};RecommendationsWrapper.prototype.listNotificationInterests=function(){return RecommendationsWrapper.__super__.listNotificationInterests.apply(this,arguments).concat([FlashNotifications.RECOMMENDATION_SELECTED,FlashNotifications.RECOMMENDATIONS_LOADED])};RecommendationsWrapper.prototype.handleNotification=function(notification){var body,name,type;RecommendationsWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.RECOMMENDATIONS_LOADED:type="loaded";this.recommendations=body;break;case FlashNotifications.RECOMMENDATION_SELECTED:type="selected"};if(type!=null)this.dispatchEvent(new Event(type,body))};function RecommendationsMediator(){RecommendationsMediator.__super__.constructor.call(this)};__extends(RecommendationsMediator,OverlayMediator);RecommendationsMediator.prototype.componentName="recommendations";RecommendationsMediator.prototype.listArea=null;RecommendationsMediator.prototype.onRegister=function(){var label;label=this.createText("recommendations-label","Recommended");this.listArea=this.create("recommendations-list-area");RecommendationsMediator.__super__.onRegister.call(this)};RecommendationsMediator.prototype.listNotificationInterests=function(){return[RecommendationsNotifications.RECOMMENDATIONS_LOADED]};RecommendationsMediator.prototype.handleNotification=function(notification){var rec,recs,_i,_len;switch(notification.getName()){case RecommendationsNotifications.RECOMMENDATIONS_LOADED:this.listArea.innerHTML="";recs=notification.getBody();if((recs!=null)&&recs.length>0)for(_i=0,_len=recs.length;_i<_len;_i++){rec=recs[_i];this.addElement(rec)}}};RecommendationsMediator.prototype.addElement=function(recommendation){var listItem,_this=this;listItem=this.create("recommendation",this.listArea);if(listItem.dataset==null)listItem.dataset={};listItem.dataset.link=recommendation.link;listItem.dataset.target=recommendation.target;listItem.innerHTML="<img src='"+recommendation.thumbnail+"' class='"+this.cssPrefix+"recommendation-thumbnail' /> <span class='"+this.cssPrefix+"recommendation-text'>"+recommendation.description+"</span>";listItem.onclick=function(event){event.stopImmediatePropagation();_this.sendNotification(RecommendationsNotifications.RECOMMENDATION_SELECTED,event.currentTarget.dataset);return false}};function RecommendationSelectedCommand(){RecommendationSelectedCommand.__super__.constructor.call(this)};__extends(RecommendationSelectedCommand,puremvc.SimpleCommand);RecommendationSelectedCommand.prototype.execute=function(notification){var rec,recProxy;recProxy=this.facade.retrieveProxy(RecommendationsProxy.NAME);rec=notification.getBody();this.facade.logger.debug('Recommendation Selected: ',rec);if(rec.target!=="none"&&rec.target!=="player")window.open(rec.link,rec.target)};function RecommendationsPlayCommand(){RecommendationsPlayCommand.__super__.constructor.call(this)};__extends(RecommendationsPlayCommand,puremvc.SimpleCommand);RecommendationsPlayCommand.prototype.execute=function(notification){var recommendationsProxy;recommendationsProxy=this.facade.retrieveProxy(RecommendationsProxy.NAME);recommendationsProxy.invoke()};function RecommendationsPlayStateChangeCommand(){RecommendationsPlayStateChangeCommand.__super__.constructor.call(this)};__extends(RecommendationsPlayStateChangeCommand,puremvc.SimpleCommand);RecommendationsPlayStateChangeCommand.prototype.execute=function(notification){var recommendations,recommendationsProxy,states;recommendationsProxy=this.facade.retrieveProxy(RecommendationsProxy.NAME);recommendations=recommendationsProxy.getRecommendations();states=notification.getBody();if(states.newState===PlayState.ENDED){if((recommendations!=null?recommendations.length:void(0))>0)this.facade.sendNotification(Notifications.ADD_APPLICATION_STATE,"recommendations-mode")}else if(states.oldState===PlayState.ENDED)if((recommendations!=null?recommendations.length:void(0))>0)this.facade.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"recommendations-mode")};function RecommendationsProxy(config){RecommendationsProxy.__super__.constructor.call(this,config);this.helper=new MRSSHelper()};__extends(RecommendationsProxy,PluginProxy);RecommendationsProxy.NAME=ModuleProxy.NAME;RecommendationsProxy.prototype.defaults={url:null,target:"_blank"};RecommendationsProxy.prototype.loaded=true;RecommendationsProxy.prototype.recommendations=null;RecommendationsProxy.prototype.helper=null;RecommendationsProxy.prototype.getRecommendations=function(){return this.recommendations};RecommendationsProxy.prototype.setRecommendations=function(value){this.recommendations=value;this.sendNotification(RecommendationsNotifications.RECOMMENDATIONS_LOADED,this.recommendations);return value};RecommendationsProxy.prototype.getURL=function(){return this.getConfigurationData().url};RecommendationsProxy.prototype.setURL=function(value){this.data.url=value;this.invoke();return value};RecommendationsProxy.prototype.getTarget=function(){return this.getConfigurationData().target||this.facade.app.retrieveProxy(ConfigurationProxy.NAME).getTarget()};RecommendationsProxy.prototype.setTarget=function(value){this.data.target=value;return value};RecommendationsProxy.prototype.invoke=function(){var url,xhr;url=this.getURL();if(!(url!=null)||url===""){this.facade.logger.error("[AMP RECOMMENDATIONS ERROR]","Load Error: No url provided");return};xhr=Utils.getJson(url,this.onload.bind(this),this.onerror.bind(this))};RecommendationsProxy.prototype.onload=function(json){var recs;recs=this.createRecommendations(json);this.setRecommendations(recs)};RecommendationsProxy.prototype.onerror=function(error){this.facade.logger.error("[AMP RECOMMENDATIONS ERROR]","Load Error:",error)};RecommendationsProxy.prototype.createRecommendations=function(feed){var item,rec,recs,_i,_len,_ref;feed=this.helper.createFeed(feed);recs=[];_ref=feed.item;for(_i=0,_len=_ref.length;_i<_len;_i++){item=_ref[_i];rec=new RecommendationVO(item.guid,item.link,item.title,item.description,item.thumbnail,item.duration,item.pubDate,this.getTarget(),item);recs.push(rec)};return recs};function AuditudePlugin(app,config){AuditudePlugin.__super__.constructor.call(this,app,config)};__extends(AuditudePlugin,AdPlugin);AuditudePlugin.NAME="AuditudePlugin";AuditudePlugin.prototype.moduleName="auditude";AuditudePlugin.prototype.featureName="ads";AuditudePlugin.prototype.createFullscreenProxy=function(){return new AuditudeFullscreenProxy(this.config)};AuditudePlugin.prototype.createProxy=function(){return new AuditudeProxy(this.config)};AuditudePlugin.prototype.isFullscreenDevice=function(){return true};AMP.registerPlugin("auditude","html",AuditudePlugin);AMP.registerPlugin("auditude","flash",AuditudeWrapper);function RecommendationsAPI(module){var proxy;RecommendationsAPI.__super__.constructor.call(this,module);proxy=module.retrieveProxy(RecommendationsProxy.NAME);this.setURL=proxy.setURL.bind(proxy);this.getURL=proxy.getURL.bind(proxy);this.getData=proxy.getRecommendations.bind(proxy);this.setData=proxy.setRecommendations.bind(proxy);this.getTarget=proxy.getTarget.bind(proxy);this.setTarget=proxy.setTarget.bind(proxy)};__extends(RecommendationsAPI,PluginAPI);RecommendationsAPI.prototype.setURL=function(value){};RecommendationsAPI.prototype.getURL=function(){};RecommendationsAPI.prototype.getData=function(){};RecommendationsAPI.prototype.setData=function(value){};RecommendationsAPI.prototype.getTarget=function(){};RecommendationsAPI.prototype.setTarget=function(value){};function AutoAdvancePlugin(app,config){AutoAdvancePlugin.__super__.constructor.call(this,app,config)};__extends(AutoAdvancePlugin,Plugin);AutoAdvancePlugin.NAME="AutoAdvancePlugin";AutoAdvancePlugin.prototype.moduleName="autoadvance";AutoAdvancePlugin.prototype.createController=function(){AutoAdvancePlugin.__super__.createController.call(this);this.registerCommand(AutoAdvanceNotifications.START,AutoAdvanceStartCommand);this.registerCommand(AutoAdvanceNotifications.ADVANCE,AutoAdvanceAdvanceCommand);this.registerCommand(Notifications.ENDED,AutoAdvanceEndedCommand);this.registerCommand(Notifications.CHANGE_MEDIA,AutoAdvanceStopCommand);this.registerCommand(Notifications.PLAY,AutoAdvanceStopCommand);this.registerCommand(Notifications.PLAYING,AutoAdvanceStopCommand);this.registerCommand(Notifications.REPLAY,AutoAdvanceStopCommand)};AutoAdvancePlugin.prototype.createModel=function(){this.registerProxy(new AutoAdvanceProxy(this.config))};AutoAdvancePlugin.prototype.createView=function(){this.registerMediator(new AutoAdvanceMediator())};AutoAdvancePlugin.prototype.listNotificationInterests=function(){return[Notifications.ENDED,Notifications.CHANGE_MEDIA,Notifications.PLAY,Notifications.PLAYING,Notifications.REPLAY]};AutoAdvancePlugin.prototype.listNotificationPublications=function(){var key,value;return AutoAdvancePlugin.__super__.listNotificationPublications.call(this).concat((function(){var _results;_results=[];for(key in AutoAdvanceNotifications){value=AutoAdvanceNotifications[key];_results.push(value)};return _results})())};AutoAdvancePlugin.prototype.listNotificationEvents=function(){var key,value;return AutoAdvancePlugin.__super__.listNotificationEvents.call(this).concat((function(){var _results;_results=[];for(key in AutoAdvanceNotifications){value=AutoAdvanceNotifications[key];_results.push(value)};return _results})())};AMP.registerPlugin("autoadvance","html",AutoAdvancePlugin);AMP.registerPlugin("autoadvance","flash",AutoAdvanceWrapper);function RecommendationsGridMediator(){RecommendationsGridMediator.__super__.constructor.call(this)};__extends(RecommendationsGridMediator,OverlayMediator);RecommendationsGridMediator.prototype.componentName="recommendations-grid";RecommendationsGridMediator.prototype.grid=null;RecommendationsGridMediator.prototype.onRegister=function(){var label;label=this.createText("recommendations-grid-label",this.localizationManager.getString(LocalizationConstants.MSG_RECOMMENDATIONS_TITLE));this.grid=this.create("recommendations-grid-table-grid",this,"table");RecommendationsGridMediator.__super__.onRegister.call(this)};RecommendationsGridMediator.prototype.listNotificationInterests=function(){return[RecommendationsNotifications.RECOMMENDATIONS_LOADED]};RecommendationsGridMediator.prototype.handleNotification=function(notification){var rec,recs,_i,_len;switch(notification.getName()){case RecommendationsNotifications.RECOMMENDATIONS_LOADED:this.grid.innerHTML="";this.create("recommendations-grid-row",this.grid,"tr");this.create("recommendations-grid-row",this.grid,"tr");recs=notification.getBody();if((recs!=null)&&recs.length>0)for(_i=0,_len=recs.length;_i<_len;_i++){rec=recs[_i];this.addElement(rec,_i)}}};RecommendationsGridMediator.prototype.addElement=function(recommendation,recommendedIndex){var gridRowIndex,td,_this=this;gridRowIndex=(recommendedIndex%4)<2?0:1;td=this.create("recommendations-grid-item",this.grid.childNodes[gridRowIndex],"td");if(td.dataset==null)td.dataset={};td.dataset.link=recommendation.link;td.dataset.target=this.config.getTarget();td.innerHTML="<img src='"+recommendation.thumbnail+"' class='"+this.cssPrefix+"recommendations-grid-thumbnail' /> <span class='"+this.cssPrefix+"recommendations-grid-text'>"+recommendation.description+"</span>";td.onclick=function(event){event.stopImmediatePropagation();_this.sendNotification(RecommendationsNotifications.RECOMMENDATION_SELECTED,event.currentTarget.dataset);return false}};function RecommendationsPlugin(app,config){RecommendationsPlugin.__super__.constructor.call(this,app,config)};__extends(RecommendationsPlugin,Feature);RecommendationsPlugin.NAME="RecommendationsPlugin";RecommendationsPlugin.prototype.featureName="recommendations";RecommendationsPlugin.prototype.moduleName="recommendations";RecommendationsPlugin.prototype.createController=function(){this.registerCommand(RecommendationsNotifications.RECOMMENDATION_SELECTED,RecommendationSelectedCommand);this.registerCommand(Notifications.START,RecommendationsPlayCommand);this.registerCommand(Notifications.PLAY_STATE_CHANGE,RecommendationsPlayStateChangeCommand)};RecommendationsPlugin.prototype.createModel=function(){this.registerProxy(new RecommendationsProxy(this.config))};RecommendationsPlugin.prototype.createView=function(){this.registerMediator(new RecommendationsMediator())};RecommendationsPlugin.prototype.createAPI=function(){this.api=new RecommendationsAPI(this);return this.api};RecommendationsPlugin.prototype.listNotificationInterests=function(){return[Notifications.START,Notifications.PLAY_STATE_CHANGE]};RecommendationsPlugin.prototype.listNotificationPublications=function(){var key,value;return RecommendationsPlugin.__super__.listNotificationPublications.call(this).concat((function(){var _results;_results=[];for(key in RecommendationsNotifications){value=RecommendationsNotifications[key];_results.push(value)};return _results})())};RecommendationsPlugin.prototype.listNotificationEvents=function(){var key,value;return RecommendationsPlugin.__super__.listNotificationEvents.call(this).concat((function(){var _results;_results=[];for(key in RecommendationsNotifications){value=RecommendationsNotifications[key];_results.push(value)};return _results})())};AMP.registerPlugin("recommendations","html",RecommendationsPlugin);AMP.registerPlugin("recommendations","flash",RecommendationsWrapper);function NielsenProxy(config){NielsenProxy.__super__.constructor.call(this,config)};__extends(NielsenProxy,DataBoundConfigurationProxy);NielsenProxy.prototype.configurationName="nielsen";NielsenProxy.NAME=ModuleProxy.NAME;NielsenProxy.cg="OnDemand";NielsenProxy.url="http://secure-us.imrworldwide.com/cgi-bin/m";NielsenProxy.prototype.defaults={url:null,data:{ci:null,c6:null,cg:null,tl:null},events:null};NielsenProxy.prototype.getTitle=function(){return this.title};NielsenProxy.prototype.setTitle=function(value){return this.title=value};NielsenProxy.prototype.start=function(){var url;url=this.constructURL("video","started");Utils.beacon(url)};NielsenProxy.prototype.end=function(){var url;url=this.constructURL("video","ended");Utils.beacon(url)};NielsenProxy.prototype.constructURL=function(target,type){var c6,cg,ci,event,events,item,tl,url,_i,_len,_ref,_ref1,_ref2,_ref3,_ref4;url=this.url||NielsenProxy.url;events=(_ref=this.value.events)!=null?_ref[target]:void(0);if(events!=null)for(_i=0,_len=events.length;_i<_len;_i++){item=events[_i];if(item.type===type)event=item};ci=(event!=null?(_ref1=event.data)!=null?_ref1.ci:void(0):void(0))||this.value.data.ci;c6=(event!=null?(_ref2=event.data)!=null?_ref2.c6:void(0):void(0))||this.value.data.c6;cg=(event!=null?(_ref3=event.data)!=null?_ref3.cg:void(0):void(0))||this.value.data.cg||NielsenProxy.cg;tl=(event!=null?(_ref4=event.data)!=null?_ref4.tl:void(0):void(0))||this.value.data.tl;return""+url+"?ci="+ci+"&c6="+c6+"&cc=1&tl="+tl+"&cg="+cg+"&rnd="+(Date.now())};function NielsenWrapper(){return NielsenWrapper.__super__.constructor.apply(this,arguments)};__extends(NielsenWrapper,PluginWrapper);NielsenWrapper.NAME="NielsenWrapper";NielsenWrapper.prototype.createXML=function(xml){var application,element,event,events,map,metrics,node,prop,props,text,txtTest,type,urlElement,vendor,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3;if(!(((_ref=this.config)!=null?_ref.events:void(0))!=null))return;application=xml.getElementsByTagName("application")[0];metrics=xml.getElementsByTagName("metrics")[0];vendor=xml.createElement("vendor");vendor.setAttribute("id","nielsen");metrics.appendChild(vendor);map={ads:{started:"adStart",ended:"adComplete"},video:{started:"videoStart",ended:"videoComplete"}};props=[{value:"ci",key:"NIELSEN_CI"},{value:"cg",key:"NIELSEN_CG"},{value:"tl",key:"NIELSEN_TL"},{value:"c6",key:"NIELSEN_C6"}];if(this.config.url!=null){urlElement=xml.createElement("property");urlElement.setAttribute("key","serviceURL");txtTest=XMLUtils.createTextContent(xml,this.config.url.toString());urlElement.appendChild(txtTest);vendor.appendChild(urlElement)};_ref1=this.config.events;for(type in _ref1){events=_ref1[type];if((events!=null)&&events.length>0)for(_i=0,_len=events.length;_i<_len;_i++){event=events[_i];node=xml.createElement("property");node.setAttribute("key",map[type][event.type]);vendor.appendChild(node);for(_j=0,_len1=props.length;_j<_len1;_j++){prop=props[_j];text=((_ref2=event.data)!=null?_ref2[prop.value]:void(0))||((_ref3=this.config.data)!=null?_ref3[prop.value]:void(0));if((text!=null)&&text!==""){element=xml.createElement("property");element.setAttribute("key",prop.key);text=XMLUtils.createTextContent(xml,text);element.appendChild(text);node.appendChild(element)}}}};return xml};function NielsenEndCommand(){NielsenEndCommand.__super__.constructor.call(this)};__extends(NielsenEndCommand,puremvc.SimpleCommand);NielsenEndCommand.prototype.execute=function(notification){var nielsen;this.facade.logger.debug("NielsenEndCommand");nielsen=this.facade.retrieveProxy(NielsenProxy.NAME);nielsen.end()};function NielsenStartCommand(){NielsenStartCommand.__super__.constructor.call(this)};__extends(NielsenStartCommand,puremvc.SimpleCommand);NielsenStartCommand.prototype.execute=function(notification){var nielsen;this.facade.logger.debug("NielsenStartCommand");nielsen=this.facade.retrieveProxy(NielsenProxy.NAME);nielsen.start()};function RecommendationsGridPlugin(app,config){RecommendationsGridPlugin.__super__.constructor.call(this,app,config)};__extends(RecommendationsGridPlugin,RecommendationsPlugin);RecommendationsGridPlugin.NAME="RecommendationsGridPlugin";RecommendationsGridPlugin.prototype.moduleName="recommendationsgrid";RecommendationsGridPlugin.prototype.createView=function(){this.registerMediator(new RecommendationsGridMediator())};AMP.registerPlugin("recommendationsgrid","html",RecommendationsGridPlugin);AMP.registerPlugin("recommendationsgrid","flash",RecommendationsWrapper);function ComscoreProxy(config){ComscoreProxy.__super__.constructor.call(this,config)};__extends(ComscoreProxy,DataBoundConfigurationProxy);ComscoreProxy.prototype.configurationName="comscore";ComscoreProxy.NAME=ModuleProxy.NAME;ComscoreProxy.prototype.defaults={url:"http://b.scorecardresearch.com/b",events:{ads:null,video:null},data:{c1:null,c2:null,c3:null,c4:null,c5:null,c6:null,c7:null,c8:null,c9:null,c10:null,c14:null}};ComscoreProxy.prototype.adStart=function(){var url;this.facade.logger.log("ComscoreProxy -> adStart");url=this.constructURL("ads","started");Utils.beacon(url)};ComscoreProxy.prototype.videoStart=function(){var url;this.facade.logger.log("ComscoreProxy -> videoStart");url=this.constructURL("video","started");Utils.beacon(url)};ComscoreProxy.prototype.constructURL=function(target,type){var data,event,events,item,key,query,url,value,_i,_len,_ref,_ref1,_ref2;data={};events=(_ref=this.value.events)!=null?_ref[target]:void(0);if(events!=null)for(_i=0,_len=events.length;_i<_len;_i++){item=events[_i];if(item.type===type)event=item};_ref1=this.value.data;for(key in _ref1){value=_ref1[key];data[key]=(event!=null?(_ref2=event.data)!=null?_ref2[key]:void(0):void(0))||value};if(data.c7==null)data.c7=document.location.href.substr(0,512);if(data.c8==null)data.c8=document.referrer.substr(0,512);if(data.c9==null)data.c9=document.title;if(data.cv==null)data.cv="2.0";data.rn=Date.now();url=this.value.url;query=[];for(key in data){value=data[key];if((value!=null)&&value!=="")query.push(key+"="+escape(value))};if(query.length>0)url+="?"+query.join("&");return url.substr(0,2080)};function ComscoreWrapper(){return ComscoreWrapper.__super__.constructor.apply(this,arguments)};__extends(ComscoreWrapper,PluginWrapper);ComscoreWrapper.NAME="ComscoreWrapper";ComscoreWrapper.prototype.createXML=function(xml){var application,element,event,events,map,metrics,node,prop,props,text,type,vendor,_i,_j,_len,_len1,_ref,_ref1,_ref2;application=xml.getElementsByTagName("application")[0];metrics=xml.getElementsByTagName("metrics")[0];if(!(metrics!=null)){metrics=xml.createElement("metrics");application.appendChild(metrics)};vendor=xml.createElement("vendor");vendor.setAttribute("id","comscore");metrics.appendChild(vendor);map={ads:{started:"adStart",ended:"adComplete"},video:{started:"videoStart",ended:"videoComplete"}};props=[{value:"c1",key:"COMSCORE_CSC1"},{value:"c2",key:"COMSCORE_CSC2"},{value:"c3",key:"COMSCORE_CSC3"},{value:"c4",key:"COMSCORE_CSC4"},{value:"c5",key:"COMSCORE_CSC5"},{value:"c6",key:"COMSCORE_CSC6"},{value:"c7",key:"COMSCORE_CSC7"},{value:"c8",key:"COMSCORE_CSC8"},{value:"c9",key:"COMSCORE_CSC9"},{value:"c10",key:"COMSCORE_CSC10"},{value:"c11",key:"COMSCORE_CSC14"}];_ref=this.config.events;for(type in _ref){events=_ref[type];if((events!=null)&&events.length>0)for(_i=0,_len=events.length;_i<_len;_i++){event=events[_i];node=xml.createElement("property");node.setAttribute("key",map[type][event.type]);vendor.appendChild(node);element=xml.createElement("property");element.setAttribute("key","COMSCORE_CSURL");text=XMLUtils.createTextContent(xml,this.config.url);element.appendChild(text);node.appendChild(element);for(_j=0,_len1=props.length;_j<_len1;_j++){prop=props[_j];text=((_ref1=event.data)!=null?_ref1[prop.value]:void(0))||((_ref2=this.config.data)!=null?_ref2[prop.value]:void(0));if((text!=null)&&text!==""){element=xml.createElement("property");element.setAttribute("key",prop.key);text=XMLUtils.createTextContent(xml,text);element.appendChild(text);node.appendChild(element)}}}};return xml};function ComscoreAdStartCommand(){ComscoreAdStartCommand.__super__.constructor.call(this)};__extends(ComscoreAdStartCommand,puremvc.SimpleCommand);ComscoreAdStartCommand.prototype.execute=function(notification){var comscore;this.facade.logger.debug("ComscoreAdStartCommand");comscore=this.facade.retrieveProxy(ComscoreProxy.NAME);comscore.adStart()};function ComscoreStartCommand(){ComscoreStartCommand.__super__.constructor.call(this)};__extends(ComscoreStartCommand,puremvc.SimpleCommand);ComscoreStartCommand.prototype.execute=function(notification){var comscore;this.facade.logger.debug("ComscoreStartCommand");comscore=this.facade.retrieveProxy(ComscoreProxy.NAME);comscore.videoStart()};function NielsenPlugin(app,config){NielsenPlugin.__super__.constructor.call(this,app,config)};__extends(NielsenPlugin,Plugin);NielsenPlugin.NAME="NielsenPlugin";NielsenPlugin.prototype.moduleName="nielsen";NielsenPlugin.prototype.createController=function(){var event,events,_i,_len,_ref,_ref1;events=(_ref=this.config)!=null?(_ref1=_ref.events)!=null?_ref1.video:void(0):void(0);if(!(events!=null))return;for(_i=0,_len=events.length;_i<_len;_i++){event=events[_i];if(event.type==="started"){this.registerCommand(Notifications.STARTED,NielsenStartCommand);this.registerCommand(Notifications.CONTENT_CHANGED,NielsenStartCommand)};if(event.type==="ended"){this.registerCommand(Notifications.ENDED,NielsenEndCommand);this.registerCommand(Notifications.CHANGE_CONTENT,NielsenEndCommand)}}};NielsenPlugin.prototype.createModel=function(){this.registerProxy(new NielsenProxy(this.config))};NielsenPlugin.prototype.listNotificationInterests=function(){return[Notifications.STARTED,Notifications.ENDED,Notifications.CONTENT_CHANGED,Notifications.CHANGE_CONTENT]};AMP.registerPlugin("nielsen","html",NielsenPlugin);AMP.registerPlugin("nielsen","flash",NielsenWrapper);function OmnitureAdProxy(proxy){this.proxy=proxy;OmnitureAdProxy.__super__.constructor.call(this);this.plugin=this.proxy.plugin;this.error=this.proxy.error};__extends(OmnitureAdProxy,puremvc.Proxy);OmnitureAdProxy.NAME="OmnitureAdProxy";OmnitureAdProxy.prototype.proxy=null;OmnitureAdProxy.prototype.plugin=null;OmnitureAdProxy.prototype.error=null;OmnitureAdProxy.prototype.currentTime=null;OmnitureAdProxy.prototype.started=false;OmnitureAdProxy.prototype.ad=null;OmnitureAdProxy.prototype.getAd=function(){return this.ad};OmnitureAdProxy.prototype.setAd=function(value){this.started=false;this.currentTime=0;return this.ad=value};OmnitureAdProxy.prototype.setTimeRemaining=function(time){if(!(this.ad!=null))return;this.currentTime=this.ad.duration-time;return time};OmnitureAdProxy.prototype.start=function(){try{this.plugin.Media.openAd(this.ad.title,this.ad.duration,this.proxy.value.playerName,this.proxy.getMediaName(),this.ad.type,this.ad.position,this.ad.cpm);this.started=true}catch(error){this.error("open",error)}};OmnitureAdProxy.prototype.play=function(){if(this.started!==true)this.start();try{this.plugin.Media.play(this.ad.title,this.currentTime||0)}catch(error){this.error("ad play",error)}};OmnitureAdProxy.prototype.pause=function(){try{this.plugin.Media.stop(this.ad.title,this.currentTime)}catch(error){this.error("ad pause",error)}};OmnitureAdProxy.prototype.ended=function(){if(this.started===false)return;try{this.started=false;this.plugin.Media.stop(this.ad.title,this.ad.duration);this.plugin.Media.close(this.ad.title)}catch(error){this.error("ad end",error)}};function OmnitureAdLoadedCommand(){OmnitureAdLoadedCommand.__super__.constructor.call(this)};__extends(OmnitureAdLoadedCommand,PluginCommand);OmnitureAdLoadedCommand.prototype.execute=function(notification){this.facade.logger.debug("OmnitureAdLoadedCommand");this.config.ads.setAd(notification.getBody())};function OmniturePlayCommand(){OmniturePlayCommand.__super__.constructor.call(this)};__extends(OmniturePlayCommand,PluginCommand);OmniturePlayCommand.prototype.execute=function(notification){this.facade.logger.debug("OmniturePlayCommand");this.config.play()};function OmnitureChangeMediaCommand(){OmnitureChangeMediaCommand.__super__.constructor.call(this)};__extends(OmnitureChangeMediaCommand,PluginCommand);OmnitureChangeMediaCommand.prototype.execute=function(notification){this.config.setMedia(notification.getBody());this.facade.removeCommand(Notifications.PLAY)};function OmniturePauseCommand(){OmniturePauseCommand.__super__.constructor.call(this)};__extends(OmniturePauseCommand,PluginCommand);OmniturePauseCommand.prototype.execute=function(notification){this.config.pause()};function OmnitureSeekingCommand(){OmnitureSeekingCommand.__super__.constructor.call(this)};__extends(OmnitureSeekingCommand,PluginCommand);OmnitureSeekingCommand.prototype.execute=function(notification){this.facade.logger.debug("OmnitureSeekingCommand");this.config.seeking()};function OmnitureSeekedCommand(){OmnitureSeekedCommand.__super__.constructor.call(this)};__extends(OmnitureSeekedCommand,PluginCommand);OmnitureSeekedCommand.prototype.execute=function(notification){this.facade.logger.debug("OmnitureSeekedCommand");this.config.seeked()};function OmnitureEndedCommand(){OmnitureEndedCommand.__super__.constructor.call(this)};__extends(OmnitureEndedCommand,PluginCommand);OmnitureEndedCommand.prototype.execute=function(notification){this.config.ended()};function OmnitureContentChangedCommand(){OmnitureContentChangedCommand.__super__.constructor.call(this)};__extends(OmnitureContentChangedCommand,PluginCommand);OmnitureContentChangedCommand.prototype.execute=function(notification){this.config.setMedia(notification.getBody());this.config.start()};function OmnitureStartCommand(){OmnitureStartCommand.__super__.constructor.call(this)};__extends(OmnitureStartCommand,PluginCommand);OmnitureStartCommand.prototype.execute=function(notification){this.facade.logger.debug("OmnitureStartCommand");this.config.start();this.facade.registerCommand(Notifications.PLAY,OmniturePlayCommand)};function OmnitureAdStartedCommand(){OmnitureAdStartedCommand.__super__.constructor.call(this)};__extends(OmnitureAdStartedCommand,PluginCommand);OmnitureAdStartedCommand.prototype.execute=function(notification){this.facade.logger.debug("OmnitureAdStartedCommand");this.config.ads.start()};function OmnitureAdPlayCommand(){OmnitureAdPlayCommand.__super__.constructor.call(this)};__extends(OmnitureAdPlayCommand,PluginCommand);OmnitureAdPlayCommand.prototype.execute=function(notification){this.facade.logger.debug("OmnitureAdPlayCommand");this.config.ads.play()};function OmnitureAdPauseCommand(){OmnitureAdPauseCommand.__super__.constructor.call(this)};__extends(OmnitureAdPauseCommand,PluginCommand);OmnitureAdPauseCommand.prototype.execute=function(notification){this.facade.logger.debug("OmnitureAdPauseCommand");this.config.ads.pause()};function OmnitureAdBreakEndCommand(){OmnitureAdBreakEndCommand.__super__.constructor.call(this)};__extends(OmnitureAdBreakEndCommand,PluginCommand);OmnitureAdBreakEndCommand.prototype.execute=function(notification){this.facade.logger.debug("OmnitureAdBreakEndCommand");this.config.ads.ended()};function CaptionCue(startTime,endTime,id){this.startTime=startTime;this.endTime=endTime;this.id=id};CaptionCue.prototype.id=null;CaptionCue.prototype.startTime=null;CaptionCue.prototype.endTime=null;CaptionCue.prototype.text=null;CaptionCue.prototype.html=null;CaptionCue.prototype.align=null;function OmnitureAdTimeRemainingCommand(){OmnitureAdTimeRemainingCommand.__super__.constructor.call(this)};__extends(OmnitureAdTimeRemainingCommand,PluginCommand);OmnitureAdTimeRemainingCommand.prototype.execute=function(notification){this.config.ads.setTimeRemaining(notification.getBody())};function SRTParser(){};SRTParser.prototype.parse=function(track,txt){var caption,captions,cue,end,index,parts,start,text,times,_i,_len;txt=txt.replace(/\r/g,'');captions=txt.split("\n\n");for(_i=0,_len=captions.length;_i<_len;_i++){caption=captions[_i];parts=caption.split("\n");try{index=parts[0];times=parts[1].match(/([0-9:\,]+)\s*-->\s*([0-9:\,]+)/).slice(1);start=Utils.flattenTimecode(times[0]);end=Utils.flattenTimecode(times[1]);text=parts.slice(2)}catch(err){Logger.warn("SRT Parsing Warning")};cue=new CaptionCue(start,end,"cue_"+index);cue.html="<p>"+text.join("<br />")+"</p>";cue.text=text.join("\n");track.cues.push(cue)};return track};function SMPTETTParser(){};SMPTETTParser.prototype.parse=function(track,xml){var captions,lang,styledElements,styles,tt,_this=this;styles=Array.prototype.slice.call(xml.querySelectorAll("styling style"));styles.forEach(function(item,index,list){var attributes,id,style;style="";id=item.getAttribute("id")||item.getAttribute("xml:id");attributes=Array.prototype.slice.call(item.attributes);attributes.forEach(function(item,index,array){if(item.prefix==="tts")return style+=Utils.formatStyleName(item.localName)+":"+item.nodeValue+";"});track.styles[id]=style});styledElements=Array.prototype.slice.call(xml.querySelectorAll("body [style]"));styledElements.forEach(function(item,index,array){var id;id=item.getAttribute("style");item.setAttribute("style",track.styles[id])});tt=xml.querySelector("tt");lang=tt.getAttribute("lang")||tt.getAttribute("xml:lang");if(track.language===void(0)||track.language===null)track.language=lang;captions=Array.prototype.slice.call(xml.querySelectorAll("body p[begin]"));captions.forEach(function(item,index,array){var align,cue,end,start,text;start=item.getAttribute("begin");item.removeAttribute("begin");if(item.getAttribute("end")!=null){end=item.getAttribute("end");item.removeAttribute("end")}else if(captions[index+1]!=null)end=captions[index+1].getAttribute("begin");cue=new CaptionCue(Utils.flattenTimecode(start),Utils.flattenTimecode(end),"cue_"+index);align=item.getAttributeNS("http://www.w3.org/ns/ttml#styling","textAlign");if(align!=null){cue.align=align==="center"?"middle":align;item.removeAttributeNS("http://www.w3.org/ns/ttml#styling","textAlign")};text=XMLUtils.serialize(item);text=text.replace(/\s*xmlns="[^"]*"/,"");cue.html=text;text=text.replace(/^<p[^>]*>/,"");text=text.replace(/<\/p>$/,"");text=text.replace(/<br\/>/,"\n");text=text.replace(/<span style="([^"]*)"/,"<c.$1");text=text.replace(/<\/span>/,"</c>");cue.text=text;track.cues.push(cue)});return track};function OmnitureWrapper(){return OmnitureWrapper.__super__.constructor.apply(this,arguments)};__extends(OmnitureWrapper,PluginWrapper);OmnitureWrapper.NAME="OmnitureWrapper";OmnitureWrapper.prototype.createXML=function(xml){var application,contextData,contextDataMapping,event,events,intervalProp,intervalReached,intervals,key,linkTracking,linkTrackingData,media,metrics,milestone,milestones,prop,property,props,trackMilestone,trackMilestones,type,value,vendor,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_len5,_len6,_m,_n,_o,_ref,_ref1,_ref2;application=xml.getElementsByTagName("application")[0];metrics=xml.getElementsByTagName("metrics")[0];if(!(metrics!=null)){metrics=xml.createElement("metrics");application.appendChild(metrics)};vendor=xml.createElement("vendor");vendor.setAttribute("id","omniture");metrics.appendChild(vendor);props=[{value:this.config.channel,key:"OMNITURE_CHANNEL"},{value:this.config.account,key:"OMNITURE_ACCOUNT"},{value:this.config.debugTracking,key:"OMNITURE_DEBUG_TRACKING"},{value:this.config.trackLocal,key:"OMNITURE_TRACK_LOCAL"},{value:this.config.visitorNamespace,key:"OMNITURE_VISITOR_NAMESPACE"},{value:this.config.trackingServer,key:"OMNITURE_TRACKING_SERVER"},{value:this.config.trackingServerSecure,key:"OMNITURE_TRACKING_SERVER_SECURE"},{value:this.config.currencyCode,key:"OMNITURE_CURRENCY_CODE"},{value:this.config.trackWhilePlaying,key:"OMNITURE_TRACK_WHILE_PLAYING"},{value:this.config.trackMediaMethods,key:"OMNITURE_TRACK_MEDIA_METHODS"},{value:this.config.mediaName,key:"OMNITURE_MEDIA_NAME"},{value:this.config.playerName,key:"OMNITURE_PLAYER_NAME"}];for(_i=0,_len=props.length;_i<_len;_i++){prop=props[_i];if(prop.value!=null)this.createProperty(xml,prop.key,prop.value,vendor)};media=this.config.Media;if(media!=null){props=[{value:media.autoTrack,key:"OMNITURE_AUTO_TRACK"},{value:media.segmentByMilestones,key:"OMNITURE_SEGMENT_MILESTONES"},{value:media.trackVars,key:"OMNITURE_TRACKVARS"},{value:media.trackEvents,key:"OMNITURE_TRACKEVENTS"},{value:media.trackUsingContextData,key:"OMNITURE_TRACK_CONTEXT_DATA"},{value:media.trackSecondIntervals,key:"OMNITURE_TRACKSECOND_INTERVALS"}];for(_j=0,_len1=props.length;_j<_len1;_j++){prop=props[_j];if(prop.value!=null)this.createProperty(xml,prop.key,prop.value,vendor)};if(media.trackMilestones!=null){trackMilestones=this.createProperty(xml,"OMNITURE_TRACK_MILESTONES",null,vendor);milestones=media.trackMilestones;for(_k=0,_len2=milestones.length;_k<_len2;_k++){milestone=milestones[_k];trackMilestone=this.createProperty(xml,milestone.percent,null,trackMilestones);for(key in milestone){value=milestone[key];if(key!=="percent")this.createProperty(xml,key,value,trackMilestone)}}};contextDataMapping=media.contextDataMapping;if(contextDataMapping!=null){contextData=this.createProperty(xml,"OMNITURE_CONTEXT_DATA",null,vendor);for(key in contextDataMapping){value=contextDataMapping[key];if(typeof value==="string")this.createProperty(xml,key,value,contextData);if(value instanceof Array){property=this.createProperty(xml,key,null,contextData);for(_l=0,_len3=value.length;_l<_len3;_l++){milestone=value[_l];this.createProperty(xml,milestone.percent,milestone.events,property)}}}}};linkTracking=this.config.customLinkTracking;if(linkTracking!=null){linkTrackingData=this.createProperty(xml,"OMNITURE_CUSTOM_LINK_TRACKING",null,vendor);for(key in linkTracking)if(key==="intervalReached"){intervalReached=this.createProperty(xml,key,null,linkTrackingData);_ref=linkTracking[key];for(_m=0,_len4=_ref.length;_m<_len4;_m++){intervals=_ref[_m];intervalProp=this.createProperty(xml,intervals.interval,null,intervalReached);for(key in intervals)if(key!=="interval")this.createProperty(xml,key,intervals[key],intervalProp)}}else this.createProperty(xml,key,linkTracking[key],linkTrackingData)};events=(_ref1=this.config.events)!=null?_ref1.video:void(0);if(events!=null)for(_n=0,_len5=events.length;_n<_len5;_n++){event=events[_n];switch(event.type){case"started":type="videoStart";break;case"ended":type="videoComplete";break;case"play":type="videoResume";break;case"pause":type="videoPause";break;default:type=event.type};this.createProperty(xml,type,event.data,vendor)};events=(_ref2=this.config.events)!=null?_ref2.ads:void(0);if(events!=null)for(_o=0,_len6=events.length;_o<_len6;_o++){event=events[_o];type=event.type==="started"?'adStart':event.type==="ended"?'adComplete':event.type;this.createProperty(xml,type,event.data,vendor)}};function CaptioningWrapper(player,config){CaptioningWrapper.__super__.constructor.call(this,player,config)};__extends(CaptioningWrapper,PluginWrapper);CaptioningWrapper.NAME="CaptioningWrapper";CaptioningWrapper.prototype.hidden=true;CaptioningWrapper.prototype.createXML=function(xml){var application,player,subply,_ref;subply=(_ref=this.config.flash)!=null?_ref.subply:void(0);if(subply!=null)try{if(subply.timeMethod!=null){player=xml.getElementsByTagName("player")[0];player.setAttribute("subply_time_method",subply.timeMethod)};if(subply.plugin!=null){application=xml.getElementsByTagName("application")[0];subply=xml.getElementsByTagName("subply")[0];if(!(subply!=null)){subply=xml.createElement("subply");application.appendChild(subply)};this.createProperty(xml,"SUBPLY_URL",this.config.flash.subply.plugin,subply)}}catch(error){this.facade.logger.error("AMP Captioning Error",error)}};CaptioningWrapper.prototype.createFlashVars=function(flashvars){var captionLangArr,captionUrlArr,config,track,_i,_len,_ref,_ref1;config=this.player.config;if(((_ref=config.media)!=null?_ref.track:void(0))!=null){track=Utils.selectTrack(config.media.track,"captions");if((track.src!=null)&&track.src!=="")flashvars.caption_url=track.src;if(config.media.track.length>1){captionUrlArr=[];captionLangArr=[];_ref1=config.media.track;for(_i=0,_len=_ref1.length;_i<_len;_i++){track=_ref1[_i];captionUrlArr.push(track.src);captionLangArr.push(track.srclang)};flashvars.caption_url=captionUrlArr.join(",");flashvars.caption_language=captionLangArr.join(",")};flashvars.caption_type=track.type!=null?encodeURIComponent(track.type):"application/ttml+xml"}};CaptioningWrapper.prototype.listNotificationInterests=function(){return CaptioningWrapper.__super__.listNotificationInterests.apply(this,arguments).concat([Notifications.MEDIA_CHANGE,FlashNotifications.CAPTIONING_REQUEST,FlashNotifications.CAPTION_LANG_CHANGE])};CaptioningWrapper.prototype.handleNotification=function(notification){var body,media,name,track,type;CaptioningWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.CAPTION_LANG_CHANGE:type="";break;case FlashNotifications.CAPTIONING_REQUEST:this.setHidden(!this.getHidden());type="visibilitychange";body=body.enabled;break;case Notifications.MEDIA_CHANGE:media=body;if(media.track!=null){track=Utils.selectTrack(media.track,"captions");if(((track!=null?track.src:void(0))!=null)&&track.src!=="")media.captioningUrl=track.src;media.captioningType=track.type||"application/ttml+xml"}};if((type!=null)&&type!=="")this.dispatchEvent(new Event(type,body))};CaptioningWrapper.prototype.getHidden=function(){return this.hidden};CaptioningWrapper.prototype.setHidden=function(value){this.hidden=value;return value};AMP.registerPlugin("captioning","flash",CaptioningWrapper);function PluginMediator(){PluginMediator.__super__.constructor.call(this)};__extends(PluginMediator,OverlayMediator);PluginMediator.prototype.initializeNotifier=function(key){PluginMediator.__super__.initializeNotifier.call(this,key);this.plugin=this.facade.retrieveProxy(ModuleProxy.NAME);this.media=this.facade.app.retrieveProxy(MediaProxy.NAME)};PluginMediator.prototype.onRegister=function(){PluginMediator.__super__.onRegister.call(this);this.facade.viewComponent=this.viewComponent};function CaptioningHTMLMediator(viewComponent){CaptioningHTMLMediator.__super__.constructor.call(this,null,null,viewComponent,null)};__extends(CaptioningHTMLMediator,ComponentMediator);CaptioningHTMLMediator.prototype.componentName="captioning-settings";CaptioningHTMLMediator.prototype.captioningObject={"default":{fontFamily:"Arial,sans-serif",size:"1.3em",fontColor:"rgba(255,255,255,1)",edgeType:null,edgeColor:"rgba(0, 0, 0, 0)",backgroundColor:"rgba(0,0,0,0)",windowColor:"rgba(0,0,0,0.5)"},appliedStyleText:"",selected:{fontFamily:null,size:null,fontColor:null,edgeType:null,edgeColor:null,backgroundColor:null,windowColor:null},preset1:{fontFamily:"Arial,sans-serif",size:"1.3em",fontColor:"rgba(255,255,255,1)",edgeType:null,edgeColor:"rgba(0, 0, 0, 0)",backgroundColor:"rgba(0,0,0,0)",windowColor:"rgba(0,0,0,0)"},preset2:{fontFamily:"Arial,sans-serif",size:"1.3em",fontColor:"rgba(255,255,0,1)",edgeType:null,edgeColor:"rgba(0, 0, 0, 0)",backgroundColor:"rgba(0,0,0,0)",windowColor:"rgba(0,0,0,0)"},preset3:{fontFamily:"Arial,sans-serif",size:"1.3em",fontColor:"rgba(255,255,255,1)",edgeType:null,edgeColor:"rgba(0, 0, 0, 0)",backgroundColor:"rgba(0,0,0,1)",windowColor:"rgba(0,0,0,0)"},preset4:{fontFamily:"Arial,sans-serif",size:"1.3em",fontColor:"rgba(255,255,0,1)",edgeType:null,edgeColor:"rgba(0, 0, 0, 1)",backgroundColor:"rgba(0,0,0,0)",windowColor:"rgba(0,0,0,0.5)"},instance:null};CaptioningHTMLMediator.prototype.captionText=null;CaptioningHTMLMediator.prototype.settingsUiVisible=false;CaptioningHTMLMediator.prototype.captionningStyle=null;CaptioningHTMLMediator.prototype.swatchColorCurr=null;CaptioningHTMLMediator.prototype.swatchOpacityCurr=null;CaptioningHTMLMediator.prototype.colorPicker=null;CaptioningHTMLMediator.prototype.colorPickerOpacity=null;CaptioningHTMLMediator.prototype.advancedSettingContainer=null;CaptioningHTMLMediator.prototype.list={font:null,language:null,edge:null,size:null,scroll:null};CaptioningHTMLMediator.prototype.picker={color:null,background:null,edge:null,window:null};CaptioningHTMLMediator.prototype.toggle={ON:null,OFF:null,disabled:false};CaptioningHTMLMediator.prototype.onRegister=function(){var applyButton,cancelButton,captionContainer,captionLabel,clonedSwatch,color,colorArray,isDefault,listOptions,preset1,preset2,preset3,preset4,previewContainer,previewPara,resetButton,swatch,titleBar,titleText,toggleAdvancedButton,_i,_len,_this=this;this.captionText=this.create("caption-text",this.viewComponent.parentElement);titleBar=this.create("captioning-titlebar");titleText=this.create("captioning-title",titleBar,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_TITLE));this.toggle.ON=this.create("captioning-toggle-btn",titleBar,"button","ON");this.toggle.OFF=this.create("captioning-toggle-btn",titleBar,"button","OFF");EventHandler.create(this.toggle.ON,EventHandler.CLICK,function(event){event.stopImmediatePropagation();if(!_this.toggle.disabled)_this.toggleButtonHandler(true);return false});if(!this.toggle.disabled)this.classList.add("captioning-floater-btnselected",this.toggle.OFF);EventHandler.create(this.toggle.OFF,EventHandler.CLICK,function(event){event.stopImmediatePropagation();if(!_this.toggle.disabled)_this.toggleButtonHandler(false);return false});captionContainer=this.create("captioning-row");captionLabel=this.create("captioning-label",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_LANGUAGE));this.list.language=this.create("captioning-dropdown",captionContainer,"select");this.languageListPopulate();EventHandler.create(this.list.language,"change",function(event){var langIsSelected;event.stopImmediatePropagation();langIsSelected=event.target.selectedValue!=="None";_this.sendNotification(CaptioningNotifications.VISIBILITY_CHANGE,langIsSelected);if(langIsSelected)_this.facade.moduleAPI.setTrack(_this.facade.moduleAPI.selectTrackByIndex(event.target.selectedIndex));return false});captionLabel=this.create("captioning-label",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_PRESETS));preset1=this.create(["captioning-preset","captioning-preset1"],captionContainer,null,"Aa");preset2=this.create(["captioning-preset","captioning-preset2"],captionContainer,null,"Aa");preset3=this.create(["captioning-preset","captioning-preset3"],captionContainer,null,"Aa");preset4=this.create(["captioning-preset","captioning-preset4"],captionContainer,null,"Aa");EventHandler.create(preset1,EventHandler.CLICK,function(event){event.stopImmediatePropagation();_this.captioningObject.selected=_this.cloneObject(_this.captioningObject.preset1);_this.applyCaptioningStyle();return false});EventHandler.create(preset2,EventHandler.CLICK,function(event){event.stopImmediatePropagation();_this.captioningObject.selected=_this.cloneObject(_this.captioningObject.preset2);_this.applyCaptioningStyle();return false});EventHandler.create(preset3,EventHandler.CLICK,function(event){event.stopImmediatePropagation();_this.captioningObject.selected=_this.cloneObject(_this.captioningObject.preset3);_this.applyCaptioningStyle();return false});EventHandler.create(preset4,EventHandler.CLICK,function(event){event.stopImmediatePropagation();_this.captioningObject.selected=_this.cloneObject(_this.captioningObject.preset4);_this.applyCaptioningStyle();return false});this.advancedSettingContainer=this.create("captioning-advanced-container");captionContainer=this.create("captioning-row",this.advancedSettingContainer);captionLabel=this.create("captioning-label",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_FONT));this.list.font=this.create("captioning-dropdown",captionContainer,"select");listOptions=this.create(null,this.list.font,"option","Arial");listOptions.value="Arial,sans-serif";this.create(null,this.list.font,"option","Times New Roman");this.create(null,this.list.font,"option","Courier");this.create(null,this.list.font,"option","Georgia");this.create(null,this.list.font,"option","Helvetica");this.create(null,this.list.font,"option","Verdana");this.create(null,this.list.font,"option","Impact");this.create(null,this.list.font,"option","Comic Sans Serif");this.create(null,this.list.font,"option","Times New Roman");EventHandler.create(this.list.font,"change",function(event){event.stopImmediatePropagation();_this.captioningObject.selected.fontFamily=event.target.value;_this.applyCaptioningStyle(false);return false});captionContainer.appendChild(this.list.font);captionLabel=this.create("captioning-label",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_EDGE));this.list.edge=this.create("captioning-dropdown",captionContainer,"select");this.create(null,this.list.edge,"option","none").value="none";this.create(null,this.list.edge,"option","Right drop shadow").value="text-shadow: 3px 3px 2px";this.create(null,this.list.edge,"option","Left drop shadow").value="text-shadow: -3px 3px 2px";this.create(null,this.list.edge,"option","Uniform").value="text-shadow: 0px 0px 4px";this.create(null,this.list.edge,"option","Raised").value="text-shadow: 0px 1px 1px";this.create(null,this.list.edge,"option","Depressed").value="text-shadow: 0px 1px 0px";EventHandler.create(this.list.edge,"change",function(event){event.stopImmediatePropagation();_this.captioningObject.selected.edgeType=event.target.value;_this.applyCaptioningStyle(false);return false});captionContainer=this.create("captioning-row",this.advancedSettingContainer);this.create("captioning-label",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_SIZE));this.list.size=this.create("captioning-dropdown",captionContainer,"select");this.create(null,this.list.size,"option","Small").value=".8em";this.create(null,this.list.size,"option","Medium").value="1.3em";this.create(null,this.list.size,"option","Large").value="2.3em";this.list.size.selectedIndex=1;EventHandler.create(this.list.size,"change",function(event){event.stopImmediatePropagation();_this.captioningObject.selected.size=event.target.value;_this.applyCaptioningStyle(false);return false});this.create("captioning-label",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_SCROLL));this.list.scroll=this.create("captioning-dropdown",captionContainer,"select");this.create(null,this.list.scroll,"option","Roll up");this.create(null,this.list.scroll,"option","Roll down");EventHandler.create(this.list.scroll,"change",function(event){event.stopImmediatePropagation();return false});captionContainer=this.create("captioning-row",this.advancedSettingContainer);this.create("captioning-label-small",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_COLOR));this.picker.color=this.create("captioning-color-picker",captionContainer);this.picker.color.style.backgroundColor=this.captioningObject["default"].fontColor;EventHandler.create(this.picker.color,EventHandler.CLICK,function(event){var alpha,_ref;event.stopImmediatePropagation();_this.colorPicker.style.display=_this.colorPicker.style.display==="block"?"none":"block";if(_this.colorPicker.style.display==="block"){if((_ref=_this.swatchColorCurr)!=null)_ref.style.borderColor="rgba(0,0,0,0.3)";_this.colorPicker.style.left="152px";_this.colorPicker.name="fontColor";_this.captioningObject.instance=_this.picker.color;if(_this.picker.color.style.backgroundColor.indexOf('rgba')!==-1)alpha=_this.picker.color.style.backgroundColor.replace(/^rgba?\(|\s+|\)$/g,'').split(',')[3];_this.colorPickerOpacity.value=alpha!=null?alpha:1};return false});this.create("captioning-label-small",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_BACKGROUND));this.picker.background=this.create("captioning-color-picker",captionContainer);this.picker.background.style.backgroundColor=this.captioningObject["default"].backgroundColor;EventHandler.create(this.picker.background,EventHandler.CLICK,function(event){var alpha,_ref;event.stopImmediatePropagation();_this.colorPicker.style.display=_this.colorPicker.style.display==="block"?"none":"block";if(_this.colorPicker.style.display==="block"){if((_ref=_this.swatchColorCurr)!=null)_ref.style.borderColor="rgba(0,0,0,0.3)";_this.colorPicker.style.left="264px";_this.colorPicker.name="backgroundColor";_this.captioningObject.instance=_this.picker.background;if(_this.picker.background.style.backgroundColor.indexOf('rgba')!==-1)alpha=_this.picker.background.style.backgroundColor.replace(/^rgba?\(|\s+|\)$/g,'').split(',')[3];_this.colorPickerOpacity.value=alpha!=null?alpha:1};return false});this.create("captioning-label-small",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_EDGE));this.picker.edge=this.create("captioning-color-picker",captionContainer);this.picker.edge.style.backgroundColor=this.captioningObject["default"].edgeColor;EventHandler.create(this.picker.edge,EventHandler.CLICK,function(event){var alpha,_ref;event.stopImmediatePropagation();_this.colorPicker.style.display=_this.colorPicker.style.display==="block"?"none":"block";if(_this.colorPicker.style.display==="block"){if((_ref=_this.swatchColorCurr)!=null)_ref.style.borderColor="rgba(0,0,0,0.3)";_this.colorPicker.style.left="212px";_this.colorPicker.name="edgeColor";_this.captioningObject.instance=_this.picker.edge;if(_this.picker.edge.style.backgroundColor.indexOf('rgba')!==-1)alpha=_this.picker.edge.style.backgroundColor.replace(/^rgba?\(|\s+|\)$/g,'').split(',')[3];_this.colorPickerOpacity.value=alpha!=null?alpha:1};return false});this.create("captioning-label-small",captionContainer,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_WINDOW));this.picker.window=this.create("captioning-color-picker",captionContainer);this.picker.window.style.backgroundColor=this.captioningObject["default"].windowColor;EventHandler.create(this.picker.window,EventHandler.CLICK,function(event){var alpha,_ref;event.stopImmediatePropagation();_this.colorPicker.style.display=_this.colorPicker.style.display==="block"?"none":"block";if(_this.colorPicker.style.display==="block"){if((_ref=_this.swatchColorCurr)!=null)_ref.style.borderColor="rgba(0,0,0,0.3)";_this.colorPicker.style.left="300px";_this.colorPicker.name="windowColor";_this.captioningObject.instance=_this.picker.window;if(_this.picker.window.style.backgroundColor.indexOf('rgba')!==-1)alpha=_this.picker.window.style.backgroundColor.replace(/^rgba?\(|\s+|\)$/g,'').split(',')[3];_this.colorPickerOpacity.value=alpha!=null?alpha:1};return false});previewContainer=this.create(["caption-text","caption-text-preview"]);previewPara=this.create(null,previewContainer,"p","Lorem ipsum dolor sit amet");captionContainer=this.create("captioning-footer-container");applyButton=this.create("captioning-footer-button",captionContainer,"button",this.localizationManager.getString(LocalizationConstants.MSG_CC_APPLY));cancelButton=this.create("captioning-footer-button",captionContainer,"button",this.localizationManager.getString(LocalizationConstants.MSG_CC_CANCEL));resetButton=this.create("captioning-footer-button",captionContainer,"button",this.localizationManager.getString(LocalizationConstants.MSG_CC_RESET));if(this.facade.app.getViewComponent().clientWidth>450){toggleAdvancedButton=this.create("captioning-advanced-button",captionContainer,"button",this.localizationManager.getString(LocalizationConstants.MSG_CC_SHOW_ADVANCED));EventHandler.create(toggleAdvancedButton,EventHandler.CLICK,function(event){event.stopImmediatePropagation();if(_this.advancedSettingContainer.style.display==="block"){event.target.innerHTML=_this.localizationManager.getString(LocalizationConstants.MSG_CC_SHOW_ADVANCED);_this.advancedSettingContainer.style.display="none";_this.colorPicker.style.display="none"}else{event.target.innerHTML=_this.localizationManager.getString(LocalizationConstants.MSG_CC_HIDE_ADVANCED);_this.advancedSettingContainer.style.display="block"};return false})};EventHandler.create(applyButton,EventHandler.CLICK,function(event){event.stopImmediatePropagation();try{localStorage.setItem(Namespace.PREFIX+"captioningDefault",JSON.stringify(_this.captioningObject.selected))}catch(localStorageError){_this.facade.logger.error("LocalStorage Not Supported on this Browser",localStorageError)};_this.sendNotification(CaptioningNotifications.SETTINGS_VISIBILITY_CHANGE,_this.settingsUiVisible);_this.applyCaptioningStyle(false,true);_this.sendNotification(CaptioningNotifications.SETTINGS_CHANGE,_this.captioningObject.selected);return false});EventHandler.create(cancelButton,EventHandler.CLICK,function(event){event.stopImmediatePropagation();_this.sendNotification(CaptioningNotifications.SETTINGS_VISIBILITY_CHANGE,_this.settingsUiVisible);return false});EventHandler.create(resetButton,EventHandler.CLICK,function(event){event.stopImmediatePropagation();_this.colorPicker.style.display="none";_this.applyCaptioningStyle(true);return false});this.captionningStyle=this.create(null,document.getElementsByTagName('head')[0],"style");this.captionningStyle.type='text/css';colorArray=["#000000","#660000","#990000","#ff0000","#000066","#660066","#990066","#ff0066","#006600","#666600","#996600","#ff6600","#006666","#666666","#996666","#ff6666","#009900","#669966","#999900","#ff9900","#009966","#669966","#999966","#ff9966","#00ff00","#66ff00","#99ff00","#ffff00","#00ff66","#66ff66","#99ff66","#ffff66","#000099","#660099","#990099","#ff0099","#0000ff","#6600ff","#9900ff","#ff00ff","#006699","#666699","#996699","#ff6699","#0066ff","#6666ff","#9966ff","#ff66ff","#009999","#669999","#999999","#ff9999","#0099ff","#6699ff","#9999ff","#ff99ff","#0099ff","#66ff99","#99ff99","#ffff99","#00ffff","#66ffff","#99ffff","#ffffff"];this.colorPicker=this.create("colorpicker-palette",this.viewComponent.parentElement);swatch=this.create("colorpicker-swatch",false,null,"&nbsp;");for(_i=0,_len=colorArray.length;_i<_len;_i++){color=colorArray[_i];swatch.style.backgroundColor=color;clonedSwatch=swatch.cloneNode();EventHandler.create(clonedSwatch,EventHandler.CLICK,function(event){event.stopImmediatePropagation();if(_this.swatchColorCurr!==null)_this.swatchColorCurr.style.borderColor="rgba(0,0,0,0.3)";_this.swatchColorCurr=event.target;_this.swatchColorCurr.style.borderColor="rgba(255, 50, 50, 1)";_this.captioningObject.instance.style.backgroundColor=_this.captioningObject.selected[_this.colorPicker.name]=_this.toRGBA(event.target.style.backgroundColor);_this.applyCaptioningStyle(false);return false});this.colorPicker.appendChild(clonedSwatch)};this.create("opacity-label",this.colorPicker,"span",this.localizationManager.getString(LocalizationConstants.MSG_CC_OPACITY));this.colorPickerOpacity=this.create("colorpicker-slider",this.colorPicker,"input");this.colorPickerOpacity.type="range";this.colorPickerOpacity.min=0;this.colorPickerOpacity.max=1;this.colorPickerOpacity.step=.1;this.colorPickerOpacity.value=1;EventHandler.create(this.colorPickerOpacity,"change",function(event){event.stopImmediatePropagation();_this.captioningObject.instance.style.backgroundColor=_this.captioningObject.selected[_this.colorPicker.name]=_this.toRGBA(_this.captioningObject.instance.style.backgroundColor);_this.applyCaptioningStyle(false);return false});this.swatchOpacityCurr=this.colorPickerOpacity;EventHandler.create(document,EventHandler.CLICK,function(event){event.stopImmediatePropagation();if(event.target.className!=="akamai-colorpicker-palette"&&event.target.className!=="akamai-opacity-label"&&event.target.className!=="akamai-colorpicker-slider"&&_this.colorPicker.style.display!=="none")_this.colorPicker.style.display="none";return false});if(localStorage.getItem(Namespace.PREFIX+"captioningDefault")!=null){this.captioningObject.selected=JSON.parse(localStorage.getItem(Namespace.PREFIX+"captioningDefault"));this.applyCaptioningStyle(false)}else{isDefault=!((this.facade.config.style!=null)||this.facade.config.style!=="undefined");if(!isDefault)this.captioningObject.selected=this.cloneObject(this.facade.config.style);this.applyCaptioningStyle(isDefault)};CaptioningHTMLMediator.__super__.onRegister.call(this)};CaptioningHTMLMediator.prototype.toRGBA=function(colorCode){var rbga,rgb;rgb=colorCode.replace(/^rgba?\(|\s+|\)$/g,'').split(',');rbga='rgba('+rgb[0]+","+rgb[1]+","+rgb[2]+","+this.swatchOpacityCurr.value+')';return rbga};CaptioningHTMLMediator.prototype.languageListPopulate=function(){var language,track,tracks,_i,_len,_ref;tracks=(_ref=this.facade.moduleAPI)!=null?_ref.getTracks():void(0);if(!(tracks!=null))return;this.list.language.innerHTML="";for(_i=0,_len=tracks.length;_i<_len;_i++){track=tracks[_i];language=track.language;language=this.facade.app.retrieveProxy(LocalizationProxy.NAME).getLanguageString(language);if((language!=null)&&language!=="")this.create(null,this.list.language,"option",language)};this.toggle.disabled=this.list.language.childElementCount===0;if(this.toggle.disabled)this.create(null,this.list.language,"option","None")};CaptioningHTMLMediator.prototype.cloneObject=function(clone){var cloned,key;cloned={};for(key in clone)cloned[key]=clone[key];return cloned};CaptioningHTMLMediator.prototype.applyCaptioningStyle=function(isDefault,isApply){var backgroundColor,color,edgeType,fontFamily,fontSize,windowColor;if(isDefault==null)isDefault=false;if(isApply==null)isApply=false;if(isDefault){this.captioningObject.selected=this.cloneObject(this.captioningObject["default"]);this.list.font.value=this.captioningObject["default"].fontFamily;this.list.edge.value=this.captioningObject["default"].edgeType!=null?this.captioningObject["default"].edgeType:"none";this.list.size.value=this.captioningObject["default"].size;this.picker.color.style.backgroundColor=this.captioningObject["default"].fontColor;this.picker.background.style.backgroundColor=this.captioningObject["default"].backgroundColor;this.picker.edge.style.backgroundColor=this.captioningObject["default"].edgeColor;this.picker.window.style.backgroundColor=this.captioningObject["default"].windowColor}else{if(this.captioningObject.selected.fontFamily!=null)this.list.font.value=this.captioningObject.selected.fontFamily;this.list.edge.value=this.captioningObject.selected.edgeType!=null?this.captioningObject.selected.edgeType:"none";if(this.captioningObject.selected.size!=null)this.list.size.value=this.captioningObject.selected.size;this.picker.color.style.backgroundColor=this.captioningObject.selected.fontColor;if(this.captioningObject.selected.backgroundColor!=null)this.picker.background.style.backgroundColor=this.captioningObject.selected.backgroundColor;if(this.captioningObject.selected.edgeColor!=null)this.picker.edge.style.backgroundColor=this.captioningObject.selected.edgeColor;if(this.captioningObject.selected.windowColor!=null)this.picker.window.style.backgroundColor=this.captioningObject.selected.windowColor};fontFamily="font-family: "+(isDefault?this.captioningObject["default"].fontFamily:this.list.font.value)+" ;";edgeType=(isDefault?this.captioningObject["default"].edgeType+this.captioningObject["default"].edgeColor:this.list.edge.value+" "+this.picker.edge.style.backgroundColor)+";";fontSize="font-size: "+(isDefault?this.captioningObject["default"].size:this.list.size.value)+" ;";color="color: "+(isDefault?this.captioningObject["default"].fontColor:this.picker.color.style.backgroundColor)+" ;";backgroundColor="background-color: "+(isDefault?this.captioningObject["default"].backgroundColor:this.picker.background.style.backgroundColor)+" ;";windowColor="background-color: "+(isDefault?this.captioningObject["default"].windowColor:this.picker.window.style.backgroundColor)+" ;";if(isApply){this.captionningStyle.innerHTML=this.captioningObject.appliedStyleText='.akamai-caption-text { '+fontFamily+fontSize+edgeType+windowColor+' }.akamai-caption-text p { '+color+backgroundColor+' }'}else this.captionningStyle.innerHTML=this.captioningObject.appliedStyleText+'.akamai-caption-text-preview { '+fontFamily+fontSize+edgeType+windowColor+' }.akamai-caption-text-preview p { '+color+backgroundColor+' }'};CaptioningHTMLMediator.prototype.toggleButtonHandler=function(isON){if(isON==null)isON=false;if(isON){this.classList.add("captioning-floater-btnselected",this.toggle.ON);this.classList.remove("captioning-floater-btnselected",this.toggle.OFF)}else{this.classList.add("captioning-floater-btnselected",this.toggle.OFF);this.classList.remove("captioning-floater-btnselected",this.toggle.ON)};this.sendNotification(CaptioningNotifications.VISIBILITY_CHANGE,isON);this.sendNotification(UserSettingsNotifications.UPDATE_SETTINGS,{captioning:{hidden:!isON}})};CaptioningHTMLMediator.prototype.listNotificationInterests=function(){return[CaptioningNotifications.CUE_CHANGE,CaptioningNotifications.SETTINGS_VISIBILITY_CHANGE,CaptioningNotifications.TOGGLE_SETTINGS_VISIBILITY,CaptioningNotifications.SETTINGS_CHANGE]};CaptioningHTMLMediator.prototype.handleNotification=function(notification){var body,captions,cue,name,note,state,_i,_len;name=notification.getName();body=notification.getBody();switch(name){case CaptioningNotifications.CUE_CHANGE:captions="";for(_i=0,_len=body.length;_i<_len;_i++){cue=body[_i];captions+=cue.html};this.captionText.innerHTML=captions;break;case CaptioningNotifications.SETTINGS_VISIBILITY_CHANGE:case CaptioningNotifications.TOGGLE_SETTINGS_VISIBILITY:if(this.settingsUiVisible)this.colorPicker.style.display="none";this.settingsUiVisible=!this.settingsUiVisible;if(this.settingsUiVisible&&this.list.language.length===1)this.languageListPopulate();note=this.settingsUiVisible?Notifications.ADD_APPLICATION_STATE:Notifications.REMOVE_APPLICATION_STATE;state="cc-setting-active";this.sendNotification(note,state);break;case CaptioningNotifications.SETTINGS_CHANGE:this.captioningObject.selected=body;this.applyCaptioningStyle(false,true)}};function LiveCaptionProxy(){var com,_this=this;this.captions=[];this.head=document.getElementsByTagName("head")[0];com=window.com||{};com.akamai=com.akamai||{};com.akamai.amp=com.akamai.amp||{};com.akamai.amp.plugins=com.akamai.amp.plugins||{};com.akamai.amp.plugins.subply=com.akamai.amp.plugins.subply||{};com.akamai.amp.plugins.subply.response=function(json){_this.parse(json);_this.poll()};if(!(window.com!=null))window.com=com;LiveCaptionProxy.__super__.constructor.call(this,this.constructor.NAME)};__extends(LiveCaptionProxy,puremvc.Proxy);LiveCaptionProxy.NAME="LiveCaptionProxy";LiveCaptionProxy.prototype.data={base:"http://test.plymedia.com.s3.amazonaws.com/online/Akamai_",interval:1e3};LiveCaptionProxy.prototype.caption=null;LiveCaptionProxy.prototype.head=null;LiveCaptionProxy.prototype.script=null;LiveCaptionProxy.prototype.timeout=null;LiveCaptionProxy.prototype.getURL=function(){return this.data.url};LiveCaptionProxy.prototype.setURL=function(value){this.data.url=value;return value};LiveCaptionProxy.prototype.start=function(){this.send()};LiveCaptionProxy.prototype.poll=function(){var timeout,_this=this;timeout=setTimeout(function(){_this.send()},this.data.interval||1e3)};LiveCaptionProxy.prototype.send=function(){if(this.script!=null)this.head.removeChild(this.script);this.script=Utils.loadScript(this.data.base+this.data.url+".js?nocache="+Date.now())};LiveCaptionProxy.prototype.stop=function(){clearTimeout(timeout)};LiveCaptionProxy.prototype.parse=function(response){var html,text,_i,_len,_ref;if(response.Stream!==this.data.url)return;if((this.caption!=null)&&this.caption.id>=response.Ticks)return;this.caption=new CaptionCue(Utils.flattenTimecode(response.From),Utils.flattenTimecode(response.To),response.Ticks);this.caption.text=response.Text;html="";_ref=response.Text.split("\n");for(_i=0,_len=_ref.length;_i<_len;_i++){text=_ref[_i];if(html!=="")html+="<br />";html+="<span>"+text+"</span>"};this.caption.html="<p>"+html+"</p>";this.sendNotification(CaptioningNotifications.CUE_CHANGE,[this.caption]);return this.caption};function CaptioningNativeMediator(viewComponent){CaptioningNativeMediator.__super__.constructor.call(this,CaptioningNativeMediator.NAME,viewComponent)};__extends(CaptioningNativeMediator,LocalizedMediator);CaptioningNativeMediator.NAME="CaptioningNativeMediator";CaptioningNativeMediator.prototype.video=null;CaptioningNativeMediator.prototype.index=-1;CaptioningNativeMediator.prototype.plugin=null;CaptioningNativeMediator.prototype.onRegister=function(){this.video=this.facade.app.video;this.plugin=this.facade.retrieveProxy(CaptioningProxy.NAME)};CaptioningNativeMediator.prototype.listNotificationInterests=function(){return[CaptioningNotifications.VISIBILITY_CHANGE,CaptioningNotifications.TRACK_SELECTED,CaptioningNotifications.TRACKS_LOADED]};CaptioningNativeMediator.prototype.handleNotification=function(notification){var body,cue,textTrack,textTrackCue,track,_i,_j,_len,_len1,_ref;body=notification.getBody();switch(notification.getName()){case CaptioningNotifications.TRACKS_LOADED:for(_i=0,_len=body.length;_i<_len;_i++){track=body[_i];if(!(track.kind==="captions"||track.kind==="subtitles"))continue;textTrack=this.video.addTextTrack(track.kind,track.label,track.srclang);_ref=track.cues;for(_j=0,_len1=_ref.length;_j<_len1;_j++){cue=_ref[_j];textTrackCue=new TextTrackCue(cue.startTime,cue.endTime,cue.text);cue.id=cue.id;textTrack.addCue(textTrackCue)}};break;case CaptioningNotifications.TRACK_SELECTED:if(this.index>-1)this.video.textTracks[this.index].mode="hidden";this.index=this.plugin.getTracks().indexOf(body);if(!this.plugin.getHidden())this.video.textTracks[this.index].mode="showing";break;case CaptioningNotifications.VISIBILITY_CHANGE:this.video.textTracks[this.index].mode=this.plugin.getHidden()?"hidden":"showing"}};function CaptioningTimeUpdateCommand(){CaptioningTimeUpdateCommand.__super__.constructor.call(this)};__extends(CaptioningTimeUpdateCommand,puremvc.SimpleCommand);CaptioningTimeUpdateCommand.prototype.execute=function(notification){var active,changed,cue,cues,index,proxy,time,track,_i,_len;time=notification.getBody();proxy=this.facade.retrieveProxy(CaptioningProxy.NAME);track=proxy.getTrack();if(!(track!=null))return;active=track.activeCues;cues=track.cues;changed=false;for(_i=0,_len=cues.length;_i<_len;_i++){cue=cues[_i];if(time>=cue.startTime&&time<cue.endTime){if(!(__indexOf.call(active,cue)>=0)){active.push(cue);changed=true}}else{index=active.indexOf(cue);if(index!==-1){active.splice(index,1);changed=true}}};if(changed===true)this.sendNotification(CaptioningNotifications.CUE_CHANGE,active)};function CaptioningChangeMediaCommand(){CaptioningChangeMediaCommand.__super__.constructor.call(this)};__extends(CaptioningChangeMediaCommand,puremvc.SimpleCommand);CaptioningChangeMediaCommand.prototype.execute=function(notification){var media,proxy;media=notification.getBody();proxy=this.facade.retrieveProxy(CaptioningProxy.NAME);if(media.track!=null)proxy.setTracks(media.track);if(media.track!=null)this.sendNotification(CaptioningNotifications.ENABLED,true)};function CaptioningVisibilityChangeCommand(){CaptioningVisibilityChangeCommand.__super__.constructor.call(this)};__extends(CaptioningVisibilityChangeCommand,puremvc.SimpleCommand);CaptioningVisibilityChangeCommand.prototype.execute=function(notification){var configProxy;configProxy=this.facade.retrieveProxy(CaptioningProxy.NAME);configProxy.setHidden(!notification.getBody())};var UserSettingsNotifications={SETTING_CHANGE:"settingchange",UPDATE_SETTINGS:"updatesettings"};function CaptioningStartedCommand(){CaptioningStartedCommand.__super__.constructor.call(this)};__extends(CaptioningStartedCommand,puremvc.SimpleCommand);CaptioningStartedCommand.prototype.execute=function(notification){var proxy,track,_ref;this.facade.logger.debug("CaptioningStartedCommand");proxy=this.facade.retrieveProxy(CaptioningProxy.NAME);track=proxy.getTrack();if(!(track!=null)&&((_ref=proxy.getTracks())!=null?_ref.length:void(0))>0)track=proxy.autoSelectTrack();if((track!=null?track.isLive:void(0))===true){this.facade.removeCommand(Notifications.TIME_UPDATE);proxy=this.facade.retrieveProxy(LiveCaptionProxy.NAME);if(!(proxy!=null)){proxy=new LiveCaptionProxy();this.facade.registerProxy(proxy)};proxy.setURL(track.src);proxy.start()}};function CaptioningMediator(viewComponent){CaptioningMediator.__super__.constructor.call(this,viewComponent)};__extends(CaptioningMediator,PluginMediator);CaptioningMediator.prototype.componentName="captioning";CaptioningMediator.prototype.captionButton=null;CaptioningMediator.prototype.onRegister=function(){var button;button=new ButtonMediator(this.localizationManager.getString(LocalizationConstants.MSG_CC),this.viewComponent,null,"caption",this.onclick.bind(this));this.facade.registerMediator(button);this.captionButton=button.getViewComponent();this.sendNotification(Notifications.ADD_CONTROL,this.captionButton);CaptioningMediator.__super__.onRegister.call(this)};CaptioningMediator.prototype.onclick=function(event){event.stopImmediatePropagation();if(this.plugin.getTrack().type==="embedded"){this.sendNotification(CaptioningNotifications.VISIBILITY_CHANGE,this.plugin.getHidden())}else if(event.currentTarget===this.captionButton)this.sendNotification(CaptioningNotifications.SETTINGS_VISIBILITY_CHANGE,this.plugin.getHidden());return false};CaptioningMediator.prototype.listNotificationInterests=function(){return[CaptioningNotifications.VISIBILITY_CHANGE,CaptioningNotifications.ENABLED,CaptioningNotifications.TRACK_SELECTED]};CaptioningMediator.prototype.handleNotification=function(notification){var body,note,state;body=notification.getBody();note=body?Notifications.ADD_APPLICATION_STATE:Notifications.REMOVE_APPLICATION_STATE;switch(notification.getName()){case CaptioningNotifications.TRACK_SELECTED:state="cc-embedded";note=body.type==="embedded"?Notifications.ADD_APPLICATION_STATE:Notifications.REMOVE_APPLICATION_STATE;break;case CaptioningNotifications.VISIBILITY_CHANGE:state="cc-active";break;case CaptioningNotifications.ENABLED:note=body?Notifications.ADD_CONTROL_STATE:Notifications.REMOVE_CONTROL_STATE;state="cc-enabled"};this.sendNotification(note,state)};CaptionParsers={"application/ttml+xml":new SMPTETTParser(),"application/x-subrip":new SRTParser(),undefined:new SMPTETTParser()};var CaptioningNotifications={VISIBILITY_CHANGE:"captioningvisibilitychange",ENABLED:"captioningEnabled",TRACKS_LOADED:"captioningTracksLoaded",TRACK_SELECTED:"captioningTrackSelected",CUE_CHANGE:"captioningCueChange",SETTINGS_VISIBILITY_CHANGE:"captioningsettingsvisibility",TOGGLE_SETTINGS_VISIBILITY:"togglesettingsvisibility",SETTINGS_CHANGE:"captioningsettingschange"};function CaptionTrack(track,onload){var xhr,_this=this;this.kind=track.kind;this.type=track.type;this.src=track.src;this.language=track.srclang;this.label=track.label||this.srclang||this.kind;this.cues=track.cues||[];this.styles=track.styles||{};this.activeCues=[];this.isLive=/live-subply/.test(this.type);if((this.src!=null)&&this.src!==""&&!this.isLive){xhr=Utils.get(this.src,{onload:function(){try{CaptionParsers[_this.type].parse(_this,xhr.response)}catch(error){Logger.error("Could not parse caption track: "+_this.src);return};if(typeof onload==="function")onload()},onerror:function(){Logger.error("Could not load caption track: "+_this.src)}})}else setTimeout(onload,1)};CaptionTrack.prototype.kind=null;CaptionTrack.prototype.src=null;CaptionTrack.prototype.language=null;CaptionTrack.prototype.cues=null;CaptionTrack.prototype.label=null;CaptionTrack.prototype.activeCues=null;CaptionTrack.prototype.type=null;CaptionTrack.prototype.styles=null;CaptionTrack.prototype.isLive=false;function OmnitureProxy(config){OmnitureProxy.__super__.constructor.call(this,config)};__extends(OmnitureProxy,PluginProxy);OmnitureProxy.NAME=ModuleProxy.NAME;OmnitureProxy.prototype.defaults={plugin:null,account:null,playerName:null,mediaName:null,main:"s"};OmnitureProxy.prototype.media=null;OmnitureProxy.prototype.started=false;OmnitureProxy.prototype.video=null;OmnitureProxy.prototype.ads=null;OmnitureProxy.prototype.getLoaded=function(){return window[this.getConfigurationData().main]!=null};OmnitureProxy.prototype.getScript=function(){return this.getConfigurationData().plugin};OmnitureProxy.prototype.getMedia=function(){return this.media};OmnitureProxy.prototype.setMedia=function(value){this.started=false;return this.media=value};OmnitureProxy.prototype.getMediaName=function(){return this.getConfigurationData().mediaName||this.media.title};OmnitureProxy.prototype.initialize=function(){var _ref;OmnitureProxy.__super__.initialize.call(this);if(this.plugin!=null){try{if(!(this.plugin.Media!=null))this.plugin.loadModule("Media")}catch(error){this.error("initialize",error)};if(((_ref=this.plugin.Media)!=null?_ref.openAd:void(0))!=null){this.ads=new OmnitureAdProxy(this);this.facade.registerProxy(this.ads);this.facade.registerCommand(AdNotifications.AD_LOADED,OmnitureAdLoadedCommand);this.facade.registerCommand(AdNotifications.AD_STARTED,OmnitureAdStartedCommand);this.facade.registerCommand(AdNotifications.AD_PLAY,OmnitureAdPlayCommand);this.facade.registerCommand(AdNotifications.AD_PAUSE,OmnitureAdPauseCommand);this.facade.registerCommand(AdNotifications.AD_TIME_REMAINING,OmnitureAdTimeRemainingCommand);this.facade.registerCommand(AdNotifications.BREAK_END,OmnitureAdBreakEndCommand)};this.video=this.facade.app.getVideo()}};OmnitureProxy.prototype.createPlugin=function(){return window[this.getConfigurationData().main]};OmnitureProxy.prototype.start=function(){try{this.plugin.Media.open(this.getMediaName(),this.video.duration,this.getConfigurationData().playerName);this.started=true}catch(error){this.error(error)}};OmnitureProxy.prototype.play=function(){if(this.started!==true)this.start();try{this.plugin.Media.play(this.getMediaName(),this.video.currentTime||0)}catch(error){this.error(error)}};OmnitureProxy.prototype.pause=function(){try{this.plugin.Media.stop(this.getMediaName(),this.video.currentTime)}catch(error){this.error(error)}};OmnitureProxy.prototype.seeking=function(){try{this.plugin.Media.stop(this.getMediaName(),this.video.currentTime)}catch(error){this.error(error)}};OmnitureProxy.prototype.seeked=function(){try{this.plugin.Media.play(this.getMediaName(),this.video.currentTime)}catch(error){this.error(error)}};OmnitureProxy.prototype.ended=function(){try{this.plugin.Media.stop(this.getMediaName(),this.video.currentTime);this.plugin.Media.close(this.getMediaName());this.started=false}catch(error){this.error(error)}};function CaptioningProxy(config){this.activeCaptions=[];this.providers={};this.tracks=[];CaptioningProxy.__super__.constructor.call(this,config)};__extends(CaptioningProxy,PluginProxy);CaptioningProxy.NAME=ModuleProxy.NAME;CaptioningProxy.prototype.defaults={};CaptioningProxy.prototype.hidden=true;CaptioningProxy.prototype.tracks=null;CaptioningProxy.prototype.track=null;CaptioningProxy.prototype.activeCaptions=null;CaptioningProxy.prototype.captions=null;CaptioningProxy.prototype.loaded=true;CaptioningProxy.prototype.useNative=function(){var _ref;return(this.facade.app.video.textTracks!=null)&&((_ref=window.TextTrackCue)!=null?_ref.length:void(0))===3};CaptioningProxy.prototype.getTracks=function(){return this.tracks};CaptioningProxy.prototype.setTracks=function(value){var count,item,loaded,track,trackLoaded,_i,_len,_this=this;this.tracks=[];this.track=null;count=value.length;loaded=0;trackLoaded=function(){loaded++;if(loaded===count){_this.sendNotification(CaptioningNotifications.TRACKS_LOADED,_this.tracks);_this.autoSelectTrack()}};for(_i=0,_len=value.length;_i<_len;_i++){item=value[_i];track=new CaptionTrack(item,trackLoaded);this.tracks.push(track)};return value};CaptioningProxy.prototype.getTrack=function(){return this.track};CaptioningProxy.prototype.setTrack=function(value){this.track=value;this.captions=this.track.cues;this.activeCaptions=[];this.sendNotification(CaptioningNotifications.TRACK_SELECTED,this.track);return value};CaptioningProxy.prototype.selectTrackByIndex=function(index){var track;if((0<=index&&index<this.tracks.length)){track=this.tracks[index];this.setTrack(track)};return track};CaptioningProxy.prototype.selectTrackByLanguage=function(lang){var item,track,_i,_len,_ref;_ref=this.tracks;for(_i=0,_len=_ref.length;_i<_len;_i++){item=_ref[_i];if(!(item.language===lang))continue;track=item;break};if(track!=null)this.setTrack(track);return track};CaptioningProxy.prototype.getHidden=function(){return this.hidden};CaptioningProxy.prototype.setHidden=function(value){this.hidden=value;return value};CaptioningProxy.prototype.autoSelectTrack=function(){var lang,track,_ref;lang=(_ref=this.facade.app.retrieveProxy(LocalizationProxy.NAME))!=null?_ref.getLanguage():void(0);if(lang!=null){lang=lang.split("-").shift();track=this.selectTrackByLanguage(lang)};if(!(track!=null)){track=this.tracks[0];this.setTrack(track)};return track};function ComscorePlugin(app,config){ComscorePlugin.__super__.constructor.call(this,app,config)};__extends(ComscorePlugin,Plugin);ComscorePlugin.NAME="ComscorePlugin";ComscorePlugin.prototype.moduleName="comscore";ComscorePlugin.prototype.createController=function(){this.registerCommand(Notifications.STARTED,ComscoreStartCommand);this.registerCommand(Notifications.CONTENT_CHANGED,ComscoreStartCommand);this.registerCommand(AdNotifications.AD_STARTED,ComscoreAdStartCommand)};ComscorePlugin.prototype.createModel=function(){this.registerProxy(new ComscoreProxy(this.config))};ComscorePlugin.prototype.listNotificationInterests=function(){return[Notifications.STARTED,AdNotifications.AD_STARTED,Notifications.CONTENT_CHANGED]};AMP.registerPlugin("comscore","html",ComscorePlugin);AMP.registerPlugin("comscore","flash",ComscoreWrapper);function CaptioningAPI(module){var proxy;CaptioningAPI.__super__.constructor.call(this,module);proxy=module.retrieveProxy(CaptioningProxy.NAME);this.getHidden=proxy.getHidden.bind(proxy);this.setHidden=function(value){module.sendNotification(CaptioningNotifications.VISIBILITY_CHANGE,!value);return value};this.getTracks=proxy.getTracks.bind(proxy);this.getTrack=proxy.getTrack.bind(proxy);this.setTrack=proxy.setTrack.bind(proxy);this.selectTrackByIndex=proxy.selectTrackByIndex.bind(proxy);this.selectTrackByLanguage=proxy.selectTrackByLanguage.bind(proxy);this.changeSettings=function(object){module.sendNotification(CaptioningNotifications.SETTINGS_CHANGE,object);return object}};__extends(CaptioningAPI,PluginAPI);CaptioningAPI.prototype.getHidden=function(){};CaptioningAPI.prototype.setHidden=function(value){};CaptioningAPI.prototype.getTracks=function(){};CaptioningAPI.prototype.getTrack=function(){};CaptioningAPI.prototype.setTrack=function(value){};CaptioningAPI.prototype.selectTrackByIndex=function(index){};CaptioningAPI.prototype.selectTrackByLanguage=function(lang){};CaptioningAPI.prototype.changeSettings=function(object){};function OmniturePlugin(app,config){OmniturePlugin.__super__.constructor.call(this,app,config)};__extends(OmniturePlugin,Plugin);OmniturePlugin.NAME="OmniturePlugin";OmniturePlugin.prototype.moduleName="omniture";OmniturePlugin.prototype.createController=function(){this.registerCommand(Notifications.CHANGE_MEDIA,OmnitureChangeMediaCommand);this.registerCommand(Notifications.ENDED,OmnitureEndedCommand);this.registerCommand(Notifications.STARTED,OmnitureStartCommand);this.registerCommand(Notifications.PAUSE,OmniturePauseCommand);this.registerCommand(Notifications.SEEKING,OmnitureSeekingCommand);this.registerCommand(Notifications.SEEKED,OmnitureSeekedCommand);this.registerCommand(Notifications.CHANGE_CONTENT,OmnitureEndedCommand);this.registerCommand(Notifications.CONTENT_CHANGED,OmnitureContentChangedCommand)};OmniturePlugin.prototype.createModel=function(){this.registerProxy(new OmnitureProxy(this.config))};OmniturePlugin.prototype.listNotificationInterests=function(){return[Notifications.CHANGE_MEDIA,Notifications.CHANGE_CONTENT,Notifications.CONTENT_CHANGED,Notifications.TIME_UPDATE,Notifications.ENDED,Notifications.STARTED,Notifications.PLAY,Notifications.PAUSE,Notifications.SEEKING,Notifications.SEEKED,AdNotifications.AD_LOADED,AdNotifications.AD_STARTED,AdNotifications.AD_PLAY,AdNotifications.AD_PAUSE,AdNotifications.AD_TIME_REMAINING,AdNotifications.BREAK_END]};AMP.registerPlugin("omniture","html",OmniturePlugin);AMP.registerPlugin("omniture","flash",OmnitureWrapper);function InfoWrapper(player,config){if(config==null)config={};InfoWrapper.__super__.constructor.call(this,player,config)};__extends(InfoWrapper,PluginWrapper);InfoWrapper.NAME="InfoWrapper";InfoWrapper.prototype.listNotificationInterests=function(){return[FlashNotifications.CREATE_FLASH_VARS,FlashNotifications.CREATE_XML,FlashNotifications.SHARE,FlashNotifications.SHARE_REQUEST]};InfoWrapper.prototype.handleNotification=function(notification){var application,body,data,element,elements,flashvars,info,name,property,provider,text,type,view,xml,_i,_len;name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.CREATE_FLASH_VARS:flashvars=body.flashvars;break;case FlashNotifications.CREATE_XML:xml=body.xml;application=xml.getElementsByTagName("application")[0];view=xml.getElementsByTagName("view")[0];elements=xml.getElementsByTagName("element");for(_i=0,_len=elements.length;_i<_len;_i++){element=elements[_i];if(!(element.getAttribute("id")==="infoOverlayAdvanced"))continue;info=element;break};if(!(view!=null))return;if(!(info!=null)){info=xml.createElement("element");info.setAttribute("id","infoOverlayAdvanced");info.setAttribute("displayStates","preplay,paused,ns,fs,mouseover");view.insertBefore(info,view.childNodes[0])};data=xml.createElement("data");info.appendChild(data);if(this.config.title!=null){property=xml.createElement("property");property.setAttribute("key","title");text=XMLUtils.createTextContent(xml,this.config.title);property.appendChild(text);data.appendChild(property)};if(this.config.description!=null){property=xml.createElement("property");property.setAttribute("key","description");text=XMLUtils.createTextContent(xml,this.config.description);property.appendChild(text);data.appendChild(property)};if(this.config.more!=null){property=xml.createElement("property");property.setAttribute("key","more");text=XMLUtils.createTextContent(xml,this.config.more);property.appendChild(text);data.appendChild(property)};if(this.config.less!=null){property=xml.createElement("property");property.setAttribute("key","less");text=XMLUtils.createTextContent(xml,this.config.less);property.appendChild(text);data.appendChild(property)};if(this.config.provider!=null){provider=xml.createElement("property");provider.setAttribute("key","provider");data.appendChild(provider);if(this.config.provider.name!=null){property=xml.createElement("property");property.setAttribute("key","name");text=XMLUtils.createTextContent(xml,this.config.provider.name);property.appendChild(text);provider.appendChild(property)};if(this.config.provider.image!=null){property=xml.createElement("property");property.setAttribute("key","image");text=XMLUtils.createTextContent(xml,this.config.provider.image);property.appendChild(text);provider.appendChild(property)}};break;case FlashNotifications.SHARE:case FlashNotifications.SHARE_REQUEST:type="share"};if(type!=null)return this.dispatchEvent(new Event(type,body))};AMP.registerPlugin("info","flash",InfoWrapper);function InfoMediator(){InfoMediator.__super__.constructor.call(this)};__extends(InfoMediator,PluginMediator);InfoMediator.prototype.componentName="info";InfoMediator.prototype.title=null;InfoMediator.prototype.shortDescription=null;InfoMediator.prototype.icon=null;InfoMediator.prototype.provider=null;InfoMediator.prototype.onRegister=function(){this.title=this.create("info-title");this.provider=this.create("info-provider");this.shortDescription=this.create("info-short-description");this.icon=this.create("info-icon",this,"img");this.dataChangedHandler();InfoMediator.__super__.onRegister.call(this)};InfoMediator.prototype.listNotificationInterests=function(){return[Notifications.MEDIA_CHANGE]};InfoMediator.prototype.handleNotification=function(notification){var body,name;name=notification.getName();body=notification.getBody();switch(name){case Notifications.MEDIA_CHANGE:this.dataChangedHandler()}};InfoMediator.prototype.moreClicked=function(event){return this.classList.add("open")};InfoMediator.prototype.closeClicked=function(event){return this.classList.remove("open")};InfoMediator.prototype.dataChangedHandler=function(){var styles,_ref;if(this.plugin.value.title!=null)this.title.textContent=this.plugin.value.title;if(((_ref=this.plugin.value.provider)!=null?_ref.image:void(0))!=null)this.icon.src=this.plugin.value.provider.image;styles=getComputedStyle(this.title);if(this.title.clientHeight>parseInt(styles.lineHeight)){this.classList.add("info-small");this.shortDescription.innerHTML=this.provider.innerHTML="";return}else this.classList.remove("info-small");this.truncateDescription(this.plugin.value.description,this.plugin.value.more);this.provider.textContent=this.plugin.value.provider.name!=null?""+this.plugin.value.provider.name:""};InfoMediator.prototype.truncateDescription=function(desc){var character,ellp,index,text,tf,_i,_len;ellp="...";text="";tf=this.shortDescription;tf.textContent="";if(!(desc!=null))return;for(index=_i=0,_len=desc.length;_i<_len;index=++_i){character=desc[index];tf.textContent=text+character+ellp;if(tf.scrollHeight>tf.clientHeight){tf.textContent=text+ellp;break}else text+=character}};function InfoProxy(data){InfoProxy.__super__.constructor.call(this,data)};__extends(InfoProxy,DataBoundConfigurationProxy);InfoProxy.prototype.configurationName="info";InfoProxy.NAME=ModuleProxy.NAME;InfoProxy.prototype.defaults={title:'#{media.title}',description:'#{media.description}',provider:{},more:"read more",less:"less"};function CaptioningPlugin(app,config){CaptioningPlugin.__super__.constructor.call(this,app,config)};__extends(CaptioningPlugin,Feature);CaptioningPlugin.NAME="CaptioningPlugin";CaptioningPlugin.prototype.featureName="captioning";CaptioningPlugin.prototype.moduleName="captioning";CaptioningPlugin.prototype.createController=function(){this.registerCommand(Notifications.CHANGE_MEDIA,CaptioningChangeMediaCommand);this.registerCommand(Notifications.STARTED,CaptioningStartedCommand);this.registerCommand(Notifications.TIME_UPDATE,CaptioningTimeUpdateCommand);this.registerCommand(CaptioningNotifications.VISIBILITY_CHANGE,CaptioningVisibilityChangeCommand)};CaptioningPlugin.prototype.createModel=function(){this.registerProxy(new CaptioningProxy(this.config))};CaptioningPlugin.prototype.createView=function(){var mediator;mediator=new CaptioningMediator();this.registerMediator(mediator);this.registerMediator(new CaptioningHTMLMediator(mediator.viewComponent))};CaptioningPlugin.prototype.createAPI=function(){return new CaptioningAPI(this)};CaptioningPlugin.prototype.listNotificationInterests=function(){return[Notifications.CHANGE_MEDIA,Notifications.STARTED,Notifications.TIME_UPDATE,CaptioningNotifications.TOGGLE_SETTINGS_VISIBILITY]};CaptioningPlugin.prototype.listNotificationPublications=function(){var key,value;return CaptioningPlugin.__super__.listNotificationPublications.call(this).concat((function(){var _results;_results=[];for(key in CaptioningNotifications){value=CaptioningNotifications[key];if(value!==CaptioningNotifications.TOGGLE_SETTINGS_VISIBILITY)_results.push(value)};return _results})()).concat([Notifications.ADD_CONTROL,Notifications.REMOVE_CONTROL,UserSettingsNotifications.UPDATE_SETTINGS,Notifications.ADD_CONTROL_STATE,Notifications.REMOVE_CONTROL_STATE])};CaptioningPlugin.prototype.listNotificationEvents=function(){return[CaptioningNotifications.VISIBILITY_CHANGE,CaptioningNotifications.ENABLED]};AMP.registerPlugin("captioning","html",CaptioningPlugin);var IMANotifications={INITIALIZED:"ima/initialize",ADD_OVERLAY:"ima/addOverlay",REMOVE_OVERLAY:"ima/removeOverlay"};function IMAOverlayProxy(config){IMAOverlayProxy.__super__.constructor.call(this,config)};__extends(IMAOverlayProxy,DataBoundConfigurationProxy);IMAOverlayProxy.prototype.configurationName="imaoverlay";IMAOverlayProxy.NAME="IMAOveralyProxy";IMAOverlayProxy.prototype.defaults={adTagUrl:null,duration:15,interval:30,delay:30};IMAOverlayProxy.prototype.durationTimer=null;IMAOverlayProxy.prototype.intervalTimer=null;IMAOverlayProxy.prototype.delayTimer=null;IMAOverlayProxy.prototype.stop=function(){clearTimeout(this.durationTimer);clearTimeout(this.delayTimer);clearTimeout(this.intervalTimer)};IMAOverlayProxy.prototype.play=function(){var _this=this;this.stop();this.delayTimer=setTimeout(function(){return _this.requestAd()},this.value.delay*1e3)};IMAOverlayProxy.prototype.requestAd=function(){var adTagUrl,xhr;adTagUrl=this.getValue("adTagUrl");if(adTagUrl!=null){adTagUrl=adTagUrl.replace("[timestamp]",new Date().getTime());adTagUrl=adTagUrl.replace("__random-number__",new Date().getTime())};xhr=Utils.get(adTagUrl,{withCredentials:true,onload:this.vastLoadHandler.bind(this),onerror:this.error.bind(this)},false)};IMAOverlayProxy.prototype.vastLoadHandler=function(xhr){var ad,clickThroughHref,creativeView,img,impression,xml;xml=xhr.target.responseXML;if(xml!=null)try{ad=xml.querySelector("NonLinear");if(ad!=null){impression=xml.querySelector("Impression")!=null?xml.querySelector("Impression").textContent:"";creativeView=xml.querySelector("Tracking[event=creativeView]")!=null?xml.querySelector("Tracking[event=creativeView]").textContent:"";clickThroughHref=ad.querySelector("NonLinearClickThrough")!=null?ad.querySelector("NonLinearClickThrough").textContent:"";img={src:ad.querySelector("StaticResource").textContent,width:ad.getAttribute("width"),height:ad.getAttribute("height"),tracking:[impression,creativeView],href:clickThroughHref};this.displayAd(img)}else this.error("No overlay was returned")}catch(error){this.error(error)}};IMAOverlayProxy.prototype.error=function(error){this.facade.logger.error("[AMP IMA OVERLAY ERROR]",error);this.stop()};IMAOverlayProxy.prototype.displayAd=function(ad){var _this=this;this.sendNotification(IMANotifications.ADD_OVERLAY,ad);this.durationTimer=setTimeout(function(){_this.sendNotification(IMANotifications.REMOVE_OVERLAY);return _this.intervalTimer=setTimeout(function(){return _this.requestAd()},_this.value.interval*1e3)},this.value.duration*1e3)};function IMAWrapper(){return IMAWrapper.__super__.constructor.apply(this,arguments)};__extends(IMAWrapper,AdWrapper);IMAWrapper.NAME="IMAWrapper";IMAWrapper.prototype.createXML=function(xml){var admedia,application,companion,companions,ids,overlay,prop,props,vendor,_i,_j,_k,_len,_len1,_len2,_ref;application=xml.getElementsByTagName("application")[0];admedia=xml.getElementsByTagName("admedia")[0];if(!(admedia!=null)){admedia=xml.createElement("admedia");application.appendChild(admedia)};vendor=xml.createElement("vendor");vendor.setAttribute("id","dfp");admedia.appendChild(vendor);props=[{value:this.config.adTagUrl,key:"DFP_AD_TAG_URL"},{value:this.config.maxBitrate,key:"DFP_MAX_BITRATE"},{value:this.config.sceneMarkers,key:"displaySceneMarkers"},{value:this.config.ppid,key:"DFP_PPID"}];for(_i=0,_len=props.length;_i<_len;_i++){prop=props[_i];if(prop.value!=null)this.createProperty(xml,prop.key,prop.value,vendor)};if(this.config.position!=null)vendor.setAttribute("position",this.config.position);if(this.config.params!=null){if(this.config.params.adTag!=null)this.createProperty(xml,"DFP_AD_TAG_PARAMS",this.config.params.adTag,vendor);if(this.config.params.manual!=null)this.createProperty(xml,"DFP_MANUAL_PARAMS",this.config.params.manual,vendor)};if(this.config.companions!=null){companions=[];ids=[];_ref=this.config.companions;for(_j=0,_len1=_ref.length;_j<_len1;_j++){companion=_ref[_j];companions.push(companion.width+"x"+companion.height);ids.push(companion.id)};this.createProperty(xml,"DFP_SIZE",companions.join(","),vendor);this.createProperty(xml,"COMPANION_ID",ids.join(","),vendor)};if(this.config.disableCompanionAds!=null)this.createProperty(xml,"disableCompanionAds",this.config.disableCompanionAds,vendor);if(this.config.overlay!=null){if(this.config.overlay.enabled===true){overlay=xml.createElement("overlay");admedia.appendChild(overlay)};props=[{value:"dfp",key:"OVERLAY_AD_PARTNER"},{value:this.config.overlay.adTagUrl,key:"OVERLAY_AD_BASE_URL"},{value:this.config.overlay.delay,key:"OVERLAY_AD_DELAY"},{value:this.config.overlay.interval,key:"OVERLAY_AD_INTERVAL"},{value:this.config.overlay.duration,key:"OVERLAY_AD_DURATION"},{value:""+this.config.overlay.width+"x"+this.config.overlay.height,key:"OVERLAY_AD_SIZE"}];for(_k=0,_len2=props.length;_k<_len2;_k++){prop=props[_k];if(prop.value!=null)this.createProperty(xml,prop.key,prop.value,overlay)}};return xml};function IMAProxy(config){IMAProxy.__super__.constructor.call(this,config);this.intervals=[]};__extends(IMAProxy,AdProxy);IMAProxy.NAME=AdProxy.NAME;IMAProxy.prototype.defaults={plugin:null,adTagUrl:null,overlay:null,width:null,height:null,maxBitrate:-1,ppid:null,companions:null};IMAProxy.prototype.key="ima";IMAProxy.prototype.intervals=null;IMAProxy.prototype.adDisplayContainer=null;IMAProxy.prototype.adDisplayContainerInitialized=false;IMAProxy.prototype.adsLoader=null;IMAProxy.prototype.adsRenderingSettings=null;IMAProxy.prototype.adsManagerLoaded=false;IMAProxy.prototype.adsManager=null;IMAProxy.prototype.cuepoints=null;IMAProxy.prototype.adLoaded=false;IMAProxy.prototype.playWhenLoaded=false;IMAProxy.prototype.contentHasEnded=false;IMAProxy.prototype.adTagUrl=null;IMAProxy.prototype.viewMode=null;IMAProxy.prototype.setEnabled=function(value){var _ref;IMAProxy.__super__.setEnabled.call(this,value);if(value===false){if((_ref=this.adsManager)!=null)if(typeof _ref.destroy==="function")_ref.destroy();if(this.getInProgress())this.contentPlay()};return value};IMAProxy.prototype.getLoaded=function(){return(typeof google!=="undefined"&&google!==null?google.ima:void(0))!=null};IMAProxy.prototype.getScript=function(){return this.value.plugin};IMAProxy.prototype.setLoadedMetadata=function(value){IMAProxy.__super__.setLoadedMetadata.call(this,value);if(this.canPlay()&&this.playWhenLoaded===true)this.startAd();return value};IMAProxy.prototype.initialize=function(){};IMAProxy.prototype.ready=function(){this.adDisplayContainer=this.createPlugin();this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer);this.adsRenderingSettings=new google.ima.AdsRenderingSettings();this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),false);this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),false)};IMAProxy.prototype.createPlugin=function(){return new google.ima.AdDisplayContainer(this.facade.getViewComponent().container)};IMAProxy.prototype.engage=function(override){if(override==null)override=true;if(this.getEnabled()===false)return;IMAProxy.__super__.engage.call(this);if(this.adsManagerLoaded===true&&this.contentHasEnded===false)this.contentEnded();this.adsManagerLoaded=false;this.contentHasEnded=false;this.adsManagerLoaded=false;this.playWhenLoaded=false};IMAProxy.prototype.setVolume=function(value){var _ref;if((_ref=this.adsManager)!=null)_ref.setVolume(value);return value};IMAProxy.prototype.getVolume=function(){var _ref;return(_ref=this.adsManager)!=null?_ref.getVolume():void(0)};IMAProxy.prototype.requestAd=function(){var adsRequest,adsResponse,height,width,_ref,_ref1;this.sendNotification(AdNotifications.REQUEST,this.adVO);width=this.facade.app.getViewComponent().clientWidth;height=this.facade.app.getViewComponent().clientHeight;adsRequest=new google.ima.AdsRequest();this.adTagUrl=this.getValue("adTagUrl");adsResponse=this.getValue("adsResponse");if((adsResponse!=null)&&adsResponse!==""){adsRequest.adsResponse=Utils.read(adsResponse,null,Utils.mimeTypes.txt)}else adsRequest.adTagUrl=this.adTagUrl;adsRequest.linearAdSlotWidth=width;adsRequest.linearAdSlotHeight=height;adsRequest.nonLinearAdSlotWidth=((_ref=this.value.overlay)!=null?_ref.width:void(0))||width;adsRequest.nonLinearAdSlotHeight=((_ref1=this.value.overlay)!=null?_ref1.height:void(0))||height;if(this.config.ppid!=null)this.adsLoader.getSettings().setPpid(this.getValue("ppid"));this.adsLoader.requestAds(adsRequest)};IMAProxy.prototype.requestOverlay=function(){var adsRequest,overlay;overlay=this.value.overlay;if(!(overlay!=null))return;adsRequest=new google.ima.AdsRequest();adsRequest.adTagUrl=overlay.adTagUrl;adsRequest.nonLinearAdSlotWidth=overlay.width||300;adsRequest.nonLinearAdSlotHeight=overlay.height||50;this.adsLoader.requestAds(adsRequest)};IMAProxy.prototype.start=function(){if(IMAProxy.__super__.start.call(this)===false)return false;if(this.adDisplayContainerInitialized!==true){this.adDisplayContainer.initialize();this.adDisplayContainerInitialized=true};if(this.canPlay()===true){this.startAd()}else{this.playWhenLoaded=true;this.requestAd()}};IMAProxy.prototype.canPlay=function(){return this.adsManagerLoaded===true&&this.loadedMetadata===true};IMAProxy.prototype.startAd=function(){var volume;this.playWhenLoaded=false;try{volume=this.facade.app.retrieveProxy(PlaybackProxy.NAME).getVolume();this.setVolume(volume);if(this.viewMode==null)this.viewMode=google.ima.ViewMode.NORMAL;this.adsManager.init(this.facade.app.getViewComponent().clientWidth,this.facade.app.getViewComponent().clientHeight,this.viewMode);this.adsManager.start()}catch(adError){this.error(adError)}};IMAProxy.prototype.resize=function(state){this.viewMode=state===DisplayState.FULL_SCREEN?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL;this.adsManager.resize(this.facade.app.getViewComponent().clientWidth,this.facade.app.getViewComponent().clientHeight,this.viewMode)};IMAProxy.prototype.onAdsManagerLoaded=function(adsManagerLoadedEvent){var adEventHandler,_ref;this.facade.logger.log("IMA: adsManagerLoaded");this.adsRenderingSettings.bitrate=this.getValue("maxBitrate");this.adsRenderingSettings.autoAlign=true;this.adsRenderingSettings.useStyledNonLinearAds=true;if((_ref=this.adsManager)!=null)if(typeof _ref.destroy==="function")_ref.destroy();this.adsManager=adsManagerLoadedEvent.getAdsManager(this.facade.app.video,this.adsRenderingSettings);this.adsManagerLoaded=true;this.cuePoints=this.adsManager.getCuePoints();this.facade.app.sendNotification(Notifications.ADD_CUE_POINTS,this.cuePoints);adEventHandler=this.onAdEvent.bind(this);this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this));this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.contentPause.bind(this));this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.contentPlay.bind(this));this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,adEventHandler);this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,adEventHandler);this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,adEventHandler);this.adsManager.addEventListener(google.ima.AdEvent.Type.RESUME,this.onAdResumed.bind(this));this.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,this.onAdPaused.bind(this));this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,adEventHandler);this.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,this.onAdClick.bind(this));this.adsManager.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,adEventHandler);this.adsManager.addEventListener(google.ima.AdEvent.Type.MIDPOINT,adEventHandler);this.adsManager.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,adEventHandler);this.adsManager.addEventListener(google.ima.AdEvent.Type.LOG,adEventHandler);if(this.canPlay()&&this.playWhenLoaded===true)this.startAd()};IMAProxy.prototype.onAdClick=function(adEvent){if((adEvent!=null?adEvent.getAd().isLinear():void(0))===false){this.facade.app.sendNotification(Notifications.PAUSE);return};if(!this.getPaused())this.pause()};IMAProxy.prototype.onAdPaused=function(adEvent){this.setPaused(true);this.facade.app.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PAUSED);this.facade.app.sendNotification(Notifications.CHANGE_ACTIVE_STATE,ActiveState.ACTIVE)};IMAProxy.prototype.onAdResumed=function(adEvent){this.setPaused(false);this.facade.app.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PLAYING)};IMAProxy.prototype.onAdEvent=function(adEvent){var ad,companion,companions,pos,type,_i,_len,_ref;ad=adEvent.getAd();if(this.adVO!=null)this.adVO.metadata=ad;switch(adEvent.type){case google.ima.AdEvent.Type.LOADED:if(ad.isLinear()){pos=ad.getAdPodInfo().getPodIndex();type=pos===0?"preroll":pos===-1?"postroll":"midroll";this.adVO=new AdVO(ad.getAdId(),ad.getAdId(),ad.getDuration(),pos,type,"ima",null,null,this.adTagUrl,ad,ad.getAdPodInfo().getTotalAds());this.sendNotification(AdNotifications.AD_LOADED,this.adVO);this.sendNotification(AdNotifications.AD_DURATION_CHANGE,this.adVO);if(type==="midroll"||type==="postroll")this.engageAds()}else{this.facade.app.sendNotification(Notifications.ADD_APPLICATION_STATE,"ad-overlaymode");this.contentPlay()};break;case google.ima.AdEvent.Type.STARTED:if(ad.isLinear()){this.setInProgress(true);this.adVO.position=ad.getAdPodInfo().getAdPosition();this.sendNotification(AdNotifications.AD_STARTED,this.adVO);this.intervals.push(setInterval(this.onAdTimeUpdate.bind(this),300));this.facade.app.sendNotification(Notifications.CHANGE_PLAY_STATE,PlayState.PLAYING);this.sendNotification(AdNotifications.AD_PLAY,this.adVO)};try{companions=[];_ref=this.getConfigurationData().companions;for(_i=0,_len=_ref.length;_i<_len;_i++){companion=_ref[_i];companions=companions.concat(ad.getCompanionAds(companion.width,companion.height))};if(companions.length>0)this.setCompanions(companions)}catch(error){this.facade.logger.error("[AMP IMA ERROR]","Could not retrieve companion ads:",error)};break;case google.ima.AdEvent.Type.COMPLETE:if(ad.isLinear())this.sendNotification(AdNotifications.AD_ENDED,this.adVO);break;case google.ima.AdEvent.Type.FIRST_QUARTILE:this.sendNotification(AdNotifications.FIRST_QUARTILE,this.adVO);break;case google.ima.AdEvent.Type.MIDPOINT:this.sendNotification(AdNotifications.MIDPOINT,this.adVO);break;case google.ima.AdEvent.Type.THIRD_QUARTILE:this.sendNotification(AdNotifications.THIRD_QUARTILE,this.adVO);break;case google.ima.AdEvent.Type.LOG:this.sendNotification(AdNotifications.LOG,this.adVO)}};IMAProxy.prototype.onAdTimeUpdate=function(adErrorEvent){this.sendNotification(AdNotifications.AD_TIME_REMAINING,this.adsManager.getRemainingTime())};IMAProxy.prototype.onAdError=function(adErrorEvent){this.error(adErrorEvent.getError());this.contentPlay()};IMAProxy.prototype.play=function(){var _ref;IMAProxy.__super__.play.call(this);try{if((_ref=this.adsManager)!=null)_ref.resume()}catch(error){this.facade.logger.error("[AMP IMA ERROR]","resume",error)}};IMAProxy.prototype.pause=function(){IMAProxy.__super__.pause.call(this);try{this.adsManager.pause()}catch(error){this.facade.logger.error("[AMP IMA ERROR]","pause",error)}};IMAProxy.prototype.breakEnd=function(){var interval,overlayProxy,_i,_len,_ref;_ref=this.intervals;for(_i=0,_len=_ref.length;_i<_len;_i++){interval=_ref[_i];clearInterval(this.intervals.pop())};IMAProxy.__super__.breakEnd.call(this);overlayProxy=this.facade.retrieveProxy(IMAOverlayProxy.NAME);if(overlayProxy!=null)overlayProxy.play()};IMAProxy.prototype.setCompanions=function(value){var companion,companions,_i,_len;companions=[];for(_i=0,_len=value.length;_i<_len;_i++){companion=value[_i];companions.push({data:companion.getContent(),type:companion.getContentType().toLowerCase(),width:companion.getWidth(),height:companion.getHeight(),metadata:companion})};IMAProxy.__super__.setCompanions.call(this,companions);return value};IMAProxy.prototype.contentPause=function(){this.sendNotification(Notifications.DISABLE_VIDEO_EVENTS,["paused","ended","durationchange","error"]);IMAProxy.__super__.contentPause.call(this);this.sendNotification(AdNotifications.BREAK_START,this.adVO)};IMAProxy.prototype.contentPlay=function(){var api,_ref,_ref1;this.facade.logger.log("IMA: contentPlay");this.sendNotification(Notifications.ENABLE_VIDEO_EVENTS,["paused","ended","durationchange","error"]);this.sendNotification(AdNotifications.BREAK_END,this.adVO);if(((_ref=this.adVO)!=null?_ref.type:void(0))==="midroll"&&Utils.getDevice()==="desktop"){api=this.facade.app.getAPI();api.setCurrentTime(Math.floor(api.getCurrentTime()))};if(((_ref1=this.adVO)!=null?_ref1.type:void(0))==="postroll"){this.facade.app.sendNotification(Notifications.ENDED);return};IMAProxy.__super__.contentPlay.call(this)};IMAProxy.prototype.contentEnded=function(){var _ref;this.facade.logger.log("IMA: contentComplete");this.contentHasEnded=true;try{if((_ref=this.adsLoader)!=null)if(typeof _ref.contentComplete==="function")_ref.contentComplete()}catch(error){this.facade.logger.error("[AMP IMA ERROR]","contentComplete",error)}};function IMAAddOverlayCommand(){IMAAddOverlayCommand.__super__.constructor.call(this)};__extends(IMAAddOverlayCommand,puremvc.SimpleCommand);IMAAddOverlayCommand.prototype.execute=function(notification){this.facade.sendNotification(Notifications.ADD_APPLICATION_STATE,"ad-overlay-mode")};function IMARemoveOverlayCommand(){IMARemoveOverlayCommand.__super__.constructor.call(this)};__extends(IMARemoveOverlayCommand,puremvc.SimpleCommand);IMARemoveOverlayCommand.prototype.execute=function(notification){var proxy;proxy=this.facade.retrieveProxy(IMAOverlayProxy.NAME);proxy.stop();this.facade.app.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"ad-overlay-mode")};function IMAOverlayMediator(){IMAOverlayMediator.__super__.constructor.call(this)};__extends(IMAOverlayMediator,OverlayMediator);IMAOverlayMediator.prototype.componentName="ad-overlay";IMAOverlayMediator.prototype.anchor=null;IMAOverlayMediator.prototype.image=null;IMAOverlayMediator.prototype.tracker=null;IMAOverlayMediator.prototype.tracker2=null;IMAOverlayMediator.prototype.closeButton=null;IMAOverlayMediator.prototype.closeText=null;IMAOverlayMediator.prototype.onRegister=function(){var _this=this;this.anchor=this.create("ad-overlay-anchor");this.anchor.target="_blank";this.image=this.create("ad-overlay-img",this.anchor,"img");this.tracker=this.create();this.tracker.width=0;this.tracker.height=0;this.tracker2=this.create(null,this,"img");this.tracker2.width=0;this.tracker2.height=0;this.closeButton=this.create("ad-close-button",this.anchor);this.closeButton.onclick=function(event){event.stopImmediatePropagation();_this.sendNotification(IMANotifications.REMOVE_OVERLAY);return false};this.closeText=this.createText("ad-close-text","x",this.closeButton);IMAOverlayMediator.__super__.onRegister.call(this)};IMAOverlayMediator.prototype.listNotificationInterests=function(){return[IMANotifications.ADD_OVERLAY,IMANotifications.REMOVE_OVERLAY]};IMAOverlayMediator.prototype.handleNotification=function(notification){var ad;switch(notification.getName()){case IMANotifications.ADD_OVERLAY:ad=notification.getBody();this.image.src=ad.src;this.anchor.href=ad.href;this.tracker.src=ad.tracking[0];this.tracker2.src=ad.tracking[1]}};function IMAReadyCommand(){IMAReadyCommand.__super__.constructor.call(this)};__extends(IMAReadyCommand,puremvc.SimpleCommand);IMAReadyCommand.prototype.execute=function(notification){this.facade.retrieveProxy(IMAProxy.NAME).ready()};function IMADisplayStateChangeCommand(){IMADisplayStateChangeCommand.__super__.constructor.call(this)};__extends(IMADisplayStateChangeCommand,puremvc.SimpleCommand);IMADisplayStateChangeCommand.prototype.execute=function(notification){this.facade.retrieveProxy(IMAProxy.NAME).resize(notification.getBody())};function IMAFullscreenProxy(config){IMAFullscreenProxy.__super__.constructor.call(this,config)};__extends(IMAFullscreenProxy,IMAProxy);IMAFullscreenProxy.NAME=IMAProxy.NAME;IMAFullscreenProxy.prototype.createPlugin=function(){return new google.ima.AdDisplayContainer(this.facade.getViewComponent().container,this.facade.app.getVideo(),this.facade.getViewComponent().container)};IMAFullscreenProxy.prototype.engage=function(media){IMAFullscreenProxy.__super__.engage.call(this,media);this.sendNotification(Notifications.DISABLE_VIDEO_EVENTS,["paused","ended","durationchange","error"])};IMAFullscreenProxy.prototype.reset=function(media){IMAFullscreenProxy.__super__.reset.call(this,media);this.sendNotification(Notifications.ENABLE_VIDEO_EVENTS,["paused","ended","durationchange","error"])};function InfoPlugin(app,config){InfoPlugin.__super__.constructor.call(this,app,config)};__extends(InfoPlugin,Plugin);InfoPlugin.NAME="InfoPlugin";InfoPlugin.prototype.moduleName="info";InfoPlugin.prototype.createModel=function(){this.registerProxy(new InfoProxy(this.config))};InfoPlugin.prototype.createView=function(){this.registerMediator(new InfoMediator())};InfoPlugin.prototype.listNotificationInterests=function(){return[Notifications.MEDIA_CHANGE]};AMP.registerPlugin("info","html",InfoPlugin);AMP.registerPlugin("info","external",InfoPlugin);function ShareWrapper(player,config){if(config==null)config={};ShareWrapper.__super__.constructor.call(this,player,config)};__extends(ShareWrapper,PluginWrapper);ShareWrapper.NAME="ShareWrapper";ShareWrapper.prototype.controls=["share","facebook","twitter"];ShareWrapper.prototype.createFlashVars=function(flashvars){if(flashvars.share_mode==null)flashvars.share_mode=2;return flashvars};ShareWrapper.prototype.createXML=function(xml){this.createControls(xml);return xml};ShareWrapper.prototype.createControls=function(xml){var id,key,_i,_len,_ref;if(this.hasControls(xml)===false)return;this.config.share=true;this.controls=this.getControls(xml);_ref=this.controls;for(_i=0,_len=_ref.length;_i<_len;_i++){key=_ref[_i];id=""+key+"Btn";if(!(controls[id]!=null)&&this.config[key]===true)this.createElement(xml,id)}};ShareWrapper.prototype.listNotificationInterests=function(){return ShareWrapper.__super__.listNotificationInterests.call(this).concat([FlashNotifications.SHARE,FlashNotifications.SHARE_REQUEST])};ShareWrapper.prototype.handleNotification=function(notification){var body,name,type;ShareWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.SHARE:case FlashNotifications.SHARE_REQUEST:type="share"};if(type!=null)this.dispatchEvent(new Event(type,body))};AMP.registerPlugin("share","flash",ShareWrapper);function ShareMediator(){ShareMediator.__super__.constructor.call(this)};__extends(ShareMediator,PluginMediator);ShareMediator.prototype.componentName="share";ShareMediator.prototype.shareControl=null;ShareMediator.prototype.shareSeparator=null;ShareMediator.prototype.embed=null;ShareMediator.prototype.onRegister=function(){this.sendNotification(Notifications.ADD_CONTROL_STATE,"share-enabled");this.shareControl=this.create(["share","control"],false);this.shareSeparator=this.create(["share","separator"],this.shareControl);this.createButton("share");if(this.plugin.getFacebook()===true)this.createButton("facebook");if(this.plugin.getTwitter()===true)this.createButton("twitter");this.sendNotification(Notifications.ADD_CONTROL,this.shareControl);ShareMediator.__super__.onRegister.call(this)};ShareMediator.prototype.createButton=function(id){var button;button=new ButtonMediator(null,this.shareControl,null,id,this.clickHandler.bind(this,id));this.facade.registerMediator(button)};ShareMediator.prototype.clickHandler=function(provider,event){event.stopImmediatePropagation();this.sendNotification(Notifications.DISPATCH_EVENT,new Event("share",{provider:provider,link:this.plugin.getLink(),embed:this.plugin.getEmbed()}));return false};ShareMediator.prototype.listNotificationInterests=function(){return[Notifications.MEDIA_CHANGE]};ShareMediator.prototype.handleNotification=function(notification){var body,media,name;name=notification.getName();body=notification.getBody();switch(name){case Notifications.MEDIA_CHANGE:media=body;if(media.embed!=null){this.sendNotification(Notifications.ADD_CONTROL_STATE,"share-enabled")}else this.sendNotification(Notifications.REMOVE_CONTROL_STATE,"share-enabled")}};function ShareProxy(config){ShareProxy.__super__.constructor.call(this,config)};__extends(ShareProxy,PluginProxy);ShareProxy.NAME=ModuleProxy.NAME;ShareProxy.prototype.defaults={facebook:false,twitter:false};ShareProxy.prototype.loaded=true;ShareProxy.prototype.link=null;ShareProxy.prototype.embed=null;ShareProxy.prototype.getEmbed=function(){return this.embed};ShareProxy.prototype.setEmbed=function(value){return this.embed=value};ShareProxy.prototype.getLink=function(){return this.link};ShareProxy.prototype.setLink=function(value){return this.link=value};ShareProxy.prototype.getFacebook=function(){return this.getConfigurationData().facebook};ShareProxy.prototype.setFacebook=function(value){return this.data.facebook=value};ShareProxy.prototype.getTwitter=function(){return this.getConfigurationData().twitter};ShareProxy.prototype.setTwitter=function(value){return this.data.twitter=value};var StatsNotifications={VISIBILITY_CHANGE:"statsvisibilitychange",BITRATES_UPDATE:"bitratesUpdate"};function ShareMediaChangeCommand(){ShareMediaChangeCommand.__super__.constructor.call(this)};__extends(ShareMediaChangeCommand,puremvc.SimpleCommand);ShareMediaChangeCommand.prototype.execute=function(notification){var media,proxy;this.facade.logger.debug("ShareMediaChangeCommand");media=notification.getBody();proxy=this.facade.retrieveProxy(ShareProxy.NAME);proxy.setEmbed(media.embed);proxy.setLink(media.link)};function StatsProxy(config){StatsProxy.__super__.constructor.call(this,config)};__extends(StatsProxy,ModuleProxy);StatsProxy.NAME=ModuleProxy.NAME;StatsProxy.prototype.defaults={url:null};StatsProxy.prototype.hidden=true;StatsProxy.prototype.getURL=function(){return this.data.url};StatsProxy.prototype.setURL=function(value){return this.data.url=value};StatsProxy.prototype.getHidden=function(){return this.hidden};StatsProxy.prototype.setHidden=function(value){return this.hidden=value};StatsProxy.prototype.invoke=function(){var xhr,_this=this;if(this.data.url!=null)return xhr=Utils.get(this.data.url,{onload:function(){if(xhr.response!=null)_this.sendNotification(StatsNotifications.BITRATES_UPDATE,xhr.response)},onerror:function(error){return _this.sendNotification(StatsNotifications.BITRATES_UPDATE,null)}})};function StatsMediator(){StatsMediator.__super__.constructor.call(this)};__extends(StatsMediator,PluginMediator);StatsMediator.prototype.componentName="stats";StatsMediator.prototype.statsText=null;StatsMediator.prototype.statsButton=null;StatsMediator.prototype.bitrateText=null;StatsMediator.prototype.bitrateArr=null;StatsMediator.prototype.onRegister=function(){var _this=this;this.sendNotification(Notifications.ADD_CONTROL_STATE,"stats-enabled");this.classList.add("hidden");this.statsFormat=this.create("stats-text");this.statsBitRate=this.create("stats-text");this.statsPlayBack=this.create("stats-text");this.statsAnalytics=this.create("stats-text");this.statsButton=this.create("stats-button",false);this.statsButton.onclick=function(event){event.stopImmediatePropagation();_this.sendNotification(StatsNotifications.VISIBILITY_CHANGE,!_this.plugin.getHidden());return false};this.sendNotification(Notifications.ADD_CONTROL,this.statsButton);StatsMediator.__super__.onRegister.call(this)};StatsMediator.prototype.listNotificationInterests=function(){return[StatsNotifications.VISIBILITY_CHANGE,StatsNotifications.BITRATES_UPDATE]};StatsMediator.prototype.handleNotification=function(notification){var body,name;name=notification.getName();body=notification.getBody();switch(name){case StatsNotifications.VISIBILITY_CHANGE:if(this.plugin.getHidden()){this.classList.add("hidden")}else{this.classList.remove("hidden");this.statsBitRate.innerHTML="<p><b class='"+this.classList.prefix+"stats-header'>Adaptive Bitrate Renditions</b></p><p>Loading...</p>";this.renderStats()};break;case StatsNotifications.BITRATES_UPDATE:if(body!=null){this.checkContentType(body)}else this.statsBitRate.innerHTML="<p><b class='"+this.classList.prefix+"stats-header'>Adaptive Bitrate Renditions</b></p><p>Not Available</p>"}};StatsMediator.prototype.renderStats=function(){var analyticsVal,api,device,formatVal,isDash,playbackVal,player,urlVal,_ref,_ref1;try{player=this.facade.app;api=player.getAPI();formatVal=api.getMedia()===void(0)?"Not Available":api.getMedia().type;urlVal=api.getSrc()===""||api.getSrc()===null?"Not Available":api.getSrc();device=Utils.getDevice();if(device==null)device="";playbackVal=this.facade.app.getConfig().mode!==""&&this.facade.app.getConfig().mode!==null&&this.facade.app.getConfig().mode.indexOf("html")!==-1?this.facade.app.parent.version+", HTML5 Video: "+device:"Not Available";isDash=(_ref=this.facade.app.retrieveProxy(PlayerProxy.NAME).getActivePlaybackCore())!=null?(_ref1=_ref.playbackCoreName)!=null?_ref1.indexOf("dash"):void(0):void(0);if(isDash>-1)playbackVal+=", dash.js";analyticsVal=this.facade.app.getAPI().getConfig().mediaanalytics.config===""||this.facade.app.getAPI().getConfig().mediaanalytics.config===null?"Not Available":this.facade.app.getAPI().getConfig().mediaanalytics.config;this.statsFormat.innerHTML="<p><b class='"+this.classList.prefix+"stats-header'>Stream</b></p><p>Format: "+formatVal+"</p><p>URL: "+urlVal+"</p>";this.statsPlayBack.innerHTML="<p><b class='"+this.classList.prefix+"stats-header'>Playback</b></p>"+playbackVal;this.statsAnalytics.innerHTML="<p><b class='"+this.classList.prefix+"stats-header'>Analytics</b></p>"+analyticsVal}catch(error){this.facade.logger.error("[AMP Stats Render Error]:",error)}};StatsMediator.prototype.checkContentType=function(items){var item,xhr,_i,_len,_ref,_this=this;this.bitrateArr=[];if(typeof items==='object'&&this.facade.app.getAPI().getMedia().type.indexOf("dash")!==-1){xhr=Utils.get(items.URL,{onload:function(event){var bitrateArray,bitrateStr,item,resStr,xml,_i,_len;xml=XMLUtils.parse(event.data.responseText);bitrateArray=xml.querySelectorAll("AdaptationSet[mimeType*='video']")[0].querySelectorAll("Representation");for(_i=0,_len=bitrateArray.length;_i<_len;_i++){item=bitrateArray[_i];bitrateStr=(parseInt(item.getAttribute('bandwidth'))/1e3).toFixed(0);resStr=item.getAttribute('width')+"x"+item.getAttribute('height');_this.bitrateArr.push({bitrate:bitrateStr,res:resStr})};return _this.constructBitrateText(_this.bitrateArr)},onerror:function(event){return _this.facade.logger.error("[AMP Stats ERROR]",event)}})}else{_ref=items.split("#");for(_i=0,_len=_ref.length;_i<_len;_i++){item=_ref[_i];if(item.indexOf("BANDWIDTH")!==-1&&item.indexOf("RESOLUTION")!==-1)this.bitrateArr.push(this.parseBitrate(item))};this.constructBitrateText(this.bitrateArr)}};StatsMediator.prototype.constructBitrateText=function(bitrateArr){var bitrateSlNo,item,_i,_len,_ref;this.bitrateArr=bitrateArr;this.bitrateText='';this.bitrateArr.sort(function(a,b){var aBitrate,bBitrate;aBitrate=parseInt(a.bitrate);bBitrate=parseInt(b.bitrate);if(aBitrate<bBitrate){return-1}else if(aBitrate>bBitrate){return 1}else return 0});_ref=this.bitrateArr;for(bitrateSlNo=_i=0,_len=_ref.length;_i<_len;bitrateSlNo=++_i){item=_ref[bitrateSlNo];this.bitrateText+="<p>"+(bitrateSlNo+1)+". "+item.bitrate+" kbps "+item.res+"</p>"};if(this.bitrateText==="")this.bitrateText="<p>Not Available</p>";this.statsBitRate.innerHTML="<p><b class='"+this.classList.prefix+"stats-header'>Adaptive Bitrate Renditions</b></p>"+this.bitrateText};StatsMediator.prototype.parseBitrate=function(item){var bandwidthEndIndex,bandwidthStartIndex,bandwidthStr,resolutionEndIndex,resolutionStartIndex,resolutionStr;bandwidthStartIndex=item.indexOf("BANDWIDTH");bandwidthEndIndex=item.indexOf(",",bandwidthStartIndex+10);bandwidthStr=item.slice(bandwidthStartIndex+10,bandwidthEndIndex);resolutionStartIndex=item.indexOf("RESOLUTION");resolutionEndIndex=item.indexOf(",",resolutionStartIndex+10);if(resolutionEndIndex-resolutionStartIndex>20||resolutionEndIndex===-1)resolutionEndIndex=item.indexOf("x",resolutionStartIndex+10)+4;resolutionStr=item.slice(resolutionStartIndex+11,resolutionEndIndex);return{bitrate:parseInt(bandwidthStr)/1e3,res:resolutionStr}};function StatsVisibilityChangeCommand(){StatsVisibilityChangeCommand.__super__.constructor.call(this)};__extends(StatsVisibilityChangeCommand,puremvc.SimpleCommand);StatsVisibilityChangeCommand.prototype.execute=function(notification){var statsProxy;this.facade.logger.debug("StatsVisibilityChangeCommand");statsProxy=this.facade.retrieveProxy(StatsProxy.NAME);statsProxy.setHidden(notification.getBody());statsProxy.setURL(""+(this.facade.app.parent.getSrc()));if(notification.getBody()===false)statsProxy.invoke()};function IMAPlugin(app,config){IMAPlugin.__super__.constructor.call(this,app,config)};__extends(IMAPlugin,AdPlugin);IMAPlugin.NAME="IMAPlugin";IMAPlugin.prototype.moduleName="ima";IMAPlugin.prototype.createFullscreenProxy=function(){return new IMAFullscreenProxy(this.config)};IMAPlugin.prototype.createProxy=function(){return new IMAProxy(this.config)};IMAPlugin.prototype.isFullscreenDevice=function(){var ua;ua=navigator.userAgent;return Utils.isFullscreenDevice()||/Android 4\.[0-1]/.test(ua)||/CrKey/.test(ua)};IMAPlugin.prototype.createModel=function(){IMAPlugin.__super__.createModel.call(this);if(this.config.overlay!=null)this.registerProxy(new IMAOverlayProxy(this.config.overlay))};IMAPlugin.prototype.createController=function(){IMAPlugin.__super__.createController.call(this);if(this.config.overlay!=null){this.registerCommand(IMANotifications.ADD_OVERLAY,IMAAddOverlayCommand);this.registerCommand(IMANotifications.REMOVE_OVERLAY,IMARemoveOverlayCommand)};this.registerCommand(Notifications.READY,IMAReadyCommand);this.registerCommand(Notifications.FULL_SCREEN_CHANGE,IMADisplayStateChangeCommand)};IMAPlugin.prototype.createView=function(){IMAPlugin.__super__.createView.call(this);if(this.config.overlay!=null)this.registerMediator(new IMAOverlayMediator())};AMP.registerPlugin("ima","html",IMAPlugin);AMP.registerPlugin("ima","flash",IMAWrapper);function StatsAPI(module){var proxy;StatsAPI.__super__.constructor.call(this,module);proxy=module.retrieveProxy(StatsProxy.NAME);this.getHidden=proxy.getHidden.bind(proxy);this.setHidden=function(value){module.sendNotification(StatsNotifications.VISIBILITY_CHANGE,value);return value}};__extends(StatsAPI,PluginAPI);StatsAPI.prototype.getHidden=function(){};StatsAPI.prototype.setHidden=function(value){};function AISLaunchIDPLoginCommand(){AISLaunchIDPLoginCommand.__super__.constructor.call(this)};__extends(AISLaunchIDPLoginCommand,AISCommand);AISLaunchIDPLoginCommand.prototype.execute=function(notification){this.facade.logger.debug("AISLaunchIDPLoginCommand");this.getProxy().launchIDPLogin(notification.getBody())};function AISChooserMediator(parent){AISChooserMediator.__super__.constructor.call(this,null,null,parent)};__extends(AISChooserMediator,ComponentMediator);AISChooserMediator.prototype.componentName="ais-chooser";AISChooserMediator.prototype.menu=null;AISChooserMediator.prototype.label=null;AISChooserMediator.prototype.grid=null;AISChooserMediator.prototype.select=null;AISChooserMediator.prototype.login=null;AISChooserMediator.prototype.title=null;AISChooserMediator.prototype.onRegister=function(){var _this=this;this.classList.add("hidden");this.title=this.createText("ais-chooser-title","Choose your provider");this.grid=this.create("ais-chooser-grid");this.menu=this.create("ais-chooser-menu");this.label=this.createText("ais-chooser-label","Providers: ",this.menu);this.select=this.create("ais-chooser-select",this.menu,"select");this.login=this.create("ais-chooser-login",false,"input");this.login.type="button";this.login.value="Login";this.login.onclick=function(event){var idpID;if(typeof event.stopImmediatePropagation==="function")event.stopImmediatePropagation();idpID=_this.select.options[_this.select.selectedIndex].value;_this.sendNotification(AISNotifications.LAUNCH_IDP_LOGIN,idpID);return false};this.menu.appendChild(this.login);AISChooserMediator.__super__.onRegister.call(this)};AISChooserMediator.prototype.listNotificationInterests=function(){return[AISNotifications.CHOOSE_AUTH_PROVIDER,AISNotifications.AUTHENTICATING]};AISChooserMediator.prototype.handleNotification=function(notification){var baseURL,div,featuredGroup,footprints,group,groups,idp,idps,img,index,key,logos,member,option,options,proxy,resp,span,src,value,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_this=this;switch(notification.getName()){case AISNotifications.CHOOSE_AUTH_PROVIDER:resp=notification.getBody();idps=resp.possible_idps;footprints=resp.footprints||[];groups=resp.grouped_idps||[];proxy=this.facade.retrieveProxy(ModuleProxy.NAME);logos=proxy.value.logos;baseURL=logos!=null?logos.base:void(0);this.grid.innerHTML="";if((groups!=null)&&((logos!=null?logos.group:void(0))!=null)){for(_i=0,_len=groups.length;_i<_len;_i++){group=groups[_i];if(!(group.name===logos.group))continue;featuredGroup=group;break};if(featuredGroup!=null){_ref=featuredGroup.members;for(index=_j=0,_len1=_ref.length;_j<_len1;index=++_j){member=_ref[index];idp=idps[member];div=this.create(["ais-chooser-grid-item","ais-chooser-grid-index-"+(index+1)],this.grid);if(div.dataset==null)div.dataset={};div.dataset.key=member;div.onclick=function(event){var idpID,target;if(typeof event.stopImmediatePropagation==="function")event.stopImmediatePropagation();target=(event.currentTarget!=null)?event.currentTarget:event.srcElement;idpID=target.dataset.key;_this.sendNotification(AISNotifications.LAUNCH_IDP_LOGIN,idpID);return false};if(((_ref1=idps[member].logos)!=null?_ref1[logos.key]:void(0))!=null){img=this.create("ais-chooser-grid-cell-img",div,"img");img.alt=idp.display_name;src=idp.logos[logos.key];if(src.indexOf("http")===-1)src=baseURL+src;img.src=src;if(img.dataset==null)img.dataset={};img.dataset.key=member;span=this.create("ais-chooser-grid-cell-label",div,"span");span.innerHTML=idp.display_name}else div.innerHTML=idp.display_name}}};if(this.grid.innerHTML!==""){this.classList.add("ais-chooser-featured");this.label.textContent="Other "};options=this.select.options;for(index=_k=0,_len2=options.length;_k<_len2;index=++_k){option=options[index];this.select.options.remove(index)};if(footprints.length>0)for(_l=0,_len3=footprints.length;_l<_len3;_l++){key=footprints[_l];options[options.length]=new Option(""+idps[key].display_name,""+key)};for(key in idps){value=idps[key];options[options.length]=new Option(""+value.display_name,""+key)};this.classList.remove("hidden");break;case AISNotifications.AUTHENTICATING:this.classList.add("hidden")}};function AISPlayMediator(parent){AISPlayMediator.__super__.constructor.call(this,null,null,parent)};__extends(AISPlayMediator,ComponentMediator);AISPlayMediator.prototype.componentName="ais-play";AISPlayMediator.prototype.menu=null;AISPlayMediator.prototype.restart=null;AISPlayMediator.prototype.resume=null;AISPlayMediator.prototype.resumeTime=null;AISPlayMediator.prototype.onRegister=function(){var _this=this;this.classList.add("hidden");this.menu=this.create("ais-play-menu");this.restart=this.create("ais-play-restart",this.menu);this.restart.type="button";this.restart.textContent="Restart";this.restart.onclick=function(event){if(typeof event.stopImmediatePropagation==="function")event.stopImmediatePropagation();_this.play();return false};this.resume=this.create("ais-play-resume",this.menu);this.resume.type="button";this.resume.value="Resume";this.restart.onclick=function(event){if(typeof event.stopImmediatePropagation==="function")event.stopImmediatePropagation();_this.play(_this.resumeTime);return false};AISPlayMediator.__super__.onRegister.call(this)};AISPlayMediator.prototype.play=function(time){var proxy;proxy=this.facade.retrieveProxy(AISProxy.NAME);proxy.play(time)};AISPlayMediator.prototype.listNotificationInterests=function(){return[AISNotifications.CHOOSE_PLAY_OPTIONS]};AISPlayMediator.prototype.handleNotification=function(notification){switch(notification.getName()){case AISNotifications.CHOOSE_PLAY_OPTIONS:this.resumeTime=notification.getBody();this.classList.remove("hidden")}};function AISAuthorizeCommand(){AISAuthorizeCommand.__super__.constructor.call(this)};__extends(AISAuthorizeCommand,AISCommand);AISAuthorizeCommand.prototype.execute=function(notification){var media;this.facade.logger.debug("AISAuthenticateMediaCommand");media=this.facade.app.retrieveProxy(MediaProxy.NAME).getData();if(media.status.reason==="ais")this.getProxy().authorize()};function AISAPI(module){var proxy;AISAPI.__super__.constructor.call(this,module);proxy=module.retrieveProxy(AISProxy.NAME);this.authorize=proxy.authorize.bind(proxy);this.logout=proxy.logout.bind(proxy);this.getIdps=function(){return module.idps}};__extends(AISAPI,PluginAPI);AISAPI.prototype.authorize=function(media){};AISAPI.prototype.logout=function(){};AISAPI.prototype.getIdps=function(){};function AISAuthenticatingMediator(parent){AISAuthenticatingMediator.__super__.constructor.call(this,null,null,parent)};__extends(AISAuthenticatingMediator,ComponentMediator);AISAuthenticatingMediator.prototype.componentName="ais-authenticating";AISAuthenticatingMediator.prototype.retry=null;AISAuthenticatingMediator.prototype.onRegister=function(){this.classList.add("hidden");this.retry=this.create("ais-authenticating-button");this.retry.type="button";this.retry.value="Back to Providers";this.retry.onclick=this.onclick.bind(this);AISAuthenticatingMediator.__super__.onRegister.call(this)};AISAuthenticatingMediator.prototype.onclick=function(event){if(typeof event.stopImmediatePropagation==="function")event.stopImmediatePropagation();this.classList.add("hidden");this.sendNotification(AISNotifications.START_AUTHENTICATION);return false};AISAuthenticatingMediator.prototype.listNotificationInterests=function(){return[AISNotifications.AUTHENTICATING]};AISAuthenticatingMediator.prototype.handleNotification=function(notification){switch(notification.getName()){case AISNotifications.AUTHENTICATING:if(notification.getBody()===true){this.classList.remove("hidden")}else this.classList.add("hidden")}};function AISStartAuthenticationCommand(){AISStartAuthenticationCommand.__super__.constructor.call(this)};__extends(AISStartAuthenticationCommand,AISCommand);AISStartAuthenticationCommand.prototype.execute=function(notification){this.facade.logger.debug("AISStartAuthenticationCommand");this.getProxy().bounce()};function AISMediator(){AISMediator.__super__.constructor.call(this)};__extends(AISMediator,OverlayMediator);AISMediator.prototype.componentName="ais";AISMediator.prototype.chooser=null;AISMediator.prototype.auth=null;AISMediator.prototype.play=null;AISMediator.prototype.onRegister=function(){var _this=this;this.classList.add("hidden");setTimeout(function(){_this.chooser=new AISChooserMediator(_this);_this.facade.registerMediator(_this.chooser);_this.auth=new AISAuthenticatingMediator(_this);_this.facade.registerMediator(_this.auth);_this.play=new AISPlayMediator(_this);return _this.facade.registerMediator(_this.play)},20);AISMediator.__super__.onRegister.call(this)};AISMediator.prototype.listNotificationInterests=function(){return[AISNotifications.START_AUTHENTICATION,AISNotifications.AUTHENTICATION_COMPLETE,AISNotifications.CHOOSE_PLAY_OPTIONS,Notifications.MEDIA_CHANGE]};AISMediator.prototype.handleNotification=function(notification){switch(notification.getName()){case AISNotifications.CHOOSE_PLAY_OPTIONS:case AISNotifications.START_AUTHENTICATION:this.classList.remove("hidden");break;case AISNotifications.AUTHENTICATION_COMPLETE:case Notifications.MEDIA_CHANGE:this.classList.add("hidden");this.facade.app.sendNotification(Notifications.REMOVE_APPLICATION_STATE,"authenticating")}};function AISPlugin(app,config){AISPlugin.__super__.constructor.call(this,app,config)};__extends(AISPlugin,Feature);AISPlugin.NAME="AISPlugin";AISPlugin.prototype.moduleName="ais";AISPlugin.prototype.featureName="auth";AISPlugin.prototype.idps=null;AISPlugin.prototype.createController=function(){this.registerCommand(SecurityNotifications.AUTHORIZE,AISAuthorizeCommand);this.registerCommand(AISNotifications.LAUNCH_IDP_LOGIN,AISLaunchIDPLoginCommand);this.registerCommand(AISNotifications.START_AUTHENTICATION,AISStartAuthenticationCommand)};AISPlugin.prototype.createModel=function(){this.registerProxy(new AISProxy(this.config))};AISPlugin.prototype.createView=function(){this.registerMediator(new AISMediator())};AISPlugin.prototype.createAPI=function(){return new AISAPI(this)};AISPlugin.prototype.listNotificationInterests=function(){return AISPlugin.__super__.listNotificationInterests.call(this).concat([Notifications.MEDIA_CHANGE,SecurityNotifications.AUTHORIZE])};AISPlugin.prototype.listNotificationPublications=function(){return AISPlugin.__super__.listNotificationPublications.call(this).concat([SecurityNotifications.AUTHORIZATION_FAILED,SecurityNotifications.AUTHORIZED,SecurityNotifications.SET_TOKEN,SecurityNotifications.SET_KEY,Notifications.INITIALIZED,Notifications.PLAY,Notifications.SEEK])};AISPlugin.prototype.listNotificationEvents=function(){return AISPlugin.__super__.listNotificationEvents.call(this).concat([AISNotifications.AUTHENTICATED])};AMP.registerPlugin("ais","html",AISPlugin);function AISFlashPlugin(app,config){AISFlashPlugin.__super__.constructor.call(this,app,config)};__extends(AISFlashPlugin,AISPlugin);AISFlashPlugin.NAME="AISFlashPlugin";AISFlashPlugin.prototype.proxy=null;AISFlashPlugin.prototype.startTime=null;AISFlashPlugin.prototype.createController=function(){this.registerCommand(AISNotifications.LAUNCH_IDP_LOGIN,AISLaunchIDPLoginCommand);this.registerCommand(AISNotifications.START_AUTHENTICATION,AISStartAuthenticationCommand)};AISFlashPlugin.prototype.setData=function(data){var proxy;proxy=this.retrieveProxy(AISProxy.NAME);proxy.data.platformID=data.platformID;proxy.data.resourceID=data.resourceID;proxy.data.contentID=data.contentID};AISFlashPlugin.prototype.authorize=function(media){this.retrieveProxy(AISProxy.NAME).authorize(media)};function SharePlugin(app,config){SharePlugin.__super__.constructor.call(this,app,config)};__extends(SharePlugin,Feature);SharePlugin.NAME="SharePlugin";SharePlugin.prototype.moduleName="share";SharePlugin.prototype.featureName="share";SharePlugin.prototype.createModel=function(){this.registerProxy(new ShareProxy(this.config))};SharePlugin.prototype.createController=function(){this.registerCommand(Notifications.MEDIA_CHANGE,ShareMediaChangeCommand)};SharePlugin.prototype.createView=function(){this.registerMediator(new ShareMediator())};SharePlugin.prototype.listNotificationInterests=function(){return[Notifications.MEDIA_CHANGE]};SharePlugin.prototype.listNotificationPublications=function(){return SharePlugin.__super__.listNotificationPublications.apply(this,arguments).concat([Notifications.ADD_CONTROL,Notifications.REMOVE_CONTROL,Notifications.ADD_CONTROL_STATE,Notifications.REMOVE_CONTROL_STATE])};AMP.registerPlugin("share","html",SharePlugin);AMP.registerPlugin("share","external",SharePlugin);function AISWrapper(player,init){var _this=this;AISWrapper.__super__.constructor.call(this,player,init);this.plugin=new AISFlashPlugin(this.player,init);this.plugin.getAPI().addEventListener("loggedin",function(event){_this.facade.dispatcher.dispatchEvent(event)});player.registerModule(this.plugin)};__extends(AISWrapper,PluginWrapper);AISWrapper.NAME="AISWrapper";AISWrapper.plugin=null;AISWrapper.prototype.getAPI=function(){return this.plugin.getAPI()};AISWrapper.prototype.getFeatureName=function(){return"auth"};AISWrapper.prototype.createXML=function(xml){var application,auth,element,prop,props,text,vendor,_i,_len;application=xml.getElementsByTagName("application")[0];auth=xml.getElementsByTagName("authentication");if(!(auth!=null)||auth.length===0){auth=xml.createElement("authentication");application.appendChild(auth)}else auth=auth[0];vendor=xml.createElement("vendor");vendor.setAttribute("id","ais");auth.appendChild(vendor);props=[{value:this.config.platformID,key:"platformID"},{value:this.config.resourceID,key:"resourceID"},{value:this.config.contentID,key:"contentID"}];for(_i=0,_len=props.length;_i<_len;_i++){prop=props[_i];if(!(prop.value!=null))continue;element=xml.createElement("property");element.setAttribute("key",prop.key);text=XMLUtils.createTextContent(xml,prop.value);element.appendChild(text);vendor.appendChild(element)};return xml};AISWrapper.prototype.listNotificationInterests=function(){return AISWrapper.__super__.listNotificationInterests.apply(this,arguments).concat([FlashNotifications.AUTHORIZE,FlashNotifications.TIME_UPDATE,FlashNotifications.ENDED,FlashNotifications.PAUSED,FlashNotifications.CAPABILITY_CHANGE,FlashNotifications.RESET])};AISWrapper.prototype.handleNotification=function(notification){var body,mediaProxy,name;AISWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.AUTHORIZE:this.plugin.startTime=null;this.plugin.setData(body);mediaProxy=this.player.retrieveProxy(FlashMediaProxy.NAME);if(!(mediaProxy.getSrc()!=null))mediaProxy.setSrc(body.media.src);this.plugin.authorize();break;case FlashNotifications.TIME_UPDATE:this.plugin.sendNotification(Notifications.TIME_UPDATE,body);break;case FlashNotifications.ENDED:this.plugin.sendNotification(Notifications.ENDED,body);break;case FlashNotifications.PAUSED:this.plugin.sendNotification(Notifications.PAUSE,body);break;case FlashNotifications.RESET:this.plugin.sendNotification(Notifications.MEDIA_CHANGE,body);break;case FlashNotifications.CAPABILITY_CHANGE:if((this.plugin.startTime!=null)&&body.type==="canSeekChange"&&body.enabled)this.player.setCurrentTime(this.plugin.startTime)}};AMP.registerPlugin("ais","flash",AISWrapper);function FreeWheelProxy(config){this.media={};FreeWheelProxy.__super__.constructor.call(this,config)};__extends(FreeWheelProxy,AdProxy);FreeWheelProxy.NAME=AdProxy.NAME;FreeWheelProxy.prototype.context=null;FreeWheelProxy.prototype.prerollSlots=null;FreeWheelProxy.prototype.midrollSlots=null;FreeWheelProxy.prototype.postrollSlots=null;FreeWheelProxy.prototype.initialized=false;FreeWheelProxy.prototype.playWhenLoaded=false;FreeWheelProxy.prototype.timeupdate=null;FreeWheelProxy.prototype.canplaythrough=null;FreeWheelProxy.prototype.seeked=null;FreeWheelProxy.prototype.media=null;FreeWheelProxy.prototype.slot=null;FreeWheelProxy.prototype.playbackCore=null;FreeWheelProxy.prototype.defaults={plugin:{js:"http://adm.fwmrm.net/p/vitest-js/AdManager.js"},networkId:"96749",serverUrl:"http://demo.v.fwmrm.net/ad/g/1",profileId:"global-js",siteSectionId:"DemoSiteGroup.01",siteSectionFallbackId:null,videoAssetId:'#{media.guid}',videoAssetFallbackId:null,prerollSlotId:null,midrollSlotId:null,postrollSlotId:null,visitorId:null,keyValues:null,keyValuesString:null,renderers:null};FreeWheelProxy.prototype.getLoaded=function(){var _ref,_ref1;return(typeof tv!=="undefined"&&tv!==null?(_ref=tv.freewheel)!=null?(_ref1=_ref.SDK)!=null?_ref1.AdManager:void(0):void(0):void(0))!=null};FreeWheelProxy.prototype.initialize=function(){this.plugin=this.createPlugin();this.plugin.setNetwork(this.value.networkId);this.plugin.setServer(this.value.serverUrl)};FreeWheelProxy.prototype.createPlugin=function(){return new tv.freewheel.SDK.AdManager()};FreeWheelProxy.prototype.engage=function(media){var cuePoints,index,key,keyValue,pair,pairs,renderer,renderers,scene,time,value,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2;FreeWheelProxy.__super__.engage.call(this,media);this.sendNotification(Notifications.DISABLE_VIDEO_EVENTS,["ended","durationchange","error"]);this.prerollSlots=[];this.midrollSlots=[];this.postrollSlots=[];this.context=this.plugin.newContext();this.context.registerVideoDisplayBase(this.facade.app.viewComponent.id);this.context.setProfile(this.value.profileId);this.context.setVideoAsset(this.value.videoAssetId,media.duration,this.value.networkId,null,null,null,null,this.videoAssetFallbackId);this.context.setSiteSection(this.value.siteSectionId,this.value.networkId,null,null,this.siteSectionFallbackId);if(this.value.visitorId!=null)this.context.setVisitor(this.value.visitorId);if(this.value.keyValues!=null){_ref=this.value.keyValues;for(key in _ref){value=_ref[key];if(value!=null)this.context.addKeyValue(key,value)}};if(this.value.keyValuesString!=null){pairs=this.value.keyValuesString.split("&");for(_i=0,_len=pairs.length;_i<_len;_i++){pair=pairs[_i];if(!(pair!==""))continue;keyValue=pair.split("=");this.context.addKeyValue(keyValue[0],keyValue[1])}};this.context.addEventListener(tv.freewheel.SDK.EVENT_REQUEST_COMPLETE,this.onRequestComplete.bind(this));this.context.addEventListener(tv.freewheel.SDK.EVENT_SLOT_STARTED,this.onSlotStarted.bind(this));this.context.addEventListener(tv.freewheel.SDK.EVENT_SLOT_ENDED,this.onSlotEnded.bind(this));this.context.addEventListener(tv.freewheel.SDK.EVENT_AD_IMPRESSION,this.onAdImpression.bind(this));this.context.addEventListener(tv.freewheel.SDK.EVENT_AD_IMPRESSION_END,this.onAdImpressionEnd.bind(this));this.context.setParameter(tv.freewheel.SDK.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT,1e4,tv.freewheel.SDK.PARAMETER_LEVEL_GLOBAL);this.context.setParameter(tv.freewheel.SDK.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT,1e4,tv.freewheel.SDK.PARAMETER_LEVEL_GLOBAL);if(this.value.prerollSlotId!=null)this.context.addTemporalSlot(this.value.prerollSlotId,tv.freewheel.SDK.ADUNIT_PREROLL,0);if(((_ref1=media.scenes)!=null?_ref1.length:void(0))>0&&(this.value.midrollSlotId!=null)){cuePoints=[];_ref2=media.scenes;for(index=_j=0,_len1=_ref2.length;_j<_len1;index=++_j){scene=_ref2[index];if(!(index>0))continue;time=Utils.flattenTimecode(scene.sceneStartTime);cuePoints.push(time);this.context.addTemporalSlot(this.value.midrollSlotId,tv.freewheel.SDK.ADUNIT_MIDROLL,time)};this.facade.app.sendNotification(Notifications.ADD_CUE_POINTS,cuePoints)};if(this.value.postrollSlotId!=null)this.context.addTemporalSlot(this.value.postrollSlotId,tv.freewheel.SDK.ADUNIT_POSTROLL,media.duration);renderers=this.value.renderers;if((renderers!=null?renderers.length:void(0))>0)for(_k=0,_len2=renderers.length;_k<_len2;_k++){renderer=renderers[_k];this.context.addRenderer(renderer.url,renderer.baseUnit,renderer.contentType,renderer.slotType,renderer.soAdUnit,renderer.creativeApi,renderer.parameters)};this.context.submitRequest()};FreeWheelProxy.prototype.breakStart=function(){this.playbackCore=this.facade.app.retrieveProxy(PlayerProxy.NAME).getActivePlaybackCore();this.sendNotification(Notifications.DISABLE_VIDEO_EVENTS,["ended","durationchange","error"])};FreeWheelProxy.prototype.reset=function(media){FreeWheelProxy.__super__.reset.call(this,media);this.sendNotification(Notifications.ENABLE_VIDEO_EVENTS,["ended","durationchange","error"])};FreeWheelProxy.prototype.onAdImpression=function(event){this.sendNotification(AdNotifications.AD_STARTED,this.adVO)};FreeWheelProxy.prototype.onAdImpressionEnd=function(event){this.sendNotification(AdNotifications.AD_ENDED,this.adVO)};FreeWheelProxy.prototype.onRequestComplete=function(event){var cues,slot,slots,_i,_len;this.facade.logger.log("FreeWheelProxy: -> onRequestComplete, success: "+event.success,event);cues=[];if(event.success){slots=this.context.getTemporalSlots();for(_i=0,_len=slots.length;_i<_len;_i++){slot=slots[_i];switch(slot.getTimePositionClass()){case tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL:this.prerollSlots.push(slot);break;case tv.freewheel.SDK.TIME_POSITION_CLASS_MIDROLL:cues.push(slot.getTimePosition());this.midrollSlots.push(slot);break;case tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL:this.postrollSlots.push(slot)}}};if(cues.length>0)this.sendNotification(Notifications.ADD_CUE_POINTS,cues);this.initialized=true;this.media.currentTime=0;if(this.playWhenLoaded===true)this.startAd()};FreeWheelProxy.prototype.midrollCheck=function(event){var midroll,video;video=event.currentTarget;midroll=this.midrollSlots[0];if(this.playbackCore.getCurrentTime()>=midroll.getTimePosition()){this.media.src=this.playbackCore.getSrc();this.media.currentTime=video.currentTime;video.removeEventListener("timeupdate",this.timeupdate);this.playAd(midroll)}};FreeWheelProxy.prototype.midrollSeekCheck=function(event){var video;video=event.currentTarget;video.removeEventListener("canplaythrough",this.canplaythrough);if(this.media.currentTime>0){video.addEventListener("seeked",this.seeked);video.currentTime=this.media.currentTime}else this.engageMidroll(video)};FreeWheelProxy.prototype.midrollSeeked=function(event){var video;video=event.currentTarget;video.removeEventListener("seeked",this.seeked);this.engageMidroll(video)};FreeWheelProxy.prototype.engageMidroll=function(video){var _ref;if(video==null)video=this.facade.app.getVideo();if(((_ref=this.midrollSlots)!=null?_ref.length:void(0))>0)video.addEventListener("timeupdate",this.timeupdate);this.contentPlay()};FreeWheelProxy.prototype.adTimeupdate=function(event){try{if(this.slot)this.sendNotification(AdNotifications.AD_TIME_REMAINING,this.slot.getTotalDuration()-this.slot.getPlayheadTime())}catch(error){this.facade.logger.error("FreeWheelProxy Error: "+error)}};FreeWheelProxy.prototype.onSlotStarted=function(event){this.slot=event.slot;this.timeupdate=this.adTimeupdate.bind(this);this.facade.app.getVideo().addEventListener("timeupdate",this.timeupdate)};FreeWheelProxy.prototype.onSlotEnded=function(event){var slotTimePositionClass,_ref;this.facade.logger.log("FreeWheelProxy: -> onSlotEnded slotTimePositionClass: "+event.slot.getTimePositionClass());this.facade.app.getVideo().removeEventListener("timeupdate",this.timeupdate);slotTimePositionClass=event.slot.getTimePositionClass();this.slot=null;switch(slotTimePositionClass){case tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL:if(this.prerollSlots.length){this.prerollSlots.shift();if(this.prerollSlots.length){this.playAd(this.prerollSlots[0])}else{this.sendNotification(AdNotifications.BREAK_END);if(((_ref=this.midrollSlots)!=null?_ref.length:void(0))>0){this.timeupdate=this.midrollCheck.bind(this);this.canplaythrough=this.midrollSeekCheck.bind(this);this.seeked=this.midrollSeeked.bind(this);this.facade.app.getVideo().addEventListener("timeupdate",this.timeupdate)}}};break;case tv.freewheel.SDK.TIME_POSITION_CLASS_MIDROLL:this.midrollSlots.shift();this.facade.app.getVideo().addEventListener("canplaythrough",this.canplaythrough);this.playbackCore.setSrc(this.media.src);this.sendNotification(AdNotifications.BREAK_END);break;case tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL:if(this.postrollSlots.length){this.postrollSlots.shift();if(this.postrollSlots.length){this.playAd(this.postrollSlots[0])}else this.context.setVideoState(tv.freewheel.SDK.VIDEO_STATE_COMPLETED)}}};FreeWheelProxy.prototype.playAd=function(ad){this.adVO=new AdVO(ad.getCustomId(),ad.getCustomId(),ad.getTotalDuration(),ad.getTimePosition(),ad.getTimePositionClass().toLowerCase(),"freewheel",null,null,null,ad);this.sendNotification(AdNotifications.BREAK_START,this.adVO);this.sendNotification(AdNotifications.AD_LOADED,this.adVO);try{ad.play()}catch(error){this.error(error)}};FreeWheelProxy.prototype.start=function(){if(FreeWheelProxy.__super__.start.call(this)===false)return false;if(this.canPlay()===true){this.startAd()}else this.playWhenLoaded=true;return true};FreeWheelProxy.prototype.canPlay=function(){return this.initialized===true};FreeWheelProxy.prototype.startAd=function(){this.playWhenLoaded=false;if(this.prerollSlots.length){this.playAd(this.prerollSlots[0])}else this.sendNotification(AdNotifications.BREAK_END,this.adVO)};FreeWheelProxy.prototype.play=function(){FreeWheelProxy.__super__.play.call(this);this.facade.app.getVideo().play()};FreeWheelProxy.prototype.pause=function(){var video;FreeWheelProxy.__super__.pause.call(this);video=this.facade.app.getVideo();video.pause();setTimeout(function(){return video.controls=false},0)};FreeWheelProxy.prototype.breakEnd=function(){this.sendNotification(Notifications.DISABLE_VIDEO_EVENTS,["paused"]);FreeWheelProxy.__super__.breakEnd.call(this);this.facade.app.sendNotification(Notifications.PLAY,true);this.context.setVideoState(tv.freewheel.SDK.VIDEO_STATE_PLAYING);this.sendNotification(Notifications.ENABLE_VIDEO_EVENTS,["paused"])};FreeWheelProxy.prototype.contentEnded=function(){var _ref;this.facade.logger.log("FreeWheelProxy: -> onContentVideoEnded");this.context.setVideoState(tv.freewheel.SDK.VIDEO_STATE_STOPPED);if(((_ref=this.postrollSlots)!=null?_ref.length:void(0))){this.playAd(this.postrollSlots[0])}else this.context.setVideoState(tv.freewheel.SDK.VIDEO_STATE_COMPLETED)};function FreeWheelWrapper(){return FreeWheelWrapper.__super__.constructor.apply(this,arguments)};__extends(FreeWheelWrapper,AdWrapper);FreeWheelWrapper.NAME="FreeWheelWrapper";FreeWheelWrapper.prototype.createXML=function(xml){var admedia,application,key,keyValue,prop,props,value,vendor,_i,_len,_ref;application=xml.getElementsByTagName("application")[0];admedia=xml.getElementsByTagName("admedia")[0];if(!(admedia!=null)){admedia=xml.createElement("admedia");application.appendChild(admedia)};vendor=xml.createElement("vendor");vendor.setAttribute("id","freewheel");admedia.appendChild(vendor);props=[{value:this.config.plugin.swf,key:"FREEWHEEL_AD_MANAGER_URL"},{value:this.config.serverUrl,key:"FREEWHEEL_SERVER_URL"},{value:this.config.networkId,key:"FREEWHEEL_NETWORK_ID"},{value:this.config.profileId,key:"FREEWHEEL_PROFILE"},{value:this.config.siteSectionId,key:"FREEWHEEL_SITE_SECTION_ID"},{value:this.config.siteSectionFallbackId,key:"FREEWHEEL_SITE_SECTION_FALLBACK_ID"},{value:this.config.prerollSlotId,key:"FREEWHEEL_PREROLL_SLOT_ID"},{value:this.config.midrollSlotId,key:"FREEWHEEL_MIDROLL_SLOT_ID"},{value:this.config.postrollSlotId,key:"FREEWHEEL_POSTROLL_SLOT_ID"},{value:this.config.videoAssetId,key:"FREEWHEEL_VIDEO_ASSET_ID"},{value:this.config.videoAssetFallbackId,key:"FREEWHEEL_VIDEO_ASSET_FALLBACK_ID"},{value:this.config.videoAssetVideoPlayRandom,key:"FREEWHEEL_VIDEO_ASSET_VIDEO_PLAY_RANDOM"},{value:this.config.visitorId,key:"FREEWHEEL_VISITOR_ID"},{value:this.config.keyValuesString,key:"FREEWHEEL_KEY_VALUES_STRING"},{value:"30898",key:"FREEWHEEL_SITE_SECTION_PAGE_VIEW_RANDOM"},{value:"EXACT",key:"FREEWHEEL_VIDEO_ASSET_DURATION_TYPE"},{value:this.config.visitorHeader,key:"FREEWHEEL_VISITOR_HTTP_HEADER_KEY_VALUE"}];for(_i=0,_len=props.length;_i<_len;_i++){prop=props[_i];if(prop.value!=null)this.createProperty(xml,prop.key,prop.value,vendor)};if(this.config.position!=null)vendor.setAttribute("position",this.config.position);if(this.config.keyValues!=null){keyValue=xml.createElement("property");keyValue.setAttribute("key","FREEWHEEL_KEY_VALUE");_ref=this.config.keyValues;for(key in _ref){value=_ref[key];if(value!=null)this.createProperty(xml,key,value,keyValue)};vendor.appendChild(keyValue)}};function DASHPlaybackProxy(data){DASHPlaybackProxy.__super__.constructor.call(this,data.types);this.buffer=data.buffer};__extends(DASHPlaybackProxy,PlaybackCoreProxy);DASHPlaybackProxy.prototype.initialized=true;DASHPlaybackProxy.prototype.playbackCoreName="dash";DASHPlaybackProxy.prototype.context=null;DASHPlaybackProxy.prototype.player=null;DASHPlaybackProxy.prototype.buffer=null;DASHPlaybackProxy.prototype.isDVR=false;DASHPlaybackProxy.prototype.createPlayer=function(type){var video,_this=this;video=this.facade.getVideo();this.context=new Dash.di.DashContext();this.player=new MediaPlayer(this.context);if(this.buffer!=null)MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME=this.buffer;this.player.startup();this.player.addEventListener("error",this.onError.bind(this));this.player.debug.setLogToBrowserConsole(false);this.player.attachView(video);this.player.setAutoPlay(false);this.player.attachSource(this.getSrc());this.isDVR=this.facade.retrieveProxy(MediaProxy.NAME).getTemporalType()==="dvr";if(this.isDVR===true){this.sendNotification(Notifications.DISABLE_VIDEO_EVENTS,["timeupdate","durationchange"]);video.addEventListener("timeupdate",function(event){var duration,time;try{time=_this.player.time();duration=_this.player.duration();_this.sendNotification(Notifications.DISPLAY_TIME,{value:time/duration,currentTime:time,duration:duration})}catch(error){_this.facade.logger.error(error)}})}};DASHPlaybackProxy.prototype.setCurrentTime=function(value){if(this.isDVR===true){this.getCore().currentTime=this.player.getDVRSeekOffset(value)}else DASHPlaybackProxy.__super__.setCurrentTime.call(this,value)};DASHPlaybackProxy.prototype.getDuration=function(){if(this.isDVR===true){return this.player.duration()}else return DASHPlaybackProxy.__super__.getDuration.call(this)};DASHPlaybackProxy.prototype.getStats=function(){return{}};DASHPlaybackProxy.prototype.onError=function(event){this.facade.logger.error("DASH JS Playback Error:",event)};function StatsPlugin(app,config){StatsPlugin.__super__.constructor.call(this,app,config)};__extends(StatsPlugin,Plugin);StatsPlugin.NAME="StatsPlugin";StatsPlugin.prototype.moduleName="stats";StatsPlugin.prototype.createModel=function(){this.registerProxy(new StatsProxy(this.config))};StatsPlugin.prototype.createController=function(){this.registerCommand(StatsNotifications.VISIBILITY_CHANGE,StatsVisibilityChangeCommand)};StatsPlugin.prototype.createView=function(){this.registerMediator(new StatsMediator())};StatsPlugin.prototype.createAPI=function(){return new StatsAPI(this)};StatsPlugin.prototype.listNotificationPublications=function(){return StatsPlugin.__super__.listNotificationPublications.call(this).concat([Notifications.ADD_CONTROL,Notifications.REMOVE_CONTROL,Notifications.ADD_CONTROL_STATE,Notifications.REMOVE_CONTROL_STATE,StatsNotifications.VISIBILITY_CHANGE])};AMP.registerPlugin("stats","html",StatsPlugin);function DASHChangeDisplayStateCommand(){DASHChangeDisplayStateCommand.__super__.constructor.call(this)};__extends(DASHChangeDisplayStateCommand,puremvc.SimpleCommand);DASHChangeDisplayStateCommand.prototype.execute=function(notification){var core,fullscreen,playback,proxy,state,target,_this=this;state=notification.getBody();playback=this.facade.retrieveProxy(PlaybackProxy.NAME);core=playback.getCore();if(!(core!=null)||!core.webkitSupportsFullscreen)return;proxy=this.facade.retrieveProxy(ApplicationStateProxy.NAME);proxy.setDisplayState(state);fullscreen={};target=this.facade.viewComponent;if(target.requestFullscreen!=null){fullscreen.enter=function(){return target.requestFullscreen()};fullscreen.exit=function(){return document.cancelFullscreen()};fullscreen.event="onfullscreenchange";fullscreen.element="fullscreenElement"}else if(target.webkitRequestFullScreen!=null){fullscreen.enter=function(){return target.webkitRequestFullScreen()};fullscreen.exit=function(){return document.webkitCancelFullScreen()};fullscreen.event="onwebkitfullscreenchange";fullscreen.element="webkitFullscreenElement"}else if(target.mozRequestFullScreen!=null){fullscreen.enter=function(){return target.mozRequestFullscreen()};fullscreen.exit=function(){return document.mozCancelFullScreen()};fullscreen.event="onmozfullscreenchange";fullscreen.element="mozFullscreenElement"}else if(target.msRequestFullScreen!=null){fullscreen.enter=function(){return target.msRequestFullscreen()};fullscreen.exit=function(){return document.msCancelFullScreen()};fullscreen.event="onmozfullscreenchange";fullscreen.element="mozFullscreenElement"};if(state===DisplayState.FULL_SCREEN){fullscreen.enter();if(fullscreen.event!=null)core[fullscreen.event]=function(event){if(!(document[fullscreen.element]!=null))return _this.sendNotification(Notifications.CHANGE_DISPLAY_STATE,DisplayState.NORMAL)}}else if(state===DisplayState.NORMAL){fullscreen.exit();core[fullscreen.event]=null};this.facade.dispatchEvent(new Event("fullscreenchange",state===DisplayState.FULL_SCREEN))};function DASHProxy(config){DASHProxy.__super__.constructor.call(this,config)};__extends(DASHProxy,PluginProxy);DASHProxy.NAME=ModuleProxy.NAME;DASHProxy.prototype.defaults={plugin:null,types:["application/dash+xml"],buffer:null};DASHProxy.prototype.initialize=function(){var core,player;window.MediaSource=window.MediaSource||window.WebKitMediaSource;if(window.MediaSource!=null){this.sendNotification(Notification.INITIALIZED);core=new DASHPlaybackProxy(this.getConfigurationData());player=this.facade.app.retrieveProxy(PlayerProxy.NAME);player.registerPlaybackCore(core)}};var ChromeCastConstants={CHANNEL_ID:"urn:x-cast:com.akamai.amp.cast",APPLICATION_ID:"44B6E47D",SUPPORTED_TYPES:[Utils.mimeTypes.m3u8,Utils.mimeTypes.mp4,Utils.mimeTypes.mpd,Utils.mimeTypes.ism,Utils.mimeTypes.webm,Utils.mimeTypes.mp3]};function FreeWheelPlugin(app,init){FreeWheelPlugin.__super__.constructor.call(this,app,init)};__extends(FreeWheelPlugin,AdPlugin);FreeWheelPlugin.NAME="FreeWheelPlugin";FreeWheelPlugin.prototype.moduleName="freewheel";FreeWheelPlugin.prototype.featureName="ads";FreeWheelPlugin.prototype.createFullscreenProxy=function(){return this.createProxy()};FreeWheelPlugin.prototype.createProxy=function(){return new FreeWheelProxy(this.config)};FreeWheelPlugin.prototype.isFullscreenDevice=function(){return true};FreeWheelPlugin.prototype.createView=function(){var adMediator;adMediator=new AdMediator();adMediator.adContainerRequired=false;return this.registerMediator(adMediator)};AMP.registerPlugin("freewheel","html",FreeWheelPlugin);AMP.registerPlugin("freewheel","flash",FreeWheelWrapper);function ChromeCastLaunchCommand(){ChromeCastLaunchCommand.__super__.constructor.call(this)};__extends(ChromeCastLaunchCommand,PluginCommand);ChromeCastLaunchCommand.prototype.execute=function(notification){this.config.launch()};function ChromeCastFeedChangedCommand(){ChromeCastFeedChangedCommand.__super__.constructor.call(this)};__extends(ChromeCastFeedChangedCommand,PluginCommand);ChromeCastFeedChangedCommand.prototype.execute=function(notification){this.config.setFeed(notification.getBody())};function ChromeCastCaptioningVisibilityChangeCommand(){ChromeCastCaptioningVisibilityChangeCommand.__super__.constructor.call(this)};__extends(ChromeCastCaptioningVisibilityChangeCommand,PluginCommand);ChromeCastCaptioningVisibilityChangeCommand.prototype.execute=function(notification){this.config.send({type:"captioning.visibilitychange",details:{visibility:notification.getBody()}})};function ChromeCastCaptioningSettingsChangeCommand(){ChromeCastCaptioningSettingsChangeCommand.__super__.constructor.call(this)};__extends(ChromeCastCaptioningSettingsChangeCommand,PluginCommand);ChromeCastCaptioningSettingsChangeCommand.prototype.execute=function(notification){this.config.send({type:"captioning.settingschange",details:notification.getBody()})};function ChromeCastReceiverReadyCommand(){ChromeCastReceiverReadyCommand.__super__.constructor.call(this)};__extends(ChromeCastReceiverReadyCommand,PluginCommand);ChromeCastReceiverReadyCommand.prototype.execute=function(notification){this.facade.logger.debug("ChromeCastReceiverReadyCommand");this.facade.app.getViewComponent().hidden=false;this.plugin.ready()};function ChromeCastPlaybackProxy(types){ChromeCastPlaybackProxy.__super__.constructor.call(this,types)};__extends(ChromeCastPlaybackProxy,PlaybackCoreProxy);ChromeCastPlaybackProxy.prototype.initialized=true;ChromeCastPlaybackProxy.prototype.player=null;ChromeCastPlaybackProxy.prototype.host=null;ChromeCastPlaybackProxy.prototype.protocol=null;ChromeCastPlaybackProxy.prototype.playbackCoreName="chromecast";ChromeCastPlaybackProxy.prototype.unload=function(){if(this.player!=null){this.player.unload();this.player=null}};ChromeCastPlaybackProxy.prototype.createPlayer=function(type){var initStart,types,video,_this=this;this.unload();video=this.facade.getVideo();if(video.src!=null)video.src=null;initStart=0;if(Logger.enabled===true)cast.player.api.setLoggerLevel(cast.player.api.LoggerLevel.DEBUG);this.host=new cast.player.api.Host({mediaElement:video,url:this.getSrc()});this.host.onError=function(errorCode){_this.facade.logger.error("Google Media Player Fatal Error - "+errorCode);_this.player.unload()};types=Utils.mimeTypes;switch(type){case types.m3u8:this.protocol=cast.player.api.CreateHlsStreamingProtocol(this.host);break;case types.mpd:this.protocol=cast.player.api.CreateDashStreamingProtocol(this.host);break;case types.ism:this.protocol=cast.player.api.CreateSmoothStreamingProtocol(this.host)};if(this.protocol!=null){this.player=new cast.player.api.Player(this.host);this.player.load(this.protocol,initStart)}else this.facade.logger.error("Google Media Player Error: Could not create protocol")};function ChromeCastPlayer(proxy,player){this.proxy=proxy;this.callbackMap={};this.handlerMap={};this.state=cast.receiver.media.PlayerState.IDLE;this.registerPlayer(player)};ChromeCastPlayer.prototype.proxy=null;ChromeCastPlayer.prototype.player=null;ChromeCastPlayer.prototype.callbackMap=null;ChromeCastPlayer.prototype.handlerMap=null;ChromeCastPlayer.prototype.state=null;ChromeCastPlayer.prototype.registerPlayer=function(player){this.player=player;this.registerHandler("playing",this.setState.bind(this,cast.receiver.media.PlayerState.PLAYING));this.registerHandler("pause",this.setState.bind(this,cast.receiver.media.PlayerState.PAUSED));this.registerHandler("waiting",this.setState.bind(this,cast.receiver.media.PlayerState.BUFFERING))};ChromeCastPlayer.prototype.registerHandler=function(type,handler){this.handlerMap[type]=handler;this.player.addEventListener(type,handler)};ChromeCastPlayer.prototype.removeHandler=function(type){this.player.removeEventListener(type,this.handlerMap[type]);this.handlerMap[type]=null;delete this.handlerMap[type]};ChromeCastPlayer.prototype.registerCallback=function(type,callback){this.callbackMap[type]=callback;this.player.addEventListener(type,callback)};ChromeCastPlayer.prototype.unregisterCallback=function(type){this.player.removeEventListener(type,this.callbackMap[type]);this.callbackMap[type]=null;delete this.callbackMap[type]};ChromeCastPlayer.prototype.canplaythroughHandler=function(time,autoplay){this.removeHandler("canplaythrough");if((time!=null)&&time>0){this.registerHandler("seeked",this.seekedHandler.bind(this,autoplay));this.player.setCurrentTime(time)}else if(autoplay===true)this.player.play()};ChromeCastPlayer.prototype.seekedHandler=function(autoplay){this.removeHandler("seeked");if(autoplay)this.player.play()};ChromeCastPlayer.prototype.setState=function(state){if(state===this.state)return;this.state=state;this.proxy.mediaManager.broadcastStatus(true)};ChromeCastPlayer.prototype.registerErrorCallback=function(errorCallback){this.registerCallback("error",errorCallback)};ChromeCastPlayer.prototype.registerEndedCallback=function(endedCallback){this.registerCallback("ended",endedCallback)};ChromeCastPlayer.prototype.registerLoadCallback=function(loadCallback){this.registerCallback("loadedmetadata",loadCallback)};ChromeCastPlayer.prototype.unregisterErrorCallback=function(){this.unregisterCallback("error")};ChromeCastPlayer.prototype.unregisterEndedCallback=function(){this.unregisterCallback("ended")};ChromeCastPlayer.prototype.unregisterLoadCallback=function(){this.unregisterCallback("loadedmetadata")};ChromeCastPlayer.prototype.load=function(contentId,autoplay,opt_time,opt_tracksInfo){var customData,feed,info,key,media,value,_ref;info=this.proxy.mediaManager.getMediaInformation();customData=info.customData;this.registerHandler("canplaythrough",this.canplaythroughHandler.bind(this,opt_time,autoplay));if(((customData!=null?customData.feed:void(0))!=null)&&(this.player.feed!=null)){feed=customData.feed;this.registerHandler("mediachange",this.mediachangeHandler.bind(this));if(feed.data!=null){this.player.feed.setData(feed.data)}else if(feed.url!=null)this.player.feed.setURL(feed.url)}else{media={src:contentId,type:info.contentType,title:info.metadata.title,poster:info.metadata.image,description:info.metadata.subtitle,pubDate:new Date(info.releaseDate),metadata:customData};if((customData!=null?customData.media:void(0))!=null){_ref=customData.media;for(key in _ref){value=_ref[key];if(!(media[key]!=null))media[key]=value}};this.player.setMedia(media)}};ChromeCastPlayer.prototype.mediachangeHandler=function(event){var media,mediaInfo;this.removeHandler("mediachange");media=this.player.getMedia();mediaInfo=new cast.receiver.media.MediaInformation();mediaInfo.contentId=media.src;mediaInfo.contentType=media.type;mediaInfo.customData=media.metadata;mediaInfo.duration=media.duration;mediaInfo.metadata={title:media.title,subtitle:media.description,image:media.poster,releaseDate:media.pubDate.toISOString()};this.proxy.mediaManager.setMediaInformation(mediaInfo,true)};ChromeCastPlayer.prototype.reset=function(){};ChromeCastPlayer.prototype.play=function(){this.player.play()};ChromeCastPlayer.prototype.seek=function(time,opt_resumeState){this.player.setCurrentTime(time);switch(opt_resumeState){case cast.receiver.media.SeekResumeState.PLAYBACK_PAUSE:this.player.pause();break;case cast.receiver.media.SeekResumeState.PLAYBACK_START:this.player.play();break}};ChromeCastPlayer.prototype.pause=function(){this.player.pause()};ChromeCastPlayer.prototype.getState=function(){return this.state};ChromeCastPlayer.prototype.getCurrentTimeSec=function(){return this.player.getCurrentTime()};ChromeCastPlayer.prototype.getDurationSec=function(){return this.player.getDuration()};ChromeCastPlayer.prototype.getVolume=function(){var volume;volume=cast.receiver.media.Volume;volume.level=this.player.getVolume();volume.muted=this.player.getMuted();return volume};ChromeCastPlayer.prototype.setVolume=function(volume){if(volume.level!=null)this.player.setVolume(volume.level);if(volume.muted===true){this.player.setMuted(true)}else if(this.player.getMuted()===true)this.player.setMuted(false)};ChromeCastPlayer.prototype.editTracksInfo=function(data){};function ChromeCastReceiverMediator(){ChromeCastReceiverMediator.__super__.constructor.call(this)};__extends(ChromeCastReceiverMediator,PluginMediator);ChromeCastReceiverMediator.prototype.onRegister=function(){this.sendNotification(Notifications.ADD_APPLICATION_STATE,"chromecast-receiver");ChromeCastReceiverMediator.__super__.onRegister.call(this)};function ChromeCastSenderMediator(){ChromeCastSenderMediator.__super__.constructor.call(this)};__extends(ChromeCastSenderMediator,PluginMediator);ChromeCastSenderMediator.prototype.componentName="chromecast";ChromeCastSenderMediator.prototype.controls=null;ChromeCastSenderMediator.prototype.onRegister=function(){this.controls=new ChromeCastControlsMediator();ChromeCastSenderMediator.__super__.onRegister.call(this)};ChromeCastSenderMediator.prototype.registerOverlay=function(){};ChromeCastSenderMediator.prototype.listNotificationInterests=function(){return[Notifications.PLAYBACK_TARGET_CHANGE,Notifications.CHANGE_PLAY_STATE]};ChromeCastSenderMediator.prototype.handleNotification=function(notification){var body,name,target;name=notification.getName();body=notification.getBody();switch(name){case Notifications.PLAYBACK_TARGET_CHANGE:target=body.target;if(target==="chromecast"){this.facade.registerMediator(this.controls)}else this.facade.removeMediator(this.controls.getMediatorName());break;case Notifications.CHANGE_PLAY_STATE:this.controls.setState(body)}};function ChromeCastHTMLSenderMediator(){ChromeCastHTMLSenderMediator.__super__.constructor.call(this)};__extends(ChromeCastHTMLSenderMediator,ChromeCastSenderMediator);ChromeCastHTMLSenderMediator.prototype.chromeCastButton=null;ChromeCastHTMLSenderMediator.prototype.onRegister=function(){this.chromeCastButton=new ChromeCastButtonMediator();this.facade.registerMediator(this.chromeCastButton);ChromeCastHTMLSenderMediator.__super__.onRegister.call(this)};ChromeCastHTMLSenderMediator.prototype.listNotificationInterests=function(){return ChromeCastHTMLSenderMediator.__super__.listNotificationInterests.call(this).concat([ChromeCastNotifications.AVAILABILITY_CHANGE])};ChromeCastHTMLSenderMediator.prototype.handleNotification=function(notification){var body,name;ChromeCastHTMLSenderMediator.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case ChromeCastNotifications.AVAILABILITY_CHANGE:if(body===true){this.sendNotification(Notifications.ADD_CONTROL_STATE,"chromecast");this.facade.app.sendNotification(Notifications.ADD_CONTROL,this.chromeCastButton.getViewComponent())}else{this.sendNotification(Notifications.REMOVE_CONTROL_STATE,"chromecast");this.facade.app.sendNotification(Notifications.REMOVE_CONTROL,this.chromeCastButton.getViewComponent())}}};function ChromeCastBreakStartCommand(){ChromeCastBreakStartCommand.__super__.constructor.call(this)};__extends(ChromeCastBreakStartCommand,PluginCommand);ChromeCastBreakStartCommand.prototype.execute=function(notification){var playbackCore;this.facade.logger.debug("ChromeCastBreakStartCommand");playbackCore=this.facade.app.retrieveProxy(PlayerProxy.NAME).getActivePlaybackCore();if(playbackCore.getPlaybackCoreName()==="chromecast"){playbackCore.unload();playbackCore.src=null}};function ChromeCastReceiverProxy(config){this.messageBus=config.messageBus||ChromeCastConstants.CHANNEL_ID;ChromeCastReceiverProxy.__super__.constructor.call(this,config.receiver)};__extends(ChromeCastReceiverProxy,PluginProxy);ChromeCastReceiverProxy.NAME=ModuleProxy.NAME;ChromeCastReceiverProxy.prototype.defaults={plugin:null,mpl:null,types:["application/x-mpegURL","application/dash+xml","application/vnd.ms-sstr+xml"]};ChromeCastReceiverProxy.prototype.messageBus=null;ChromeCastReceiverProxy.prototype.castReceiverManager=null;ChromeCastReceiverProxy.prototype.castMessageBus=null;ChromeCastReceiverProxy.prototype.castChannel=null;ChromeCastReceiverProxy.prototype.startTime=0;ChromeCastReceiverProxy.prototype.currentTime=0;ChromeCastReceiverProxy.prototype.boundHandler=null;ChromeCastReceiverProxy.prototype.amp=null;ChromeCastReceiverProxy.prototype.mediaManager=null;ChromeCastReceiverProxy.prototype.mediaManagerHandlers=null;ChromeCastReceiverProxy.prototype.playbackCore=null;ChromeCastReceiverProxy.prototype.load=function(loaded){var script,_this=this;script=this.getScript();if(!((typeof cast!=="undefined"&&cast!==null?cast.receiver:void(0))!=null)){if((script!=null)&&script!==""){Utils.loadAMPScript(script,function(){_this.loadMPL(loaded)})}else this.loadComplete(false,loaded)}else this.loadMPL(loaded)};ChromeCastReceiverProxy.prototype.loadMPL=function(loaded){var mpl,_this=this;mpl=this.getConfigurationData().mpl;if(!((typeof cast!=="undefined"&&cast!==null?cast.player:void(0))!=null)){if((mpl!=null)&&mpl!==""){Utils.loadAMPScript(mpl,function(){_this.loadComplete(true,loaded)})}else this.loadComplete(false,loaded)}else this.loadComplete(true,loaded)};ChromeCastReceiverProxy.prototype.loadComplete=function(success,loaded){this.loaded=success;if(typeof loaded==="function")loaded(success)};ChromeCastReceiverProxy.prototype.getLoaded=function(){return this.loaded||(((typeof cast!=="undefined"&&cast!==null?cast.receiver:void(0))!=null)&&((typeof cast!=="undefined"&&cast!==null?cast.player:void(0))!=null))};ChromeCastReceiverProxy.prototype.initialize=function(){var core,player;this.sendNotification(Notification.INITIALIZED);core=new ChromeCastPlaybackProxy(this.getConfigurationData().types);player=this.facade.app.retrieveProxy(PlayerProxy.NAME);player.registerPlaybackCore(core)};ChromeCastReceiverProxy.prototype.ready=function(){this.castReceiverManager=cast.receiver.CastReceiverManager.getInstance();this.castReceiverManager.onReady=this.castReceiverManager.onSystemVolumeChanged=this.castReceiverManager.onVisibilityChanged=this.logEvent.bind(this);this.castReceiverManager.onSenderConnected=this.onSenderConnected.bind(this);this.castReceiverManager.onSenderDisconnected=this.onSenderDisconnected.bind(this);this.amp=this.facade.app.parent;this.mediaManager=new cast.receiver.MediaManager(this.createPlayer(this.amp));this.castMessageBus=this.castReceiverManager.getCastMessageBus(this.messageBus,cast.receiver.CastMessageBus.MessageType.JSON);this.castReceiverManager.start()};ChromeCastReceiverProxy.prototype.createPlayer=function(player){return new ChromeCastPlayer(this,player)};ChromeCastReceiverProxy.prototype.logEvent=function(message,data){if(!(message!=null)){message=data.type||""}else if(!(data!=null)){data=message.data;message=data.type};this.facade.logger.log("[CHROMECAST] ",message,data)};ChromeCastReceiverProxy.prototype.onSenderConnected=function(event){var senderID;this.logEvent("senderconnected",event);senderID=this.castReceiverManager.getSenders()[0];this.castChannel=this.castMessageBus.getCastChannel(senderID);this.castChannel.onMessage=this.onMessage.bind(this);this.castChannel.onClose=this.onClose.bind(this);this.amp.addEventListener("playstatechange",this.eventHandler.bind(this));this.amp.addEventListener("timeupdate",this.timeupdateHandler.bind(this));this.amp.addEventListener("durationchange",this.durationchangeHandler.bind(this));this.amp.addEventListener("seeking",this.eventHandler.bind(this));this.amp.addEventListener("seeked",this.eventHandler.bind(this));if(this.amp.ads!=null){this["amp"].ads.addEventListener("breakstart",this.dispatchEvent.bind(this,"ads"));this["amp"].ads.addEventListener("breakend",this.dispatchEvent.bind(this,"ads"));this["amp"].ads.addEventListener("started",this.dispatchEvent.bind(this,"ads"));this["amp"].ads.addEventListener("ended",this.dispatchEvent.bind(this,"ads"));this["amp"].ads.addEventListener("companion",this.dispatchEvent.bind(this,"ads"))}};ChromeCastReceiverProxy.prototype.onSenderDisconnected=function(event){this.logEvent("sender disconnected",event);if(this.castReceiverManager.getSenders().length===0&&event.reason===cast.receiver.system.DisconnectReason.REQUESTED_BY_SENDER)window.close()};ChromeCastReceiverProxy.prototype.onMessage=function(event){var details,message,type;this.logEvent("message from sender",event);message=event.message;type=message.type;details=message.details;if(typeof details==="string")details=JSON.parse(details);switch(type){case"captioning.visibilitychange":type=this["amp"].captioning.getTrack().type;if(type!==void(0)&&type.indexOf("608")!==-1){try{this.playbackCore.player.enableCaptions(details.visibility,cast.player.api.CaptionsType.CEA608)}catch(err){this.facade.logger.debug('caption Error 608:',err)};return};this["amp"].captioning.setHidden(details.visibility);break;case"captioning.settingschange":this["amp"].captioning.changeSettings(details);break;case"stats.visibilitychange":this["amp"].stats.setHidden(!details.visibility)};this.sendNotification(Notifications.DISPATCH_EVENT,event)};ChromeCastReceiverProxy.prototype.onClose=function(event){this.logEvent("message channel closed",event)};ChromeCastReceiverProxy.prototype.timeupdateHandler=function(event){var time;time=Math.floor(this.amp.getCurrentTime());if(this.currentTime===time)return;this.currentTime=time;this.send({type:event.type,details:{currentTime:time}})};ChromeCastReceiverProxy.prototype.durationchangeHandler=function(event){this.send({type:event.type,details:{duration:this.amp.getDuration()}})};ChromeCastReceiverProxy.prototype.eventHandler=function(event){var msg;msg={type:event.type};if(event.details!=null)msg.details=event.details;this.send(msg)};ChromeCastReceiverProxy.prototype.dispatchEvent=function(target,event){this.send({type:"dispatchevent",details:{target:target,event:event}});this.send({type:""+target+"."+event.type,details:event.details})};ChromeCastReceiverProxy.prototype.send=function(message){this.castChannel.send(message)};function ChromeCastSeekCommand(){ChromeCastSeekCommand.__super__.constructor.call(this)};__extends(ChromeCastSeekCommand,PluginCommand);ChromeCastSeekCommand.prototype.execute=function(notification){this.facade.logger.debug("ChromeCastSeekCommand");this.plugin.setCurrentTime(notification.getBody())};function ChromeCastButtonMediator(){ChromeCastButtonMediator.__super__.constructor.call(this)};__extends(ChromeCastButtonMediator,ButtonMediator);ChromeCastButtonMediator.prototype.componentName="chromecast";ChromeCastButtonMediator.prototype.onclick=function(event){event.stopImmediatePropagation();this.sendNotification(ChromeCastNotifications.LAUNCH);return false};function ChromeCastTogglePlayPauseCommand(){ChromeCastTogglePlayPauseCommand.__super__.constructor.call(this)};__extends(ChromeCastTogglePlayPauseCommand,PluginCommand);ChromeCastTogglePlayPauseCommand.prototype.execute=function(notification){var appStateProxy;this.facade.logger.debug("ChromeCastTogglePlayPauseCommand");appStateProxy=this.facade.app.retrieveProxy(ApplicationStateProxy.NAME);switch(this.config.getPlayState()){case PlayState.ENDED:this.plugin.setCurrentTime(0);this.plugin.play();break;case PlayState.PAUSED:case PlayState.READY:this.plugin.play();break;case PlayState.PLAYING:case PlayState.WAITING:this.plugin.pause()}};function ChromeCastControlsMediator(){ChromeCastControlsMediator.__super__.constructor.call(this)};__extends(ChromeCastControlsMediator,ControlsMediator);ChromeCastControlsMediator.prototype.componentName="chromecast-controls";ChromeCastControlsMediator.prototype.message=null;ChromeCastControlsMediator.prototype.messageContainer=null;ChromeCastControlsMediator.prototype.button=null;ChromeCastControlsMediator.prototype.captioningActive=false;ChromeCastControlsMediator.prototype.initializeNotifier=function(key){ChromeCastControlsMediator.__super__.initializeNotifier.call(this,key);this.viewComponent.innerHTML="";this.messageContainer=this.create("chromecast-message-container");this.message=this.createText("chromecast-message",this.localizationManager.getString("MSG_CHROMECAST_MESSAGE"),this.messageContainer);this.button=new ChromeCastButtonMediator()};ChromeCastControlsMediator.prototype.onRegister=function(){var button,fullscreen;this.facade.registerMediator(this.button);ChromeCastControlsMediator.__super__.onRegister.call(this);fullscreen=new FullScreenMediator(this.controlBar);fullscreen.setDisabled(true);this.facade.registerMediator(fullscreen);this.sendNotification(Notifications.ADD_CONTROL,this.button.getViewComponent());if(!this.viewComponent.getElementsByClassName("akamai-caption akamai-button").length&&this.facade.app.parent.captioning.config.enabled===true){button=new ButtonMediator(this.localizationManager.getString(LocalizationConstants.MSG_CC),this.viewComponent.getElementsByClassName("akamai-control-bar")[0],null,"caption",this.captionButtonClick.bind(this));this.facade.registerMediator(button);this.captionButton=button.getViewComponent();this.sendNotification(Notifications.ADD_CONTROL,this.captionButton);this.sendNotification(Notifications.ADD_CONTROL_STATE,"cc-enabled")}};ChromeCastControlsMediator.prototype.captionButtonClick=function(){var note;this.captioningActive=!this.captioningActive;try{this.facade.app.parent.chromecast.postMessage({type:"captioning.visibilitychange",details:{visibility:this.captioningActive}})}catch(error){this.facade.logger.error("[AMP Chromecast Captioning Error]",error)};note=this.captioningActive?Notifications.ADD_APPLICATION_STATE:Notifications.REMOVE_APPLICATION_STATE;this.sendNotification(note,"cc-active")};function ChromeCastPlaybackTargetChangeCommand(){ChromeCastPlaybackTargetChangeCommand.__super__.constructor.call(this)};__extends(ChromeCastPlaybackTargetChangeCommand,PluginCommand);ChromeCastPlaybackTargetChangeCommand.prototype.execute=function(notification){var api,body,currentTime,duration,target;body=notification.getBody();target=body.target;api=this.facade.app.getAPI();if(target==="chromecast"){api.pause()}else if(target==="amp"){currentTime=this.config.getCurrentTime();duration=api.getDuration();if(currentTime!==0){if(currentTime!==duration){this.seekedHandler=this.seeked.bind(this);api.addEventListener("seeked",this.seekedHandler)};this.facade.app.getAPI().setCurrentTime(currentTime)}}};ChromeCastPlaybackTargetChangeCommand.prototype.seeked=function(event){var api;api=this.facade.app.getAPI();api.removeEventListener("seeked",this.seekedHandler);api.play()};ChromeCastPlaybackTargetChangeCommand.prototype.seekedHandler=null;function ChromeCastPlugin(app,config){ChromeCastPlugin.__super__.constructor.call(this,app,config)};__extends(ChromeCastPlugin,Plugin);ChromeCastPlugin.NAME="ChromeCastPlugin";ChromeCastPlugin.prototype.moduleName="chromecast";ChromeCastPlugin.prototype.createModel=function(){if(this.isSender()){this.registerProxy(new ChromeCastSenderProxy(this.config))}else if(this.isReceiver())this.registerProxy(new ChromeCastReceiverProxy(this.config))};ChromeCastPlugin.prototype.createController=function(){if(this.isSender()){this.registerCommand(Notifications.PLAYBACK_TARGET_CHANGE,ChromeCastPlaybackTargetChangeCommand);this.registerCommand(ChromeCastNotifications.LAUNCH,ChromeCastLaunchCommand);this.registerCommand(FeedNotifications.FEED_CHANGED,ChromeCastFeedChangedCommand);this.registerCommand(UserNotifications.TOGGLE_PLAY_PAUSE,ChromeCastTogglePlayPauseCommand);this.registerCommand(UserNotifications.SEEK,ChromeCastSeekCommand);this.registerCommand(CaptioningNotifications.VISIBILITY_CHANGE,ChromeCastCaptioningVisibilityChangeCommand);this.registerCommand(CaptioningNotifications.SETTINGS_CHANGE,ChromeCastCaptioningSettingsChangeCommand)}else{this.registerCommand(Notifications.READY,ChromeCastReceiverReadyCommand);this.registerCommand(AdNotifications.BREAK_START,ChromeCastBreakStartCommand)}};ChromeCastPlugin.prototype.createView=function(){if(this.isSender()){this.registerMediator(new ChromeCastHTMLSenderMediator())}else if(this.isReceiver())this.registerMediator(new ChromeCastReceiverMediator())};ChromeCastPlugin.prototype.createAPI=function(){return new ChromeCastAPI(this)};ChromeCastPlugin.prototype.isSender=function(){return!this.isReceiver()&&/Chrome/.test(navigator.userAgent)};ChromeCastPlugin.prototype.isReceiver=function(){return/CrKey/.test(navigator.userAgent)};ChromeCastPlugin.prototype.listNotificationInterests=function(){return[Notifications.READY,FeedNotifications.LOAD_FEED,CaptioningNotifications.VISIBILITY_CHANGE,CaptioningNotifications.SETTINGS_CHANGE,AdNotifications.BREAK_START]};ChromeCastPlugin.prototype.listNotificationEvents=function(){return ChromeCastPlugin.__super__.listNotificationEvents.call(this).concat([ChromeCastNotifications.AVAILABILITY_CHANGE])};ChromeCastPlugin.prototype.listNotificationPublications=function(){return ChromeCastPlugin.__super__.listNotificationPublications.apply(this,arguments).concat([Notifications.INITIALIZED,Notifications.ADD_CONTROL,Notifications.REMOVE_CONTROL,Notifications.ADD_CONTROL_STATE,Notifications.REMOVE_CONTROL_STATE,Notifications.PLAYBACK_TARGET_CHANGE,ChromeCastNotifications.AVAILABILITY_CHANGE])};AMP.registerPlugin("chromecast","html",ChromeCastPlugin);function ChromeCastFlashPlugin(app,config){ChromeCastFlashPlugin.__super__.constructor.call(this,app,config)};__extends(ChromeCastFlashPlugin,ChromeCastPlugin);ChromeCastFlashPlugin.NAME="ChromeCastFlashPlugin";ChromeCastFlashPlugin.prototype.createModel=function(){this.registerProxy(new ChromeCastSenderProxy(this.config))};ChromeCastFlashPlugin.prototype.createController=function(){this.registerCommand(Notifications.PLAYBACK_TARGET_CHANGE,ChromeCastPlaybackTargetChangeCommand);this.registerCommand(ChromeCastNotifications.LAUNCH,ChromeCastLaunchCommand);this.registerCommand(FeedNotifications.FEED_CHANGED,ChromeCastFeedChangedCommand);this.registerCommand(UserNotifications.TOGGLE_PLAY_PAUSE,ChromeCastTogglePlayPauseCommand);this.registerCommand(UserNotifications.SEEK,ChromeCastSeekCommand)};ChromeCastFlashPlugin.prototype.createView=function(){this.registerMediator(new ChromeCastSenderMediator())};ChromeCastFlashPlugin.prototype.listNotificationInterests=function(){return[FeedNotifications.FEED_CHANGED,Notifications.CHANGE_MEDIA]};function ChromeCastSenderProxy(config){this.messageBus=config.messageBus||ChromeCastConstants.CHANNEL_ID;ChromeCastSenderProxy.__super__.constructor.call(this,config.sender)};__extends(ChromeCastSenderProxy,PluginProxy);ChromeCastSenderProxy.NAME=ModuleProxy.NAME;ChromeCastSenderProxy.prototype.defaults={plugin:null,applicationID:ChromeCastConstants.APPLICATION_ID};ChromeCastSenderProxy.prototype.session=null;ChromeCastSenderProxy.prototype.media=null;ChromeCastSenderProxy.prototype.messageBus=null;ChromeCastSenderProxy.prototype.feed=null;ChromeCastSenderProxy.prototype.playState=null;ChromeCastSenderProxy.prototype.currentTime=null;ChromeCastSenderProxy.prototype.duration=null;ChromeCastSenderProxy.prototype.receiverAvailable=false;ChromeCastSenderProxy.prototype.getLoaded=function(){return this.loaded||((typeof chrome!=="undefined"&&chrome!==null?chrome.cast:void(0))!=null)};ChromeCastSenderProxy.prototype.initialize=function(){var _ref,_this=this;if(typeof chrome!=="undefined"&&chrome!==null?(_ref=chrome.cast)!=null?_ref.isAvailable:void(0):void(0)){this.initializeCastApi()}else window.__onGCastApiAvailable=function(loaded,errorInfo){if(loaded===true){_this.initializeCastApi()}else _this.logError("cast load error",errorInfo)}};ChromeCastSenderProxy.prototype.initializeCastApi=function(){var apiConfig,applicationID,sessionRequest;applicationID=this.getConfigurationData().applicationID;sessionRequest=new chrome.cast.SessionRequest(applicationID);apiConfig=new chrome.cast.ApiConfig(sessionRequest,this.sessionListener.bind(this),this.receiverListener.bind(this));chrome.cast.initialize(apiConfig,this.onInitSuccess.bind(this),this.onInitError.bind(this))};ChromeCastSenderProxy.prototype.onInitSuccess=function(event){this.logEvent("init success",event)};ChromeCastSenderProxy.prototype.onInitError=function(event){this.logError("init error",event)};ChromeCastSenderProxy.prototype.receiverListener=function(event){this.receiverAvailable=event==='available';this.sendNotification(ChromeCastNotifications.AVAILABILITY_CHANGE,this.receiverAvailable);this.logEvent("receiver "+(this.receiverAvailable?"found":"list empty"))};ChromeCastSenderProxy.prototype.sessionListener=function(event){this.onRequestSessionSuccess(event);this.logEvent("session listener",event)};ChromeCastSenderProxy.prototype.launch=function(){chrome.cast.requestSession(this.onRequestSessionSuccess.bind(this),this.onLaunchError.bind(this))};ChromeCastSenderProxy.prototype.send=function(msg){this.session.sendMessage(this.messageBus,msg,this.onMessageSuccess.bind(this),this.onMessageError.bind(this))};ChromeCastSenderProxy.prototype.onLaunchError=function(event){this.logError("launch error.",event)};ChromeCastSenderProxy.prototype.onRequestSessionSuccess=function(event){var playbackProxy;this.logEvent("request session success.",event);this.session=event;this.session.addMessageListener(this.messageBus,this.onMessage.bind(this));this.session.addUpdateListener(this.onUpdate.bind(this));playbackProxy=this.facade.app.retrieveProxy(PlaybackProxy.NAME);this.loadMedia(playbackProxy.getCurrentTime());this.sendNotification(Notifications.PLAYBACK_TARGET_CHANGE,{target:"chromecast"})};ChromeCastSenderProxy.prototype.onUpdate=function(isAlive){if(!isAlive)this.sendNotification(Notifications.PLAYBACK_TARGET_CHANGE,{target:"amp"})};ChromeCastSenderProxy.prototype.onMessageSuccess=function(event){this.logEvent("message sent",event)};ChromeCastSenderProxy.prototype.onMessageError=function(event){this.logError("message error",event)};ChromeCastSenderProxy.prototype.onMessage=function(namespace,message){var details,target,type;message=JSON.parse(message);type=message.type;details=message.details;switch(type){case"playstatechange":this.playState=details.newState;this.sendNotification(Notifications.CHANGE_PLAY_STATE,this.playState);break;case"timeupdate":this.currentTime=details.currentTime;this.sendNotification(Notifications.DISPLAY_TIME,{currentTime:this.currentTime,duration:this.duration});break;case"durationchange":if(details.duration!==0&&!isNaN(details.duration)){this.duration=details.duration;this.sendNotification(Notifications.DURATION_CHANGE,this.duration)};break;case"dispatchevent":target=details.target==="player"?this.facade.app.parent:this.facade.app.parent[details.target];if(target!=null)target.dispatchEvent(details.event)};if(type!=="timeupdate")this.logEvent("message from receiver",message);this.sendNotification(Notifications.DISPATCH_EVENT,{type:"message",message:message})};ChromeCastSenderProxy.prototype.onStop=function(event){this.logEvent("stop");this.session.stop(this.onStopSuccess.bind(this),this.onStopError.bind(this))};ChromeCastSenderProxy.prototype.onStopSuccess=function(event){this.logEvent("stop success",event)};ChromeCastSenderProxy.prototype.onStopError=function(event){this.logError("stop error",event)};ChromeCastSenderProxy.prototype.logEvent=function(message,data){if(message==null)message=data.type||"";this.facade.logger.log("[AMP CHROMECAST] "+message,data)};ChromeCastSenderProxy.prototype.logError=function(message,data){this.facade.logger.error("[AMP CHROMECAST ERROR] "+message,data)};ChromeCastSenderProxy.prototype.getPlayState=function(){return this.playState};ChromeCastSenderProxy.prototype.getFeed=function(){return this.feed};ChromeCastSenderProxy.prototype.setFeed=function(value){if(this.feed===value)return;this.feed=value;if(this.session!=null)this.loadMedia()};ChromeCastSenderProxy.prototype.loadMedia=function(startTime){var customData,feed,helper,media,mediaInfo,metadata,receiverCanPlay,request,source,_ref,_ref1;if(startTime==null)startTime=0;helper=new MRSSHelper();media=(_ref=helper.createFeed(this.getFeed()))!=null?(_ref1=_ref.item)!=null?_ref1[0]:void(0):void(0);if(!(media!=null))return;receiverCanPlay=function(type){if(ChromeCastConstants.SUPPORTED_TYPES.indexOf(type)>-1){return"maybe"}else return""};source=Utils.selectSource(media.source,receiverCanPlay);if(!(source!=null))return;feed=this.getFeed();if(feed!=null){customData={feed:{data:feed}}}else customData={guid:media.guid,embed:media.embed,category:media.category,medium:media.medium,duration:media.duration,scenes:media.scenes};metadata=new chrome.cast.media.GenericMediaMetadata();metadata.title=media.title;metadata.subtitle=media.description;metadata.image=media.poster;metadata.releaseDate=media.pubDate.toISOString();mediaInfo=new chrome.cast.media.MediaInfo(source.src,source.type);mediaInfo.customData=customData;mediaInfo.metadata=metadata;request=new chrome.cast.media.LoadRequest(mediaInfo);request.currentTime=startTime;this.session.loadMedia(request,this.onMediaDiscovered.bind(this),this.onMediaError.bind(this))};ChromeCastSenderProxy.prototype.onMediaDiscovered=function(media){this.media=media;this.media.addUpdateListener(this.onMediaStatusUpdate.bind(this))};ChromeCastSenderProxy.prototype.onMediaStatusUpdate=function(status){this.logEvent("mediastatusupdate",status)};ChromeCastSenderProxy.prototype.onMediaError=function(error){this.logError("media error",error)};ChromeCastSenderProxy.prototype.play=function(){this.media.play()};ChromeCastSenderProxy.prototype.pause=function(){this.media.pause()};ChromeCastSenderProxy.prototype.setCurrentTime=function(time){var request;request=new chrome.cast.media.SeekRequest();request.currentTime=time;this.media.seek(request)};ChromeCastSenderProxy.prototype.getCurrentTime=function(){return this.currentTime};ChromeCastSenderProxy.prototype.isReceiverAvailable=function(){return this.receiverAvailable};function ChromeCastWrapper(player,init){ChromeCastWrapper.__super__.constructor.call(this,player,init);this.plugin=new ChromeCastFlashPlugin(this.player,init);player.registerModule(this.plugin)};__extends(ChromeCastWrapper,PluginWrapper);ChromeCastWrapper.NAME="ChromeCastWrapper";ChromeCastWrapper.prototype.buttonId="chromecastBtn";ChromeCastWrapper.prototype.plugin=null;ChromeCastWrapper.prototype.getAPI=function(){return this.plugin.getAPI()};ChromeCastWrapper.prototype.createXML=function(xml){var controls;if(this.hasControls(xml)===false)return xml;controls=this.getControls(xml);if(!(controls[this.buttonId]!=null))this.createElement(xml,this.buttonId);return xml};ChromeCastWrapper.prototype.listNotificationInterests=function(){return ChromeCastWrapper.__super__.listNotificationInterests.call(this).concat([FlashNotifications.ELEMENT_EVENT,FlashNotifications.LOAD_STATE_READY,FlashNotifications.LOAD_STATE_LOADING,FlashNotifications.APPLICATION_STATE_CHANGE,ChromeCastNotifications.AVAILABILITY_CHANGE])};ChromeCastWrapper.prototype.handleNotification=function(notification){var body,isReceiverAvailable,name,_ref;ChromeCastWrapper.__super__.handleNotification.call(this,notification);name=notification.getName();body=notification.getBody();switch(name){case FlashNotifications.ELEMENT_EVENT:if(body.type==="click"&&body.element===this.buttonId)this.plugin.sendNotification(ChromeCastNotifications.LAUNCH);break;case ChromeCastNotifications.AVAILABILITY_CHANGE:if(((_ref=this.player.video)!=null?_ref.setPlayerProperty:void(0))!=null)this.player.video.setPlayerProperty(this.buttonId,{visible:body});break;case FlashNotifications.APPLICATION_STATE_CHANGE:case FlashNotifications.LOAD_STATE_READY:case FlashNotifications.LOAD_STATE_LOADING:isReceiverAvailable=this.plugin.getAPI().isReceiverAvailable();if(isReceiverAvailable)this.player.video.setPlayerProperty(this.buttonId,{state:1});this.player.video.setPlayerProperty(this.buttonId,{visible:isReceiverAvailable})}};AMP.registerPlugin("chromecast","flash",ChromeCastWrapper);var ChromeCastNotifications={LAUNCH:"launch",AVAILABILITY_CHANGE:"availabilitychange"};function ChromeCastAPI(module){var proxy;ChromeCastAPI.__super__.constructor.call(this,module);proxy=module.retrieveProxy(ChromeCastSenderProxy.NAME);if(!(proxy!=null))return;this.postMessage=proxy.send.bind(proxy);if(module.isSender()){this.play=proxy.play.bind(proxy);this.pause=proxy.pause.bind(proxy);this.setCurrentTime=proxy.setCurrentTime.bind(proxy);this.isReceiverAvailable=proxy.isReceiverAvailable.bind(proxy);this.getSession=function(){return proxy.session};this.getMedia=function(){return proxy.media}}else{this.getMediaManager=function(){return proxy.mediaManager};this.getCastReceiverManager=function(){return proxy.castReceiverManager};this.getCastMessageBus=function(){return proxy.castMessageBus};this.getCastChannel=function(){return proxy.castChannel}}};__extends(ChromeCastAPI,PluginAPI);ChromeCastAPI.prototype.play=function(){};ChromeCastAPI.prototype.pause=function(){};ChromeCastAPI.prototype.setCurrentTime=function(value){};ChromeCastAPI.prototype.isReceiverAvailable=function(){};ChromeCastAPI.prototype.postMessage=function(msg){};function DASHPlugin(app,config){DASHPlugin.__super__.constructor.call(this,app,config)};__extends(DASHPlugin,Plugin);DASHPlugin.NAME="DASHPlugin";DASHPlugin.prototype.moduleName="dash";DASHPlugin.prototype.createModel=function(){this.registerProxy(new DASHProxy(this.config))};DASHPlugin.prototype.registered=function(){this.app.registerCommand(Notifications.CHANGE_DISPLAY_STATE,DASHChangeDisplayStateCommand);DASHPlugin.__super__.registered.call(this)};AMP.registerPlugin("dash","html",DASHPlugin);function ControlPlugin(app,config){ControlPlugin.__super__.constructor.call(this,app,config)};__extends(ControlPlugin,Plugin);ControlPlugin.NAME="ControlPlugin";ControlPlugin.prototype.listNotificationPublications=function(){return ControlPlugin.__super__.listNotificationPublications.apply(this,arguments).concat([Notifications.ADD_CONTROL,Notifications.REMOVE_CONTROL,Notifications.ADD_CONTROL_STATE,Notifications.REMOVE_CONTROL_STATE])};function PanelControlMediator(componentName){PanelControlMediator.__super__.constructor.call(this,null,null,null,componentName,onclick)};__extends(PanelControlMediator,ButtonMediator);PanelControlMediator.prototype.panel=null;PanelControlMediator.prototype.timeout=null;PanelControlMediator.prototype.closePanelDelayed=null;PanelControlMediator.prototype.onRegister=function(){this.closePanelDelayed=this.delayedClosePanel.bind(this);if(Utils.getDevice()==="desktop"){this.onmouseleave=this.closePanelDelayed;this.onmouseenter=this.openPanel;this.onclick=this.clickHandler}else this.onclick=this.togglePanel;PanelControlMediator.__super__.onRegister.call(this);this.sendNotification(Notifications.ADD_CONTROL_STATE,""+this.componentName+"-enabled");this.sendNotification(Notifications.ADD_CONTROL,this.viewComponent)};PanelControlMediator.prototype.openPanel=function(){clearTimeout(this.timeout);this.sendNotification(PanelNotifications.OPEN_PANEL,this.panel);this.panel.viewComponent.addEventListener("mouseleave",this.closePanelDelayed)};PanelControlMediator.prototype.closePanel=function(){if(Utils.isMouseOverElement(this.panel.viewComponent)||Utils.isMouseOverElement(this.viewComponent)||this.facade.app.retrieveProxy(ApplicationStateProxy.NAME).getIsUserActive())return;this.panel.viewComponent.addEventListener("mouseleave",this.closePanelDelayed);this.sendNotification(PanelNotifications.CLOSE_PANEL,this.panel)};PanelControlMediator.prototype.delayedClosePanel=function(){this.timeout=setTimeout(this.closePanel.bind(this),350)};PanelControlMediator.prototype.togglePanel=function(){this.sendNotification(PanelNotifications.TOGGLE_PANEL,this.panel)};PanelControlMediator.prototype.clickPanel=function(){};function PanelMediator(componentName){PanelMediator.__super__.constructor.call(this,componentName,null,null,null)};__extends(PanelMediator,ComponentMediator);PanelMediator.prototype.componentType="panel";PanelMediator.prototype.control=null;PanelMediator.prototype.onRegister=function(){PanelMediator.__super__.onRegister.call(this);this.sendNotification(PanelNotifications.ADD_PANEL,this)};function ControlProxy(config){ControlProxy.__super__.constructor.call(this,config)};__extends(ControlProxy,PluginProxy);ControlProxy.NAME=ModuleProxy.NAME;ControlProxy.prototype.loaded=true;ControlProxy.prototype.controlName=null;ControlProxy.prototype.getControlName=function(){return this.controlName};ControlProxy.prototype.setControlName=function(value){return this.controlName=value};function ControlPanelProxy(config){ControlPanelProxy.__super__.constructor.call(this,config)};__extends(ControlPanelProxy,ControlProxy);ControlPanelProxy.NAME=ModuleProxy.NAME;ControlPanelProxy.prototype.hidden=true;ControlPanelProxy.prototype.getHidden=function(){return this.hidden};ControlPanelProxy.prototype.setHidden=function(value){this.hidden=value;return value};function VolumePanelProxy(config){VolumePanelProxy.__super__.constructor.call(this,config)};__extends(VolumePanelProxy,ControlPanelProxy);VolumePanelProxy.NAME=ModuleProxy.NAME;VolumePanelProxy.prototype.controlName="volume";VolumePanelProxy.prototype.defaults={direction:"vertical"};VolumePanelProxy.prototype.getDirection=function(){return this.data.direction};function VolumePanelWrapper(player,config){if(config==null)config={};VolumePanelWrapper.__super__.constructor.call(this,player,config)};__extends(VolumePanelWrapper,PluginWrapper);VolumePanelWrapper.NAME="VolumePanelWrapper";AMP.registerPlugin("volumepanel","flash",VolumePanelWrapper);function VolumePanelControlMediator(componentName){VolumePanelControlMediator.__super__.constructor.call(this,componentName)};__extends(VolumePanelControlMediator,PanelControlMediator);VolumePanelControlMediator.prototype.clickHandler=function(){this.sendNotification(Notifications.TOGGLE_MUTED)};function VolumeMediator(parent,direction){VolumeMediator.__super__.constructor.call(this,parent,direction)};__extends(VolumeMediator,SliderMediator);VolumeMediator.prototype.componentName="volume";VolumeMediator.prototype.setValue=function(percent){VolumeMediator.__super__.setValue.call(this,percent);this.sendNotification(Notifications.CHANGE_VOLUME,percent);this.sendNotification(UserSettingsNotifications.UPDATE_SETTINGS,{volume:percent});return percent};VolumeMediator.prototype.listNotificationInterests=function(){return[Notifications.VOLUME_CHANGE,Notifications.READY]};VolumeMediator.prototype.handleNotification=function(notification){switch(notification.getName()){case Notifications.READY:this.updateValue(this.facade.app.retrieveProxy(PlaybackProxy.NAME).getVolume());break;case Notifications.VOLUME_CHANGE:this.updateValue(notification.getBody())}};function ControlPanelMediator(){ControlPanelMediator.__super__.constructor.call(this);this.controls={}};__extends(ControlPanelMediator,PluginMediator);ControlPanelMediator.prototype.panel=null;ControlPanelMediator.prototype.control=null;ControlPanelMediator.prototype.separator=null;ControlPanelMediator.prototype.controls=null;ControlPanelMediator.prototype.labels=null;ControlPanelMediator.prototype.closed=true;ControlPanelMediator.prototype.panelClass=PanelMediator;ControlPanelMediator.prototype.controlClass=PanelControlMediator;ControlPanelMediator.prototype.onRegister=function(){this.panel=this.createPanel(this.componentName);this.control=this.createControl(this.componentName);this.separator=this.createSeparator(this.componentName);this.panel.control=this.control;this.control.panel=this.panel;if(this.labels==null)this.labels={};this.createPanelControls(name)};ControlPanelMediator.prototype.createControl=function(name){var control;control=new this.controlClass(name);this.facade.registerMediator(control);return control};ControlPanelMediator.prototype.createPanel=function(name){var panel;panel=new this.panelClass(name);this.facade.registerMediator(panel);return panel};ControlPanelMediator.prototype.createSeparator=function(name){return this.create(["separator","icon"],this.panel)};ControlPanelMediator.prototype.createPanelControls=function(name){var data,key,value,_ref;data=this.plugin.getConfigurationData();for(key in data){value=data[key];if(value===true)this.controls[key]=this.addPanelControl(new ButtonMediator(this.localizationManager.getString(this.labels[key]),null,null,key,(_ref=this.panelButtonClickHandler)!=null?typeof _ref.bind==="function"?_ref.bind(this,key):void(0):void(0)))}};ControlPanelMediator.prototype.addPanelControl=function(control){this.facade.registerMediator(control);this.panel.getViewComponent().appendChild(control.getViewComponent());return control};ControlPanelMediator.prototype.panelButtonClickHandler=function(){this.sendNotification(PanelNotifications.CLOSE_PANEL,this.panel)};function VolumePanelMediator(){VolumePanelMediator.__super__.constructor.call(this)};__extends(VolumePanelMediator,ControlPanelMediator);VolumePanelMediator.prototype.componentName="volume";VolumePanelMediator.prototype.slider=null;VolumePanelMediator.prototype.level=null;VolumePanelMediator.prototype.controlClass=VolumePanelControlMediator;VolumePanelMediator.prototype.onRegister=function(){VolumePanelMediator.__super__.onRegister.call(this);this.slider=new VolumeMediator(this.panel,this.plugin.getDirection());this.facade.registerMediator(this.slider)};VolumePanelMediator.prototype.updateVolumeButton=function(percent){var level;level=Math.ceil(percent*10);if(level===this.level)return;if(this.level!=null)this.sendNotification(Notifications.REMOVE_CONTROL_STATE,"volume-"+this.level);this.level=level;this.sendNotification(Notifications.ADD_CONTROL_STATE,"volume-"+this.level)};VolumePanelMediator.prototype.listNotificationInterests=function(){return VolumePanelMediator.__super__.listNotificationInterests.apply(this,arguments).concat([Notifications.VOLUME_CHANGE])};VolumePanelMediator.prototype.handleNotification=function(notification){VolumePanelMediator.__super__.handleNotification.call(this,notification);switch(notification.getName()){case Notifications.VOLUME_CHANGE:this.updateVolumeButton(notification.body)}};function ControlPanelPlugin(app,config){ControlPanelPlugin.__super__.constructor.call(this,app,config)};__extends(ControlPanelPlugin,ControlPlugin);ControlPanelPlugin.NAME="ControlPanelPlugin";ControlPanelPlugin.prototype.listNotificationPublications=function(){var key,value;return ControlPanelPlugin.__super__.listNotificationPublications.call(this).concat((function(){var _results;_results=[];for(key in PanelNotifications){value=PanelNotifications[key];_results.push(value)};return _results})())};function VolumePanelPlugin(app,config){VolumePanelPlugin.__super__.constructor.call(this,app,config)};__extends(VolumePanelPlugin,ControlPanelPlugin);VolumePanelPlugin.NAME="VolumePanelPlugin";VolumePanelPlugin.prototype.moduleName="volumepanel";VolumePanelPlugin.prototype.isVolumeSettable=function(){var newVolume,oldVolume,settable,video;settable=false;video=this.app.getVideo();oldVolume=video.volume;newVolume=Math.random();video.volume=newVolume;if(video.volume===newVolume)settable=true;video.volume=oldVolume;return settable};VolumePanelPlugin.prototype.initialize=function(){if(!this.isVolumeSettable()){return}else VolumePanelPlugin.__super__.initialize.call(this)};VolumePanelPlugin.prototype.createModel=function(){this.registerProxy(new VolumePanelProxy(this.config))};VolumePanelPlugin.prototype.createView=function(){if(!this.isVolumeSettable())return;this.registerMediator(new VolumePanelMediator())};VolumePanelPlugin.prototype.listNotificationPublications=function(){return VolumePanelPlugin.__super__.listNotificationPublications.apply(this,arguments).concat([Notifications.CHANGE_VOLUME,Notifications.TOGGLE_MUTED,UserSettingsNotifications.UPDATE_SETTINGS])};VolumePanelPlugin.prototype.listNotificationInterests=function(){return VolumePanelPlugin.__super__.listNotificationInterests.apply(this,arguments).concat([Notifications.VOLUME_CHANGE,Notifications.READY])};AMP.registerPlugin("volumepanel","html",VolumePanelPlugin);global.akamai={amp:{AMP:AMP,utils:{Utils:Utils,QueryString:QueryString,Clock:Clock,Alarm:Alarm,Logger:Logger}}};window.AKAMAI_MEDIA_PLAYER.saveSDK(version,global)};window.AKAMAI_MEDIA_PLAYER.setVersion(version)})();;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/videoamp/lib/amp.premier/amp.premier.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/media_asset_factory/media_asset.factory.js. */
twc.shared.apps.factory('MediaAssetFactory',['dsxclient',function(dsxclient){return{getAssetModel:function(response,assetId){if(assetId.indexOf("db04bc18-ee64-11e2-9ee2-001d092f5a10")!==-1){return"ugcAssetWithColl"}else{var rawResponse=response.attrs["rawResponseMap"],assetObj=rawResponse["/cms/asset-collection/"+assetId];if(assetObj&&assetObj.doc&&assetObj.doc.providerid){var assetProviderId=assetObj.doc.providerid;if(assetProviderId!=null&&assetProviderId==="db04bc18-ee64-11e2-9ee2-001d092f5a10"){return"ugcAssetWithColl"}else if(assetProviderId!==null&&assetObj.doc.type==="video")return"videoAssetWithColl"}};return"videoAssetWithColl"},getMediaAssetData:function(assetInfo){var _self=this,results={},assetIdConfig={$id:assetInfo.id,recordType:"cms",recordName:"videoAssetWithColl",assetId:assetInfo.assetId};if(!assetInfo.assetId)return null;var promise=dsxclient.execute([assetIdConfig]);promise.then(function(response){var modelType=_self.getAssetModel(response,assetInfo.assetId),massagedResponse=response.getModel({$id:assetInfo.id,recordType:"cms",recordName:modelType,assetId:assetInfo.assetId});results[assetInfo.id]=massagedResponse;promise.$setResults(results);return promise});return promise}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/media_asset_factory/media_asset.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/mouse/mouse.directive.js. */
twc.shared.apps.directive('twcMouse',['MouseBroadcast',function(MouseBroadcast){return{restrict:'A',link:function(scope,element,attrs){element.bind('mousemove',function(evt){MouseBroadcast.setLocation(scope,attrs,evt)});element.bind('click',function(evt){MouseBroadcast.setLocation(scope,attrs,evt)})}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/mouse/mouse.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/ad_control/ad_control.factory.js. */
twc.shared.apps.factory('AdControl',['twcPco','PcoAd','twcUtil','customEvent','$q',function(twcPco,PcoAd,twcUtil,customEvent,$q){var refreshEvent=customEvent.getEvent("slotRefreshReady"),loadEvent=customEvent.getEvent('dfpLoaded'),slotRefreshEvent=customEvent.getEvent('slotRefreshReady'),slotRefresh=false;window.googletag=window.googletag||{};googletag.cmd=googletag.cmd||[];slotNames2Slots=function(slotNames){if(slotNames&&slotNames.length){var refreshSlots=PcoAd.getRefreshSlots(),slots=[];angular.forEach(slotNames,function(slotName){if(slotName in refreshSlots)slots.push(refreshSlots[slotName].slot)});return slots}else return null};setTargeting=function(targetMap,targetObj){angular.forEach(targetMap,function(val,key){googletag.pubads().clearTargeting();googletag.pubads().setTargeting(key,val)})};refresh=function(targetMap,slots){if(!googletag||!('pubads'in googletag))return;var tMap=targetMap||{},pubads=googletag.pubads();if(slots){for(var slotIdx=0,slotLen=slots.length;slotIdx<slotLen;slotIdx++){var cSlot=slots[slotIdx];if(cSlot){clearElement(cSlot);setTargeting(tMap,cSlot)}}}else setTargeting(tMap,pubads);pubads.refresh(slots)};getTargetMapFromCustParams=function(cust_params){var targetMap={};try{var targets=window.decodeURIComponent(cust_params).split("&");angular.forEach(targets,function(target){var parts=target.split("=");if(parts&&parts.length>1){var key=parts[0],value=parts.splice(1);targetMap[key]=value.join("=")}})}catch(err){};return targetMap};clearElement=function(slot){var slotName;if(angular.isObject(slot)){slotName=slot.getSlotId().getDomId()}else if(angular.isString(slot))slotName=slot;if(slotName){var $domEl=angular.element("#"+slotName);if($domEl&&$domEl.length>0)$domEl.empty()}};return{refreshAllSlots:function(targetMap){refreshEvent.done(function(){refresh(targetMap,null)})},refreshSlots:function(targetMap,slotNames){refreshEvent.done(function(){var slots=[];slots=slotNames2Slots(slotNames);refresh(targetMap,slots)})},refreshRetargetSlots:function(targetMap){refreshEvent.done(function(){var refreshSlots=PcoAd.getRefreshSlots(),refreshableSlots=(refreshSlots?twcUtil.filter(refreshSlots,function(slotObj){return slotObj.slot&&slotObj.refresh}):null),slots=(refreshableSlots?twcUtil.map(refreshableSlots,function(refreshSlot){return refreshSlot.slot}):null);refresh(targetMap,slots)})},refreshSlotsWithLoc:function(targetMap,slotNames,locObj){refreshEvent.done(function(){if(angular.isObject(locObj)){TWC.Events.ad_cust_params_changed=jQuery.Deferred();TWC.Events.ad_cust_params_changed.done(function(){var cust_params=twcPco.getNodeValue('ad','cust_params'),keyValues,i,custMap={},slots=[];cust_params=decodeURIComponent(cust_params);keyValues=cust_params.split("&");for(i=0,l=keyValues.length;i<l;i++){var keyValue=keyValues[i].split("=");custMap[keyValue[0]]=keyValue[1]};angular.extend(custMap,targetMap);slots=slotNames2Slots(slotNames);refresh(custMap,slots)});twcPco.setNodeValue('ad','location',locObj)}})},createOrRefreshSlot:function(slotNames,targetMap,enableCorrelatorUpdate){var deferred=$q.defer();slotRefreshEvent.done(function(){var gnv=twcPco.getNodeValue,ads_ctrld_clientside=gnv("ad","ads_ctrld_clientside");if(ads_ctrld_clientside){var cust_params=gnv("ad","cust_params"),i,l,slotName,p,adUnitAndZone=gnv("ad","adUnitAndZone"),DFPSlots=twcPco.getNodeValue("ad","DFPSlots"),slots2Refresh=[],sizes,pos,processSlot=function(slotName){if(DFPSlots[slotName].slot){return DFPSlots[slotName].slot}else{var slot=googletag.defineSlot(adUnitAndZone,sizes,slotName);slotRefresh=false;googletag.enableServices();slot.addService(googletag.pubads());slot.setTargeting("pos",pos);setTargeting(targetMap,slot);if(enableCorrelatorUpdate)googletag.pubads().updateCorrelator();googletag.display(slotName);DFPSlots[slotName].slot=slot;return slot}};targetMap=targetMap||{};angular.extend(targetMap,getTargetMapFromCustParams(cust_params));if(typeof slotNames==="object"&&slotNames.length&&slotNames.length>0){slots2Refresh=[];for(i=0,l=slotNames.length;i<l;i++){if(!ads_ctrld_clientside[slotNames[i]])continue;slotName=slotNames[i];sizes=ads_ctrld_clientside[slotNames[i]].sizes;pos=ads_ctrld_clientside[slotNames[i]].pos;slots2Refresh.push(processSlot(slotName))}}else{slots2Refresh=[];sizes=ads_ctrld_clientside[slotNames].sizes;pos=ads_ctrld_clientside[slotNames].pos;slots2Refresh.push(processSlot(slotNames))};if(slotRefresh)if(slots2Refresh.length===1){refresh(targetMap,slots2Refresh)}else if(slots2Refresh.length>1){for(i=0,l=slots2Refresh.length;i<l;i++)clearElement(slots2Refresh[i]);googletag.pubads().clearTargeting();for(p in targetMap)if(targetMap.hasOwnProperty(p))googletag.pubads().set(p,targetMap[p]);googletag.pubads().refresh(slots2Refresh)};slotRefresh=true;deferred.resolve()}else deferred.reject()});return deferred.promise},onSlotRender:function(slotName,callback){loadEvent.done(function(){googletag.pubads().addEventListener('slotRenderEnded',function(e){var domId=e.slot.getSlotId().getDomId();if(domId===slotName)callback()})})},ugcTealium:function(ugcCollection){if(ugcCollection){var ugcCatFamCh=TWC.tealium.lookup(ugcCollection,utag_data['lookup.ugcTitle2catFamCh'],'string','nl');TWC.tealium.processCatFamCh(ugcCatFamCh);TWC.tealium.processPCOcustParams()}},registerCompanion:function(adsObjectFromPco){if(adsObjectFromPco&&adsObjectFromPco.ad_video_companions){var companionName,companionSlots;for(var compName in adsObjectFromPco.ad_video_companions)if(adsObjectFromPco.ad_video_companions.hasOwnProperty(compName)){companionName=compName;companionSlots=adsObjectFromPco.ad_video_companions[compName].sizes;break};window.googletag=window.googletag||{};googletag.cmd.push(function(){var adUnitAndZone=TWC.pco.getNodeValue("ad","adUnitAndZone");googletag.defineSlot(adUnitAndZone,companionSlots,companionName).addService(googletag.companionAds());googletag.companionAds().setRefreshUnfilledSlots(true);googletag.pubads().enableVideoAds();googletag.enableServices();googletag.display(companionName)})}}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/ad_control/ad_control.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/fast_button/fast_button.factory.js. */
twc.shared.apps.factory('FastButton',function(){return FastButton});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/fast_button/fast_button.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/fast_button/fastbutton/google.fastbutton.js. */
(function(){function addListener(el,type,listener,useCapture){if(el.addEventListener){el.addEventListener(type,listener,useCapture);return{destroy:function(){el.removeEventListener(type,listener,useCapture)}}}else{var handler=function(e){listener.handleEvent(window.event,listener)};el.attachEvent('on'+type,handler);return{destroy:function(){el.detachEvent('on'+type,handler)}}}};var isTouch="ontouchstart"in window;this.FastButton=function(element,handler,useCapture){this.events=[];this.touchEvents=[];this.element=element;this.handler=handler;this.useCapture=useCapture;if(isTouch)this.events.push(addListener(element,'touchstart',this,this.useCapture));this.events.push(addListener(element,'click',this,this.useCapture))};this.FastButton.prototype.destroy=function(){for(var i=this.events.length-1;i>=0;i-=1)this.events[i].destroy();this.events=this.touchEvents=this.element=this.handler=this.fastButton=null};this.FastButton.prototype.handleEvent=function(event){switch(event.type){case'touchstart':this.onTouchStart(event);break;case'touchmove':this.onTouchMove(event);break;case'touchend':this.onClick(event);break;case'click':this.onClick(event);break}};this.FastButton.prototype.onTouchStart=function(event){event.stopPropagation?event.stopPropagation():(event.cancelBubble=true);this.touchEvents.push(addListener(this.element,'touchend',this,this.useCapture));this.touchEvents.push(addListener(document.body,'touchmove',this,this.useCapture));this.startX=event.touches[0].clientX;this.startY=event.touches[0].clientY};this.FastButton.prototype.onTouchMove=function(event){if(Math.abs(event.touches[0].clientX-this.startX)>10||Math.abs(event.touches[0].clientY-this.startY)>10)this.reset()};this.FastButton.prototype.onClick=function(event){event.stopPropagation?event.stopPropagation():(event.cancelBubble=true);this.reset();var result=this.handler.call(this.element,event);if(event.type==='touchend')clickbuster.preventGhostClick(this.startX,this.startY);return result};this.FastButton.prototype.reset=function(){for(var i=this.touchEvents.length-1;i>=0;i-=1)this.touchEvents[i].destroy();this.touchEvents=[]};this.clickbuster=function(){};this.clickbuster.preventGhostClick=function(x,y){clickbuster.coordinates.push(x,y);window.setTimeout(clickbuster.pop,2500)};this.clickbuster.pop=function(){clickbuster.coordinates.splice(0,2)};this.clickbuster.onClick=function(event){for(var i=0;i<clickbuster.coordinates.length;i+=2){var x=clickbuster.coordinates[i],y=clickbuster.coordinates[i+1];if(Math.abs(event.clientX-x)<25&&Math.abs(event.clientY-y)<25){event.stopPropagation?event.stopPropagation():(event.cancelBubble=true);event.preventDefault?event.preventDefault():(event.returnValue=false)}}};if(isTouch){document.addEventListener('click',clickbuster.onClick,true);clickbuster.coordinates=[]}})(this);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/fast_button/fastbutton/google.fastbutton.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/anim/vendor/anim_modified/anim.modified.js. */
var anim=function(A){"use strict";A=function(n,g,t,e){var a,o,c,q=[],cb=function(i){if(i=q.shift())i[1]?A.apply(this,i).anim(cb):i[0]>0?setTimeout(cb,i[0]*1e3):(i[0](),cb())};if(n.charAt)n=document.getElementById(n);if(n>0||!n)g={},t=0,cb(q=[[n||0]]);expand(g,{padding:0,margin:0,border:"Width"},[T,R,B,L]);expand(g,{borderRadius:"Radius"},[T+L,T+R,B+R,B+L]);++mutex;for(a in g){o=g[a];if(!o.to&&o.to!==0)o=g[a]={to:o};A.defs(o,n,a,e)};A.iter(g,t*1e3,cb);return{anim:function(){q.push([].slice.call(arguments));return this}}};var T="Top",R="Right",B="Bottom",L="Left",mutex=1,expand=function(g,dim,dir,a,i,d,o){for(a in g)if(a in dim){o=g[a];for(i=0;d=dir[i];i++)g[a.replace(dim[a],"")+d+(dim[a]||"")]={to:(o.to===0)?o.to:(o.to||o),fr:o.fr,e:o.e};delete g[a]}},timeout=function(w,a){return w["webkitR"+a]||w["r"+a]||w["mozR"+a]||w["msR"+a]||w["oR"+a]}(window,"equestAnimationFrame");A.defs=function(o,n,a,e,s){s=n.style;o.a=a;o.n=n;o.s=(a in s)?s:n;o.e=o.e||e;o.fr=o.fr||(o.fr===0?0:o.s==n?n[a]:(window.getComputedStyle?getComputedStyle(n,null):n.currentStyle)[a]);o.u=(/\d(\D+)$/.exec(o.to)||/\d(\D+)$/.exec(o.fr)||[0,0])[1];o.fn=/color/i.test(a)?A.fx.color:(A.fx[a]||A.fx._);o.mx="anim_"+a;n[o.mx]=o.mxv=mutex;if(n[o.mx]!=o.mxv)o.mxv=null};A.iter=function(g,t,cb){var _,i,o,p,e,z=+new Date()+t,_=function(now){i=z-new Date().getTime();if(i<50){for(o in g)o=g[o],o.p=1,o.fn(o,o.n,o.to,o.fr,o.a,o.e);cb&&cb()}else{i=i/t;for(o in g){o=g[o];if(o.n[o.mx]!=o.mxv)return;e=o.e;p=i;if(e=="lin"){p=1-p}else if(e=="ease"){p=(0.5-p)*2;p=1-((p*p*p-p*3)+2)/4}else if(e=="ease-in"){p=1-p;p=p*p*p}else p=1-p*p*p;o.p=p;o.fn(o,o.n,o.to,o.fr,o.a,o.e)};timeout?timeout(_):setTimeout(_,20,0)}};_()};A.fx={_:function(o,n,to,fr,a,e){fr=parseFloat(fr)||0,to=parseFloat(to)||0,o.s[a]=(o.p>=1?to:(o.p*(to-fr)+fr))+o.u},width:function(o,n,to,fr,a,e){if(!(o._fr>=0))o._fr=!isNaN(fr=parseFloat(fr))?fr:a=="width"?n.clientWidth:n.clientHeight;A.fx._(o,n,to,o._fr,a,e)},opacity:function(o,n,to,fr,a,e){if(isNaN(fr=fr||o._fr))fr=n.style,fr.zoom=1,fr=o._fr=(/alpha\(opacity=(\d+)\b/i.exec(fr.filter)||{})[1]/100||1;fr*=1;to=(o.p*(to-fr)+fr);n=n.style;if(a in n){n[a]=to}else n.filter=to>=1?"":"alpha("+a+"="+Math.round(to*100)+")"},color:function(o,n,to,fr,a,e,i,v){if(!o.ok){to=o.to=A.toRGBA(to);fr=o.fr=A.toRGBA(fr);if(to[3]==0)to=[].concat(fr),to[3]=0;if(fr[3]==0)fr=[].concat(to),fr[3]=0;o.ok=1};v=[0,0,0,o.p*(to[3]-fr[3])+1*fr[3]];for(i=2;i>=0;i--)v[i]=Math.round(o.p*(to[i]-fr[i])+1*fr[i]);if(v[3]>=1||A.rgbaIE)v.pop();try{o.s[a]=(v.length>3?"rgba(":"rgb(")+v.join(",")+")"}catch(e){A.rgbaIE=1}}};A.fx.height=A.fx.width;A.RGBA=/#(.)(.)(.)\b|#(..)(..)(..)\b|(\d+)%,(\d+)%,(\d+)%(?:,([\d\.]+))?|(\d+),(\d+),(\d+)(?:,([\d\.]+))?\b/;A.toRGBA=function(s,v){v=[0,0,0,0];s.replace(/\s/g,"").replace(A.RGBA,function(i,a,b,c,f,g,h,l,m,n,o,w,x,y,z){var h=[a+a||f,b+b||g,c+c||h],p=[l,m,n];for(i=0;i<3;i++)h[i]=parseInt(h[i],16),p[i]=Math.round(p[i]*2.55);v=[h[0]||p[0]||w||0,h[1]||p[1]||x||0,h[2]||p[2]||y||0,o||z||1]});return v};return A}();;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/anim/vendor/anim_modified/anim.modified.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_css_anim/twc_css_anim.factory.js. */
twc.shared.apps.factory('twcCssAnim',function(){var $=angular.element,transitionEndEvents='transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd';return{isSupported:Modernizr.csstransitions,transitionEndEvents:transitionEndEvents,onTransitionEnd:function($elem,callback,property){var regex=property?new RegExp('^[\\w-]*'+property+'$'):null;$elem.on(transitionEndEvents,function transitionEndCallback(event){if($elem.is(event.target)&&(!regex||regex.test(event.originalEvent.propertyName)))setTimeout(callback)})},onTransitionEndOnce:function($elem,callback,property){if(this.isSupported){var regex=property?new RegExp('^[\\w-]*'+property+'$'):null;$elem.on(transitionEndEvents,function transitionEndCallback(event){if($elem.is(event.target)&&(!regex||regex.test(event.originalEvent.propertyName))){$elem.off(transitionEndEvents,transitionEndCallback);setTimeout(callback)}})}else setTimeout(function(){callback()},250)},addTransitionEndDeferred:function($elem,allTransitionsEnd,property){var deferred=$.Deferred();allTransitionsEnd.push(deferred);this.onTransitionEndOnce($elem,function(){deferred.resolve()},property)},setElemTransition:function($elem,val){$elem.css({'-webkit-transition':val,'-moz-transition':val,'-o-transition':val,transition:val})},setElemTransitionProp:function($elem,prop,val){var style={};style['-webkit-transition-'+prop]=style['-moz-transition-'+prop]=style['-o-transition-'+prop]=style['transition-'+prop]=val;$elem.css(style)}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_css_anim/twc_css_anim.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_events/twc_events.run.js. */
twc.shared.apps.run(['$swipe','customEvent','$window','twcUtil','twcConstant','$rootScope',function($swipe,customEvent,$window,twcUtil,twcConstant,$rootScope){if('ontouchstart'in document.documentElement){var body=angular.element(document).find('html');$swipe.bind(body,{start:function(pt,e){if(e.currentTarget.nodeName==='HTML')customEvent.getEvent('touch-on-body-event').notify(e)},cancel:function(pt){}})};angular.element($window).resize(twcUtil.debounce(function(evt){angular.element(this).trigger('ScreenResizeEnd')},300));if(Boolean(angular.element.cookie('debug'))){var ascii=twcConstant.ascii,beenHere=false;angular.element('body').on('mousedown mousemove',twcUtil.debounce(function(e){twcConstant.holdShiftKey=e.shiftKey;twcConstant.holdAltKey=e.altKey;if(e.which===1&&twcConstant.holdShiftKey&&twcConstant.holdAltKey)if(e.type==='mousemove'){var selectedModule=angular.element(e.target).closest('[data-twc-controller]');if(selectedModule.length>0){$rootScope.$log.log(Drupal.settings.twc.instance[selectedModule.attr('instance')]);if(!beenHere){$rootScope.$log.log('Total of ',Object.keys(Drupal.settings.twc.instance).length,' modules on the page.');beenHere=true}}}},300))}}]);twc.shared.apps.directive('twcClick',function(){return function(scope,element,attrs){element.bind("click",function(evt){evt.preventDefault();scope.$apply(function(){scope.$eval(attrs.twcClick)})})}});twc.shared.apps.directive('twcEnter',['twcConstant',function(twcConstant){return function(scope,element,attrs){element.bind("keydown keypress",function(evt){if(evt.which===twcConstant.ascii.CR){evt.preventDefault();scope.$apply(function(){scope.$eval(attrs.twcEnter)})}})}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_events/twc_events.run.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_select_text/twc_select_text.directive.js. */
twc.shared.apps.directive('twcSelectText',function(){'use strict';return{restrict:'A',link:function(scope,element){var preventMouseUpDeselect=false;element.mouseup(function(e){if(preventMouseUpDeselect){e.preventDefault();preventMouseUpDeselect=false}});element.mousedown(function(){preventMouseUpDeselect=false});element.on('focusin',function(e){e.preventDefault();element.select();setTimeout(function(){element.select()});preventMouseUpDeselect=true})}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_select_text/twc_select_text.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_placeholder/twc_placeholder.directive.js. */
twc.shared.apps.directive('twcPlaceholder',['$timeout',function($timeout){return{restrict:'A',link:function(scope,element,attrs){scope.text=attrs.twcPlaceholder;var setPlaceholder=function(placeIt){if(element.val().length===0)scope.$apply(function(){element.val(placeIt?scope.text:'')})};element.bind('focus',function(){if(element.val()===scope.text)scope.$apply(function(){element.val('')})});element.bind('blur',function(){if(element.val()==='')setPlaceholder(true)});scope.$watch('term',function(nVal,oVal){if(nVal!==oVal)if((!nVal||nVal.length===0)&&element.hasClass('manage-location-input'))element.val(scope.text)});setTimeout(function(){element.val(scope.text)},50)}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_placeholder/twc_placeholder.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/linker_factory/linker_factory.factory.js. */
twc.shared.apps.factory('linkerFactory',["$rootScope","dsxclient","PcoPage","customEvent","$interpolate","twcPco","twcUtil",function($rootScope,dsxclient,PcoPage,customEvent,$interpolate,twcPco,twcUtil){'use strict';var currentTimeISO,tzOffset,config,tempScope,getDateTime=function(){dsxclient.execute(config).then(['dateTimeModel',function(dateTimeModel){if(dateTimeModel){currentTimeISO=dateTimeModel.getDateTimeISO();customEvent.getEvent("gotCurrentTime").resolve({date:currentTimeISO})}else{currentTimeISO=new Date().toISOString();customEvent.getEvent("gotCurrentTime").resolve({date:currentTimeISO})}}])['catch'](function(){customEvent.getEvent("gotCurrentTime").reject();console.log("error")})},toISOTimeFormat=function(dateTime,diff){var sign='+',minutes="00";if(diff<0){sign="-";diff=diff*-1};var addZero=diff>9?"":"0";if(diff%1!==0){diff=parseInt(diff);minutes="30"};return dateTime.replace(" ","T")+sign+addZero+diff+":"+minutes},jq=window.jQuery,init=function(){jq.when.apply(jq,[].concat(twcPco.get("page").promises,twcPco.get("user").promises)).done(function(){var locId;tempScope=('dynamiclocation'in $rootScope&&$rootScope.dynamiclocation)?$rootScope:{};customEvent.getEvent("linker_factory_tempScope").resolve(tempScope);if(PcoPage.getCurrentLocationModel()&&!PcoPage.getCurrentLocationModel().data.error){var loc=PcoPage.getCurrentLocationModel(),daylightAdjustment=loc.getDaylightSavingsActive()==='Y'?1:0;locId=loc.getFullLocId();tzOffset=loc.getGmtDiff()+daylightAdjustment}else{locId='30339:4:US';tzOffset=((new Date().getTimezoneOffset()/60)*-1)};config=[{$id:"dateTimeModel",recordType:"cs",recordName:"datetime",fullLocId:locId}],getDateTime()})};init();return{validateLinkSchedule:function(validBetween,overrideTzOffset){if(overrideTzOffset)tzOffset=overrideTzOffset;if(!validBetween.value)return true;var startTimeISO=toISOTimeFormat(validBetween.value,tzOffset),endTimeISO=toISOTimeFormat(validBetween.value2,tzOffset),startTimeMilliseconds=twcUtil.fromISOToDate(startTimeISO).getTime(),endTimeMilliseconds=twcUtil.fromISOToDate(endTimeISO).getTime(),currentTimeMilliseconds=twcUtil.fromISOToDate(currentTimeISO).getTime();if(!startTimeMilliseconds||!endTimeMilliseconds||!currentTimeMilliseconds||startTimeMilliseconds===endTimeMilliseconds)return true;return startTimeMilliseconds<currentTimeMilliseconds&&endTimeMilliseconds>currentTimeMilliseconds},interpolateLinkUrl:function(linkUrl){if(tempScope&&linkUrl){return $interpolate(linkUrl)(tempScope)}else return linkUrl}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/linker_factory/linker_factory.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_popover/twc_popover.directive.js. */
twc.shared.apps.directive('twcPopover',['$compile','twcUtil',function($compile,twcUtil){'use strict';return{restrict:'A',scope:{popoverClass:'@',popoverText:'@',popoverPosition:'@',popoverTheme:'@'},controller:['$scope',function($scope){$scope.popoverToggle=false;this.func={getElementSize:function(el){var _w=el.outerWidth(),_h=el.outerHeight();return{width:_w,height:_h}},getElementPosition:function(el){var _x=el[0].getBoundingClientRect().left,_y=el[0].getBoundingClientRect().top;return{left:_x,top:_y}},setPopoverPosition:function(el){switch($scope.popoverPosition){case'top':return{top:this.getElementPosition(el).top-this.getElementSize(el).height,left:this.getElementPosition(el).left};case'right':return{top:this.getElementPosition(el).top,left:this.getElementSize(el).width};case'bottom':return{top:this.getElementPosition(el).top+this.getElementSize(el).height,left:0};case'left':return{top:this.getElementPosition(el).top,right:this.getElementSize(el).width};default:return{top:this.getElementPosition(el).top,left:this.getElementSize(el).width}}},showPopover:function(el,popover){popover.css(this.setPopoverPosition(el));$scope.popoverToggle=true},hidePopover:function(el){$scope.popoverToggle=false}}}],link:function(scope,elem,attrs,ctrl){var self=ctrl.func,template='<div data-ng-show="popoverToggle" data-ng-class="[popoverClass, popoverPosition, popoverTheme]" class=""><span data-ng-bind="popoverText"></span></div>',popover=$compile(template)(scope);angular.element('body').append(popover);if(!Modernizr.touch){elem.on('mouseenter',function(){twcUtil.safeApply(scope,function(){self.showPopover(elem,popover)})});elem.on('mouseleave',function(){twcUtil.safeApply(scope,function(){self.hidePopover()})})}}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_popover/twc_popover.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/track_str/track_str_action_tracker.factory.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module("shared",[]);twc.shared.apps.factory('ActionTracker',['customEvent',function(customEvent){var serviceObj={track:function(pagename,moduleId,attrs){var trackString=[pagename,moduleId,attrs.trackStr].join("_");if(attrs.trackStr)customEvent.ifReady(['utagReady']).done(function(e){attrs.linkTrackVars=(attrs.linkTrackVars&&(attrs.linkTrackVars+",prop35"))||"prop35";for(var p in attrs)if(p.match(/event|eVar|prop|linkTrackVars|campaign|linkTrackEvents/))s[p]=attrs[p];if(attrs.socialTrackAction)trackString=attrs.trackStr;s.prop35=trackString;s.tl(document,'o',trackString);s.prop35="";for(p in attrs)s[p]=""})}};return serviceObj}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/track_str/track_str_action_tracker.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/track_str/track_str.directive.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module("shared",[]);twc.shared.apps.directive('trackStr',['customEvent','twcPco','ActionTracker',function(customEvent,twcPco,action){'use strict';return{scope:'=',replace:false,transclude:false,link:function(scope,element,attrs){element.click(function(e){var pagename=(twcPco.get('metrics')&&twcPco.get('metrics').attributes.pagename),moduleId=(scope.getInstance&&scope.getInstance().module_id)||attrs.moduleId;action.track(pagename,moduleId,attrs)})}}}]).factory('trackEvent',['customEvent','twcPco','ActionTracker',function(customEvent,twcPco,action){return{fire:function(trackStr){customEvent.ifReady(['utagReady']).done(function(){var pagename=(twcPco.get('metrics')&&twcPco.get('metrics').attributes.pagename),moduleId=(scope.getInstance&&scope.getInstance().module_id||"").replace(/ /g,"-"),attrs={trackStr:trackStr};action.track(pagename,moduleId,attrs)})}}}]).run(['customEvent','twcPco','ActionTracker',function(customEvent,twcPco,action){customEvent.ifReady(['utagReady']).then(function(){customEvent.getEvent('track-string-event').progress(function(e){var pagename=((twcPco.get('metrics')&&twcPco.get('metrics').attributes.pagename)||"").replace(/ /g,"-"),moduleId=(e.module_id)||(e.settings&&e.settings.module_id)||(e.scope&&e.scope.getInstance&&e.scope.getInstance().module_id),attrs=angular.extend({trackStr:e.trackStr},(e.attrs||{}));action.track(pagename,moduleId,attrs)})})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/track_str/track_str.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_tooltip/twc_tooltip.directive.js. */
twc.shared.apps.directive('twcTooltip',['$compile','customEvent',function($compile,customEvent){'use strict';return{restrict:'A',scope:{isValid:'@'},link:function(scope,element,attrs){var tooltip=attrs.twcTooltip,validateClass=attrs.validateClass?attrs.validateClass:'',placement=attrs.placement?attrs.placement:'top';if(tooltip){var template=angular.element('<span ng-if="tooltipToggle" class="tooltip error-tooltip"><strong>'+tooltip+'</strong></span>');placement==='top'?template.insertBefore(element):template.insertAfter(element);$compile(template)(scope);scope.tooltipToggle=false};scope.$watch('isValid',function(isValid){if(validateClass)Boolean(isValid)?element.removeClass(validateClass):element.addClass(validateClass);scope.tooltipToggle=!isValid});customEvent.getEvent('reset-error-tooltip-event').progress(function(e){scope.isValid=true})}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_tooltip/twc_tooltip.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/class/class.factory.js. */
twc.shared.apps.factory('TwcClass',function(){var extend=function(protoProps,staticProps){var parent=this,child;if(protoProps&&Object.prototype.hasOwnProperty.call(protoProps,'constructor')){child=protoProps.constructor}else child=function(){return parent.apply(this,arguments)};angular.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate();if(protoProps)angular.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child},TwcClass=function(){if(this.construct)this.construct.apply(this,arguments)};TwcClass.extend=extend;return TwcClass});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/class/class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/collections/collections.factory.js. */
twc.shared.apps.factory('Set',['TwcClass',function(TwcClass){return TwcClass.extend({construct:function(){this.setMap={}},add:function(data){var key=data.toString().replace(/ /g,"");if(!this.setMap[key])this.setMap[key]=data},getAll:function(){var array=[];angular.forEach(this.setMap,function(value,key){array.push(key)});return array},hasKey:function(key){return(key in this.setMap)}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/collections/collections.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/from_str/from_str.directive.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module("shared",[]);twc.shared.apps.directive('fromStr',['$log','twcPco',function($log,twcPco){'use strict';var logger=$log.getInstance('fromStr');return{replace:false,transclude:false,link:function(scope,element,attrs){element.bind('click',function(e){var pagename=(twcPco.get('metrics')&&twcPco.get('metrics').attributes.pagename),settings=scope.getInstance&&scope.getInstance()||scope.settings||{},moduleId;for(var key in settings)if(key.indexOf("module_id")>-1)moduleId=(scope.getInstance&&scope.getInstance()[key]||settings[key]);moduleId=moduleId||attrs.moduleId;var addlAttrs=scope.fromAttrs||"";addlAttrs=addlAttrs?addlAttrs+"-":"";var linkFromString=addlAttrs+attrs.fromStr,fromString=moduleId?[pagename,moduleId,linkFromString].join("_"):[pagename,linkFromString].join("_");jQuery.cookie("fromStr",fromString,{domain:".weather.com",path:"/"});logger.debug(fromString)})}}}]).run(['customEvent','twcPco',function(customEvent,twcPco){customEvent.getEvent('from-string-event').progress(function(e){var pagename=(twcPco.get('metrics')&&twcPco.get('metrics').attributes.pagename),moduleId=(e.module_id)||(e.settings&&e.settings.module_id)||(e.scope&&e.scope.getInstance&&e.scope.getInstance().module_id),fromString=[pagename,moduleId,e.fromStr].join("_");jQuery.cookie("fromStr",fromString,{domain:".weather.com",path:"/"})})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/from_str/from_str.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/remove_padding/remove_padding.directive.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module("shared",[]);twc.shared.apps.directive('removePanePadding',function(){return{scope:true,replace:false,transclude:false,link:function($scope,$element,$attrs){$element.closest(".panel-pane").removeClass("module-padding")}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/remove_padding/remove_padding.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_ellipsis/twc_ellipsis.directive.js. */
twc.shared.apps.directive('twcEllipsis',['twcUtil',function(twcUtil){'use strict';return{restrict:'A',link:function(scope,element,attrs){function toggleTruncationClass(isTruncated,origContent){if(isTruncated){element.addClass('is-truncated').removeClass('not-truncated')}else element.addClass('not-truncated').removeClass('is-truncated')};attrs.twcEllipsisText=attrs.twcEllipsisText||'';attrs.twcEllipsisTail=attrs.twcEllipsisTail||' ';attrs.twcEllipsisWatch=attrs.twcEllipsisWatch||'window';attrs.twcEllipsisWrap=attrs.twcEllipsisWrap||'letter';attrs.twcEllipsisAfter=attrs.twcEllipsisAfter||null;attrs.twcEllipsisHeight=attrs.twcEllipsisHeight||null;attrs.twcEllipsisTolerance=attrs.twcEllipsisTolerance||0;attrs.twcEllipsisEndRemoveChars=attrs.twcEllipsisEndRemoveChars||[' ',',',';','.','!','?'];attrs.twcEllipsisEndNoTailChars=attrs.twcEllipsisEndNoTailChars||[];attrs.twcEllipsisFallbackToLetter=attrs.twcEllipsisFallbackToLetter||true;twcUtil.safeApply(scope,function(){var afterElement,objOptions={ellipsis:attrs.twcEllipsisTail,watch:attrs.twcEllipsisWatch,wrap:attrs.twcEllipsisWrap,height:attrs.twcEllipsisHeight,tolerance:attrs.twcEllipsisTolerance,callback:toggleTruncationClass,lastCharacter:{remove:attrs.twcEllipsisEndRemoveChars,noEllipsis:attrs.twcEllipsisEndNoTailChars},fallbackToLetter:attrs.twcEllipsisFallbackToLetter};element.html(attrs.twcEllipsisText);if(attrs.twcEllipsisAfter)afterElement=element.next(attrs.twcEllipsisAfter).remove();if(afterElement&&afterElement.length){objOptions.after=attrs.twcEllipsisAfter;element.append(afterElement)};element.dotdotdot(objOptions)})}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_ellipsis/twc_ellipsis.directive.js. */
/*
 *	jQuery dotdotdot 1.6.16
 *
 *	Copyright (c) Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */
!function(t,e){function n(t,e,n){var r=t.children(),o=!1;t.empty();for(var i=0,d=r.length;d>i;i++){var l=r.eq(i);if(t.append(l),n&&t.append(n),a(t,e)){l.remove(),o=!0;break}n&&n.detach()}return o}function r(e,n,i,d,l){var s=!1,c="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",u="script, .dotdotdot-keep";return e.contents().detach().each(function(){var f=this,h=t(f);if("undefined"==typeof f||3==f.nodeType&&0==t.trim(f.data).length)return!0;if(h.is(u))e.append(h);else{if(s)return!0;e.append(h),l&&e[e.is(c)?"after":"append"](l),a(i,d)&&(s=3==f.nodeType?o(h,n,i,d,l):r(h,n,i,d,l),s||(h.detach(),s=!0)),s||l&&l.detach()}}),s}function o(e,n,r,o,d){var c=e[0];if(!c)return!1;var f=s(c),h=-1!==f.indexOf(" ")?" ":"",p="letter"==o.wrap?"":h,g=f.split(p),v=-1,w=-1,b=0,y=g.length-1;for(o.fallbackToLetter&&0==b&&0==y&&(p="",g=f.split(p),y=g.length-1);y>=b&&(0!=b||0!=y);){var m=Math.floor((b+y)/2);if(m==w)break;w=m,l(c,g.slice(0,w+1).join(p)+o.ellipsis),a(r,o)?(y=w,o.fallbackToLetter&&0==b&&0==y&&(p="",g=g[0].split(p),v=-1,w=-1,b=0,y=g.length-1)):(v=w,b=w)}if(-1==v||1==g.length&&0==g[0].length){var x=e.parent();e.detach();var T=d&&d.closest(x).length?d.length:0;x.contents().length>T?c=u(x.contents().eq(-1-T),n):(c=u(x,n,!0),T||x.detach()),c&&(f=i(s(c),o),l(c,f),T&&d&&t(c).parent().append(d))}else f=i(g.slice(0,v+1).join(p),o),l(c,f);return!0}function a(t,e){return t.innerHeight()>e.maxHeight}function i(e,n){for(;t.inArray(e.slice(-1),n.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),n.lastCharacter.noEllipsis)<0&&(e+=n.ellipsis),e}function d(t){return{width:t.innerWidth(),height:t.innerHeight()}}function l(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function s(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}function c(t){do t=t.previousSibling;while(t&&1!==t.nodeType&&3!==t.nodeType);return t}function u(e,n,r){var o,a=e&&e[0];if(a){if(!r){if(3===a.nodeType)return a;if(t.trim(e.text()))return u(e.contents().last(),n)}for(o=c(a);!o;){if(e=e.parent(),e.is(n)||!e.length)return!1;o=c(e[0])}if(o)return u(t(o),n)}return!1}function f(e,n){return e?"string"==typeof e?(e=t(e,n),e.length?e:!1):e.jquery?e:!1:!1}function h(t){for(var e=t.innerHeight(),n=["paddingTop","paddingBottom"],r=0,o=n.length;o>r;r++){var a=parseInt(t.css(n[r]),10);isNaN(a)&&(a=0),e-=a}return e}if(!t.fn.dotdotdot){t.fn.dotdotdot=function(e){if(0==this.length)return t.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(e)});var o=this;o.data("dotdotdot")&&o.trigger("destroy.dot"),o.data("dotdotdot-style",o.attr("style")||""),o.css("word-wrap","break-word"),"nowrap"===o.css("white-space")&&o.css("white-space","normal"),o.bind_events=function(){return o.bind("update.dot",function(e,d){e.preventDefault(),e.stopPropagation(),l.maxHeight="number"==typeof l.height?l.height:h(o),l.maxHeight+=l.tolerance,"undefined"!=typeof d&&(("string"==typeof d||d instanceof HTMLElement)&&(d=t("<div />").append(d).contents()),d instanceof t&&(i=d)),g=o.wrapInner('<div class="dotdotdot" />').children(),g.contents().detach().end().append(i.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var c=!1,u=!1;return s.afterElement&&(c=s.afterElement.clone(!0),c.show(),s.afterElement.detach()),a(g,l)&&(u="children"==l.wrap?n(g,l,c):r(g,o,g,l,c)),g.replaceWith(g.contents()),g=null,t.isFunction(l.callback)&&l.callback.call(o[0],u,i),s.isTruncated=u,u}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],s.isTruncated),s.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],i),i}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),o.unwatch().unbind_events().contents().detach().end().append(i).attr("style",o.data("dotdotdot-style")||"").data("dotdotdot",!1)}),o},o.unbind_events=function(){return o.unbind(".dot"),o},o.watch=function(){if(o.unwatch(),"window"==l.watch){var e=t(window),n=e.width(),r=e.height();e.bind("resize.dot"+s.dotId,function(){n==e.width()&&r==e.height()&&l.windowResizeFix||(n=e.width(),r=e.height(),u&&clearInterval(u),u=setTimeout(function(){o.trigger("update.dot")},100))})}else c=d(o),u=setInterval(function(){if(o.is(":visible")){var t=d(o);(c.width!=t.width||c.height!=t.height)&&(o.trigger("update.dot"),c=t)}},500);return o},o.unwatch=function(){return t(window).unbind("resize.dot"+s.dotId),u&&clearInterval(u),o};var i=o.contents(),l=t.extend(!0,{},t.fn.dotdotdot.defaults,e),s={},c={},u=null,g=null;return l.lastCharacter.remove instanceof Array||(l.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),l.lastCharacter.noEllipsis instanceof Array||(l.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),s.afterElement=f(l.after,o),s.isTruncated=!1,s.dotId=p++,o.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&o.watch(),o},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","",",",";",".","!","?"],noEllipsis:[]}},t.fn.dotdotdot.debug=function(){};var p=1,g=t.fn.html;t.fn.html=function(n){return n!=e&&!t.isFunction(n)&&this.data("dotdotdot")?this.trigger("update",[n]):g.apply(this,arguments)};var v=t.fn.text;t.fn.text=function(n){return n!=e&&!t.isFunction(n)&&this.data("dotdotdot")?(n=t("<div />").text(n).html(),this.trigger("update",[n])):v.apply(this,arguments)}}}(jQuery);;/**/
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/filters/module_filters.filter.js. */
twc.shared.apps.filter('safeDisplay',function(){return function(input,textToReplace){if('isLoading'in this&&this.isLoading)return"";return(input===0||!!input)?input:(textToReplace||'N/A')}}).filter('twcFilter',['twcUtil',function(twcUtil){return{getByProperty:function(name,value,collection){return twcUtil.find(collection,function(item){return item.data?item.data[name]===value:item[name]===value})}}}]).filter('truncate',function(){return function(value,max,tail){if(!value)return'';max=parseInt(max,10);if(!max)return value;if(value.length<=max)return value;value=value.substr(0,max);return value+(tail||' ')}}).filter('appendRandomLoremIpsum',function(){var words=['Lorem','ipsum','sit','amor','cetere','Carthago','delenda','est','et','ad','alia'],wordPositions,offsetSeed
function getNextNumber(string,min,max){var currentPos,currentCharCode,responseRange;if(typeof wordPositions[string]==='undefined'){currentPos=(offsetSeed%string.length)}else if(wordPositions[string]>=string.length){currentPos=0}else currentPos=wordPositions[string];wordPositions[string]=currentPos+1;currentCharCode=string.charCodeAt(currentPos);responseRange=max-min;return((currentCharCode%responseRange)+min)}
function getWord(value){return words[getNextNumber(value,0,words.length)]}
function getWords(value,min,max){var words=' ',i,howMany=getNextNumber(value,min,max);for(i=0;i<howMany;i++)words+=(getWord(value)+' ');return words};return function(value,min,max){wordPositions={};offsetSeed=(new Date()).getMinutes();value=value||'';min=min||0;max=max||12;return value+getWords(value,min,max)}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/filters/module_filters.filter.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/pco.factory.js. */
twc.shared.apps.service('twcPco',function(){return TWC.pco});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/pco.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/pco.run.js. */
twc.shared.apps.factory('dynamicLocResolvedEvent',['customEvent',function(customEvent){return customEvent.getEvent("DYNAMIC_LOC_RESOLVED")}]).run(["$rootScope","$q","twcPco","PcoPage","pcoUser","customEvent","dynamicLocResolvedEvent",function($rootScope,$q,twcPco,PcoPage,pcoUser,customEvent,dynamicLocResolvedEvent){var jq=window.jQuery,setLocation;setLocation=function(location,objectKey,idKey,nameKey){if(!!location){var hasLocation=('loc'in location);$rootScope[objectKey]=hasLocation?location:null;$rootScope[idKey]=hasLocation?location.loc:null;$rootScope[nameKey]=(hasLocation&&'prsntNm'in location)?location.prsntNm:null}};jq.when.apply(jq,twcPco.get("page").promises).done(function(){var currLoc=PcoPage._get('currentLocation');setLocation(currLoc,'pagelocation','pageLocId','pageLocName')});jq.when.apply(jq,twcPco.get("user").promises).done(function(){var userPrefLoc=pcoUser.getPreferredLocation(),currLoc=pcoUser._get('currentLocation');setLocation(userPrefLoc||currLoc,'userlocation','userLocId','userLocName')});jq.when.apply(jq,[].concat(twcPco.get("page").promises,twcPco.get("user").promises)).done(function(){var prefLocation=pcoUser.getPreferredLocation(),setDynamicLoc;setDynamicLoc=function(){var currPageLoc=PcoPage._get('currentLocation'),userCurrLoc=pcoUser._get('currentLocation');setLocation(((currPageLoc&&!currPageLoc.error)?currPageLoc:(prefLocation||userCurrLoc)),'dynamiclocation','dynamicLocId','dynamicLocName');if(dynamicLocResolvedEvent.state()!=="resolved")dynamicLocResolvedEvent.resolve()};if(!prefLocation)setDynamicLoc();customEvent.getEvent("preferred_location_change").progress(function(data){setDynamicLoc()})})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/pco.run.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.user.model.class.factory.js. */
twc.shared.apps.factory('pcoUser',['TwcModel','twcPco','twcUtil','$q','locUtil','PcoSavedLocationModel','customEvent',function(TwcModel,twcPco,twcUtil,$q,locUtil,PcoSavedLocationModel,customEvent){var User=TwcModel.extend({init:function(){this.fromDto(twcUtil.clone(twcPco.get('user').getAttributes()));var _self=this;jQuery.when.apply($,twcPco.get("user").promises).done(function(){_self.fromDto(twcUtil.clone(twcPco.get('user').getAttributes()))});customEvent.getEvent("preferred_location_change").progress(function(data){if(data&&data.locations)_self.set({preferredLocation:data.locations})})},getGender:function(){return this._get('gender')},getPreferredDeclaration:function(){return this._get('preferredDeclaration')},getTimezoneOffset:function(){return this._get('tzOffset')},getFlashPlayerVersion:function(){return this._get('flash')},getBrowser:function(){return this._get('browser')},getAgeGroups:function(){return this._get('age')},getBackToPage:function(){return this._get('backTo')},getUnit:function(){return this._get('unit')},getSpeedMeasure:function(){var pLocale=TWC&&TWC.Titan&&TWC.Titan.locale;if(pLocale&&pLocale==="en_GB")return'mph';return this._get('unit')==='e'?' mph':' km/h'},getPressureUnit:function(){return this._get('unit')==='e'?'in':'mb'},getDistanceUnit:function(){return this._get('unit')==='e'?'mi':'km'},getSpeedUnit:function(){return this._get('unit')==='e'?'M':'K'},getTempUnit:function(){return this._get('unit')==='e'?'F':'C'},getAccumulationUnit:function(){return this._get('unit')==='e'?'in':'cm'},getPrecipUnit:function(){return this._get('unit')==='e'?'in':'mm'},getFreezingPoint:function(){return this.getTempUnit()==='F'?32:0},setTempUnit:function(unit){var unitSys;switch(unit){case'F':unitSys='e';break;default:unitSys='m';break};this._set('unit',unitSys);twcPco.setNodeValue('user','unit',unitSys);return this},getIsSignedIn:function(){return!!this.getSignedInToken()},getSignedInToken:function(){return this._get('signedIn')},getLocale:function(){return this._get('locale')},setLocale:function(locale){this._set("locale",locale);twcPco.setNodeValue('user','locale',locale);return this},getPreferredLocation:function(){return this._get("preferredLocation")},getFullLocationList:function(){var sl=this._get("savedLocations")||[],rs=this._get("recentSearchLocations")||[];return sl.concat(rs)},getSavedLocations:function(){return twcUtil.map(this._get("savedLocations"),function(savedLocation){return new PcoSavedLocationModel().fromPcoData(savedLocation)})},addSavedLocation:function(recentLoc){this.addLocation(recentLoc,"saved");return this},removeSavedLocation:function(savedLocation){this.removeLocation(savedLocation,"saved");return this},getRecentSearchLocations:function(){return twcUtil.map(this._get("recentSearchLocations"),function(recentLoc){return new PcoSavedLocationModel().fromPcoData(recentLoc)})},addRecentSearchLocation:function(recentLoc){this.addLocation(recentLoc,"recentSearch");return this},removeRecentSearchLocation:function(recentSearchLocation){this.removeLocation(recentSearchLocation,"recentSearch");return this},addLocation:function(location,type){if(location){var alreadySaved=false,nodeType=type+"Locations",currentLocs=this._get(nodeType)||[],deleteType=(type==='saved')?'recentSearch':'saved',deleteNodeType=deleteType+"Locations",locObjArry=[];location=location.attrs?location.attrs:location;location=location.data?location.data:location;for(var i=0,l=currentLocs.length;i<l;i++)if(locUtil.areLocationsEqual(location,currentLocs[i])){alreadySaved=true;break};var deleteLocations=this._get(deleteNodeType)||[];for(var idx=0,len=deleteLocations.length;idx<len;idx++)if(locUtil.areLocationsEqual(location,deleteLocations[idx]))if(deleteType==='recentSearch'){this.removeLocation(deleteLocations[idx],deleteType);break}else alreadySaved=true;if(!alreadySaved){locObjArry=this._get(nodeType)||[];if(type==="saved"){locObjArry.push(location)}else this._get(nodeType).unshift(location);var truncatedLocations=locObjArry.slice(0,Math.min(locObjArry.length,10));twcPco.setNodeValue("user",nodeType,truncatedLocations)}}},removeLocation:function(location,type){if(location){var nodeType=type+'Locations',locObjArry=[],currentLocations=this._get(nodeType);location=location.attrs?location.attrs:location;location=location.data?location.data:location;for(var i=currentLocations.length-1;i>=0;i--)if(currentLocations[i].locId===location.locId){currentLocations.splice(i,1);break};twcPco.setNodeValue('user',nodeType,currentLocations)}},updateLocation:function(location){if(location){var savedLocs=this._get("savedLocations");location=location.attrs?location.attrs:location;location=location.data?location.data:location;if(savedLocs&&angular.isArray(savedLocs))for(var idx=0,len=savedLocs.length;idx<len;idx++)if(locUtil.areLocationsEqual(location,savedLocs[idx])){angular.extend(savedLocs[idx],location);break};twcPco.setNodeValue('user','savedLocations',savedLocs)}}});return new User()}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.user.model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.device.model.class.factory.js. */
twc.shared.apps.factory('PcoDevice',['TwcModel','twcUtil','twcPco','$q',function(TwcModel,twcUtil,twcPco,$q){var Device=TwcModel.extend({init:function(){this.fromDto(twcUtil.clone(twcPco.get('device').getAttributes()));var _self=this;$q.all(twcPco.get("device").promises).then(function(){_self.fromDto(twcUtil.clone(twcPco.get('device').getAttributes()))})},onReady:function(callback){$q.all(twcPco.get("device").promises).then(function(){callback()})},getOpenDDRCrawler:function(){return this._get('OpenDDRCrawler')},getOpenDDRDesktop:function(){return this._get('OpenDDRDesktop')},getOpenDDRDevice:function(){return this._get('OpenDDRDevice')},getOpenDDRDisplay:function(){return this._get('OpenDDRDisplay')},getOpenDDRId:function(){return this._get('OpenDDRId')},getOpenDDRJS:function(){return this._get('OpenDDRJS')},getOpenDDRTablet:function(){return this._get('OpenDDRTablet')},getOpenDDRWireless:function(){return this._get('OpenDDRWireless')},getUserAgent:function(){return this._get('UserAgent')},getBrowserId:function(){return this._get('browserId')},getBrowserName:function(){return this._get('browserName')},getBrowserOS:function(){return this._get('browserOS')},getBrowserVer:function(){return this._get('browserVer')},getDClass:function(){return this._get('dClass')},getDClassVersion:function(){return this._get('dClassVersion')}});return new Device()}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.device.model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.twclog.model.class.factory.js. */
twc.shared.apps.service('twcLog',['twcPco',function(twcPco){return twcPco.get("twclog")}]).factory('PcoLog',['TwcModel','twcUtil','twcLog',function(TwcModel,twcUtil,twcLog){return{debug:function(){twcLog.debug.apply(twcLog,Array.prototype.slice.call(arguments,0))},error:function(){twcLog.error.apply(twcLog,Array.prototype.slice.call(arguments,0))}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.twclog.model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.performance.model.class.factory.js. */
twc.shared.apps.service('twcPerf',['twcPco',function(twcPco){return twcPco.get("performance")}]).factory('PcoPerf',['TwcModel','twcUtil','twcPerf',function(TwcModel,twcUtil,twcPerf){return{logDsxCall:function(){twcPerf.log_dsx_call.apply(twcPerf,Array.prototype.slice.call(arguments,0))},log:function(){twcPerf.log.apply(twcPerf,Array.prototype.slice.call(arguments,0))}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.performance.model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.page.model.class.factory.js. */
twc.shared.apps.factory('PcoPage',['TwcModel','twcUtil','twcPco','$q','$injector','$rootScope',function(TwcModel,twcUtil,twcPco,$q,$injector,$rootScope){var Page=TwcModel.extend({construct:function(){this.attrs=twcPco.get('page').getAttributes();this._set('pagepromise_wrapper',$q.defer());var _self=this;jQuery.when.apply(jQuery,twcPco.get("page").promises).done(function(){_self.attrs=twcPco.get('page').getAttributes();var currLoc=_self._get('currentLocation'),model=_self._get('currentLocationModel');if(!!currLoc&&!model){var ModelClass=$injector.has("WxdLocModelClass")&&$injector.get("WxdLocModelClass");if(!!ModelClass)_self.set({currentLocationModel:(new ModelClass(currLoc))})};_self._get("pagepromise_wrapper").resolve()})},getCurrentLocId:function(){return this._get('currentLocId')},getCurrentLocation:function(){return this._get('currentLocation')},getCurrentLocationModel:function(){return this._get('currentLocationModel')},getAMPM:function(){return this._get('ampm')},getEnv:function(){return this._get('env')},getFromString:function(){return this._get('fromStr')},getFV:function(){return this._get('fv')},getLanguage:function(){return this._get('lang')},getLocale:function(){return this._get('locale')},getServerDate:function(){return this._get('serverdate')},getServerTime:function(){return this._get('servertime')},getServerDay:function(){return this._get('serverday')},getServerHours:function(){return this._get('serverhrs')},getPagePromises:function(){return this._get("pagepromise_wrapper").promise},getBackToPage:function(){return this._get('backTo')},getPartner:function(){return this._get('partner')},getPageType:function(){return this._get('content')},getTimeZone:function(){return this._get('timezone')}});return new Page()}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.page.model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.ad.model.class.factory.js. */
twc.shared.apps.factory('PcoAd',['TwcModel','twcUtil','twcPco','$q',function(TwcModel,twcUtil,twcPco,$q){var Ad=TwcModel.extend({init:function(){this.fromDto(twcUtil.clone(twcPco.get('ad').getAttributes()));var _self=this;$q.all(twcPco.get("ad").promises).then(function(){_self.fromDto(twcUtil.clone(twcPco.get('ad').getAttributes()))})},getCustom_Params:function(){return this._get('cust_params')},getAd_Positions:function(){return this._get('ad_positions')},getAdPromises:function(){return $q.all(twcPco.get("ad").promises)},getRefreshSlots:function(){return this._get('DFPSlots')}});return new Ad()}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.ad.model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.savedLocation.model.class.factory.js. */
twc.shared.apps.factory('PcoSavedLocationModel',['TwcModel',function(TwcModel){return TwcModel.extend({toPcoData:function(){return this.attrs},fromPcoData:function(data){this.set(data);return this},setLongitude:function(lon){return this._set('lon',lon)},setLatitude:function(lat){return this._set('lat',lat)},setLocType:function(locType){return this._set('locType',locType)},setLocId:function(locId){return this._set('locId',locId)},getLocId:function(){return this._get('locId')},getLocType:function(){return this._get('locType')},getLatitude:function(){return this._get('lat')},getLongitude:function(){return this._get('lon')},getFullName:function(){return this._get('prsntNm')},setCountryCode:function(cd){return this._set('cntryCd',cd)},getCountryCode:function(){return this._get('cntryCd')},setLocationRecord:function(locationRecord){jQuery.extend(this.attrs,locationRecord.data)},setObservationRecord:function(observationRecord){this._observationRecord=observationRecord},getObservationRecord:function(){return this._observationRecord},markObservationRecordFetched:function(){this._observationRecordFetched=true;return this},getIsObservationRecordFetched:function(){return!!this._observationRecordFetched},getNickname:function(){return this._get('nickname')},setNickname:function(val){return this._set('nickname',val)},getFullLocId:function(){return this.getLocId()+':'+this.getLocType()+':'+this.getCountryCode()},getCity:function(){return this.attrs['city']?this._get('city'):this._get('cityNm')},getState:function(){return this.attrs['state']?this._get('state'):this._get('stNm')},getCountry:function(){return this.attrs['countryName']?this._get('countryName'):this._get('_country')},getStateName:function(){return this._get('stateName')},getBigCity:function(){return this._get('bigcity')},getCountryName:function(){return this.attrs['countryName']?this._get('countryName'):this._get('_country')},getCityName:function(){return this._get('cityNm')},getStateCode:function(){return this._get('stCd')}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.savedLocation.model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.profile.model.class.factory.js. */
twc.shared.apps.factory('PcoProfile',['TwcModel','twcUtil','twcPco','$q',function(TwcModel,twcUtil,twcPco,$q){var Profile=TwcModel.extend({init:function(){this.fromDto(twcUtil.clone(twcPco.get('profile').getAttributes()));var _self=this;$q.all(twcPco.get("profile").promises).then(function(){_self.fromDto(twcUtil.clone(twcPco.get('profile').getAttributes()))})},getAddlParams:function(){return this._get('addlparams')},getLastModified:function(){return this._get('lastmodified')},getUpHostname:function(){return this._get('uphostname')},getUsername:function(){return this._get('username')},getUserId:function(){return this._get('userid')}});return new Profile()}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.profile.model.class.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.metrics.model.class.factory.js. */
twc.shared.apps.factory('PcoMetrics',['TwcModel','twcUtil','twcPco',function(TwcModel,twcUtil,twcPco){var Metrics=TwcModel.extend({init:function(){this.fromDto(twcUtil.clone(twcPco.get('metrics').getAttributes()))},getPageName:function(){return this._get('pagename')}});return new Metrics()}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pco/models/pco.metrics.model.class.factory.js. */
/**
 * Created with JetBrains PhpStorm.
 * User: thomas.vo
 * Date: 8/26/13
 * Time: 4:01 PM
 * To change this template use File | Settings | File Templates.
 *
 */
twc.shared = twc.shared || {};
twc.shared.apps = twc.shared.apps || angular.module("shared",[]);
twc.shared.apps.factory('twcUtil',function(){
  var _ = (function() {
    //     Underscore.js 1.5.2
    //     http://underscorejs.org
    //     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
    //     Underscore may be freely distributed under the MIT license.
    (function() {

      // Baseline setup
      // --------------

      // Establish the root object, `window` in the browser, or `exports` on the server.
      var root = this;

      // Save the previous value of the `_` variable.
      var previousUnderscore = root._;

      // Establish the object that gets returned to break out of a loop iteration.
      var breaker = {};

      // Save bytes in the minified (but not gzipped) version:
      var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;

      // Create quick reference variables for speed access to core prototypes.
      var
        push             = ArrayProto.push,
        slice            = ArrayProto.slice,
        concat           = ArrayProto.concat,
        toString         = ObjProto.toString,
        hasOwnProperty   = ObjProto.hasOwnProperty;

      // All **ECMAScript 5** native function implementations that we hope to use
      // are declared here.
      var
        nativeForEach      = ArrayProto.forEach,
        nativeMap          = ArrayProto.map,
        nativeReduce       = ArrayProto.reduce,
        nativeReduceRight  = ArrayProto.reduceRight,
        nativeFilter       = ArrayProto.filter,
        nativeEvery        = ArrayProto.every,
        nativeSome         = ArrayProto.some,
        nativeIndexOf      = ArrayProto.indexOf,
        nativeLastIndexOf  = ArrayProto.lastIndexOf,
        nativeIsArray      = Array.isArray,
        nativeKeys         = Object.keys,
        nativeBind         = FuncProto.bind;

      // Create a safe reference to the Underscore object for use below.
      var _ = function(obj) {
        if (obj instanceof _) return obj;
        if (!(this instanceof _)) return new _(obj);
        this._wrapped = obj;
      };

      // Export the Underscore object for **Node.js**, with
      // backwards-compatibility for the old `require()` API. If we're in
      // the browser, add `_` as a global object via a string identifier,
      // for Closure Compiler "advanced" mode.
      if (typeof exports !== 'undefined') {
        if (typeof module !== 'undefined' && module.exports) {
          exports = module.exports = _;
        }
        exports._ = _;
      } else {
        root._ = _;
      }

      // Current version.
      _.VERSION = '1.5.2';

      // Collection Functions
      // --------------------

      // The cornerstone, an `each` implementation, aka `forEach`.
      // Handles objects with the built-in `forEach`, arrays, and raw objects.
      // Delegates to **ECMAScript 5**'s native `forEach` if available.
      var each = _.each = _.forEach = function(obj, iterator, context) {
        if (obj == null) return;
        if (nativeForEach && obj.forEach === nativeForEach) {
          obj.forEach(iterator, context);
        } else if (obj.length === +obj.length) {
          for (var i = 0, length = obj.length; i < length; i++) {
            if (iterator.call(context, obj[i], i, obj) === breaker) return;
          }
        } else {
          var keys = _.keys(obj);
          for (var i = 0, length = keys.length; i < length; i++) {
            if (iterator.call(context, obj[keys[i]], keys[i], obj) === breaker) return;
          }
        }
      };

      // Return the results of applying the iterator to each element.
      // Delegates to **ECMAScript 5**'s native `map` if available.
      _.map = _.collect = function(obj, iterator, context) {
        var results = [];
        if (obj == null) return results;
        if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);
        each(obj, function(value, index, list) {
          results.push(iterator.call(context, value, index, list));
        });
        return results;
      };

      var reduceError = 'Reduce of empty array with no initial value';

      // **Reduce** builds up a single result from a list of values, aka `inject`,
      // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.
      _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {
        var initial = arguments.length > 2;
        if (obj == null) obj = [];
        if (nativeReduce && obj.reduce === nativeReduce) {
          if (context) iterator = _.bind(iterator, context);
          return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);
        }
        each(obj, function(value, index, list) {
          if (!initial) {
            memo = value;
            initial = true;
          } else {
            memo = iterator.call(context, memo, value, index, list);
          }
        });
        if (!initial) throw new TypeError(reduceError);
        return memo;
      };

      // The right-associative version of reduce, also known as `foldr`.
      // Delegates to **ECMAScript 5**'s native `reduceRight` if available.
      _.reduceRight = _.foldr = function(obj, iterator, memo, context) {
        var initial = arguments.length > 2;
        if (obj == null) obj = [];
        if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {
          if (context) iterator = _.bind(iterator, context);
          return initial ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);
        }
        var length = obj.length;
        if (length !== +length) {
          var keys = _.keys(obj);
          length = keys.length;
        }
        each(obj, function(value, index, list) {
          index = keys ? keys[--length] : --length;
          if (!initial) {
            memo = obj[index];
            initial = true;
          } else {
            memo = iterator.call(context, memo, obj[index], index, list);
          }
        });
        if (!initial) throw new TypeError(reduceError);
        return memo;
      };

      // Return the first value which passes a truth test. Aliased as `detect`.
      _.find = _.detect = function(obj, iterator, context) {
        var result;
        any(obj, function(value, index, list) {
          if (iterator.call(context, value, index, list)) {
            result = value;
            return true;
          }
        });
        return result;
      };

      // Return all the elements that pass a truth test.
      // Delegates to **ECMAScript 5**'s native `filter` if available.
      // Aliased as `select`.
      _.filter = _.select = function(obj, iterator, context) {
        var results = [];
        if (obj == null) return results;
        if (nativeFilter && obj.filter === nativeFilter) return obj.filter(iterator, context);
        each(obj, function(value, index, list) {
          if (iterator.call(context, value, index, list)) results.push(value);
        });
        return results;
      };

      // Return all the elements for which a truth test fails.
      _.reject = function(obj, iterator, context) {
        return _.filter(obj, function(value, index, list) {
          return !iterator.call(context, value, index, list);
        }, context);
      };

      // Determine whether all of the elements match a truth test.
      // Delegates to **ECMAScript 5**'s native `every` if available.
      // Aliased as `all`.
      _.every = _.all = function(obj, iterator, context) {
        iterator || (iterator = _.identity);
        var result = true;
        if (obj == null) return result;
        if (nativeEvery && obj.every === nativeEvery) return obj.every(iterator, context);
        each(obj, function(value, index, list) {
          if (!(result = result && iterator.call(context, value, index, list))) return breaker;
        });
        return !!result;
      };

      // Determine if at least one element in the object matches a truth test.
      // Delegates to **ECMAScript 5**'s native `some` if available.
      // Aliased as `any`.
      var any = _.some = _.any = function(obj, iterator, context) {
        iterator || (iterator = _.identity);
        var result = false;
        if (obj == null) return result;
        if (nativeSome && obj.some === nativeSome) return obj.some(iterator, context);
        each(obj, function(value, index, list) {
          if (result || (result = iterator.call(context, value, index, list))) return breaker;
        });
        return !!result;
      };

      // Determine if the array or object contains a given value (using `===`).
      // Aliased as `include`.
      _.contains = _.include = function(obj, target) {
        if (obj == null) return false;
        if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;
        return any(obj, function(value) {
          return value === target;
        });
      };

      // Invoke a method (with arguments) on every item in a collection.
      _.invoke = function(obj, method) {
        var args = slice.call(arguments, 2);
        var isFunc = _.isFunction(method);
        return _.map(obj, function(value) {
          return (isFunc ? method : value[method]).apply(value, args);
        });
      };

      // Convenience version of a common use case of `map`: fetching a property.
      _.pluck = function(obj, key) {
        return _.map(obj, function(value){ return value[key]; });
      };

      // Convenience version of a common use case of `filter`: selecting only objects
      // containing specific `key:value` pairs.
      _.where = function(obj, attrs, first) {
        if (_.isEmpty(attrs)) return first ? void 0 : [];
        return _[first ? 'find' : 'filter'](obj, function(value) {
          for (var key in attrs) {
            if (attrs[key] !== value[key]) return false;
          }
          return true;
        });
      };

      // Convenience version of a common use case of `find`: getting the first object
      // containing specific `key:value` pairs.
      _.findWhere = function(obj, attrs) {
        return _.where(obj, attrs, true);
      };

      // Return the maximum element or (element-based computation).
      // Can't optimize arrays of integers longer than 65,535 elements.
      // See [WebKit Bug 80797](https://bugs.webkit.org/show_bug.cgi?id=80797)
      _.max = function(obj, iterator, context) {
        if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {
          return Math.max.apply(Math, obj);
        }
        if (!iterator && _.isEmpty(obj)) return -Infinity;
        var result = {computed : -Infinity, value: -Infinity};
        each(obj, function(value, index, list) {
          var computed = iterator ? iterator.call(context, value, index, list) : value;
          computed > result.computed && (result = {value : value, computed : computed});
        });
        return result.value;
      };

      // Return the minimum element (or element-based computation).
      _.min = function(obj, iterator, context) {
        if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {
          return Math.min.apply(Math, obj);
        }
        if (!iterator && _.isEmpty(obj)) return Infinity;
        var result = {computed : Infinity, value: Infinity};
        each(obj, function(value, index, list) {
          var computed = iterator ? iterator.call(context, value, index, list) : value;
          computed < result.computed && (result = {value : value, computed : computed});
        });
        return result.value;
      };

      // Shuffle an array, using the modern version of the
      // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/FisherYates_shuffle).
      _.shuffle = function(obj) {
        var rand;
        var index = 0;
        var shuffled = [];
        each(obj, function(value) {
          rand = _.random(index++);
          shuffled[index - 1] = shuffled[rand];
          shuffled[rand] = value;
        });
        return shuffled;
      };

      // Sample **n** random values from an array.
      // If **n** is not specified, returns a single random element from the array.
      // The internal `guard` argument allows it to work with `map`.
      _.sample = function(obj, n, guard) {
        if (arguments.length < 2 || guard) {
          return obj[_.random(obj.length - 1)];
        }
        return _.shuffle(obj).slice(0, Math.max(0, n));
      };

      // An internal function to generate lookup iterators.
      var lookupIterator = function(value) {
        return _.isFunction(value) ? value : function(obj){ return obj[value]; };
      };

      // Sort the object's values by a criterion produced by an iterator.
      _.sortBy = function(obj, value, context) {
        var iterator = lookupIterator(value);
        return _.pluck(_.map(obj, function(value, index, list) {
          return {
            value: value,
            index: index,
            criteria: iterator.call(context, value, index, list)
          };
        }).sort(function(left, right) {
            var a = left.criteria;
            var b = right.criteria;
            if (a !== b) {
              if (a > b || a === void 0) return 1;
              if (a < b || b === void 0) return -1;
            }
            return left.index - right.index;
          }), 'value');
      };

      // An internal function used for aggregate "group by" operations.
      var group = function(behavior) {
        return function(obj, value, context) {
          var result = {};
          var iterator = value == null ? _.identity : lookupIterator(value);
          each(obj, function(value, index) {
            var key = iterator.call(context, value, index, obj);
            behavior(result, key, value);
          });
          return result;
        };
      };

      // Groups the object's values by a criterion. Pass either a string attribute
      // to group by, or a function that returns the criterion.
      _.groupBy = group(function(result, key, value) {
        (_.has(result, key) ? result[key] : (result[key] = [])).push(value);
      });

      // Indexes the object's values by a criterion, similar to `groupBy`, but for
      // when you know that your index values will be unique.
      _.indexBy = group(function(result, key, value) {
        result[key] = value;
      });

      // Counts instances of an object that group by a certain criterion. Pass
      // either a string attribute to count by, or a function that returns the
      // criterion.
      _.countBy = group(function(result, key) {
        _.has(result, key) ? result[key]++ : result[key] = 1;
      });

      // Use a comparator function to figure out the smallest index at which
      // an object should be inserted so as to maintain order. Uses binary search.
      _.sortedIndex = function(array, obj, iterator, context) {
        iterator = iterator == null ? _.identity : lookupIterator(iterator);
        var value = iterator.call(context, obj);
        var low = 0, high = array.length;
        while (low < high) {
          var mid = (low + high) >>> 1;
          iterator.call(context, array[mid]) < value ? low = mid + 1 : high = mid;
        }
        return low;
      };

      // Safely create a real, live array from anything iterable.
      _.toArray = function(obj) {
        if (!obj) return [];
        if (_.isArray(obj)) return slice.call(obj);
        if (obj.length === +obj.length) return _.map(obj, _.identity);
        return _.values(obj);
      };

      // Return the number of elements in an object.
      _.size = function(obj) {
        if (obj == null) return 0;
        return (obj.length === +obj.length) ? obj.length : _.keys(obj).length;
      };

      // Array Functions
      // ---------------

      // Get the first element of an array. Passing **n** will return the first N
      // values in the array. Aliased as `head` and `take`. The **guard** check
      // allows it to work with `_.map`.
      _.first = _.head = _.take = function(array, n, guard) {
        if (array == null) return void 0;
        return (n == null) || guard ? array[0] : slice.call(array, 0, n);
      };

      // Returns everything but the last entry of the array. Especially useful on
      // the arguments object. Passing **n** will return all the values in
      // the array, excluding the last N. The **guard** check allows it to work with
      // `_.map`.
      _.initial = function(array, n, guard) {
        return slice.call(array, 0, array.length - ((n == null) || guard ? 1 : n));
      };

      // Get the last element of an array. Passing **n** will return the last N
      // values in the array. The **guard** check allows it to work with `_.map`.
      _.last = function(array, n, guard) {
        if (array == null) return void 0;
        if ((n == null) || guard) {
          return array[array.length - 1];
        } else {
          return slice.call(array, Math.max(array.length - n, 0));
        }
      };

      // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.
      // Especially useful on the arguments object. Passing an **n** will return
      // the rest N values in the array. The **guard**
      // check allows it to work with `_.map`.
      _.rest = _.tail = _.drop = function(array, n, guard) {
        return slice.call(array, (n == null) || guard ? 1 : n);
      };

      // Trim out all falsy values from an array.
      _.compact = function(array) {
        return _.filter(array, _.identity);
      };

      // Internal implementation of a recursive `flatten` function.
      var flatten = function(input, shallow, output) {
        if (shallow && _.every(input, _.isArray)) {
          return concat.apply(output, input);
        }
        each(input, function(value) {
          if (_.isArray(value) || _.isArguments(value)) {
            shallow ? push.apply(output, value) : flatten(value, shallow, output);
          } else {
            output.push(value);
          }
        });
        return output;
      };

      // Flatten out an array, either recursively (by default), or just one level.
      _.flatten = function(array, shallow) {
        return flatten(array, shallow, []);
      };

      // Return a version of the array that does not contain the specified value(s).
      _.without = function(array) {
        return _.difference(array, slice.call(arguments, 1));
      };

      // Produce a duplicate-free version of the array. If the array has already
      // been sorted, you have the option of using a faster algorithm.
      // Aliased as `unique`.
      _.uniq = _.unique = function(array, isSorted, iterator, context) {
        if (_.isFunction(isSorted)) {
          context = iterator;
          iterator = isSorted;
          isSorted = false;
        }
        var initial = iterator ? _.map(array, iterator, context) : array;
        var results = [];
        var seen = [];
        each(initial, function(value, index) {
          if (isSorted ? (!index || seen[seen.length - 1] !== value) : !_.contains(seen, value)) {
            seen.push(value);
            results.push(array[index]);
          }
        });
        return results;
      };

      // Produce an array that contains the union: each distinct element from all of
      // the passed-in arrays.
      _.union = function() {
        return _.uniq(_.flatten(arguments, true));
      };

      // Produce an array that contains every item shared between all the
      // passed-in arrays.
      _.intersection = function(array) {
        var rest = slice.call(arguments, 1);
        return _.filter(_.uniq(array), function(item) {
          return _.every(rest, function(other) {
            return _.indexOf(other, item) >= 0;
          });
        });
      };

      // Take the difference between one array and a number of other arrays.
      // Only the elements present in just the first array will remain.
      _.difference = function(array) {
        var rest = concat.apply(ArrayProto, slice.call(arguments, 1));
        return _.filter(array, function(value){ return !_.contains(rest, value); });
      };

      // Zip together multiple lists into a single array -- elements that share
      // an index go together.
      _.zip = function() {
        var length = _.max(_.pluck(arguments, "length").concat(0));
        var results = new Array(length);
        for (var i = 0; i < length; i++) {
          results[i] = _.pluck(arguments, '' + i);
        }
        return results;
      };

      // Converts lists into objects. Pass either a single array of `[key, value]`
      // pairs, or two parallel arrays of the same length -- one of keys, and one of
      // the corresponding values.
      _.object = function(list, values) {
        if (list == null) return {};
        var result = {};
        for (var i = 0, length = list.length; i < length; i++) {
          if (values) {
            result[list[i]] = values[i];
          } else {
            result[list[i][0]] = list[i][1];
          }
        }
        return result;
      };

      // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),
      // we need this function. Return the position of the first occurrence of an
      // item in an array, or -1 if the item is not included in the array.
      // Delegates to **ECMAScript 5**'s native `indexOf` if available.
      // If the array is large and already in sort order, pass `true`
      // for **isSorted** to use binary search.
      _.indexOf = function(array, item, isSorted) {
        if (array == null) return -1;
        var i = 0, length = array.length;
        if (isSorted) {
          if (typeof isSorted == 'number') {
            i = (isSorted < 0 ? Math.max(0, length + isSorted) : isSorted);
          } else {
            i = _.sortedIndex(array, item);
            return array[i] === item ? i : -1;
          }
        }
        if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item, isSorted);
        for (; i < length; i++) if (array[i] === item) return i;
        return -1;
      };

      // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.
      _.lastIndexOf = function(array, item, from) {
        if (array == null) return -1;
        var hasIndex = from != null;
        if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) {
          return hasIndex ? array.lastIndexOf(item, from) : array.lastIndexOf(item);
        }
        var i = (hasIndex ? from : array.length);
        while (i--) if (array[i] === item) return i;
        return -1;
      };

      // Generate an integer Array containing an arithmetic progression. A port of
      // the native Python `range()` function. See
      // [the Python documentation](http://docs.python.org/library/functions.html#range).
      _.range = function(start, stop, step) {
        if (arguments.length <= 1) {
          stop = start || 0;
          start = 0;
        }
        step = arguments[2] || 1;

        var length = Math.max(Math.ceil((stop - start) / step), 0);
        var idx = 0;
        var range = new Array(length);

        while(idx < length) {
          range[idx++] = start;
          start += step;
        }

        return range;
      };

      // Function (ahem) Functions
      // ------------------

      // Reusable constructor function for prototype setting.
      var ctor = function(){};

      // Create a function bound to a given object (assigning `this`, and arguments,
      // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if
      // available.
      _.bind = function(func, context) {
        var args, bound;
        if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));
        if (!_.isFunction(func)) throw new TypeError;
        args = slice.call(arguments, 2);
        return bound = function() {
          if (!(this instanceof bound)) return func.apply(context, args.concat(slice.call(arguments)));
          ctor.prototype = func.prototype;
          var self = new ctor;
          ctor.prototype = null;
          var result = func.apply(self, args.concat(slice.call(arguments)));
          if (Object(result) === result) return result;
          return self;
        };
      };

      // Partially apply a function by creating a version that has had some of its
      // arguments pre-filled, without changing its dynamic `this` context.
      _.partial = function(func) {
        var args = slice.call(arguments, 1);
        return function() {
          return func.apply(this, args.concat(slice.call(arguments)));
        };
      };

      // Bind all of an object's methods to that object. Useful for ensuring that
      // all callbacks defined on an object belong to it.
      _.bindAll = function(obj) {
        var funcs = slice.call(arguments, 1);
        if (funcs.length === 0) throw new Error("bindAll must be passed function names");
        each(funcs, function(f) { obj[f] = _.bind(obj[f], obj); });
        return obj;
      };

      // Memoize an expensive function by storing its results.
      _.memoize = function(func, hasher) {
        var memo = {};
        hasher || (hasher = _.identity);
        return function() {
          var key = hasher.apply(this, arguments);
          return _.has(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));
        };
      };

      // Delays a function for the given number of milliseconds, and then calls
      // it with the arguments supplied.
      _.delay = function(func, wait) {
        var args = slice.call(arguments, 2);
        return setTimeout(function(){ return func.apply(null, args); }, wait);
      };

      // Defers a function, scheduling it to run after the current call stack has
      // cleared.
      _.defer = function(func) {
        return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));
      };

      // Returns a function, that, when invoked, will only be triggered at most once
      // during a given window of time. Normally, the throttled function will run
      // as much as it can, without ever going more than once per `wait` duration;
      // but if you'd like to disable the execution on the leading edge, pass
      // `{leading: false}`. To disable execution on the trailing edge, ditto.
      _.throttle = function(func, wait, options) {
        var context, args, result;
        var timeout = null;
        var previous = 0;
        options || (options = {});
        var later = function() {
          previous = options.leading === false ? 0 : new Date;
          timeout = null;
          result = func.apply(context, args);
        };
        return function() {
          var now = new Date;
          if (!previous && options.leading === false) previous = now;
          var remaining = wait - (now - previous);
          context = this;
          args = arguments;
          if (remaining <= 0) {
            clearTimeout(timeout);
            timeout = null;
            previous = now;
            result = func.apply(context, args);
          } else if (!timeout && options.trailing !== false) {
            timeout = setTimeout(later, remaining);
          }
          return result;
        };
      };

      // Returns a function, that, as long as it continues to be invoked, will not
      // be triggered. The function will be called after it stops being called for
      // N milliseconds. If `immediate` is passed, trigger the function on the
      // leading edge, instead of the trailing.
      _.debounce = function(func, wait, immediate) {
        var timeout, args, context, timestamp, result;
        return function() {
          context = this;
          args = arguments;
          timestamp = new Date();
          var later = function() {
            var last = (new Date()) - timestamp;
            if (last < wait) {
              timeout = setTimeout(later, wait - last);
            } else {
              timeout = null;
              if (!immediate) result = func.apply(context, args);
            }
          };
          var callNow = immediate && !timeout;
          if (!timeout) {
            timeout = setTimeout(later, wait);
          }
          if (callNow) result = func.apply(context, args);
          return result;
        };
      };

      // Returns a function that will be executed at most one time, no matter how
      // often you call it. Useful for lazy initialization.
      _.once = function(func) {
        var ran = false, memo;
        return function() {
          if (ran) return memo;
          ran = true;
          memo = func.apply(this, arguments);
          func = null;
          return memo;
        };
      };

      // Returns the first function passed as an argument to the second,
      // allowing you to adjust arguments, run code before and after, and
      // conditionally execute the original function.
      _.wrap = function(func, wrapper) {
        return function() {
          var args = [func];
          push.apply(args, arguments);
          return wrapper.apply(this, args);
        };
      };

      // Returns a function that is the composition of a list of functions, each
      // consuming the return value of the function that follows.
      _.compose = function() {
        var funcs = arguments;
        return function() {
          var args = arguments;
          for (var i = funcs.length - 1; i >= 0; i--) {
            args = [funcs[i].apply(this, args)];
          }
          return args[0];
        };
      };

      // Returns a function that will only be executed after being called N times.
      _.after = function(times, func) {
        return function() {
          if (--times < 1) {
            return func.apply(this, arguments);
          }
        };
      };

      // Object Functions
      // ----------------

      // Retrieve the names of an object's properties.
      // Delegates to **ECMAScript 5**'s native `Object.keys`
      _.keys = nativeKeys || function(obj) {
        if (obj !== Object(obj)) throw new TypeError('Invalid object');
        var keys = [];
        for (var key in obj) if (_.has(obj, key)) keys.push(key);
        return keys;
      };

      // Retrieve the values of an object's properties.
      _.values = function(obj) {
        var keys = _.keys(obj);
        var length = keys.length;
        var values = new Array(length);
        for (var i = 0; i < length; i++) {
          values[i] = obj[keys[i]];
        }
        return values;
      };

      // Convert an object into a list of `[key, value]` pairs.
      _.pairs = function(obj) {
        var keys = _.keys(obj);
        var length = keys.length;
        var pairs = new Array(length);
        for (var i = 0; i < length; i++) {
          pairs[i] = [keys[i], obj[keys[i]]];
        }
        return pairs;
      };

      // Invert the keys and values of an object. The values must be serializable.
      _.invert = function(obj) {
        var result = {};
        var keys = _.keys(obj);
        for (var i = 0, length = keys.length; i < length; i++) {
          result[obj[keys[i]]] = keys[i];
        }
        return result;
      };

      // Return a sorted list of the function names available on the object.
      // Aliased as `methods`
      _.functions = _.methods = function(obj) {
        var names = [];
        for (var key in obj) {
          if (_.isFunction(obj[key])) names.push(key);
        }
        return names.sort();
      };

      // Extend a given object with all the properties in passed-in object(s).
      _.extend = function(obj) {
        each(slice.call(arguments, 1), function(source) {
          if (source) {
            for (var prop in source) {
              obj[prop] = source[prop];
            }
          }
        });
        return obj;
      };

      // Return a copy of the object only containing the whitelisted properties.
      _.pick = function(obj) {
        var copy = {};
        var keys = concat.apply(ArrayProto, slice.call(arguments, 1));
        each(keys, function(key) {
          if (key in obj) copy[key] = obj[key];
        });
        return copy;
      };

      // Return a copy of the object without the blacklisted properties.
      _.omit = function(obj) {
        var copy = {};
        var keys = concat.apply(ArrayProto, slice.call(arguments, 1));
        for (var key in obj) {
          if (!_.contains(keys, key)) copy[key] = obj[key];
        }
        return copy;
      };

      // Fill in a given object with default properties.
      _.defaults = function(obj) {
        each(slice.call(arguments, 1), function(source) {
          if (source) {
            for (var prop in source) {
              if (obj[prop] === void 0) obj[prop] = source[prop];
            }
          }
        });
        return obj;
      };

      // Create a (shallow-cloned) duplicate of an object.
      _.clone = function(obj) {
        if (!_.isObject(obj)) return obj;
        return _.isArray(obj) ? obj.slice() : _.extend({}, obj);
      };

      // Invokes interceptor with the obj, and then returns obj.
      // The primary purpose of this method is to "tap into" a method chain, in
      // order to perform operations on intermediate results within the chain.
      _.tap = function(obj, interceptor) {
        interceptor(obj);
        return obj;
      };

      // Internal recursive comparison function for `isEqual`.
      var eq = function(a, b, aStack, bStack) {
        // Identical objects are equal. `0 === -0`, but they aren't identical.
        // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).
        if (a === b) return a !== 0 || 1 / a == 1 / b;
        // A strict comparison is necessary because `null == undefined`.
        if (a == null || b == null) return a === b;
        // Unwrap any wrapped objects.
        if (a instanceof _) a = a._wrapped;
        if (b instanceof _) b = b._wrapped;
        // Compare `[[Class]]` names.
        var className = toString.call(a);
        if (className != toString.call(b)) return false;
        switch (className) {
          // Strings, numbers, dates, and booleans are compared by value.
          case '[object String]':
            // Primitives and their corresponding object wrappers are equivalent; thus, `"5"` is
            // equivalent to `new String("5")`.
            return a == String(b);
          case '[object Number]':
            // `NaN`s are equivalent, but non-reflexive. An `egal` comparison is performed for
            // other numeric values.
            return a != +a ? b != +b : (a == 0 ? 1 / a == 1 / b : a == +b);
          case '[object Date]':
          case '[object Boolean]':
            // Coerce dates and booleans to numeric primitive values. Dates are compared by their
            // millisecond representations. Note that invalid dates with millisecond representations
            // of `NaN` are not equivalent.
            return +a == +b;
          // RegExps are compared by their source patterns and flags.
          case '[object RegExp]':
            return a.source == b.source &&
              a.global == b.global &&
              a.multiline == b.multiline &&
              a.ignoreCase == b.ignoreCase;
        }
        if (typeof a != 'object' || typeof b != 'object') return false;
        // Assume equality for cyclic structures. The algorithm for detecting cyclic
        // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.
        var length = aStack.length;
        while (length--) {
          // Linear search. Performance is inversely proportional to the number of
          // unique nested structures.
          if (aStack[length] == a) return bStack[length] == b;
        }
        // Objects with different constructors are not equivalent, but `Object`s
        // from different frames are.
        var aCtor = a.constructor, bCtor = b.constructor;
        if (aCtor !== bCtor && !(_.isFunction(aCtor) && (aCtor instanceof aCtor) &&
          _.isFunction(bCtor) && (bCtor instanceof bCtor))) {
          return false;
        }
        // Add the first object to the stack of traversed objects.
        aStack.push(a);
        bStack.push(b);
        var size = 0, result = true;
        // Recursively compare objects and arrays.
        if (className == '[object Array]') {
          // Compare array lengths to determine if a deep comparison is necessary.
          size = a.length;
          result = size == b.length;
          if (result) {
            // Deep compare the contents, ignoring non-numeric properties.
            while (size--) {
              if (!(result = eq(a[size], b[size], aStack, bStack))) break;
            }
          }
        } else {
          // Deep compare objects.
          for (var key in a) {
            if (_.has(a, key)) {
              // Count the expected number of properties.
              size++;
              // Deep compare each member.
              if (!(result = _.has(b, key) && eq(a[key], b[key], aStack, bStack))) break;
            }
          }
          // Ensure that both objects contain the same number of properties.
          if (result) {
            for (key in b) {
              if (_.has(b, key) && !(size--)) break;
            }
            result = !size;
          }
        }
        // Remove the first object from the stack of traversed objects.
        aStack.pop();
        bStack.pop();
        return result;
      };

      // Perform a deep comparison to check if two objects are equal.
      _.isEqual = function(a, b) {
        return eq(a, b, [], []);
      };

      // Is a given array, string, or object empty?
      // An "empty" object has no enumerable own-properties.
      _.isEmpty = function(obj) {
        if (obj == null) return true;
        if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;
        for (var key in obj) if (_.has(obj, key)) return false;
        return true;
      };

      // Is a given value a DOM element?
      _.isElement = function(obj) {
        return !!(obj && obj.nodeType === 1);
      };

      // Is a given value an array?
      // Delegates to ECMA5's native Array.isArray
      _.isArray = nativeIsArray || function(obj) {
        return toString.call(obj) == '[object Array]';
      };

      // Is a given variable an object?
      _.isObject = function(obj) {
        return obj === Object(obj);
      };

      // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp.
      each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp'], function(name) {
        _['is' + name] = function(obj) {
          return toString.call(obj) == '[object ' + name + ']';
        };
      });

      // Define a fallback version of the method in browsers (ahem, IE), where
      // there isn't any inspectable "Arguments" type.
      if (!_.isArguments(arguments)) {
        _.isArguments = function(obj) {
          return !!(obj && _.has(obj, 'callee'));
        };
      }

      // Optimize `isFunction` if appropriate.
      if (typeof (/./) !== 'function') {
        _.isFunction = function(obj) {
          return typeof obj === 'function';
        };
      }

      // Is a given object a finite number?
      _.isFinite = function(obj) {
        return isFinite(obj) && !isNaN(parseFloat(obj));
      };

      // Is the given value `NaN`? (NaN is the only number which does not equal itself).
      _.isNaN = function(obj) {
        return _.isNumber(obj) && obj != +obj;
      };

      // Is a given value a boolean?
      _.isBoolean = function(obj) {
        return obj === true || obj === false || toString.call(obj) == '[object Boolean]';
      };

      // Is a given value equal to null?
      _.isNull = function(obj) {
        return obj === null;
      };

      // Is a given variable undefined?
      _.isUndefined = function(obj) {
        return obj === void 0;
      };

      // Shortcut function for checking if an object has a given property directly
      // on itself (in other words, not on a prototype).
      _.has = function(obj, key) {
        return hasOwnProperty.call(obj, key);
      };

      // Utility Functions
      // -----------------

      // Run Underscore.js in *noConflict* mode, returning the `_` variable to its
      // previous owner. Returns a reference to the Underscore object.
      _.noConflict = function() {
        root._ = previousUnderscore;
        return this;
      };

      // Keep the identity function around for default iterators.
      _.identity = function(value) {
        return value;
      };

      // Run a function **n** times.
      _.times = function(n, iterator, context) {
        var accum = Array(Math.max(0, n));
        for (var i = 0; i < n; i++) accum[i] = iterator.call(context, i);
        return accum;
      };

      // Return a random integer between min and max (inclusive).
      _.random = function(min, max) {
        if (max == null) {
          max = min;
          min = 0;
        }
        return min + Math.floor(Math.random() * (max - min + 1));
      };

      // List of HTML entities for escaping.
      var entityMap = {
        escape: {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#x27;'
        }
      };
      entityMap.unescape = _.invert(entityMap.escape);

      // Regexes containing the keys and values listed immediately above.
      var entityRegexes = {
        escape:   new RegExp('[' + _.keys(entityMap.escape).join('') + ']', 'g'),
        unescape: new RegExp('(' + _.keys(entityMap.unescape).join('|') + ')', 'g')
      };

      // Functions for escaping and unescaping strings to/from HTML interpolation.
      _.each(['escape', 'unescape'], function(method) {
        _[method] = function(string) {
          if (string == null) return '';
          return ('' + string).replace(entityRegexes[method], function(match) {
            return entityMap[method][match];
          });
        };
      });

      // If the value of the named `property` is a function then invoke it with the
      // `object` as context; otherwise, return it.
      _.result = function(object, property) {
        if (object == null) return void 0;
        var value = object[property];
        return _.isFunction(value) ? value.call(object) : value;
      };

      // Add your own custom functions to the Underscore object.
      _.mixin = function(obj) {
        each(_.functions(obj), function(name) {
          var func = _[name] = obj[name];
          _.prototype[name] = function() {
            var args = [this._wrapped];
            push.apply(args, arguments);
            return result.call(this, func.apply(_, args));
          };
        });
      };

      // Generate a unique integer id (unique within the entire client session).
      // Useful for temporary DOM ids.
      var idCounter = 0;
      _.uniqueId = function(prefix) {
        var id = ++idCounter + '';
        return prefix ? prefix + id : id;
      };

      // By default, Underscore uses ERB-style template delimiters, change the
      // following template settings to use alternative delimiters.
      _.templateSettings = {
        evaluate    : /<%([\s\S]+?)%>/g,
        interpolate : /<%=([\s\S]+?)%>/g,
        escape      : /<%-([\s\S]+?)%>/g
      };

      // When customizing `templateSettings`, if you don't want to define an
      // interpolation, evaluation or escaping regex, we need one that is
      // guaranteed not to match.
      var noMatch = /(.)^/;

      // Certain characters need to be escaped so that they can be put into a
      // string literal.
      var escapes = {
        "'":      "'",
        '\\':     '\\',
        '\r':     'r',
        '\n':     'n',
        '\t':     't',
        '\u2028': 'u2028',
        '\u2029': 'u2029'
      };

      var escaper = /\\|'|\r|\n|\t|\u2028|\u2029/g;

      // JavaScript micro-templating, similar to John Resig's implementation.
      // Underscore templating handles arbitrary delimiters, preserves whitespace,
      // and correctly escapes quotes within interpolated code.
      _.template = function(text, data, settings) {
        var render;
        settings = _.defaults({}, settings, _.templateSettings);

        // Combine delimiters into one regular expression via alternation.
        var matcher = new RegExp([
          (settings.escape || noMatch).source,
          (settings.interpolate || noMatch).source,
          (settings.evaluate || noMatch).source
        ].join('|') + '|$', 'g');

        // Compile the template source, escaping string literals appropriately.
        var index = 0;
        var source = "__p+='";
        text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {
          source += text.slice(index, offset)
            .replace(escaper, function(match) { return '\\' + escapes[match]; });

          if (escape) {
            source += "'+\n((__t=(" + escape + "))==null?'':_.escape(__t))+\n'";
          }
          if (interpolate) {
            source += "'+\n((__t=(" + interpolate + "))==null?'':__t)+\n'";
          }
          if (evaluate) {
            source += "';\n" + evaluate + "\n__p+='";
          }
          index = offset + match.length;
          return match;
        });
        source += "';\n";

        // If a variable is not specified, place data values in local scope.
        if (!settings.variable) source = 'with(obj||{}){\n' + source + '}\n';

        source = "var __t,__p='',__j=Array.prototype.join," +
          "print=function(){__p+=__j.call(arguments,'');};\n" +
          source + "return __p;\n";

        try {
          render = new Function(settings.variable || 'obj', '_', source);
        } catch (e) {
          e.source = source;
          throw e;
        }

        if (data) return render(data, _);
        var template = function(data) {
          return render.call(this, data, _);
        };

        // Provide the compiled function source as a convenience for precompilation.
        template.source = 'function(' + (settings.variable || 'obj') + '){\n' + source + '}';

        return template;
      };

      // Add a "chain" function, which will delegate to the wrapper.
      _.chain = function(obj) {
        return _(obj).chain();
      };

      // OOP
      // ---------------
      // If Underscore is called as a function, it returns a wrapped object that
      // can be used OO-style. This wrapper holds altered versions of all the
      // underscore functions. Wrapped objects may be chained.

      // Helper function to continue chaining intermediate results.
      var result = function(obj) {
        return this._chain ? _(obj).chain() : obj;
      };

      // Add all of the Underscore functions to the wrapper object.
      _.mixin(_);

      // Add all mutator Array functions to the wrapper.
      each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {
        var method = ArrayProto[name];
        _.prototype[name] = function() {
          var obj = this._wrapped;
          method.apply(obj, arguments);
          if ((name == 'shift' || name == 'splice') && obj.length === 0) delete obj[0];
          return result.call(this, obj);
        };
      });

      // Add all accessor Array functions to the wrapper.
      each(['concat', 'join', 'slice'], function(name) {
        var method = ArrayProto[name];
        _.prototype[name] = function() {
          return result.call(this, method.apply(this._wrapped, arguments));
        };
      });

      _.extend(_.prototype, {

        // Start chaining a wrapped Underscore object.
        chain: function() {
          this._chain = true;
          return this;
        },

        // Extracts the result from a wrapped and chained object.
        value: function() {
          return this._wrapped;
        }

      });

    }).call(this);

    return this._;
  }).call({});

  //--------------------------------------------------------------------------------------
  //CUSTOM SETTINGS
  _.templateSettings = {
    evaluate:    /\{#(.+?)\}\}/g,       // {{# console.log("blah") }}
    interpolate: /\{\{(.+?)\}\}/g,      // {{ title }}
    escape:      /\{\{\{(.+?)\}\}\}/g,  // {{{ title }}}
  };

  //--------------------------------------------------------------------------------------
  //CUSTOM FUNCTIONS

  _.capitalize = (window.TWC && TWC.PcoUtils && TWC.PcoUtils.capitalize) || function(string) {
    string = String(string);
    return string && (string.charAt(0).toUpperCase() + string.slice(1));
  };

  _.convertToCamelCase = function(string) {
    string = String(string);
    return string && (string.charAt(0).toUpperCase() + string.slice(1).toLowerCase());
  };

  _.getCamelCase = function(name) {
    return name.toLowerCase().replace(/-(.)/g, function(match, group1) {
      return group1.toUpperCase();
    });
  },

  _.trim = function (str) {
    return str.replace(/^\s+|\s+$/g, '');
  };

  _.param = function(obj) {
    return jQuery.param(obj);
  };

  /**
   * Helper method to strip out :SS from HH:MM:SS am
   * @param tm
   * @returns {string}  Ex: 09:45 am
   */
  _.formatTime = function(tm) {
    var t1 = tm.split(':'), t2 = tm.split(' ');
    return [t1[0],':',t1[1], ' ', t2[1]].join('');
  };



  /**
   * Helper method to retrieve timezone based on browser or location object
   * loc Location object
   * @param loc
   * @returns {String} Ex: EDT
   */
  _.getTimeZone = function(loc) {
    return loc ? loc : new Date().toString().match(/\(([A-Za-z\s].*)\)/)[1];
  };

  /**
   * Merges multiple arrays into the first array
   */
  _.merge = function() {
    jQuery.merge.apply(jQuery,arguments);
  };

  /**
   * Split array into small sub-arrays of mentioned chunkSize.
   * Eg: chunk([1,2,3,4,5,6,7,8], 3) results in [[1,2,3], [4,5,6], [7,8]]
   * Added by: ksankaran (Velu)
   * @param array
   * @param chunkSize
   * @returns {Array|Array}
   */
  _.chunk = function(array, chunkSize) {
    return [].concat.apply([],
      _.map(array, function(elem,i) {
        return i%chunkSize ? [] : [array.slice(i,i+chunkSize)];
      })
    );
  };

  _.getURLParameter = ('PcoUtils' in TWC && 'getURLParameter' in TWC.PcoUtils) ? TWC.PcoUtils.getURLParameter : function( parameter ) {
    return decodeURIComponent((new RegExp('[?|&]' + parameter + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
  };

  /**
   * SafeApply for AngularJS modules.
   * @param scope
   * @param fn
   */
  _.safeApply = function(scope, fn) {
    return scope.$evalAsync(fn);
  };

  /**
   *
   * @param destination
   * @param {...*} sources
   * @returns {*}
   */
  _.deepExtend = function(destination) {
    var deepExtend = _.deepExtend;
    var sources = Array.prototype.slice.call(arguments,1);
    _.each(sources, function(source) {
      _.each(source,function(value,property) {
        if (value && _.isObject(value)) {
          destination[property] = destination[property] || {};
          deepExtend(destination[property], value);
        } else {
          destination[property] = value;
        }
      });
    });

    return destination;
  };

  /**
   *
   * @param locModel {{getCountryCode:Function}}
   * @returns {Boolean}
   */
  _.isUSLocation = function(locModel){
    return ((locModel.getCountryCode() || '').toLowerCase() ===  'us');
  };

  /**
   * isNumeric: Returns a boolean indicating if a given string value is number only
   * @param val
   * @returns {*|boolean}
   */
  _.isNumeric = function(val) {
    return /^-?\d+$/.test(val);
  };

  /**
   * isAlpha:  Returns a boolean indicating if a given string value is alphabet only
   * @param val
   * @returns {*|boolean}
   */
  _.isAlpha = function(val) {
    return /^[a-zA-Z.,\s]+$/.test(val);
  };

  /**
   * List of non-conus states
   * @type {Array}
   */
  _.nonConusStates = ['AK', 'AS', 'GU', 'HI', 'MP', 'MQ', 'PR', 'VI', 'WQ'];

  /**
   * Taken the location model and returns if the location is conus or not
   * @param loc
   * @returns {boolean}
   */
  _.isConus = function(loc) {
    var stateCd = loc.getStateCode();
    var countryCode = loc.getCountryCode();

    return _.isConusByCountryState(stateCd, countryCode);
  };

  /**
  * Taken the countryCode and the stateCode and returns if the location is conus or not
  * @param stateCd
  * @param countryCode
  * @returns {boolean}
  */
  _.isConusByCountryState = function(stateCd, countryCode) {
    return countryCode == 'US' && _.nonConusStates.indexOf(stateCd) === -1;
  };


  /**
   * returns null for undefined data field
   * @param input
   * @returns {*}
   */
  _.validate = function(input) {
    return (input === 0 || !!input) ? input : null;
  };

  /**
   *
   */

  _.dateTimeToDate = function(datetime){
    return datetime && datetime.replace(/-/g,"").substr(0,8);
  };
  /**
   * Get GMT diff from ISO date string. We can modify dsxdate but the
   * requirement was to just get the GMT diff and creating one big object
   * for just a small data is not a good idea.
   * @param dateStr in ISO format
   * @return {String}
   */
  _.getGMTOffsetFromISODate = function( dateStr ) {
    if(!!dateStr) {
      var match_parts = dateStr.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})\.(\d+)([+-]?)(\d+)([:]{1})(\d+)/);
      // is it ISO string?
      if(match_parts && match_parts.length === 12) {
        var diff = ((parseInt(match_parts[9]) || 0) + ((parseInt(match_parts[11]) || 0) / 60));
        return (match_parts[8] === "-") ? -(diff) : diff;
      }
    }
    return null;
  };

  /**
   * Removes duplicated char in a given string
   * @param string
   * @param char
   * @returns {*}
   */
  _.removeDupChar = function(string, char) {
    var pattern = _isValid(char) ? "(" + char + ")\\1+" : "(\\" + char + ")\\1+";
    var regex = new RegExp(pattern, "g");
    return string.replace(regex, function (str, match) {
      return match[0]
    });
  };


  /**
   * Removes all special characters (keeps digits, word chars, underscores, and whitespaces)
   * @param string
   * @return string
   */
  _.removeSpecialChars = function(str) {
    return str.replace(/[^\w\s]/gi, '');
  };

  /**
   * Removes spaces
   * @param  string
   * @return string
   */
  _.removeSpaces = function(str) {
    return str.replace(/\s+/g, '');
  };

  /**
   * Check to see if char is not a special char
   * @param char
   * @returns {boolean}
   * @private
   */
  _isValid = function(char) {
    var check = /^[a-z0-9 ]$/i;
    return check.test(char);
  };

  /**
   * Removes char in a given string
   * @param string
   * @param char
   * @returns {*}
   * @private
   */
  _removeChar = function(string, char) {
    var pattern = _isValid(char) ? char : "\\"+char;
    var regex = new RegExp(pattern, "g");
    return string.replace(regex, function (str, match) {
      return '';
    });
  };

  /**
   * Converts hexadecimal colors to rgb in order to add the alpha channel
   * @param hex
   * @returns {{r: Number, g: Number, b: Number}}
   * @private
   */
  _.hexToRgb = function(hex, alpha) {
    // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, function(m, r, g, b) {
      return r + r + g + g + b + b;
    });

    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);

    var r = parseInt(result[1], 16),
        g = parseInt(result[2], 16),
        b = parseInt(result[3], 16),
        a = alpha || 1;

    var rgba = [r,g,b,a].join(',');
    var rgbaCode = ['rgba(', rgba, ')'].join('');

    return result ? rgbaCode : null;

  };

  _.loadTemplate = function(templateUrl) {
    var df = $q.defer();
    $http.get(templateUrl, {cache: $templateCache}).then(function(html) {
      df.resolve(html);
    });
    return df.promise;
  };


  /**
   * Converts ISO time to date object. Only for IE8
   * @returns date
   */
  _.fromISOToDate = (function(){
    var testIso = '2011-11-24T09:00:27+0200';
    // Chrome
    var diso= Date.parse(testIso);
    if(diso===1322118027000) {
      return function(s){
        return new Date(Date.parse(s));
      };
    }
    // JS 1.8 gecko
    var noOffset = function(s) {
      var day= s.slice(0,-5).split(/\D/).map(function(itm){
        return parseInt(itm, 10) || 0;
      });
      day[1]-= 1;
      day= new Date(Date.UTC.apply(Date, day));
      var offsetString = s.slice(-5);
      var offset = parseInt(offsetString,10)/100;
      if (offsetString.slice(0,1)==="+"){offset*=-1;}
      day.setHours(day.getHours()+offset);
      return day;
    };
    if (noOffset(testIso)===1322118027000) {
      return noOffset;
    }
    return function(s){ // kennebec@SO + QTax@SO
      var day, tz,
//        rx = /^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d{4}))?$/,
        rx = /^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):?(\d\d))?$/,

        p= rx.exec(s) || [];
      if(p[1]){
        day= p[1].split(/\D/).map(function(itm){
          return parseInt(itm, 10) || 0;
        });
        day[1]-= 1;
        day= new Date(Date.UTC.apply(Date, day));
        if(!day.getDate()){ return NaN;}
        if(p[5]){
          tz= parseInt(p[5], 10)/100*60;
          if(p[6]) {tz += parseInt(p[6], 10);}
          if(p[4]=== "+") {tz*= -1;}
          if(tz) {day.setUTCMinutes(day.getUTCMinutes()+ tz);}
        }
        return day;
      }
      return NaN;
    };
  })();

  return _;
});
;/**/
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/notify/notify.factory.js. */
twc.shared.apps.factory('twcNotify',['$log',function($log){window.l=$log;return{error:function(str){$log.error(str)},warning:function(str){$log.warn('%c'+str,'color:white;background-color:rgb(252, 191, 83)')},success:function(str){$log.log('%c'+str,'color:white;background-color:green')},info:function(str){$log.info('%c'+str,'color:white;background-color:rgb(84, 152, 255)')}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/notify/notify.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/twc_social_sharing.factory.js. */
twc.shared.apps.factory('TwcSocialSharing',['$rootScope','$window','customEvent','$q','PageMetaTags','twcConstant','httpclient','TwcMicrodata','$interpolate',function($rootScope,$window,customEvent,$q,PageMetaTags,twcConstant,httpclient,TwcMicrodata,$interpolate){'use strict';var share={},schema=twcConstant.microdata.schema,socialConstants={basePath:'http://'+window.location.hostname,securePath:'https://ssl.weather.com',playerSwf:'/sites/all/modules/custom/angularmods/app/shared/videoamp/lib/amp.premier/AkamaiPremierPlayer.swf',swfPlayerConfig:'/sites/all/modules/custom/angularmods/app/shared/videoplayer_amp/flash-secured.xml',ampPlayerConfig:'/sites/all/modules/custom/angularmods/app/shared/videoplayer_amp/videoampsecure_config.xml',logoImage:twcConstant.assetsUrl+'240x180_twc_default.png',fbSite:'The Weather Channel',twitterSite:'@weatherchannel'};customEvent.getEvent('close-ugc-modal-event').progress(function(event,data){TwcMicrodata.injectMicrodata()});var social={isLoggedIn:false,userName:'',status:'',user:'',userAuth:{},shareUrl:$window.location.href,gigyaLoaded:false,gigyaUrl:'http://cdn.gigya.com/js/gigya.js',apiKey:'2_zm_J-0UHOLnihq44PTNDi4NgoxbHWy24MhkmKlQMWPd3lOa1a-4r8uViC7HAu8Jr',gigyaParams:{callback:window.gigyaConnectCallback},getGigyaUrl:function(){return social.gigyaUrl+'?apiKey='+social.apiKey},loadGigyaAPI:function(){var df=$q.defer();if(typeof gigya==='undefined'&&!social.gigyaLoaded&&social.gigyaLoaded!=='loading'){social.gigyaLoaded='loading';window.onGigyaServiceReady=function(response){social.gigyaLoaded=true;customEvent.getEvent('gigyaLoadedEvent').resolve();df.resolve(response)};httpclient.getScript({url:social.getGigyaUrl()})}else df.resolve();return df.promise},connect:function(provider){var df=$q.defer();social.gigyaParams={provider:provider,callback:function(response){df.resolve(response)}};social.loadGigyaAPI().then(function(){gigya.socialize.addConnection(social.gigyaParams)});return df.promise},alertInfoUpdate:function(instanceId,alert){if(alert){angular.forEach({'og:site_name':socialConstants.fbSite,'og:title':alert.title,'og:image':socialConstants.logoImage,'og:url':alert.url+"?_escaped_fragment_",'og:description':alert.description,'og:type':'website'},function(value,key){PageMetaTags.addOGTagToDOM(key,value)});angular.forEach({'twitter:site':socialConstants.twitterSite,'twitter:title':alert.description,'twitter:image:src':socialConstants.logoImage,'twitter:url':alert.url,'twitter:description':alert.description,'twitter:card':'summary'},function(value,key){PageMetaTags.addTwitterTagToDOM(key,value)});social.setMetaTags(instanceId,alert);social.updateShareUrl(instanceId,alert.url);TwcMicrodata.injectMicrodata({schema:schema.organization.name,image:socialConstants.logoImage,name:alert.title,description:alert.description})}},assetInfoUpdate:function(instanceId,asset){if(asset){var mediaAsset={};mediaAsset.type=(asset.getType()==='video'?'video':'photo');mediaAsset={assetId:asset.getId(),title:asset.getTitle(),type:asset.getType(),description:asset.getDescription(),image:asset.getLargeThumbUrl(),stream:asset.getAssetUrl(),width:'485',height:'273'};if(asset.getType()==='video'){mediaAsset.secureurl=socialConstants.securePath+'/video/player/'+mediaAsset.assetId;mediaAsset.streamurl=socialConstants.basePath+socialConstants.playerSwf+'?settings_url='+socialConstants.basePath+socialConstants.swfPlayerConfig+'&video_url='+mediaAsset.stream+'&d=www.weather.com';mediaAsset.securestreamurl=socialConstants.securePath+socialConstants.playerSwf+'?settings_url='+socialConstants.securePath+socialConstants.swfPlayerConfig+'&video_url='+mediaAsset.stream+'&d=www.weather.com'};mediaAsset.url='http://'+window.location.hostname+asset.getCanonicalUrl();social.populateOGTagsForAsset(mediaAsset);social.populateTwitterCardsForAsset(mediaAsset);social.setMetaTags(instanceId,mediaAsset);social.updateShareUrl(instanceId,mediaAsset.url);if(asset.getType()==='video'){TwcMicrodata.injectMicrodata({schema:schema.video.name,image:mediaAsset.image,name:mediaAsset.title,description:mediaAsset.description,embedUrl:mediaAsset.stream,thumbnailUrl:mediaAsset.image,author:asset.getProviderId()})}else TwcMicrodata.injectMicrodata({schema:schema.image.name,image:mediaAsset.image,name:mediaAsset.title,description:mediaAsset.description,author:asset.getProviderId(),publishDate:asset.getPublishDate()})}},updateMapLayerShare:function(instanceId,url){social.updateShareUrl(instanceId,url);TwcMicrodata.injectMicrodata({schema:schema.organization.name,image:socialConstants.logoImage})},populateOGTagsForAsset:function(mediaAsset){var ogTags={'og:site_name':socialConstants.fbSite,'og:title':mediaAsset.title,'og:image':mediaAsset.image,'og:url':mediaAsset.url+"?_escaped_fragment_",'og:description':mediaAsset.description,'og:type':mediaAsset.type};if(mediaAsset.type==='video'){ogTags['og:video:width']=mediaAsset.width;ogTags['og:video:height']=mediaAsset.height;ogTags['og:video:type']='application/x-shockwave-flash';ogTags['og:video']=mediaAsset.streamurl;ogTags['og:video:secure_url']=mediaAsset.securestreamurl}else ogTags['og:type']='website';angular.forEach(ogTags,function(value,key){PageMetaTags.addOGTagToDOM(key,value)})},populateTwitterCardsForAsset:function(mediaAsset){var twitterTags={'twitter:site':socialConstants.twitterSite,'twitter:title':mediaAsset.title,'twitter:image:src':mediaAsset.image,'twitter:url':mediaAsset.url,'twitter:description':mediaAsset.description,'twitter:card':'summary'};if(mediaAsset.type==='video'){twitterTags['twitter:card']='player';twitterTags['twitter:player:width']=mediaAsset.width;twitterTags['twitter:player:height']=mediaAsset.height;twitterTags['twitter:player']=mediaAsset.secureurl}else if(mediaAsset.type==='image')twitterTags['twitter:card']='photo';angular.forEach(twitterTags,function(value,key){PageMetaTags.addTwitterTagToDOM(key,value)})},setMetaTags:function(instanceId,override){var pageTitle=$interpolate(TWC.pageTitle)($rootScope),pageUrl=document.location.href,desc=$interpolate(TWC.pageDescription)($rootScope),ogType=function(){return angular.element(document.querySelector('[property="og:type"]')).attr('content')},ogUrl=function(){return angular.element(document.querySelector('[property="og:url"]')).attr('content')},ogTitle=function(){return(angular.element(document.querySelector('[property="og:title"]')).attr('content'))},ogDescription=function(){return(angular.element(document.querySelector('[property="og:description"]')).attr('content'))},ogImageUrl=function(){return angular.element(document.querySelector('[property="og:image"]')).attr('content')},twitterUrl=function(){return angular.element(document.querySelector('[name="twitter:url"]')).attr('content')},twitterTitle=function(){return(angular.element(document.querySelector('[name="twitter:title"]')).attr('content'))},twitterDescription=function(){return(angular.element(document.querySelector('[name="twitter:description"]')).attr('content'))},twitterImageUrl=function(){return angular.element(document.querySelector('[name="twitter:image:src"]')).attr('content')},isArticle=!!Drupal.settings['ct_article'],metaTags;if(!share[instanceId]){share[instanceId]={metaTags:{},media:{}};metaTags=share[instanceId].metaTags}else metaTags=share[instanceId].metaTags;metaTags.ogType=function(){return(override&&override.type)?override.type:ogType()};metaTags.ogUrl=function(){return(override&&override.url)?override.url:ogUrl()};metaTags.ogTitle=function(){return(override&&override.title)?override.title:ogTitle()};metaTags.ogDescription=function(){return(override&&override.description)?override.description:ogDescription()};metaTags.ogImageUrl=function(){return(override&&override.image)?override.image:ogImageUrl()};metaTags.twitterUrl=function(){return(override&&override.url)?override.url:twitterUrl()};metaTags.twitterImageUrl=function(){return(override&&override.image)?override.image:twitterImageUrl()};metaTags.twitterTitle=function(){return(override&&override.title)?override.title:twitterTitle()};metaTags.twitterDescription=function(){return(override&&override.description)?override.description:twitterDescription()};metaTags.twitterSite=function(){return socialConstants.twitterSite};if(!ogType()&&!isArticle){ogType=function(){return'website'};metaTags.ogType=function(){return ogType()};PageMetaTags.addOGTagToDOM('og:type',ogType())};if(metaTags.ogType()==='video'){metaTags.ogVidUrl=function(){return(override&&override.streamurl)?override.streamurl:angular.element(document.querySelector('[property="og:video"]')).attr('content')};metaTags.ogVidSecureUrl=function(){return(override&&override.securestreamurl)?override.securestreamurl:angular.element(document.querySelector('[property="og:video:secure_url"]')).attr('content')}};if(!metaTags.ogUrl()){metaTags.ogUrl=function(){return pageUrl};PageMetaTags.addTwitterTagToDOM('og:url',pageUrl)};if(!metaTags.twitterUrl()){metaTags.twitterUrl=function(){return pageUrl};PageMetaTags.addTwitterTagToDOM('twitter:url',pageUrl)};if(!metaTags.ogTitle()){metaTags.ogTitle=function(){return pageTitle};PageMetaTags.addOGTagToDOM('og:title',metaTags.ogTitle())};if(!metaTags.ogDescription()){metaTags.ogDescription=function(){return desc};PageMetaTags.addOGTagToDOM('og:description',metaTags.ogDescription())};PageMetaTags.addOGTagToDOM('og:site_name',socialConstants.fbSite);if(!metaTags.twitterTitle()){metaTags.twitterTitle=function(){return pageTitle};PageMetaTags.addTwitterTagToDOM('twitter:title',metaTags.twitterTitle())};if(!metaTags.twitterDescription()){metaTags.twitterDescription=function(){return desc};PageMetaTags.addTwitterTagToDOM('twitter:description',metaTags.twitterDescription())};if(!metaTags.ogImageUrl()){metaTags.ogImageUrl=function(){return socialConstants.logoImage};PageMetaTags.addOGTagToDOM('og:image',socialConstants.logoImage)};if(!metaTags.twitterImageUrl()){metaTags.twitterImageUrl=function(){return socialConstants.logoImage};PageMetaTags.addTwitterTagToDOM('twitter:image:src',socialConstants.logoImage)};if(!metaTags.twitterSite()){metaTags.twitterSite=function(){return socialConstants.twitterSite};PageMetaTags.addTwitterTagToDOM('twitter:site',socialConstants.twitterSite)}},updateShareUrl:function(instanceId,shareUrl){if(!share[instanceId])share[instanceId]={metaTags:{},media:{}};var metaTags=share[instanceId].metaTags,media=share[instanceId].media;media.shareUrl=shareUrl;media.shareUrl+=((media.shareUrl.indexOf('?')!==-1)?'&':'?');media.facebookUrl=media.shareUrl+'cm_ven=Facebook&cm_cat=www.facebook.com&cm_pla=fb_feed&cm_ite=fb_social_rec&fb_ref=ls_share';media.twitterUrl=media.shareUrl+'cm_ven=Twitter&cm_cat=www.twitter.com&cm_pla=tw_feed&cm_ite=tw_social_tweet';media.redditUrl=media.shareUrl+'cm_ven=Reddit&cm_cat=www.reddit.com&cm_pla=r_feed&cm_ite=r_social_post';media.pinterestUrl=media.shareUrl+'cm_ven=Pinterest&cm_cat=www.pinterest.com&cm_pla=p_feed&cm_ite=p_social_pin';media.googleplusUrl=media.shareUrl+'cm_ven=GooglePlus&cm_cat=plus.google.com&cm_pla=gp_feed&cm_ite=gp_social_post';media.emailUrl=media.shareUrl+'&cm_ven=Email&cm_cat='+metaTags.cmCat},setShareUrl:function(instanceId){social.updateShareUrl(instanceId,(angular.element(document.querySelector('[rel="canonical"]')).attr('href')||$window.location.href))},getShareInstance:function(instanceId){return share[instanceId]},initSocialSettings:function(instanceId){return($q.all(social.setMetaTags(instanceId),social.setShareUrl(instanceId),social.loadGigyaAPI()))}};return social}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/twc_social_sharing.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/twc_social_sharing.controller.js. */
twc.shared.apps.controller('twcSocialSharingController',['$scope','DrupalSettings','TwcSocialSharing','$q','customEvent','twcConfig','$injector','twcConstant','twcPco','twcUtil',function($scope,DrupalSettings,TwcSocialSharing,$q,customEvent,twcConfig,$injector,twcConstant,twcPco,twcUtil){'use strict';var logger=$scope.$root.$log.getInstance('twcSocialSharingController'),status=twcConfig.module_status_codes,params,share,metaTags,media,trackEvents={facebook:'event53,event57',twitter:'event55,event57',pinterest:'event62,event57',reddit:'event67,event57',googleplus:'event61,event57',email:'event56,event57'},isArticle=!!Drupal.settings['ct_article'],fns={createProviderArray:function(settings){angular.forEach(settings.providers,function(value){if(value)$scope.params.providers.push(value)})}};$scope.params={status:status.LOADING,scope:$scope,providers:[]};$scope.init=function(settings){$scope.params.settings=settings;$scope.params.instanceId=DrupalSettings.getInstanceIdBySettings(settings);fns.createProviderArray(settings);jQuery.when.apply(jQuery,[].concat(twcPco.get("page").promises,twcPco.get("user").promises)).done(function(){TwcSocialSharing.initSocialSettings($scope.params.instanceId).then(function(){params=$scope.params;share=TwcSocialSharing.getShareInstance(params.instanceId);metaTags=share.metaTags;media=share.media})});customEvent.getEvent('newAsset').progress(function(payload,instanceId){if(isArticle)return;TwcSocialSharing.assetInfoUpdate(instanceId||$scope.params.instanceId,payload)});customEvent.getEvent('imap_layerChanged').progress(function(layer){var currentURL=window.location.href,queryStringChar=((currentURL.indexOf('?')!==-1)?'&':'?'),layersParam=TWC.PcoUtils.getURLParameter("interactiveMapLayer"),posOfLayersParam=currentURL.indexOf("interactiveMapLayer");if(posOfLayersParam!==-1){currentURL=currentURL.replace("interactiveMapLayer="+layersParam,"interactiveMapLayer="+layer)}else currentURL=currentURL+queryStringChar+"interactiveMapLayer="+layer;TwcSocialSharing.updateMapLayerShare($scope.params.instanceId,currentURL)});customEvent.getEvent('alertDetailEvent').progress(function(payload){TwcSocialSharing.alertInfoUpdate($scope.params.instanceId,payload)});customEvent.getEvent('urlChangeEvent').progress(function(){TwcSocialSharing.setShareUrl($scope.params.instanceId)})};$scope.openShare=function(provider){var titleStr,thumbnailUrlStr,twitterTitle=(metaTags.twitterTitle&&metaTags.twitterTitle())||(metaTags.ogTitle&&metaTags.ogTitle())||"",twitterImageUrl=metaTags.twitterImageUrl&&metaTags.twitterImageUrl(),shareUrl=media.shareUrl,ogImageUrl=metaTags.ogImageUrl&&metaTags.ogImageUrl(),ogDescription=metaTags.ogDescription&&metaTags.ogDescription();if(provider==="twitter"){titleStr=twitterTitle?twitterTitle+' @weatherchannel':metaTags.twitterDescription()+' @weatherchannel';thumbnailUrlStr=twitterImageUrl?twitterImageUrl:ogImageUrl}else{titleStr=metaTags.ogTitle&&metaTags.ogTitle();thumbnailUrlStr=ogImageUrl};var gigUrl=media[provider+"Url"];if(!gigUrl)gigUrl=shareUrl;var act=new gigya.socialize.UserAction();act.setTitle(titleStr);act.setSubtitle(window.location.hostname);act.setLinkBack(gigUrl);if(ogDescription)act.setDescription(ogDescription);if(metaTags.ogType()==="video"&&provider==="facebook"){var video={src:metaTags.ogVidSecureUrl(),previewImageURL:thumbnailUrlStr,previewImageWidth:'160',previewImageHeight:'90',type:'flash',width:'485',height:'273'};act.addMediaItem(video)}else act.addMediaItem({type:'image',src:thumbnailUrlStr,href:gigUrl});if(gigya&&provider!=='email'){var options={provider:provider,url:gigUrl,title:titleStr,cid:twcPco.getNodeValue("metrics","contentChannel")||"",shortURLs:(provider==="twitter"?'always':'never'),description:ogDescription,thumbnailURL:thumbnailUrlStr,userAction:act};if(provider==='facebook')options.facebookDialogType='feed';gigya.socialize.postBookmark(options);$scope.trackProvider(provider)}else if(gigya&&provider==='email'){$scope.trackProvider(provider);location.href='mailto:?body='+encodeURIComponent(titleStr+'\n\n'+gigUrl)+'&subject=Check this out on weather.com'}else return false};$scope.trackProvider=function(provider){var attrs={linkTrackVars:'eVar21,eVar22,eVar24,campaign,events',linkTrackEvents:trackEvents[provider],socialTrackAction:true,eVar21:provider,eVar22:twcPco.getNodeValue("metrics","pagename")||"",eVar24:twcPco.getNodeValue("metrics","contentChannel")||"",campaign:null,events:trackEvents[provider]};$scope.tracking(twcConstant.socialMedia[provider].title,attrs)};$scope.tracking=function(trackStr,attrs){customEvent.getEvent('track-string-event').notify({trackStr:trackStr,settings:params.settings,attrs:attrs})}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/twc_social_sharing.controller.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/twc_social_sharing.directive.js. */
twc.shared.apps.directive('twcSocialBar',['$rootScope','twcUtil','$compile','$parse','$timeout',function($rootScope,twcUtil,$compile,$parse,$timeout){return{restrict:'EA',templateUrl:function(element,attrs){var templatePath='/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/templates/',device=$rootScope.isMobile?'mobile':'',template=attrs.template,basicTemplate=(angular.element('html').hasClass('lt-ie9')||angular.element('html').hasClass('ie-9'))?'social_bar.html':'social_bar.html';basicTemplate=template?template+'.html':basicTemplate;return attrs.template?templatePath+attrs.template+'.html':templatePath+device+basicTemplate},require:'^twcReferenceScope',scope:{providers:'=',tooltipPosition:'=',theme:'='},controller:['$scope',function($scope){this.doShare=function(media){$scope.callback($scope.refCtrl.refScope(),{media:media})};this.tooltipPosition=function(){return $scope.tooltipPosition};this.theme=function(){return $scope.theme};$scope.toggleExpand=false;$scope.expand=function(){$scope.toggleExpand=!$scope.toggleExpand}}],link:function(scope,element,attrs,refCtrl){var $ul=element.find('ul');scope.refCtrl=refCtrl;scope.callback=$parse(attrs.callback);angular.forEach(scope.providers,function(provider,key){$ul.append($compile('<div data-twc-media data-provider="'+provider+'"></div>')(scope))})}}}]).directive('twcMedia',['twcConstant','$filter',function(twcConstant,$filter){return{restrict:'EA',replace:true,templateUrl:'/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/templates/social_media.html',require:['^twcSocialBar','^?twcTooltip'],scope:true,controller:['$scope',function($scope){$scope.doShare=function(){$scope.ctrl.doShare($scope.provider)};$scope.getTooltipPosition=function(){return $scope.ctrl.tooltipPosition()};$scope.getTheme=function(){return $scope.ctrl.theme()}}],link:function(scope,element,attrs,ctrls){var tooltipCtrl=ctrls[1]?ctrls[1]:null,span=element.find('span');scope.provider=attrs.provider?attrs.provider:'';scope.title=$filter('translate')('twcSocialSharing.'+scope.provider);scope.mediaClass=twcConstant.socialMedia[scope.provider].icon||"";scope.ctrl=ctrls[0];scope.$watch('getTooltipPosition()',function(newVal,oldVal){scope.tooltipPosition=newVal})}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/twc_social_sharing.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/mobile_header_display_ctr/mobile_header_display_ctr.factory.js. */
twc.shared.apps.factory("mobileHeaderDisplayCtr",function(){'use strict';var displayMainMenu=false,mw_main_menu_icon="wx-iconfont-global wx-icon-menu",mw_main_menu=" ",mw_nav_menu=" ",hideSearchBox=true,api={getActiveMenuIconClass:function(){return mw_main_menu_icon},getActiveMainMenuClass:function(){return mw_main_menu},getActiveNavMenuClass:function(){return mw_nav_menu},getDisplayMainMenuValue:function(){return displayMainMenu},displayMenu:function(){displayMainMenu=true;mw_main_menu_icon="wx-iconfont-global wx-icon-close";mw_main_menu="mw-menu-active";mw_nav_menu="mw-nav-active"},hideMainMenu:function(){displayMainMenu=false;mw_main_menu_icon="wx-iconfont-global wx-icon-menu";mw_main_menu="";mw_nav_menu=""},getSearchBoxDisplayValue:function(){return hideSearchBox},displaySearchLocations:function(){hideSearchBox=false;api.changeFocus()},hideSearchLocations:function(){hideSearchBox=true}};return api});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/mobile_header_display_ctr/mobile_header_display_ctr.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/loc_util/loc_util.factory.js. */
twc.shared.apps.factory("locUtil",['twcUtil',function(twcUtil){function convertToLocId(locObj){if(!locObj)return null;if(twcUtil.isString(locObj)){if(((""+locObj).length===5)&&!isNaN(locObj))return locObj+":4:US";if(locObj.length===8&&locObj.slice(0,2)==="US")return locObj+":1:US";if(locObj.split(",").length===2)return locObj;if((splitLength=locObj.split(":").length)>=2)return locObj+(splitLength===2?":US":"");if(locObj.split(":").length===3)return locObj}else if(twcUtil.isNumber(locObj)&&locObj.toString().length===5){return locObj+":4:US"}else if(twcUtil.isObject(locObj)){if('lat'in locObj&&'lng'in locObj)return locObj.lat+","+locObj.lng;if('locId'in locObj&&'locType'in locObj&&'cntryCd'in locObj)return locObj.locId+":"+locObj.locType+":"+locObj.cntryCd};return null}
function areLocationsEqual(location1,location2){if(location1&&location2)return(location1.locId===location2.locId);return false};return{getFullLocId:function(locObj){return convertToLocId(locObj)},areLocationsEqual:function(location1,location2){return areLocationsEqual(location1,location2)}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/loc_util/loc_util.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dom_event_origin_verifier/dom_event_origin_verifier.factory.js. */
twc.shared.apps.factory('TwcDomEventOriginVerifier',['twcUtil','TwcClass','pcoUser',function(twcUtil,TwcClass,pcoUser){var incrementId=0,namespace='twcDomEventOriginVerifier';return TwcClass.extend({construct:function(originator,events){this.id=incrementId++;if(originator){this.setOriginator(originator);if(events)this.bindEvents(events)}},setOriginator:function(originator){this.originator=angular.element(originator)},bindEvents:function(events){events=twcUtil.isArray(events)?events:events.split(/\s+/);var eventStr=twcUtil.reduce(events,function(str,event){return str+(event?event+'.'+namespace+' ':'')},''),self=this;if(pcoUser.getBrowser().ltIE9){this.originator.on(eventStr,function(e){if(e.originalEvent)e.originalEvent.data=namespace+':'+self.id})}else this.originator.on(eventStr,function(e){if(e.originalEvent)e.originalEvent[namespace]=self.id})},cleanUp:function(){if(this.originator)this.originator.off('.'+namespace)},verifyOrigin:function(event){event=event.originalEvent||event;if(pcoUser.getBrowser().ltIE9){return event.data===namespace+':'+this.id}else return event[namespace]===this.id},test:function(event){return this.verifyOrigin(event)}})}]).factory('eventOrigin',['TwcDomEventOriginVerifier',function(TwcDomEventOriginVerifier){return{init:function(params){var scope=params.scope,events=params.event||params.events,origin=params.origin,verifier=new TwcDomEventOriginVerifier(origin,events);scope.$on('$destroy',function(){verifier.cleanUp()});return verifier}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dom_event_origin_verifier/dom_event_origin_verifier.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/mouse_broadcast/mouse_broadcast.factory.js. */
twc.shared.apps.factory('MouseBroadcast',['$rootScope',function($rootScope){'use strict';var location=null,lastLocation=null,api={getLocation:function(){return angular.copy(location)},setLocation:function(scope,attrs,evt){if(location)lastLocation=location;location={x:evt.pageX,y:evt.pageY};var event=attrs.eventName?attrs.eventName+'-'+evt.type+'-broadcast':evt.type+'-broadcast';$rootScope.$broadcast(event,this.getLocation())}};return api}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/mouse_broadcast/mouse_broadcast.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/social_links/social_links.directives.js. */
twc.shared.apps.directive('twcFbShare',['twcConstant',function(twcConstant){'use strict';return{scope:true,replace:false,transclude:false,controller:["$scope","$element","$attrs","customEvent",function($scope,$element,$attrs,customEvent){$element.bind('click',function(){customEvent.getEvent("gigyaLoadedEvent").done(function(){if(!$attrs.fbDescription)$attrs.fbDescription="Visit www.weather.com for continuing coverage.";if($attrs.twcFbShare.indexOf("http://")<0)$attrs.twcFbShare="http://"+window.location.hostname+$attrs.twcFbShare;var act=new gigya.socialize.UserAction();act.setTitle($attrs.fbTitle);act.setSubtitle($attrs.fbCaption||"http://www.weather.com");act.setLinkBack($attrs.twcFbShare);gigya.socialize.postBookmark({provider:'facebook',url:$attrs.twcFbShare,title:$attrs.fbTitle,cid:$attrs.fbCid,shortURLs:'always',thumbnailURL:$attrs.fbPicture||twcConstant.assetsUrl+'240x180_twc_default.png',userAction:act})});return false})}]}}]).directive('twcGplusShare',function(){'use strict';return{scope:true,replace:false,transclude:false,controller:["$scope","$element","$attrs","customEvent",function($scope,$element,$attrs,customEvent){$element.bind('click',function(){customEvent.getEvent("gigyaLoadedEvent").done(function(){if($attrs.twcGplusShare.indexOf("http://")<0)$attrs.twcGplusShare="http://"+window.location.hostname+$attrs.twcGplusShare;gigya.socialize.postBookmark({provider:'googleplus',url:$attrs.twcGplusShare,cid:$attrs.twcGplusCid,shortURLs:'never'})});return false})}]}}).directive('twcTwShare',function(){'use strict';return{scope:true,replace:false,transclude:false,controller:["$scope","$element","$attrs","customEvent",function($scope,$element,$attrs,customEvent){$element.bind('click',function(){customEvent.getEvent("gigyaLoadedEvent").done(function(){if($attrs.twcTwShare.indexOf("http://")<0)$attrs.twcTwShare="http://"+window.location.hostname+$attrs.twcTwShare;gigya.socialize.postBookmark({provider:'twitter',title:$attrs.twTitle+'&via=weatherchannel',cid:$attrs.twcTwCid,url:$attrs.twcTwShare,shortURLs:'always'})});return false})}]}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/social_links/social_links.directives.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/custom_event/custom_event.factory.js. */
twc.shared.apps.factory('customEvent',function(){'use strict';return TWC.Events});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/custom_event/custom_event.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/page_metatags/page_metatags.factory.js. */
twc.shared.apps.factory('PageMetaTags',function(){return{addOGTagToDOM:function(key,value){if(!key||!value)return;var meta=this.checkElementExists(key),doesElemExists=false;if(!meta){meta=document.createElement('meta')}else doesElemExists=true;meta.setAttribute("property",key);meta.setAttribute("content",value);if(!doesElemExists)document.getElementsByTagName('head')[0].appendChild(meta)},addMicroData:function(key,value){if(!key||!value)return;var meta=document.querySelector('[itemprop="'+key+'"]');if(!meta)meta=document.createElement('meta');meta.setAttribute("itemprop",key);meta.setAttribute("content",value);document.getElementsByTagName('head')[0].appendChild(meta)},checkElementExists:function(key){var meta=document.querySelector('[property="'+key+'"]');if(!meta)meta=document.querySelector('[name="'+key+'"]');return meta},addTwitterTagToDOM:function(key,value){if(!key||!value)return;var meta=this.checkElementExists(key),doesElemExists=false;if(!meta){meta=document.createElement('meta')}else doesElemExists=true;meta.setAttribute("name",key);meta.setAttribute("content",value);if(!doesElemExists)document.getElementsByTagName('head')[0].appendChild(meta)}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/page_metatags/page_metatags.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.cache.js. */
twc.shared.apps.factory('dsxLocalCache',['$window','twcUtil','$log','$timeout','twcConfig','RecordUtil',function($window,twcUtil,$log,$timeout,twcConfig,RecordUtil){var isLocalStorage=false;try{isLocalStorage=!!(('localStorage'in $window)&&$window.localStorage)}catch(err){$log.debug("Unable to access local storage. Going to make calls every time.")};var vars={hasWebStorage:isLocalStorage,webStorage:isLocalStorage?$window.localStorage:{},webStorageMax:1,itemQueue:[],itemMap:{},expirationTime:60,timeoutPromise:null,locale:twcConfig.dsxclient.locale,version:3},fns={getStorageKey:function(){return'dsxcache'},deleteItem:function(key){if(key in vars.itemMap){var item=vars.itemMap[key];vars.itemQueue=twcUtil.without(vars.itemQueue,item);delete vars.itemMap[key]}},getStorageSize:function(){var currentStorage=angular.toJson(vars.itemQueue);return((currentStorage.length*2)/1024/1024).toFixed(2)},storeInMemory:function(key,valueObj){valueObj.cacheKey=key;if(key in vars.itemMap)fns.deleteItem(key);while(fns.getStorageSize()>vars.webStorageMax&&vars.itemQueue.length>0){var tobeDeleted=vars.itemQueue[0];fns.deleteItem(tobeDeleted.cacheKey)};vars.itemMap[key]=valueObj;vars.itemQueue.push(valueObj)},writeToStorage:function(){if(vars.timeoutPromise)vars.timeoutPromise=$timeout.cancel(vars.timeoutPromise)&&false;vars.timeoutPromise=$timeout(function(){vars.webStorage.setItem(fns.getStorageKey(),angular.toJson({version:vars.version,locale:vars.locale,records:vars.itemQueue}))},2e3)},init:function(){if(vars.hasWebStorage)try{var items=vars.webStorage.getItem(fns.getStorageKey()),currentTime=(new Date()).getTime(),itemsObj=items?angular.fromJson(items):{};if(itemsObj.version&&itemsObj.version===vars.version&&itemsObj.locale&&itemsObj.locale===vars.locale){var records=twcUtil.filter(itemsObj.records,function(item){return!(fns.isExpired(item))});vars.itemQueue=records;angular.forEach(records,function(item){vars.itemMap[item.cacheKey]=item})};var pageLocId=window.explicit_location,pageLocObj=window.explicit_location_obj,cacheId=RecordUtil.getRecordID({recordType:'wxd',recordName:'loc',fullLocId:pageLocId});if(pageLocId&&pageLocObj&&!(cacheId in vars.itemMap)){var objToPersist={cacheKey:cacheId,timestamp:(((new Date()).getTime())+1e4),doc:pageLocObj,id:cacheId,status:200};vars.itemMap[cacheId]=objToPersist;vars.itemQueue.push(objToPersist)};fns.writeToStorage()}catch(err){$log.debug("Exception while trying to initialize webstorage cache. Resetting it.");vars.webStorage.removeItem(fns.getStorageKey())}},isExpired:function(item){var currentTime=(new Date()).getTime();return(!('timestamp'in item)||item.timestamp<currentTime)},getExpirationTime:function(recordResponse){var currentTime=(new Date()).getTime(),expirationTime=vars.expirationTime;if(recordResponse&&recordResponse.generatedTime&&recordResponse.cacheMaxSeconds&&recordResponse.currentTime){var recordExpiration=recordResponse.cacheMaxSeconds-(recordResponse.currentTime-recordResponse.generatedTime);if(recordExpiration>0&&(recordExpiration<600||(recordResponse.id&&(recordResponse.id.match(/\/loc\//)||recordResponse.id.match(/\/Astro\//)))))expirationTime=recordExpiration};return currentTime+(expirationTime*1e3)}};fns.init();return{isEnabled:function(){return vars.hasWebStorage},add:function(key,value){if(value&&vars.hasWebStorage){fns.storeInMemory(key,angular.extend(value,{timestamp:fns.getExpirationTime(value),lscache:true}));fns.writeToStorage()}},get:function(key){var currentTime=(new Date()).getTime();if((key in vars.itemMap)&&fns.isExpired(vars.itemMap[key])){$timeout(function(){fns.deleteItem(key);fns.writeToStorage()},10);return null};return vars.itemMap[key]}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.cache.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pagecache/pagecache.factory.js. */
twc.shared.apps.factory('MemCache',['TwcClass',function(TwcClass){return TwcClass.extend({construct:function(){this.data={}},put:function(key,value){this.data[key]=value},hasKey:function(key){return(key in this.data)},get:function(key){return this.data[key]}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/pagecache/pagecache.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/promise_pool/promise_pool.factory.js. */
twc.shared.apps.value('PromisePoolStatusCodes',{PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"}).factory('PromisePool',['TwcClass','$q','PromisePoolStatusCodes',function(TwcClass,$q,PromisePoolStatusCodes){return TwcClass.extend({construct:function(){this.data={};this.status={}},getPromise:function(key){this.createDefer(key);return this.data[key].promise},hasDefer:function(key){return(key in this.data)},createDefer:function(key){if(!this.hasDefer(key)){this.data[key]=$q.defer();this.status[key]=PromisePoolStatusCodes.PENDING}},deleteDefer:function(key){delete this.data[key];delete this.status[key]},resolveDefer:function(key,data){if(this.hasDefer(key)){this.data[key].resolve(data);this.status[key]=PromisePoolStatusCodes.RESOLVED}},rejectDefer:function(key,data){if(this.hasDefer(key)){this.data[key].reject(data);this.status[key]=PromisePoolStatusCodes.REJECTED}},getStatus:function(key){return this.status[key]}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/promise_pool/promise_pool.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.config.js. */
twc.shared.apps.config(['twcConfigProvider',function(twcConfigProvider){twcConfigProvider.add({dsxclient:{cache:true,locale:TWC.Configs.dsx.locale,url:TWC.Configs.dsx.host,version:"v2",params:{jsonp:"JSON_CALLBACK",api:TWC.Configs.dsx.apiKey},wxd:{records:{astro:'Astro',airportDelay:'ADRecord',observation:'MORecord',dailyForecast:'DFRecord',hourly:'DHRecord',daypart:'DDRecord',dailyInternational:'DIRecord',airQuality:'ESRecord',flightArrival:'FARecord',flu:'FURecord',bulletin:'BERecord',nowcast:'NCRecord',intraday:'IFRecord',index:'IDRecord',interstate:'Interstate',moon:'Moon',lightning:'LGRecord',pastObsAvg:'PastObsAvg',precipitation:'PERecord',pollen:'Pollen',pollenObserved:'PLRecord',hurricaneTracker:'HTRecord',tide:'TIRecord',pollenUk:'UPRecord',hurricaneProjection:'HPRecord',ski:'SKRecord',stormReport:'SRRecord',locFull:'LFRecord',loc:'loc',marine:'WMRecord',wv:'WVRecord',ww:'WWRecord',zipMapping:'ZFRecord',climo:'Climatology',mappoint:'mappoint',wwir:'wwir',hiradff:'HiRadFF',alertStates:'AlertsStates',alertArea:'AlertsArea',alertLocations:'AlertLocations',farmingAlmanac:'FarmingAlmanacRecord',NationalFlu:'NationalFlu',PastFlu:'PastFlu',fifteenDayForecast:'FifteenDayForecast'},defaultPathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.fullLocId]},recordConfig:{AlertsStates:{type:'array',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,'alerts','states']}},AlertsArea:{pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,'alerts','area',ido.fullLocId]}},AlertLocations:{pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,'alerts','alertLocations',ido.twcIId]}},FarmingAlmanacRecord:{pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,'FarmingAlmanac',ido.date,ido.fullLocId]}},BERecord:{type:'array'},DDRecord:{type:'collection'},DFRecord:{type:'collection'},DHRecord:{type:'collection',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,'DHRecord',ido.locale||thisConfig.locale,ido.fullLocId]}},PERecord:{type:'collection'},IFRecord:{type:'collection'},DIRecord:{type:'collection'},Pollen:{type:'collection'},IDRecord:{type:'collection',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.indexType||1,ido.fullLocId]}},Moon:{type:'array',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.days||1,ido.fullLocId]}},Climatology:{type:'array',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.month+(ido.date?("-"+ido.date):""),ido.count||1,ido.fullLocId]}},PastObsAvg:{type:'array',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.date,ido.numOfDays||1,ido.fullLocId]}},mappoint:{type:'array',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.key]}},HiRadFF:{type:'collection',model:'WxdHiRadFFModelClass',responseFormat:{data:"HiRadFFData",header:"HiRadFFHdr"},pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.fullLocId]}},Astro:{type:'collection',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.date,ido.numOfDays||1,ido.fullLocId]}},NationalFlu:{type:'collection',pathFormat:function(ido,thisConfig){if(ido.date){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.date]}else return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale]}},PastFlu:{type:'collection,',pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName,ido.locale||thisConfig.locale,ido.state]}},FifteenDayForecast:{type:'collection',model:'WxdFifteenDayForecastModelClass',responseFormat:{data:"fcstdaily15alluoms.forecasts",header:"metadata"},pathFormat:function(ido,thisConfig){return['wxd',ido.version||thisConfig.version,ido.recordName?'15DayForecast':'',ido.locale||thisConfig.locale,ido.fullLocId]}}}},q:{recordConfig:{loc:{type:'array',pathFormat:function(ido,thisConfig){var regions=[];if(ido.country&&ido.region&&ido.key){regions.push(ido.country,ido.region,ido.key)}else{if(ido.locType)regions.push(ido.locType);regions.push(ido.key)};return['q',ido.version||thisConfig.version,'loc',ido.locale||thisConfig.locale].concat(regions)}},"loc.near":{type:'collection',pathFormat:function(ido,thisConfig){return['q',ido.version||thisConfig.version,'loc.near',ido.locale||thisConfig.locale,ido.locType,ido.zoom,ido.lat+','+ido.lon]}}}},cms:{defaultPathFormat:function(ido){return["cms","assets"]},recordConfig:{a:{type:'array',transformParamMap:{DMA:"tags.geo.DMA",wxlow:"tags.wx.low",wxhigh:"tags.wx.high",keyword:"tags.keyword",city:"tags.geo.city",state:"tags.geo.state",loc:"tags.loc"},transformParam:function(param,val,cond){return(param+":$"+cond+"("+val+")")},paramFormat:function(paramMap){var result={};if(paramMap.query){var queries=paramMap.query,qparams=[];for(var idx=0,len=queries.length;idx<len;idx++){var query=queries[idx],subqparams=[],_self=this;for(var key in query)if(query.hasOwnProperty(key)){var rawValue=query[key],keyparts=key.split("|"),cond=(keyparts.length>1?keyparts[1]:'in');key=keyparts[0];var valueStr='';if(angular.isArray(rawValue)){var value=rawValue.slice(0);for(var counter=0,vlen=value.length;counter<vlen;counter++)value[counter]=("'"+value[counter]+"'");valueStr=value.join(",")}else valueStr="'"+rawValue+"'";subqparams.push(_self.transformParam((_self.transformParamMap[key]?_self.transformParamMap[key]:key),valueStr,cond))};qparams.push(subqparams.join(";"))};if(qparams.length>0)result.q=qparams};if(typeof paramMap.start!=='undefined'&&typeof paramMap.end!=='undefined'){result.pg=paramMap.start+","+paramMap.end}else result.pg="0,10";return result}},aidQ:{model:"CmsAModelClass",pathFormat:function(ido){return['cms','a',ido.assetId]}},videoAssetWithColl:{model:"VideoAssetModelClass",pathFormat:function(ido){return['cms','asset-collection',ido.assetId]}},ugcAssetWithColl:{model:"UGCAssetModelClass",pathFormat:function(ido){return['cms','asset-collection',ido.assetId]}},ugc:{model:"UGCAssetModelClass",pathFormat:function(ido){return['cms','a',ido.assetId]}},video:{model:"VideoAssetModelClass",pathFormat:function(ido){return['cms','a',ido.assetId]}},slideshow:{model:"CmsAModelClass",pathFormat:function(ido){return['cms','assets','slideshow',ido.assetId,(ido.startIndex||0)+','+(ido.count||50)]}},nextarticle:{model:"CmsNextArticleModelClass",pathFormat:function(ido){return['cms','nextArticle',ido.assetId]}},collections:{pathFormat:function(ido){return['cms','collections',ido.path]}},adDataServer:{model:"CmsAdDataServerPoiClass",type:"array",pathFormat:function(ido){return['cms','AdDataServer','poi',ido.sponsorId,ido.tileId]}},BreakingNow:{pathFormat:function(ido,thisConfig){return['cms',ido.version||thisConfig.version,"settings/breakingnow"]}},AssetList:{model:"CmsAssetListModelClass",type:"array",pathFormat:function(ido,thisConfig){return['cms',ido.version||thisConfig.version,'asset-list',ido.listName,((ido.startIndex||0)+','+(ido.count||20))]}},orderedlist:{pathFormat:function(ido,thisConfig){return['cms',"orderedlist/video",ido.path]}},playlist:{model:'CmsAModelClass',type:'array',pathFormat:function(ido,thisConfig){return['cms',"orderedlist/video",ido.path]}},affiliateVideos:{pathFormat:function(ido,thisConfig){return["cms",ido.version||thisConfig.version,"dma",ido.dma]}}}},cs:{recordConfig:{datetime:{pathFormat:function(ido,thisConfig){return['cs',ido.version||thisConfig.version,'datetime',ido.locale||thisConfig.locale,ido.fullLocId]}}}},maps:{records:{series:'series',radar:'radar',rwi:'rwi',hiradClouds:'hirad_clouds',hiradTemp:'hirad_temp',hiradWindSpeed:'hirad_windSpeed',hiradUV:'hirad_UV'},recordConfig:{series:{pathFormat:function(ido,thisConfig){return['maps',ido.version||thisConfig.version,'i/series']}},radar:{pathFormat:function(ido,thisConfig){return['maps',ido.version||thisConfig.version,'i/series/radar']}},rwi:{pathFormat:function(ido,thisConfig){return['maps',ido.version||thisConfig.version,'i/series/rwi']}},hirad_clouds:{pathFormat:function(ido,thisConfig){return['maps',ido.version||thisConfig.version,'i/series/hirad_clouds']}},hirad_temp:{pathFormat:function(ido,thisConfig){return['maps',ido.version||thisConfig.version,'i/series/hirad_temp']}},hirad_windSpeed:{pathFormat:function(ido,thisConfig){return['maps',ido.version||thisConfig.version,'i/series/hirad_windSpeed']}},hirad_UV:{pathFormat:function(ido,thisConfig){return['maps',ido.version||thisConfig.version,'i/series/hirad_UV']}}}},xweb:{records:{webdailyForecast:'WebDFRecord',webhourly:'WebDHRecord',loc:'loc',webLoc:'WebLoc',commuter:'CommutercastRecord',social:'social',photos:'photos',titanDaily:'TitanDaily'},recordConfig:{WebDFRecord:{type:'collection',pathFormat:function(ido,thisConfig){return['x',ido.version||thisConfig.version,'web/WebDFRecord',ido.locale||thisConfig.locale,ido.fullLocId]}},TitanDaily:{type:'collection',model:"XwebWebDFRecordModelClass",responseFormat:{data:"WebDFData",header:"WebDFHdr"},pathFormat:function(ido,thisConfig){return['x-web',ido.version||thisConfig.version,'titan-daily',ido.locale||thisConfig.locale,ido.fullLocId]}},CommutercastRecord:{pathFormat:function(ido,thisConfig){return['x-web',ido.version||thisConfig.version,'commutercast',ido.locale||thisConfig.locale,ido.hourIndex,ido.fullLocId]}},WebDHRecord:{type:'collection',pathFormat:function(ido,thisConfig){return['x',ido.version||thisConfig.version,'web/WebDHRecord',ido.locale||thisConfig.locale,ido.fullLocId]}},social:{pathFormat:function(ido,thisConfig){return['x',ido.version||thisConfig.version,'social',ido.path]}},photos:{model:'XwebPhotosModelClass',type:'array',pathFormat:function(ido,thisConfig){return['x',ido.version||thisConfig.version,'social',ido.path,[ido.pageStart,ido.pageEnd].join(',')]}},WebLoc:{cache:false,type:'array',pathFormat:function(ido,thisConfig){var path=[];if(ido.proximity){path=['x',ido.version||thisConfig.version,'web/loc.near',ido.locType,ido.zoom,ido.lat+','+ido.lon]}else{path=['x',ido.version||thisConfig.version,'web/loc',ido.locale||thisConfig.locale];if(ido.locTypes)if(angular.isArray(ido.locTypes)){path.push.apply(path,ido.locTypes)}else path.push(ido.locTypes);if(ido.country)if(ido.country.code){path.push(ido.country.code+(ido.country.boost?'^':''))}else path.push(ido.country);if(ido.region)path.push(ido.region);if(ido.term)path.push(ido.term)};return path}},WebLocNear:{type:'array',pathFormat:function(ido,thisConfig){return['x',ido.version||thisConfig.version,'web/loc.near',ido.locale||thisConfig.locale,ido.locType,ido.zoom,ido.lat+','+ido.lon]}},loc:{type:'array',pathFormat:function(ido,thisConfig){var regions=[];if(ido.locType)regions.push(ido.locType);regions.push(ido.key);return['x',ido.version||thisConfig.version,'web','loc',ido.locale||thisConfig.locale].concat(regions)}}}},xmweb:{records:{mwebdailyForecast:'MWebDFRecord'},recordConfig:{MWebDFRecord:{type:'collection',pathFormat:function(ido,thisConfig){return['x',ido.version||thisConfig.version,'mweb/MWebDFRecord',ido.locale||thisConfig.locale,ido.fullLocId]}}}},u:{records:{user:'user'},recordConfig:{user:{model:'UUserIdModelClass',pathFormat:function(ido,thisConfig){return['u',ido.version||thisConfig.version,ido.userId]}}}},xreboot:{records:{bulletin:'BERecord'},recordConfig:{BERecord:{type:'array',pathFormat:function(ido,thisConfig){return['x',ido.version||thisConfig.version,'reboot',ido.recordName,ido.fullLocId]}}}}}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.config.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/throttled_events/throttle.factory.js. */
twc.shared.apps.factory('throttler',['$q','$window','twcUtil',function($q,$window,twcUtil){var resizeEvent=$q.defer();angular.element($window).bind('resize',twcUtil.throttle(function(){resizeEvent.notify()},125));angular.element($window).bind('orientationchange',twcUtil.throttle(function(){resizeEvent.notify()},125));return{onResize:function(callback,context){resizeEvent.promise.then(null,null,callback)}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/throttled_events/throttle.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/httpclient/httpclient.factory.js. */
twc.shared.apps.factory("httpclient",['$http','twcUtil',function($http,twcUtil){var $=angular.element,scriptLoader=(function(){var head=document.head||jQuery("head")[0]||document.documentElement
function _getScript(s,callback,script){script.async=true;if(s.scriptCharset)script.charset=s.scriptCharset;script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(script.parentNode&&s.remove)script.parentNode.removeChild(script);if(!isAbort)callback(200,"success")}};head.insertBefore(script,head.firstChild);return script};return{cache:{},getScript:function(settings){var url,callback,attrs;if(!angular.isObject(settings))settings={url:arguments[0],callback:arguments[1],attrs:arguments[2]};twcUtil.defaults(settings,{url:'',callback:angular.noop,attrs:{},remove:true});url=settings.url;callback=settings.callback;attrs=settings.attrs;if(this.cache[url]){this.cache[url].done(callback)}else{var deferred=this.cache[url]=$.Deferred();deferred.done(callback);var script=$(document.createElement('script'));script.attr(attrs);_getScript(settings,function(){deferred.resolve()},script[0])}}}})();return{jsonp:function(url,config){return $http.jsonp(url,config)},getScript:function(settings){return scriptLoader.getScript.apply(scriptLoader,arguments)}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/httpclient/httpclient.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/drupal_settings/drupal_settings.factory.js. */
twc.shared.apps.factory('DrupalSettings',['PcoPage',function(PcoPage){'use strict';var settings;return{getArticleUUID:function(){return(window.Drupal&&window.Drupal.settings&&window.Drupal.settings.ct_article&&window.Drupal.settings.ct_article&&window.Drupal.settings.ct_article.article_uuid)},getSettings:function(instanceId){return Drupal.settings.twc.instance[instanceId]},getContexts:function(){return Drupal.settings.twc.contexts},getContextArg:function(contextArg){var contexts=this.getContexts();return contexts.hasOwnProperty(contextArg)?contexts[contextArg].id:false},getLocation:function(settingsObj,contextName){var contexts=Drupal.settings.twc.contexts,attrName=contextName||"twclocation",keyName=settingsObj[attrName],pageLocId=PcoPage.getCurrentLocId();if(contexts){return(contexts[keyName]&&contexts[keyName].is_page_loc&&pageLocId)?{id:pageLocId}:contexts[keyName]}else{settingsObj.id=keyName;return settingsObj}},getLocId:function(settingsObj,contextName){return this.getLocation(settingsObj,contextName).id},getAsset:function(settingsObj){var contexts=Drupal.settings.twc.contexts;if(contexts){return contexts[settingsObj.twcasset]}else{settingsObj.id=settingsObj.twcasset;return settingsObj}},isArticle:function(){return!!Drupal.settings['ct_article']},getModuleByName:function(name){return Drupal.settings.twc.modules&&Drupal.settings.twc.modules[name]},getAssetId:function(settingsObj){return this.getAsset(settingsObj).id},getInstanceIdBySettings:function(settings){return Object.getKey(Drupal.settings.twc.instance,settings)},getInstanceId:function(index){return Object.keys(Drupal.settings.twc.instance)[index]},getPathInfo:function(){var pathItems=window.location.pathname.split("/");return pathItems[pathItems.length-1]}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/drupal_settings/drupal_settings.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.utils.js. */
twc.shared.apps.factory('AggregateUtil',['RecordUtil','Set',function(RecordUtil,Set){function getURLAggregations(configs){var urlaggregations=[];angular.forEach(configs,function(config){urlaggregations.push(RecordUtil.getRecordURL(config))});return urlaggregations}
function getCommonPrefix(urlaggregations){var urlParts=[],commonParts=[],minlength=99;angular.forEach(urlaggregations,function(urlaggregation){if(urlaggregation.length<minlength)minlength=urlaggregation.length;angular.forEach(urlaggregation,function(urlpart,idx){urlParts[idx]=urlParts[idx]||new Set();urlParts[idx].add(urlpart)})});for(var idx=0,max_traversal=minlength-1;idx<max_traversal;idx++){var hashSet=urlParts[idx],entries=hashSet.getAll();if(hashSet.hasKey("cms")&&entries.length>1)throw"cms call cannot be aggregated.";if(entries.length!==1)break;commonParts.push(entries[0])};return commonParts}
function getCommonLocID(urlaggregations){var locIDs=new Set();for(var idx=0,len=urlaggregations.length;idx<len;idx++){var urlaggregation=urlaggregations[idx],agglen=urlaggregation.length,lastParam=urlaggregation[agglen-1];if(lastParam&&lastParam.match&&lastParam.match(/^([^:]+):([^:]+):([A-Z]{2})$/)){locIDs.add(lastParam)}else{locIDs=false;break}};var locs=locIDs&&locIDs.getAll();return(locs&&locs.length===1&&urlaggregations.length>1)?locs[0]:false}
function formAggregatedURL(urlaggregations){var commonItemsInRecords=getCommonPrefix(urlaggregations),commonLocID=getCommonLocID(urlaggregations),newAggregations=[];for(var idx=0,length=urlaggregations.length;idx<length;idx++){var cAggregation=urlaggregations[idx];if(commonItemsInRecords.length>0)cAggregation=cAggregation.slice(commonItemsInRecords.length);if(commonLocID)cAggregation=cAggregation.slice(0,cAggregation.length-1);newAggregations.push(cAggregation.join("/"))};return(commonItemsInRecords.length>0?(commonItemsInRecords.join("/")+"/"):"")+("("+newAggregations.join(";")+")")+(commonLocID?("/"+commonLocID):"")};return{getAggregatedURL:function(configs){return formAggregatedURL(getURLAggregations(configs))}}}]).factory('ParamUtil',['twcConfig','twcUtil',function(twcConfig,twcUtil){var dsxclient_config=twcConfig.dsxclient
function parseRecordParam(paramMap,config){var recordConfig=dsxclient_config[config.recordType].recordConfig[config.recordName],returnMap={};if(recordConfig&&'paramFormat'in recordConfig)returnMap=recordConfig.paramFormat(paramMap,twcUtil);return returnMap};return{parseParams:function(configs){var result={};angular.forEach(configs,function(config){if(config.custom_params)result=angular.extend(result,parseRecordParam(config.custom_params,config))});return result}}}]).factory('RecordUtil',['twcConfig','twcUtil',function(twcConfig,twcUtil){var dsxclient_config=twcConfig.dsxclient;return{getRecordURL:function(config){if('url'in config)return config.url.split("/");var recordConfig=dsxclient_config[config.recordType].recordConfig[config.recordName],pathFormat=dsxclient_config[config.recordType].defaultPathFormat;if(recordConfig&&recordConfig.pathFormat)pathFormat=recordConfig.pathFormat;return pathFormat(config,dsxclient_config)},getRecordID:function(config){return("/"+twcUtil.removeDupChar(this.getRecordURL(config).join("/"),'/'))},getUniqueKey:function(config){return("/"+twcUtil.removeDupChar(this.getRecordURL(config).join("/"),'/')+(config.custom_params?("-"+JSON.stringify(config.custom_params)):""))}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.utils.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.promise.js. */
twc.shared.apps.factory('DsxClientPromise',['TwcClass','$injector','$q','twcUtil',function(TwcClass,$injector,$q,twcUtil){return TwcClass.extend({constructor:function(promise){this._promise=promise;this._results={}},$setResults:function(results){twcUtil.extend(this._results,results)},then:function(done,error){var methods=[],self=this;methods.push(done&&function(){return $injector.invoke(done,null,self._results)});methods.push(error&&function(){return error.apply(null,arguments)});return this._promise.then.apply(this._promise,methods)},'catch':function(callback){return this.then(null,callback)},'finally':function(callback){return this._promise['finally'](callback)},addResultsTo:function(obj){var self=this;this._promise.then(function(){twcUtil.extend(obj,self._results)});return this}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.promise.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.response.js. */
twc.shared.apps.factory('DsxClientResponse',['TwcModel','$log','twcConfig','twcUtil','$injector','RecordUtil','$parse',function(TwcModel,$log,twcConfig,twcUtil,$injector,RecordUtil,$parse){var dsxclient_config=twcConfig.dsxclient
function getModelObject(recordBody,config){if(!recordBody||!recordBody.id||'error'in recordBody||!(recordBody.doc))return null;var className,recordConfig,recordName="DsxModel";if('recordType'in config&&'recordName'in config){var recordType=config.recordType;recordName=config.recordName;recordConfig=dsxclient_config[recordType].recordConfig[recordName];className=(twcUtil.capitalize(recordType)+twcUtil.capitalize(recordName)+"ModelClass");if(recordConfig&&'model'in recordConfig)className=recordConfig.model};if(config&&'model'in config)className=config.model;var ModelClass=(!!className)&&$injector.has(className)&&$injector.get(className);if(!ModelClass){$log.debug((className?className:"_NULL_")+" not found. Returning RAW response.");className='ResponseModel';ModelClass=$injector.get('ResponseModel').extend({});ModelClass.prototype.recordType=recordName};var models=[],header,data,index,length,defaultModelCreation=true;if(recordConfig&&recordConfig.type&&recordConfig.type==="collection"){if(recordName.indexOf("Record")!==-1||'responseFormat'in recordConfig){defaultModelCreation=false;var recordDataName,recordDataHdr;if(recordConfig.responseFormat){recordDataName=recordConfig.responseFormat.data;recordDataHdr=recordConfig.responseFormat.header}else{recordDataName=/(.*)Record/.exec(recordName)[1]+'Data';recordDataHdr=/(.*)Record/.exec(recordName)[1]+'Hdr'};header=recordBody.doc[recordDataHdr];data=recordBody.doc[recordDataName];if(!data)try{data=$parse(recordDataName)(recordBody.doc)}catch(err){$log.debug("Error trying to parse the record data: ",recordDataName)};for(index=0,length=data.length;index<length;index++){var obj={};obj[recordDataHdr]={};obj[recordDataName]=data[index];models.push(new ModelClass(obj,className))};var CollectionClass=$injector.get('RecordCollection').extend({});CollectionClass.prototype.recordType=recordName;return new CollectionClass({items:models,header:header})}}else if(recordConfig&&recordConfig.type&&recordConfig.type==="array"){defaultModelCreation=false;data=recordBody.doc;if(angular.isArray(data))for(index=0,length=data.length;index<length;index++)models.push(new ModelClass(data[index],className));return models};if(defaultModelCreation)return new ModelClass(recordBody.doc,className)};return TwcModel.extend({construct:function(response,configs){this.attrs=response;this.attrs.responseMap={};this.attrs.rawResponseMap={};this.process(response,configs)},process:function(response,configs){var responseMap=this.get('responseMap'),rawResponseMap=this.get('rawResponseMap');if(response&&response.data&&response.data.body&&angular.isArray(response.data.body)){var responseBody=response.data.body;for(var rcount=0,responselen=responseBody.length;rcount<responselen;rcount++){var recordBody=responseBody[rcount];if(recordBody&&'id'in recordBody)rawResponseMap[recordBody.id]=recordBody}};if(configs&&configs.length>0){var _self=this;angular.forEach(configs,function(config){var configId=RecordUtil.getRecordID(config),cacheId=RecordUtil.getUniqueKey(config);responseMap[cacheId]=rawResponseMap[configId]})}},getModel:function(config){if(angular.isObject(config)){var rawResponse=this._get('responseMap')[RecordUtil.getUniqueKey(config)];return rawResponse?getModelObject(rawResponse,config):null};return null},getLocation:function(locId){return this.getModel({recordType:"wxd",recordName:"loc",fullLocId:locId})}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.response.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsx_date/dsx_date.config.js. */
twc.shared.apps.run(['$locale',function($locale){$locale.DATETIME_FORMATS.dsxShortDate='MMM, d';$locale.DATETIME_FORMATS.dsxLongDate='EEEE, MMM d';$locale.DATETIME_FORMATS.dsxMedium='MMM d, yyyy, h:mma z'}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsx_date/dsx_date.config.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsx_date/dsx_date.factory.js. */
twc.shared.apps.factory("datefactory",['$locale','twcUtil','$log',function($locale,twcUtil,$log){var date=function(dateStr,timeStr,tzStr){var self=this,formatter=(function(){var slice=[].slice,uppercase=function(string){return twcUtil.isString(string)?string.toUpperCase():string}
function concat(array1,array2,index){return array1.concat(slice.call(array2,index))}
function padNumber(num,digits,trim){var neg='';if(num<0){neg='-';num=-num};num=''+num;while(num.length<digits)num='0'+num;if(trim)num=num.substr(num.length-digits);return neg+num}
function dateGetter(name,size,offset,trim){offset=offset||0;return function(date){var value=date['get'+name]();if(offset>0||value>-offset)value+=offset;if(value===0&&offset===-12)value=12;return padNumber(value,size,trim)}}
function dateStrGetter(name,shortForm){return function(date,formats){var value=date['get'+name](),get=uppercase(shortForm?('SHORT'+name):name);return formats[get][value]}}
function timeZoneGetter(date){var zone=-1*date.getTimezoneOffset(),paddedZone=(zone>=0)?"+":"";paddedZone+=padNumber(Math[zone>0?'floor':'ceil'](zone/60),2)+padNumber(Math.abs(zone%60),2);return paddedZone}
function timeZoneStrGetter(){return self.tz}
function ampmGetter(date,formats){return(date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]).toLowerCase()}
function AMPMGetter(date,formats){return ampmGetter(date,formats).toUpperCase()};var DATE_FORMATS={yyyy:dateGetter('FullYear',4),yy:dateGetter('FullYear',2,0,true),y:dateGetter('FullYear',1),MMMM:dateStrGetter('Month'),MMM:dateStrGetter('Month',true),MM:dateGetter('Month',2,1),M:dateGetter('Month',1,1),dd:dateGetter('Date',2),d:dateGetter('Date',1),HH:dateGetter('Hours',2),H:dateGetter('Hours',1),hh:dateGetter('Hours',2,-12),h:dateGetter('Hours',1,-12),mm:dateGetter('Minutes',2),m:dateGetter('Minutes',1),ss:dateGetter('Seconds',2),s:dateGetter('Seconds',1),sss:dateGetter('Milliseconds',3),EEEE:dateStrGetter('Day'),EEE:dateStrGetter('Day',true),a:ampmGetter,A:AMPMGetter,Z:timeZoneGetter,z:timeZoneStrGetter},DATE_FORMATS_SPLIT=/((?:[^yMdHhmsaAZzE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|A|Z|z))(.*)/,NUMBER_STRING=/^\d+$/;return(function(){var R_ISO8601_STR=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/
function jsonStringToDate(string){var match=string.match(R_ISO8601_STR);if(match){var date=new Date(0),tzHour=0,tzMin=0,dateSetter=match[8]?date.setUTCFullYear:date.setFullYear,timeSetter=match[8]?date.setUTCHours:date.setHours;if(match[9]){tzHour=int(match[9]+match[10]);tzMin=int(match[9]+match[11])};dateSetter.call(date,int(match[1]),int(match[2])-1,int(match[3]));var h=int(match[4]||0)-tzHour,m=int(match[5]||0)-tzMin,s=int(match[6]||0),ms=Math.round(parseFloat('0.'+(match[7]||0))*1e3);timeSetter.call(date,h,m,s,ms);return date};return string};return function(date,format){var text='',parts=[],fn,match;format=format||'mediumDate';format=$locale.DATETIME_FORMATS[format]||format;if(twcUtil.isString(date))if(NUMBER_STRING.test(date)){date=int(date)}else date=jsonStringToDate(date);if(twcUtil.isNumber(date))date=new Date(date);if(!twcUtil.isDate(date))return date;while(format){match=DATE_FORMATS_SPLIT.exec(format);if(match){parts=concat(parts,match,1);format=parts.pop()}else{parts.push(format);format=null}};twcUtil.each(parts,function(value){fn=DATE_FORMATS[value];text+=fn?fn(date,$locale.DATETIME_FORMATS):value.replace(/(^'|'$)/g,'').replace(/''/g,"'")});return text}})()})();this.format=function(format){return formatter(this.nativeDate||this.toDateObject(),format)};this.toDateObject=function(){var nativeDate=new Date();if(this.day)nativeDate.setDate(this.day);if(this.month)nativeDate.setMonth(this.month-1);if(this.year)nativeDate.setYear(this.year);if(typeof this.hour!=="undefined")nativeDate.setHours(this.hour);if(typeof this.minute!=="undefined")nativeDate.setMinutes(this.minute);if(typeof this.second!=="undefined")nativeDate.setSeconds(this.second);return nativeDate};this.toString=function(){return'DSXDate Object: '+this.date+' - '+this.time+' - '+this.tz};this.nativeDate=angular.isDate(dateStr)&&dateStr;this.tz=String(tzStr||'');if(!this.nativeDate){this.date=String(dateStr||'');this.time=String(timeStr||'');if(this.date&&this.date.length===8){this.year=parseInt(this.date.substring(0,4),10);this.month=parseInt(this.date.substring(4,6),10);this.day=parseInt(this.date.substring(6),10)};if(this.time){var hourVal=parseInt(this.time.substring(0,2),10),minuteVal=parseInt(this.time.substring(2,4),10),secondVal=parseInt(this.time.substring(4),10);this.hour=(!isNaN(hourVal)?hourVal:undefined);this.minute=(!isNaN(minuteVal)?minuteVal:undefined);this.second=(!isNaN(secondVal)?secondVal:undefined)}}}
function getDateObject(dateStr,timeStr,tzStr){try{return new date(dateStr,timeStr,tzStr)}catch(err){$log.error(err)};return null};var ret={'new':function(){if(arguments[0]&&angular.isDate(arguments[0]))return getDateObject(arguments[0],null,arguments[1]);var dateStr,timeStr,tzStr;if(arguments.length<=2){if(!isNaN(arguments[0])){dateStr=arguments[0].toString().slice(0,8);timeStr=arguments[0].toString().slice(8);tzStr=arguments[1]}else{var match_parts=arguments[0].match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);if(match_parts&&match_parts.length>=7){dateStr=match_parts[1]+match_parts[2]+match_parts[3];timeStr=match_parts[4]+match_parts[5]+match_parts[6];tzStr=arguments[1]}}}else if(arguments.length===3){dateStr=arguments[0];timeStr=arguments[1];tzStr=arguments[2]};return getDateObject(dateStr,timeStr,tzStr)}};return ret}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsx_date/dsx_date.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.factory.js. */
twc.shared.apps.factory('timeoutHttpIntercept',function(){return{request:function(config){config.timeout=3e4;return config}}}).config(['$httpProvider',function($httpProvider){$httpProvider.interceptors.push('timeoutHttpIntercept')}]).factory('AsyncCallCounter',[function(){return{increment:function(){window.twc.async_calls=(window.twc.async_calls?++window.twc.async_calls:1)},decrement:function(){if(window.twc.async_calls>0)--window.twc.async_calls}}}]).factory("dsxclient",['httpclient','twcConfig','$injector','twcUtil','Set','$log','PromisePool','PromisePoolStatusCodes','$q','RecordUtil','AggregateUtil','ParamUtil','PcoPerf','DsxClientPromise','DsxClientResponse','dsxLocalCache','AsyncCallCounter',function(httpclient,twcConfig,$injector,twcUtil,Set,$log,PromisePool,PromisePoolStatusCodes,$q,RecordUtil,AggregateUtil,ParamUtil,PcoPerf,DsxClientPromise,DsxClientResponse,dsxLocalCache,callCounter){var dsxclient_config=twcConfig.dsxclient,dsxPromisePool=new PromisePool(),MODEL_ERROR_RESPONSE={error:"Invalid response body. Cannot create model"}
function isCacheable(configs){for(var idx=0,len=configs.length;idx<len;idx++){var config=configs[idx];if(('recordType'in config&&'cache'in dsxclient_config[config.recordType]&&dsxclient_config[config.recordType].cache===false)||('recordType'in config&&dsxclient_config[config.recordType]&&dsxclient_config[config.recordType]['recordConfig']&&dsxclient_config[config.recordType]['recordConfig'][config.recordName]&&dsxclient_config[config.recordType]['recordConfig'][config.recordName].cache===false)||('cache'in config&&config.cache===false))return false};return true}
function sortConfigs(newConfigs){return newConfigs.sort(function(config1,config2){if('recordName'in config1&&'recordName'in config2){if(config1.recordName===config2.recordName)return 0;return((config1.recordName<config2.recordName)?-1:1)};return 0})}
function preparePromise(promises,requestConfigs){callCounter.increment();var mainPromise=$q.all(promises),defer=$q.defer(),isLegacy=twcUtil.some(requestConfigs,function(config){return!('$id'in config)}),returnPromise=isLegacy?defer.promise:new DsxClientPromise(mainPromise);mainPromise.then(function(body){var response=body;if(!body||!angular.isArray(body)||!body.length||!angular.isObject(body[0])||!('headers'in body[0])){response={lscache:false,status:200,data:{body:body}}}else if(angular.isArray(body)&&body.length)response=body[0];var dsxResponse=new DsxClientResponse(response,requestConfigs);if(isLegacy){defer.resolve(dsxResponse)}else{var results={};twcUtil.each(requestConfigs,function(ido){if('$id'in ido)results[ido.$id]=dsxResponse.getModel(ido)});results.response=dsxResponse;returnPromise.$setResults(results)}});if(isLegacy)mainPromise['catch'](function(err){defer.reject(err)});returnPromise["finally"](function(){callCounter.decrement()});return returnPromise};return{getURLPath:function(configs){return dsxclient_config.url+AggregateUtil.getAggregatedURL(configs)},getURLParams:function(configs,additionalParams){var custom_params=ParamUtil.parseParams(configs),params=additionalParams;if(!params)params={};angular.extend(params,dsxclient_config.params,custom_params);return params},execute:function(configs,params){var newConfigs=[],promises=[],canCache=dsxclient_config.cache&&isCacheable(configs),cids=[];if(canCache){for(var idx=0,len=configs.length;idx<len;idx++){var config=configs[idx],cid=RecordUtil.getUniqueKey(config),isCached=false,localCachedItem=dsxLocalCache.get(cid);if(localCachedItem&&!dsxPromisePool.hasDefer(cid)){dsxPromisePool.createDefer(cid);dsxPromisePool.resolveDefer(cid,localCachedItem)};if(!localCachedItem&&dsxLocalCache.isEnabled()&&dsxPromisePool.getStatus(cid)===PromisePoolStatusCodes.RESOLVED)dsxPromisePool.deleteDefer(cid);if(dsxPromisePool.hasDefer(cid)){isCached=true;PcoPerf.logDsxCall(cid,true)};if(!isCached)newConfigs.push(config);promises.push(dsxPromisePool.getPromise(cid))};newConfigs=sortConfigs(newConfigs)}else newConfigs=configs;if(newConfigs.length>0){var configChunks=twcUtil.chunk(newConfigs,10),_self=this;angular.forEach(configChunks,function(configChunk){var url=_self.getURLPath(configChunk),_initial=new Date();PcoPerf.logDsxCall("/"+url,false);var newparams=_self.getURLParams(configChunk,params),ajaxPromise=httpclient.jsonp(url,{params:newparams});ajaxPromise.then(function(response){var rawResponseMap={},_final=new Date();PcoPerf.logDsxCall("/"+url,false,(_final.getTime()-_initial.getTime())/1e3);if(response&&response.data&&response.data.body&&angular.isArray(response.data.body)){var responseBody=response.data.body;for(var rcount=0,responselen=responseBody.length;rcount<responselen;rcount++){var recordBody=responseBody[rcount];if('id'in recordBody)rawResponseMap[recordBody.id]=recordBody}};for(var ccount=0,configlen=configChunk.length;ccount<configlen;ccount++){var config=configChunk[ccount],configId=RecordUtil.getRecordID(config),cacheId=RecordUtil.getUniqueKey(config),configResponse=rawResponseMap[configId];if(canCache){dsxLocalCache.add(cacheId,configResponse);dsxPromisePool.resolveDefer(cacheId,configResponse)}}});ajaxPromise['catch'](function(error){if(canCache)for(var count=0;count<configChunk.length;count++){var config=configChunk[count],cid=RecordUtil.getUniqueKey(config);dsxPromisePool.rejectDefer(cid,error)}});if(!canCache)promises.push(ajaxPromise)})};return promises.length?preparePromise(promises,configs):null}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/dsxclient.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/base.model.js. */
twc.shared.apps.factory('ResponseModel',['TwcClass',function(TwcClass){return TwcClass.extend({setResponse:function(response){this.data=response},_get:function(key){return this.data?this.data[key]:''},set:function(map){angular.extend(this.data,map)},construct:function(response,className){this.className=className;this.setResponse(response)}})}]).factory('RecordModel',['ResponseModel',function(ResponseModel){return ResponseModel.extend({setResponse:function(response){var recordDataName=/(.*)Record/.exec(this.recordType)[1]+'Data',recordDataHdr=/(.*)Record/.exec(this.recordType)[1]+'Hdr';this.header=response[recordDataHdr];this.data=response[recordDataName]},getHeader:function(){return this.header},getRecordUpdatedTime:function(alternateKey){var key='_procTmLocal';if(alternateKey)key=alternateKey;return((this.header&&this.header[key])?this.header[key]:'')}})}]).factory('RecordCollection',['ResponseModel',function(ResponseModel){return ResponseModel.extend({setResponse:function(response){this.header=response.header;this.items=response.items},getHeader:function(){return this.header},getItems:function(){return this.items},getRecordUpdatedTime:function(alternateKey){var key='_procTmLocal';if(alternateKey)key=alternateKey;return((this.header&&this.header[key])?this.header[key]:'')}})}]).factory('dsxModelUtils',['pcoUser','$parse',function(pcoUser,$parse){return{getPrecipValue:function(model,key){return pcoUser.getPrecipUnit()==='mm'?(angular.isDefined(model._get('_'+key+'Mm'))?model._get('_'+key+'Mm'):model._get(key)*25.4):model._get(key)},getAccumulationValue:function(model,key){return pcoUser.getAccumulationUnit()==='cm'?(angular.isDefined(model._get('_'+key+'Cm'))?model._get('_'+key+'Cm'):model._get(key)*2.54):model._get(key)},getWindDirectionText:function(model,key,forceEnglish){return!forceEnglish?model._get(key):model._get('_'+key+'_en')},getPrecipFromValue:function(model,key){var metricProperty='data.metric.'+key,imperialProperty='data.imperial.'+key;if(pcoUser.getPrecipUnit()==='mm'){var modelValue=$parse(metricProperty)(model);return angular.isDefined(modelValue)?modelValue:$parse(imperialProperty)(model)*25.4}else return $parse(imperialProperty)(model)}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/base.model.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.berecord.js. */
twc.shared.apps.factory('WxdBERecordModelClass',['RecordModel','twcUtil',function(RecordModel,twcUtil){return RecordModel.extend({recordType:'BERecord',construct:function(){this._langToNarrTextCache={};RecordModel.prototype.construct.apply(this,arguments)},setResponse:function(response){this.header=response.BEHdr;this.data=response.BEData;this.event=response.BEHdr&&response.BEHdr.bEvent||{};this.location=response.BEHdr&&response.BEHdr.bLocations||{}},getLocationCounty:function(){return this.location.bLocCd__bLoc},getLocationStateCd:function(){return this.location.bStCd},getLocationState:function(){return this.location.bStCd_bSt},getLocationType:function(){return this.location.bLocCd__bLocTyp},getLocationCd:function(){return this.location.bLocCd},getLocationStateName:function(){return this.location.bStCd__bSt},getLocationUTCOffset:function(){return this.location.bUTCDiff},getLocationTimeZone:function(){return this.location.bTzAbbrv},getEventSeverity:function(){return this.event.eSvrty},getEventSignificance:function(){return this.event.eSgnfcnc},getEventDescription:function(){return this.event.eDesc},getEventDescriptionSuffix:function(){return this.header._multiPostfix},getEventTrackingNumber:function(){return this.event.eETN},getEventActionPriority:function(){return this.event.eActionCd__eActionPriority},getEventActionCode:function(){return this.event.eActionCd},getEventPhenomena:function(){return this.event.ePhenom},getEventStartTimeInUTC:function(){return this.event.eStTmUTC},getEventEndTimeInUTC:function(){return this.event.eEndTmUTC},getEventStartLocalTime:function(){return this.event._eStTmLocal},getEventEndLocalTime:function(){return this.event._eEndTmLocal},getEventOfficeId:function(){return this.event.eOfficeId},getTwcIId:function(){return this.event.eTWCIId},getEventOfficeName:function(){return this.event.eOfficeId__eOfficeNm},getFloodCode:function(){return this.event.eFld&&this.event.eFld.eFldRcrdCd},getFloodRecordDescription:function(){return this.event.eFld&&this.event.eFld.eFldRcrdCd__eFldRcrd},getFloodSeverityCode:function(){return this.event.eFld&&this.event.eFld.eFldSvrtyCd},getFloodSeverityDescription:function(){return this.event.eFld&&this.event.eFld.eFldSvrtyCd__eFldSvrty},getFloodCauseCode:function(){return this.event.eFld&&this.event.eFld.eFldCauseCd},getFloodCauseDescription:function(){return this.event.eFld&&this.event.eFld.eFldCauseCd__eFldCause},getFloodRiverName:function(){return this.event.eFld&&this.event.eFld.eNWSLICd__eNWSLI},getFloodEventDescriptionSuffix:function(){return this.event.eFld&&this.event.eFld._eFldSeq},getHeadlineText:function(){var headline=this._get('bHdln');return headline&&headline[0]&&headline[0].bHdlnTxt},getNarrativeLangList:function(){return this._get('bNarrTxt__bNarrTxtLang')},getIssueTimeInUTC:function(){return this._get('bIssueTmUTC')},getIssueTimeLocalISO:function(){return this._get('bIssueTmISOLocal')},getProcessTime:function(){return this.header._procTmLocal},getNarrativeTextByLanguage:function(lang){lang=lang||'en-GB';var narrTxt=this._langToNarrTextCache[lang];if(this._langToNarrTextCache[lang]===undefined){narrTxt=twcUtil.find(this._get('bNarrTxt')||[],function(narrTxt){return narrTxt});narrTxt=narrTxt||null;this._langToNarrTextCache[lang]=narrTxt};return narrTxt&&narrTxt.bLn}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.berecord.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.pollen.js. */
twc.shared.apps.factory('WxdPollenModelClass',['RecordModel','twcUtil','WxdPollenRecordModelClass',function(RecordModel,twcUtil,WxdPollenRecordModelClass){return RecordModel.extend({recordType:'Pollen',construct:function(){this.pollenAlerts={tree:[],grass:[],weed:[]};RecordModel.prototype.construct.apply(this,arguments)},setResponse:function(response){this._mapPollenRecords(response,'tree',this.pollenAlerts);this._mapPollenRecords(response,'grass',this.pollenAlerts);this._mapPollenRecords(response,'weed',this.pollenAlerts)},_mapPollenRecords:function(response,type,pollenAlerts){if(response[type])twcUtil.each(response[type],function(pollenRecord){pollenRecord.type=type;pollenAlerts[type].push(new WxdPollenRecordModelClass(pollenRecord))})},getPollenRecords:function(type){return this.pollenAlerts[type]}})}]).factory('WxdPollenRecordModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({setResponse:function(response){this.data=response},getType:function(){return this._get('type')},getSeverity:function(){return this._get('idxPrt1')},getSeverityDescription:function(){return this._get('idxPhr1')},getLocalTime:function(){return this._get('idxLocTm')},getGMTTime:function(){return this._get('idxGMTTm')},getSpecies:function(){return this._get('idxAux2')}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.pollen.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.alertsarea.js. */
twc.shared.apps.factory('WxdAlertsAreaModelClass',['RecordModel','WxdBERecordModelClass',function(RecordModel,WxdBERecordModelClass){return RecordModel.extend({construct:function(){RecordModel.prototype.construct.apply(this,arguments)},setResponse:function(response){this.location=response.AreaAlertsHdr;this.otherAlerts=[];this.alerts=[];this._mapRecords(response.TargetAlerts,this.alerts);this._mapRecords(response.OtherAlerts,this.otherAlerts)},_mapRecords:function(targetAlerts,alertsRecord){for(var i=0;i<targetAlerts.length;i++)alertsRecord.push(new WxdBERecordModelClass(targetAlerts[i]))}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.alertsarea.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.alertlocations.js. */
twc.shared.apps.factory('WxdAlertLocationsModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({setResponse:function(response){this.locations=response.AlertLocations},getStateCode:function(){return this._get('bSt')},getAffectedLocations:function(){return this.locations._get('bLoc')}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.alertlocations.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/wxicon/wxicon.directive.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module("shared",[]);twc.shared.apps.directive('wxicon',['twcUtil','wxiconFactory',function(twcUtil,wxiconFactory){var wxIconDefinition={priority:0,replace:false,template:'<div class="svg-icon"><img/></div>',scope:{skyCode:'='},restrict:'EA',link:function($scope,$element){$element.addClass("wx-weather-icon");$scope.$watch('skyCode',function(){var img=angular.element('<img/>');img.attr('src',wxiconFactory.getIconUrl($scope.skyCode));img.attr('aria-hidden','true');img.attr('alt','Weather Condition Icon');$element.find('img').replaceWith(img)})}};return wxIconDefinition}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/wxicon/wxicon.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/wxicon/wxicon.factory.js. */
twc.shared.apps.factory('wxiconFactory',['twcUtil',function(twcUtil){var config={basePath:'/sites/all/modules/custom/angularmods/app/shared/wxicon/',pngPath:'png/',svgPath:'svg/',svgzPath:'svgz/',allowSVG:true,useSVGz:true};config.useSVG=config.allowSVG&&Modernizr.svg;var iconCodeMap={tornado:['0','00'],'tropical-storm':['1','01','2','02'],thunderstorm:['3','03','4','04'],'rain-snow':['5','05','7','07'],'rain-hail':['6','06','10','35'],'freezing-drizzle':['8','08'],'scattered-showers':['9','09','11','39'],rain:['12'],flurries:['13'],snow:['14','16'],'blowing-snow':['15','25'],hail:['17','18'],fog:['19','20','21','22'],wind:['23','24'],cloudy:['26'],'mostly-cloudy-night':['27'],'mostly-cloudy':['28'],'partly-cloudy-night':['29'],'partly-cloudy':['30'],'clear-night':['31'],sunny:['32','36'],'mostly-clear-night':['33'],'mostly-sunny':['34'],'isolated-thunderstorms':['37'],'scattered-thunderstorms':['38'],'heavy-rain':['40'],'scattered-snow':['41'],'heavy-snow':['42','43'],na:['-','44','na'],'scattered-showers-night':['45'],'scattered-snow-night':['46'],'scattered-thunderstorms-night':['47']}
function getImageType(forcePNG){return config.useSVG&&!forcePNG?(config.useSVGz?'.svgz':'.svg'):'.png'}
function getImagePath(forcePNG){var iconPath=config.useSVG&&!forcePNG?(config.useSVGz?config.svgzPath:config.svgPath):config.pngPath;return config.basePath+iconPath};return{getIconName:function(skyCode){var iconName;if(twcUtil.isNumeric(skyCode)&&skyCode>=0&&skyCode<=47){var keys=twcUtil.keys(iconCodeMap);twcUtil.each(keys,function(key){if(twcUtil.indexOf(iconCodeMap[key],skyCode.toString())!==-1)iconName=key})}else iconName='na';return iconName},getIconUrl:function(skyCode,forcePNG){return getImagePath(forcePNG)+this.getIconName(skyCode)+getImageType(forcePNG)}}}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/wxicon/wxicon.factory.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/modules/video_playlist/vendor/idangerous.swiper.modified.js. */
var Swiper=function(selector,params){'use strict';if(document.body.__defineGetter__)if(HTMLElement){var element=HTMLElement.prototype;if(element.__defineGetter__)element.__defineGetter__('outerHTML',function(){return new XMLSerializer().serializeToString(this)})};if(!window.getComputedStyle)window.getComputedStyle=function(el,pseudo){this.el=el;this.getPropertyValue=function(prop){var re=/(\-([a-z]){1})/g;if(prop==='float')prop='styleFloat';if(re.test(prop))prop=prop.replace(re,function(){return arguments[2].toUpperCase()});return el.currentStyle[prop]?el.currentStyle[prop]:null};return this};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(obj,start){for(var i=(start||0),j=this.length;i<j;i++)if(this[i]===obj)return i;return-1};if(!document.querySelectorAll)if(!window.jQuery)return
function $$(selector,context){if(document.querySelectorAll){return(context||document).querySelectorAll(selector)}else return jQuery(selector,context)};if(typeof selector==='undefined')return;if(!(selector.nodeType))if($$(selector).length===0)return;var _this=this;_this.touches={start:0,startX:0,startY:0,current:0,currentX:0,currentY:0,diff:0,abs:0};_this.positions={start:0,abs:0,diff:0,current:0};_this.times={start:0,end:0};_this.id=(new Date()).getTime();_this.container=(selector.nodeType)?selector:$$(selector)[0];_this.isTouched=false;_this.isMoved=false;_this.activeIndex=0;_this.centerIndex=0;_this.activeLoaderIndex=0;_this.activeLoopIndex=0;_this.previousIndex=null;_this.velocity=0;_this.snapGrid=[];_this.slidesGrid=[];_this.imagesToLoad=[];_this.imagesLoaded=0;_this.wrapperLeft=0;_this.wrapperRight=0;_this.wrapperTop=0;_this.wrapperBottom=0;_this.isAndroid=navigator.userAgent.toLowerCase().indexOf('android')>=0;var wrapper,slideSize,wrapperSize,direction,isScrolling,containerSize,defaults={eventTarget:'wrapper',mode:'horizontal',touchRatio:1,speed:300,freeMode:false,freeModeFluid:false,momentumRatio:1,momentumBounce:true,momentumBounceRatio:1,slidesPerView:1,slidesPerGroup:1,slidesPerViewFit:true,simulateTouch:true,followFinger:true,shortSwipes:true,longSwipesRatio:0.5,moveStartThreshold:false,onlyExternal:false,createPagination:true,pagination:false,paginationElement:'span',paginationClickable:false,paginationAsRange:true,resistance:true,scrollContainer:false,preventLinks:true,preventLinksPropagation:false,noSwiping:false,noSwipingClass:'swiper-no-swiping',initialSlide:0,keyboardControl:false,mousewheelControl:false,mousewheelControlForceToAxis:false,useCSS3Transforms:true,autoplay:false,autoplayDisableOnInteraction:true,autoplayStopOnLast:false,loop:false,loopAdditionalSlides:0,roundLengths:false,calculateHeight:false,cssWidthAndHeight:false,updateOnImagesReady:true,releaseFormElements:true,watchActiveIndex:false,visibilityFullFit:false,offsetPxBefore:0,offsetPxAfter:0,offsetSlidesBefore:0,offsetSlidesAfter:0,centeredSlides:false,queueStartCallbacks:false,queueEndCallbacks:false,autoResize:true,resizeReInit:false,DOMAnimation:true,loader:{slides:[],slidesHTMLType:'inner',surroundGroups:1,logic:'reload',loadAllSlides:false},slideElement:'div',slideClass:'swiper-slide',slideActiveClass:'swiper-slide-active',slideVisibleClass:'swiper-slide-visible',slideDuplicateClass:'swiper-slide-duplicate',wrapperClass:'swiper-wrapper',paginationElementClass:'swiper-pagination-switch',paginationActiveClass:'swiper-active-switch',paginationVisibleClass:'swiper-visible-switch'};params=params||{};for(var prop in defaults)if(prop in params&&typeof params[prop]==='object'){for(var subProp in defaults[prop])if(!(subProp in params[prop]))params[prop][subProp]=defaults[prop][subProp]}else if(!(prop in params))params[prop]=defaults[prop];_this.params=params;if(params.scrollContainer){params.freeMode=true;params.freeModeFluid=true};if(params.loop)params.resistance='100%';var isH=params.mode==='horizontal',desktopEvents=['mousedown','mousemove','mouseup'];if(_this.browser.ie10)desktopEvents=['MSPointerDown','MSPointerMove','MSPointerUp'];if(_this.browser.ie11)desktopEvents=['pointerdown','pointermove','pointerup'];_this.touchEvents={touchStart:_this.support.touch||!params.simulateTouch?'touchstart':desktopEvents[0],touchMove:_this.support.touch||!params.simulateTouch?'touchmove':desktopEvents[1],touchEnd:_this.support.touch||!params.simulateTouch?'touchend':desktopEvents[2]};for(var i=_this.container.childNodes.length-1;i>=0;i--)if(_this.container.childNodes[i].className){var _wrapperClasses=_this.container.childNodes[i].className.split(/\s+/);for(var j=0;j<_wrapperClasses.length;j++)if(_wrapperClasses[j]===params.wrapperClass)wrapper=_this.container.childNodes[i]};_this.wrapper=wrapper;_this._extendSwiperSlide=function(el){el.append=function(){if(params.loop){el.insertAfter(_this.slides.length-_this.loopedSlides)}else{_this.wrapper.appendChild(el);_this.reInit()};return el};el.prepend=function(){if(params.loop){_this.wrapper.insertBefore(el,_this.slides[_this.loopedSlides]);_this.removeLoopedSlides();_this.calcSlides();_this.createLoop()}else _this.wrapper.insertBefore(el,_this.wrapper.firstChild);_this.reInit();return el};el.insertAfter=function(index){if(typeof index==='undefined')return false;var beforeSlide;if(params.loop){beforeSlide=_this.slides[index+1+_this.loopedSlides];if(beforeSlide){_this.wrapper.insertBefore(el,beforeSlide)}else _this.wrapper.appendChild(el);_this.removeLoopedSlides();_this.calcSlides();_this.createLoop()}else{beforeSlide=_this.slides[index+1];_this.wrapper.insertBefore(el,beforeSlide)};_this.reInit();return el};el.clone=function(){return _this._extendSwiperSlide(el.cloneNode(true))};el.remove=function(){_this.wrapper.removeChild(el);_this.reInit()};el.html=function(html){if(typeof html==='undefined'){return el.innerHTML}else{el.innerHTML=html;return el}};el.index=function(){var index;for(var i=_this.slides.length-1;i>=0;i--)if(el===_this.slides[i])index=i;return index};el.isActive=function(){if(el.index()===_this.activeIndex){return true}else return false};if(!el.swiperSlideDataStorage)el.swiperSlideDataStorage={};el.getData=function(name){return el.swiperSlideDataStorage[name]};el.setData=function(name,value){el.swiperSlideDataStorage[name]=value;return el};el.data=function(name,value){if(typeof value==='undefined'){return el.getAttribute('data-'+name)}else{el.setAttribute('data-'+name,value);return el}};el.getWidth=function(outer,round){return _this.h.getWidth(el,outer,round)};el.getHeight=function(outer,round){return _this.h.getHeight(el,outer,round)};el.getOffset=function(){return _this.h.getOffset(el)};return el};_this.calcSlides=function(forceCalcSlides){var oldNumber=_this.slides?_this.slides.length:false;_this.slides=[];_this.displaySlides=[];for(var i=0;i<_this.wrapper.childNodes.length;i++)if(_this.wrapper.childNodes[i].className){var _className=_this.wrapper.childNodes[i].className,_slideClasses=_className.split(/\s+/);for(var j=0;j<_slideClasses.length;j++)if(_slideClasses[j]===params.slideClass)_this.slides.push(_this.wrapper.childNodes[i])};for(i=_this.slides.length-1;i>=0;i--)_this._extendSwiperSlide(_this.slides[i]);if(oldNumber===false)return;if(oldNumber!==_this.slides.length||forceCalcSlides){removeSlideEvents();addSlideEvents();_this.updateActiveSlide();if(_this.params.pagination)_this.createPagination();_this.callPlugins('numberOfSlidesChanged')}};_this.createSlide=function(html,slideClassList,el){slideClassList=slideClassList||_this.params.slideClass;el=el||params.slideElement;var newSlide=document.createElement(el);newSlide.innerHTML=html||'';newSlide.className=slideClassList;return _this._extendSwiperSlide(newSlide)};_this.appendSlide=function(html,slideClassList,el){if(!html)return;if(html.nodeType){return _this._extendSwiperSlide(html).append()}else return _this.createSlide(html,slideClassList,el).append()};_this.prependSlide=function(html,slideClassList,el){if(!html)return;if(html.nodeType){return _this._extendSwiperSlide(html).prepend()}else return _this.createSlide(html,slideClassList,el).prepend()};_this.insertSlideAfter=function(index,html,slideClassList,el){if(typeof index==='undefined')return false;if(html.nodeType){return _this._extendSwiperSlide(html).insertAfter(index)}else return _this.createSlide(html,slideClassList,el).insertAfter(index)};_this.removeSlide=function(index){if(_this.slides[index]){if(params.loop){if(!_this.slides[index+_this.loopedSlides])return false;_this.slides[index+_this.loopedSlides].remove();_this.removeLoopedSlides();_this.calcSlides();_this.createLoop()}else _this.slides[index].remove();return true}else return false};_this.removeLastSlide=function(){if(_this.slides.length>0){if(params.loop){_this.slides[_this.slides.length-1-_this.loopedSlides].remove();_this.removeLoopedSlides();_this.calcSlides();_this.createLoop()}else _this.slides[_this.slides.length-1].remove();return true}else return false};_this.removeAllSlides=function(){for(var i=_this.slides.length-1;i>=0;i--)_this.slides[i].remove()};_this.getSlide=function(index){return _this.slides[index]};_this.getLastSlide=function(){return _this.slides[_this.slides.length-1]};_this.getFirstSlide=function(){return _this.slides[0]};_this.activeSlide=function(){return _this.slides[_this.activeIndex]};_this.fireCallback=function(){var callback=arguments[0];if(Object.prototype.toString.call(callback)==='[object Array]'){for(var i=0;i<callback.length;i++)if(typeof callback[i]==='function')callback[i](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}else if(Object.prototype.toString.call(callback)==='[object String]'){if(params['on'+callback])_this.fireCallback(params['on'+callback])}else callback(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}
function isArray(obj){if(Object.prototype.toString.apply(obj)==='[object Array]')return true;return false};_this.addCallback=function(callback,func){var _this=this,tempFunc;if(_this.params['on'+callback]){if(isArray(this.params['on'+callback])){return this.params['on'+callback].push(func)}else if(typeof this.params['on'+callback]==='function'){tempFunc=this.params['on'+callback];this.params['on'+callback]=[];this.params['on'+callback].push(tempFunc);return this.params['on'+callback].push(func)}}else{this.params['on'+callback]=[];return this.params['on'+callback].push(func)}};_this.removeCallbacks=function(callback){if(_this.params['on'+callback])_this.params['on'+callback]=null};var _plugins=[];for(var plugin in _this.plugins)if(params[plugin]){var p=_this.plugins[plugin](_this,params[plugin]);if(p)_plugins.push(p)};_this.callPlugins=function(method,args){if(!args)args={};for(var i=0;i<_plugins.length;i++)if(method in _plugins[i])_plugins[i][method](args)};if((_this.browser.ie10||_this.browser.ie11)&&!params.onlyExternal)_this.wrapper.classList.add('swiper-wp8-'+(isH?'horizontal':'vertical'));if(params.freeMode)_this.container.className+=' swiper-free-mode';_this.initialized=false;_this.init=function(force,forceCalcSlides){var _width=_this.h.getWidth(_this.container,false,params.roundLengths),_height=_this.h.getHeight(_this.container,false,params.roundLengths);if(_width===_this.width&&_height===_this.height&&!force)return;_this.width=_width;_this.height=_height;var slideWidth,slideHeight,slideMaxHeight,wrapperWidth,wrapperHeight,slideLeft,i;containerSize=isH?_width:_height;var wrapper=_this.wrapper;if(force)_this.calcSlides(forceCalcSlides);if(params.slidesPerView==='auto'){var slidesWidth=0,slidesHeight=0;if(params.slidesOffset>0){wrapper.style.paddingLeft='';wrapper.style.paddingRight='';wrapper.style.paddingTop='';wrapper.style.paddingBottom=''};if(params.offsetPxBefore>0)if(isH){_this.wrapperLeft=params.offsetPxBefore}else _this.wrapperTop=params.offsetPxBefore;if(params.offsetPxAfter>0)if(isH){_this.wrapperRight=params.offsetPxAfter}else _this.wrapperBottom=params.offsetPxAfter;if(params.centeredSlides)if(isH){_this.wrapperLeft=(containerSize-this.slides[0].getWidth(true,params.roundLengths))/2;_this.wrapperRight=(containerSize-_this.slides[_this.slides.length-1].getWidth(true,params.roundLengths))/2}else{_this.wrapperTop=(containerSize-_this.slides[0].getHeight(true,params.roundLengths))/2;_this.wrapperBottom=(containerSize-_this.slides[_this.slides.length-1].getHeight(true,params.roundLengths))/2};if(isH){if(_this.wrapperLeft>=0)wrapper.style.paddingLeft=_this.wrapperLeft+'px';if(_this.wrapperRight>=0)wrapper.style.paddingRight=_this.wrapperRight+'px'}else{if(_this.wrapperTop>=0)wrapper.style.paddingTop=_this.wrapperTop+'px';if(_this.wrapperBottom>=0)wrapper.style.paddingBottom=_this.wrapperBottom+'px'};slideLeft=0;var centeredSlideLeft=0;_this.snapGrid=[];_this.slidesGrid=[];slideMaxHeight=0;for(i=0;i<_this.slides.length;i++){slideWidth=_this.slides[i].getWidth(true,params.roundLengths);slideHeight=_this.slides[i].getHeight(true,params.roundLengths);if(params.calculateHeight)slideMaxHeight=Math.max(slideMaxHeight,slideHeight);var _slideSize=isH?slideWidth:slideHeight;if(params.centeredSlides){var nextSlideWidth=i===_this.slides.length-1?0:_this.slides[i+1].getWidth(true,params.roundLengths),nextSlideHeight=i===_this.slides.length-1?0:_this.slides[i+1].getHeight(true,params.roundLengths),nextSlideSize=isH?nextSlideWidth:nextSlideHeight;if(_slideSize>containerSize){if(params.slidesPerViewFit){_this.snapGrid.push(slideLeft+_this.wrapperLeft);_this.snapGrid.push(slideLeft+_slideSize-containerSize+_this.wrapperLeft)}else for(var j=0;j<=Math.floor(_slideSize/(containerSize+_this.wrapperLeft));j++)if(j===0){_this.snapGrid.push(slideLeft+_this.wrapperLeft)}else _this.snapGrid.push(slideLeft+_this.wrapperLeft+containerSize*j);_this.slidesGrid.push(slideLeft+_this.wrapperLeft)}else{_this.snapGrid.push(centeredSlideLeft);_this.slidesGrid.push(centeredSlideLeft)};centeredSlideLeft+=_slideSize/2+nextSlideSize/2}else{if(_slideSize>containerSize){if(params.slidesPerViewFit){_this.snapGrid.push(slideLeft);_this.snapGrid.push(slideLeft+_slideSize-containerSize)}else if(containerSize!==0){for(var k=0;k<=Math.floor(_slideSize/containerSize);k++)_this.snapGrid.push(slideLeft+containerSize*k)}else _this.snapGrid.push(slideLeft)}else _this.snapGrid.push(slideLeft);_this.slidesGrid.push(slideLeft)};slideLeft+=_slideSize;slidesWidth+=slideWidth;slidesHeight+=slideHeight};if(params.calculateHeight)_this.height=slideMaxHeight;if(isH){wrapperSize=slidesWidth+_this.wrapperRight+_this.wrapperLeft;wrapper.style.width=slidesWidth+'px';wrapper.style.height=(_this.height)+'px'}else{wrapperSize=slidesHeight+_this.wrapperTop+_this.wrapperBottom;wrapper.style.width=(_this.width)+'px';wrapper.style.height=slidesHeight+'px'}}else if(params.scrollContainer){wrapper.style.width='';wrapper.style.height='';wrapperWidth=_this.slides[0].getWidth(true,params.roundLengths);wrapperHeight=_this.slides[0].getHeight(true,params.roundLengths);wrapperSize=isH?wrapperWidth:wrapperHeight;wrapper.style.width=wrapperWidth+'px';wrapper.style.height=wrapperHeight+'px';slideSize=isH?wrapperWidth:wrapperHeight}else{if(params.calculateHeight){slideMaxHeight=0;wrapperHeight=0;if(!isH)_this.container.style.height='';wrapper.style.height='';for(i=0;i<_this.slides.length;i++){_this.slides[i].style.height='';slideMaxHeight=Math.max(_this.slides[i].getHeight(true),slideMaxHeight);if(!isH)wrapperHeight+=_this.slides[i].getHeight(true)};slideHeight=slideMaxHeight;_this.height=slideHeight;if(isH){wrapperHeight=slideHeight}else{containerSize=slideHeight;_this.container.style.height=containerSize+'px'}}else{slideHeight=isH?_this.height:_this.height/params.slidesPerView;if(params.roundLengths)slideHeight=Math.round(slideHeight);wrapperHeight=isH?_this.height:_this.slides.length*slideHeight};slideWidth=isH?_this.width/params.slidesPerView:_this.width;if(params.roundLengths)slideWidth=Math.round(slideWidth);wrapperWidth=isH?_this.slides.length*slideWidth:_this.width;slideSize=isH?slideWidth:slideHeight;if(params.offsetSlidesBefore>0)if(isH){_this.wrapperLeft=slideSize*params.offsetSlidesBefore}else _this.wrapperTop=slideSize*params.offsetSlidesBefore;if(params.offsetSlidesAfter>0)if(isH){_this.wrapperRight=slideSize*params.offsetSlidesAfter}else _this.wrapperBottom=slideSize*params.offsetSlidesAfter;if(params.offsetPxBefore>0)if(isH){_this.wrapperLeft=params.offsetPxBefore}else _this.wrapperTop=params.offsetPxBefore;if(params.offsetPxAfter>0)if(isH){_this.wrapperRight=params.offsetPxAfter}else _this.wrapperBottom=params.offsetPxAfter;if(params.centeredSlides)if(isH){_this.wrapperLeft=(containerSize-slideSize)/2;_this.wrapperRight=(containerSize-slideSize)/2}else{_this.wrapperTop=(containerSize-slideSize)/2;_this.wrapperBottom=(containerSize-slideSize)/2};if(isH){if(_this.wrapperLeft>0)wrapper.style.paddingLeft=_this.wrapperLeft+'px';if(_this.wrapperRight>0)wrapper.style.paddingRight=_this.wrapperRight+'px'}else{if(_this.wrapperTop>0)wrapper.style.paddingTop=_this.wrapperTop+'px';if(_this.wrapperBottom>0)wrapper.style.paddingBottom=_this.wrapperBottom+'px'};wrapperSize=isH?wrapperWidth+_this.wrapperRight+_this.wrapperLeft:wrapperHeight+_this.wrapperTop+_this.wrapperBottom;if(!params.cssWidthAndHeight){if(parseFloat(wrapperWidth)>0)wrapper.style.width=wrapperWidth+'px';if(parseFloat(wrapperHeight)>0)wrapper.style.height=wrapperHeight+'px'};slideLeft=0;_this.snapGrid=[];_this.slidesGrid=[];for(i=0;i<_this.slides.length;i++){_this.snapGrid.push(slideLeft);_this.slidesGrid.push(slideLeft);slideLeft+=slideSize;if(!params.cssWidthAndHeight){if(parseFloat(slideWidth)>0)_this.slides[i].style.width=slideWidth+'px';if(parseFloat(slideHeight)>0)_this.slides[i].style.height=slideHeight+'px'}}};if(!_this.initialized){_this.callPlugins('onFirstInit');if(params.onFirstInit)_this.fireCallback(params.onFirstInit,_this)}else{_this.callPlugins('onInit');if(params.onInit)_this.fireCallback(params.onInit,_this)};_this.initialized=true};_this.reInit=function(forceCalcSlides){_this.init(true,forceCalcSlides)};_this.resizeFix=function(reInit){_this.callPlugins('beforeResizeFix');_this.init(params.resizeReInit||reInit);if(!params.freeMode){_this.swipeTo((params.loop?_this.activeLoopIndex:_this.activeIndex),0,false);if(params.autoplay)if(_this.support.transitions&&typeof autoplayTimeoutId!=='undefined'){if(typeof autoplayTimeoutId!=='undefined'){clearTimeout(autoplayTimeoutId);autoplayTimeoutId=undefined;_this.startAutoplay()}}else if(typeof autoplayIntervalId!=='undefined'){clearInterval(autoplayIntervalId);autoplayIntervalId=undefined;_this.startAutoplay()}}else if(_this.getWrapperTranslate()<-maxWrapperPosition()){_this.setWrapperTransition(0);_this.setWrapperTranslate(-maxWrapperPosition())};_this.callPlugins('afterResizeFix')}
function maxWrapperPosition(){var a=(wrapperSize-containerSize);if(params.freeMode)a=wrapperSize-containerSize;if(params.slidesPerView>_this.slides.length&&!params.centeredSlides)a=0;if(a<0)a=0;return a}
function initEvents(){var bind=_this.h.addEventListener,eventTarget=params.eventTarget==='wrapper'?_this.wrapper:_this.container;if(!(_this.browser.ie10||_this.browser.ie11)){if(_this.support.touch){bind(eventTarget,'touchstart',onTouchStart);bind(eventTarget,'touchmove',onTouchMove);bind(eventTarget,'touchend',onTouchEnd)};if(params.simulateTouch){bind(eventTarget,'mousedown',onTouchStart);bind(document,'mousemove',onTouchMove);bind(document,'mouseup',onTouchEnd)}}else{bind(eventTarget,_this.touchEvents.touchStart,onTouchStart);bind(document,_this.touchEvents.touchMove,onTouchMove);bind(document,_this.touchEvents.touchEnd,onTouchEnd)};if(params.autoResize)bind(window,'resize',_this.resizeFix);addSlideEvents();_this._wheelEvent=false;if(params.mousewheelControl){if(document.onmousewheel!==undefined)_this._wheelEvent='mousewheel';if(!_this._wheelEvent)try{new WheelEvent('wheel');_this._wheelEvent='wheel'}catch(e){};if(!_this._wheelEvent)_this._wheelEvent='DOMMouseScroll';if(_this._wheelEvent)bind(_this.container,_this._wheelEvent,handleMousewheel)}
function _loadImage(src){var image=new Image();image.onload=function(){if(_this&&_this.imagesLoaded!==undefined)_this.imagesLoaded++;if(_this.imagesLoaded===_this.imagesToLoad.length){_this.reInit();if(params.onImagesReady)_this.fireCallback(params.onImagesReady,_this)}};image.src=src};if(params.keyboardControl)bind(document,'keydown',handleKeyboardKeys);if(params.updateOnImagesReady){_this.imagesToLoad=$$('img',_this.container);for(var i=0;i<_this.imagesToLoad.length;i++)_loadImage(_this.imagesToLoad[i].getAttribute('src'))}};_this.destroy=function(){var unbind=_this.h.removeEventListener,eventTarget=params.eventTarget==='wrapper'?_this.wrapper:_this.container;if(!(_this.browser.ie10||_this.browser.ie11)){if(_this.support.touch){unbind(eventTarget,'touchstart',onTouchStart);unbind(eventTarget,'touchmove',onTouchMove);unbind(eventTarget,'touchend',onTouchEnd)};if(params.simulateTouch){unbind(eventTarget,'mousedown',onTouchStart);unbind(document,'mousemove',onTouchMove);unbind(document,'mouseup',onTouchEnd)}}else{unbind(eventTarget,_this.touchEvents.touchStart,onTouchStart);unbind(document,_this.touchEvents.touchMove,onTouchMove);unbind(document,_this.touchEvents.touchEnd,onTouchEnd)};if(params.autoResize)unbind(window,'resize',_this.resizeFix);removeSlideEvents();if(params.paginationClickable)removePaginationEvents();if(params.mousewheelControl&&_this._wheelEvent)unbind(_this.container,_this._wheelEvent,handleMousewheel);if(params.keyboardControl)unbind(document,'keydown',handleKeyboardKeys);if(params.autoplay)_this.stopAutoplay();_this.callPlugins('onDestroy');_this=null}
function addSlideEvents(){var bind=_this.h.addEventListener,i;if(params.preventLinks){var links=$$('a',_this.container);for(i=0;i<links.length;i++)bind(links[i],'click',preventClick)};if(params.releaseFormElements){var formElements=$$('input, textarea, select',_this.container);for(i=0;i<formElements.length;i++)bind(formElements[i],_this.touchEvents.touchStart,releaseForms,true)};if(params.onSlideClick)for(i=0;i<_this.slides.length;i++)bind(_this.slides[i],'click',slideClick);if(params.onSlideTouch)for(i=0;i<_this.slides.length;i++)bind(_this.slides[i],_this.touchEvents.touchStart,slideTouch)}
function removeSlideEvents(){var unbind=_this.h.removeEventListener,i;if(params.onSlideClick)for(i=0;i<_this.slides.length;i++)unbind(_this.slides[i],'click',slideClick);if(params.onSlideTouch)for(i=0;i<_this.slides.length;i++)unbind(_this.slides[i],_this.touchEvents.touchStart,slideTouch);if(params.releaseFormElements){var formElements=$$('input, textarea, select',_this.container);for(i=0;i<formElements.length;i++)unbind(formElements[i],_this.touchEvents.touchStart,releaseForms,true)};if(params.preventLinks){var links=$$('a',_this.container);for(i=0;i<links.length;i++)unbind(links[i],'click',preventClick)}}
function handleKeyboardKeys(e){var kc=e.keyCode||e.charCode;if(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey)return;if(kc===37||kc===39||kc===38||kc===40){var inView=false,swiperOffset=_this.h.getOffset(_this.container),scrollLeft=_this.h.windowScroll().left,scrollTop=_this.h.windowScroll().top,windowWidth=_this.h.windowWidth(),windowHeight=_this.h.windowHeight(),swiperCoord=[[swiperOffset.left,swiperOffset.top],[swiperOffset.left+_this.width,swiperOffset.top],[swiperOffset.left,swiperOffset.top+_this.height],[swiperOffset.left+_this.width,swiperOffset.top+_this.height]];for(var i=0;i<swiperCoord.length;i++){var point=swiperCoord[i];if(point[0]>=scrollLeft&&point[0]<=scrollLeft+windowWidth&&point[1]>=scrollTop&&point[1]<=scrollTop+windowHeight)inView=true};if(!inView)return};if(isH){if(kc===37||kc===39)if(e.preventDefault){e.preventDefault()}else e.returnValue=false;if(kc===39)_this.swipeNext();if(kc===37)_this.swipePrev()}else{if(kc===38||kc===40)if(e.preventDefault){e.preventDefault()}else e.returnValue=false;if(kc===40)_this.swipeNext();if(kc===38)_this.swipePrev()}};_this.disableKeyboardControl=function(){params.keyboardControl=false;_this.h.removeEventListener(document,'keydown',handleKeyboardKeys)};_this.enableKeyboardControl=function(){params.keyboardControl=true;_this.h.addEventListener(document,'keydown',handleKeyboardKeys)};var lastScrollTime=(new Date()).getTime()
function handleMousewheel(e){var we=_this._wheelEvent,delta=0;if(e.detail){delta=-e.detail}else if(we==='mousewheel'){if(params.mousewheelControlForceToAxis){if(isH){if(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)){delta=e.wheelDeltaX}else return}else if(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)){delta=e.wheelDeltaY}else return}else delta=e.wheelDelta}else if(we==='DOMMouseScroll'){delta=-e.detail}else if(we==='wheel')if(params.mousewheelControlForceToAxis){if(isH){if(Math.abs(e.deltaX)>Math.abs(e.deltaY)){delta=-e.deltaX}else return}else if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){delta=-e.deltaY}else return}else delta=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX:-e.deltaY;if(!params.freeMode){if((new Date()).getTime()-lastScrollTime>60)if(delta<0){_this.swipeNext()}else _this.swipePrev();lastScrollTime=(new Date()).getTime()}else{var position=_this.getWrapperTranslate()+delta;if(position>0)position=0;if(position<-maxWrapperPosition())position=-maxWrapperPosition();_this.setWrapperTransition(0);_this.setWrapperTranslate(position);_this.updateActiveSlide(position);if(position===0||position===-maxWrapperPosition())return};if(params.autoplay)_this.stopAutoplay(true);if(e.preventDefault){e.preventDefault()}else e.returnValue=false;return false};_this.disableMousewheelControl=function(){if(!_this._wheelEvent)return false;params.mousewheelControl=false;_this.h.removeEventListener(_this.container,_this._wheelEvent,handleMousewheel);return true};_this.enableMousewheelControl=function(){if(!_this._wheelEvent)return false;params.mousewheelControl=true;_this.h.addEventListener(_this.container,_this._wheelEvent,handleMousewheel);return true};if(params.grabCursor){var containerStyle=_this.container.style;containerStyle.cursor='move';containerStyle.cursor='grab';containerStyle.cursor='-moz-grab';containerStyle.cursor='-webkit-grab'};_this.allowSlideClick=true
function slideClick(event){if(_this.allowSlideClick){setClickedSlide(event);_this.fireCallback(params.onSlideClick,_this,event)}}
function slideTouch(event){setClickedSlide(event);_this.fireCallback(params.onSlideTouch,_this,event)}
function setClickedSlide(event){if(!event.currentTarget){var element=event.srcElement;do{if(element.className.indexOf(params.slideClass)>-1)break;element=element.parentNode}while(element);_this.clickedSlide=element}else _this.clickedSlide=event.currentTarget;_this.clickedSlideIndex=_this.slides.indexOf(_this.clickedSlide);_this.clickedSlideLoopIndex=_this.clickedSlideIndex-(_this.loopedSlides||0)};_this.allowLinks=true
function preventClick(e){if(!_this.allowLinks){if(e.preventDefault){e.preventDefault()}else e.returnValue=false;if(params.preventLinksPropagation&&'stopPropagation'in e)e.stopPropagation();return false}}
function releaseForms(e){if(e.stopPropagation){e.stopPropagation()}else e.returnValue=false;return false};var isTouchEvent=false,allowThresholdMove,allowMomentumBounce=true
function onTouchStart(event){if(params.preventLinks)_this.allowLinks=true;if(_this.isTouched||params.onlyExternal)return false;if(params.noSwiping&&(event.target||event.srcElement)&&noSwipingSlide(event.target||event.srcElement))return false;allowMomentumBounce=false;_this.isTouched=true;isTouchEvent=event.type==='touchstart';if(!isTouchEvent||event.targetTouches.length===1){_this.callPlugins('onTouchStartBegin');if(!isTouchEvent&&!_this.isAndroid)if(event.preventDefault){event.preventDefault()}else event.returnValue=false;var pageX=isTouchEvent?event.targetTouches[0].pageX:(event.pageX||event.clientX),pageY=isTouchEvent?event.targetTouches[0].pageY:(event.pageY||event.clientY);_this.touches.startX=_this.touches.currentX=pageX;_this.touches.startY=_this.touches.currentY=pageY;_this.touches.start=_this.touches.current=isH?pageX:pageY;_this.setWrapperTransition(0);_this.positions.start=_this.positions.current=_this.getWrapperTranslate();_this.setWrapperTranslate(_this.positions.start);_this.times.start=(new Date()).getTime();isScrolling=undefined;if(params.moveStartThreshold>0)allowThresholdMove=false;if(params.onTouchStart)_this.fireCallback(params.onTouchStart,_this,event);_this.callPlugins('onTouchStartEnd')}};var velocityPrevPosition,velocityPrevTime
function onTouchMove(event){if(!_this.isTouched||params.onlyExternal)return;if(isTouchEvent&&event.type==='mousemove')return;var pageX=isTouchEvent?event.targetTouches[0].pageX:(event.pageX||event.clientX),pageY=isTouchEvent?event.targetTouches[0].pageY:(event.pageY||event.clientY);if(typeof isScrolling==='undefined'&&isH)isScrolling=!!(isScrolling||Math.abs(pageY-_this.touches.startY)>Math.abs(pageX-_this.touches.startX));if(typeof isScrolling==='undefined'&&!isH)isScrolling=!!(isScrolling||Math.abs(pageY-_this.touches.startY)<Math.abs(pageX-_this.touches.startX));if(isScrolling){_this.isTouched=false;return};if(event.assignedToSwiper){_this.isTouched=false;return};event.assignedToSwiper=true;if(params.preventLinks)_this.allowLinks=false;if(params.onSlideClick)_this.allowSlideClick=false;if(params.autoplay)_this.stopAutoplay(true);if(!isTouchEvent||event.touches.length===1){if(!_this.isMoved){_this.callPlugins('onTouchMoveStart');if(params.loop){_this.fixLoop();_this.positions.start=_this.getWrapperTranslate()};if(params.onTouchMoveStart)_this.fireCallback(params.onTouchMoveStart,_this)};_this.isMoved=true;if(event.preventDefault){event.preventDefault()}else event.returnValue=false;_this.touches.current=isH?pageX:pageY;_this.positions.current=(_this.touches.current-_this.touches.start)*params.touchRatio+_this.positions.start;if(_this.positions.current>0&&params.onResistanceBefore)_this.fireCallback(params.onResistanceBefore,_this,_this.positions.current);if(_this.positions.current<-maxWrapperPosition()&&params.onResistanceAfter)_this.fireCallback(params.onResistanceAfter,_this,Math.abs(_this.positions.current+maxWrapperPosition()));if(params.resistance&&params.resistance!=='100%'){var resistance;if(_this.positions.current>0){resistance=1-_this.positions.current/containerSize/2;if(resistance<0.5){_this.positions.current=(containerSize/2)}else _this.positions.current=_this.positions.current*resistance};if(_this.positions.current<-maxWrapperPosition()){var diff=(_this.touches.current-_this.touches.start)*params.touchRatio+(maxWrapperPosition()+_this.positions.start);resistance=(containerSize+diff)/containerSize;var newPos=_this.positions.current-diff*(1-resistance)/2,stopPos=-maxWrapperPosition()-containerSize/2;if(newPos<stopPos||resistance<=0){_this.positions.current=stopPos}else _this.positions.current=newPos}};if(params.resistance&&params.resistance==='100%'){if(_this.positions.current>0&&!(params.freeMode&&!params.freeModeFluid))_this.positions.current=0;if(_this.positions.current<-maxWrapperPosition()&&!(params.freeMode&&!params.freeModeFluid))_this.positions.current=-maxWrapperPosition()};if(!params.followFinger)return;if(!params.moveStartThreshold){_this.setWrapperTranslate(_this.positions.current)}else if(Math.abs(_this.touches.current-_this.touches.start)>params.moveStartThreshold||allowThresholdMove){if(!allowThresholdMove){allowThresholdMove=true;_this.touches.start=_this.touches.current;return};_this.setWrapperTranslate(_this.positions.current)}else _this.positions.current=_this.positions.start;if(params.freeMode||params.watchActiveIndex)_this.updateActiveSlide(_this.positions.current);if(params.grabCursor){_this.container.style.cursor='move';_this.container.style.cursor='grabbing';_this.container.style.cursor='-moz-grabbin';_this.container.style.cursor='-webkit-grabbing'};if(!velocityPrevPosition)velocityPrevPosition=_this.touches.current;if(!velocityPrevTime)velocityPrevTime=(new Date()).getTime();_this.velocity=(_this.touches.current-velocityPrevPosition)/((new Date()).getTime()-velocityPrevTime)/2;if(Math.abs(_this.touches.current-velocityPrevPosition)<2)_this.velocity=0;velocityPrevPosition=_this.touches.current;velocityPrevTime=(new Date()).getTime();_this.callPlugins('onTouchMoveEnd');_this.isBeingMoved=true;if(params.onTouchMove)_this.fireCallback(params.onTouchMove,_this,event);return false}}
function onTouchEnd(event){if(isScrolling)_this.swipeReset();if(params.onlyExternal||!_this.isTouched)return;_this.isTouched=false;if(params.grabCursor){_this.container.style.cursor='move';_this.container.style.cursor='grab';_this.container.style.cursor='-moz-grab';_this.container.style.cursor='-webkit-grab'};if(!_this.positions.current&&_this.positions.current!==0)_this.positions.current=_this.positions.start;if(params.followFinger)_this.setWrapperTranslate(_this.positions.current);_this.times.end=(new Date()).getTime();_this.touches.diff=_this.touches.current-_this.touches.start;_this.touches.abs=Math.abs(_this.touches.diff);_this.positions.diff=_this.positions.current-_this.positions.start;_this.positions.abs=Math.abs(_this.positions.diff);var diff=_this.positions.diff,diffAbs=_this.positions.abs,timeDiff=_this.times.end-_this.times.start;if(diffAbs<5&&timeDiff<300&&_this.allowLinks===false){if(!params.freeMode&&diffAbs!==0)_this.swipeReset();if(params.preventLinks)_this.allowLinks=true;if(params.onSlideClick)_this.allowSlideClick=true};setTimeout(function(){if(params.preventLinks)_this.allowLinks=true;if(params.onSlideClick)_this.allowSlideClick=true},100);var isBeingMoved=_this.isBeingMoved;_this.isBeingMoved=false;var maxPosition=maxWrapperPosition();if(!_this.isMoved&&params.freeMode){_this.isMoved=false;if(params.onTouchEnd)_this.fireCallback(params.onTouchEnd,_this,event);_this.callPlugins('onTouchEnd');return};if(!_this.isMoved||_this.positions.current>0||_this.positions.current<-maxPosition){_this.swipeReset();if(params.onTouchEnd)_this.fireCallback(params.onTouchEnd,_this,event);_this.callPlugins('onTouchEnd');return};_this.isMoved=false;if(params.freeMode&&isBeingMoved){_this.updateActiveSlide(_this.positions.current);if(params.freeModeFluid){var momentumDuration=1e3*params.momentumRatio,momentumDistance=_this.velocity*momentumDuration,newPosition=_this.positions.current+momentumDistance,doBounce=false,afterBouncePosition,bounceAmount=Math.abs(_this.velocity)*20*params.momentumBounceRatio;if(newPosition<-maxPosition)if(params.momentumBounce&&_this.support.transitions){if(newPosition+maxPosition<-bounceAmount)newPosition=-maxPosition-bounceAmount;afterBouncePosition=-maxPosition;doBounce=true;allowMomentumBounce=true}else newPosition=-maxPosition;if(newPosition>0)if(params.momentumBounce&&_this.support.transitions){if(newPosition>bounceAmount)newPosition=bounceAmount;afterBouncePosition=0;doBounce=true;allowMomentumBounce=true}else newPosition=0;if(_this.velocity!==0)momentumDuration=Math.abs((newPosition-_this.positions.current)/_this.velocity);_this.setWrapperTranslate(newPosition);_this.setWrapperTransition(momentumDuration);if(params.momentumBounce&&doBounce)_this.wrapperTransitionEnd(function(){if(!allowMomentumBounce)return;if(params.onMomentumBounce)_this.fireCallback(params.onMomentumBounce,_this);_this.callPlugins('onMomentumBounce');_this.setWrapperTranslate(afterBouncePosition);_this.setWrapperTransition(300)});_this.updateActiveSlide(newPosition)};if(!params.freeModeFluid||timeDiff>=300)_this.updateActiveSlide(_this.positions.current);if(params.onTouchEnd)_this.fireCallback(params.onTouchEnd,_this,event);_this.callPlugins('onTouchEnd');return};direction=diff<0?'toNext':'toPrev';if(direction==='toNext'&&(timeDiff<=300))if(diffAbs<30||!params.shortSwipes){_this.swipeReset()}else _this.swipeNext(true);if(direction==='toPrev'&&(timeDiff<=300))if(diffAbs<30||!params.shortSwipes){_this.swipeReset()}else _this.swipePrev(true);var targetSlideSize=0;if(params.slidesPerView==='auto'){var currentPosition=Math.abs(_this.getWrapperTranslate()),slidesOffset=0,_slideSize;for(var i=0;i<_this.slides.length;i++){_slideSize=isH?_this.slides[i].getWidth(true,params.roundLengths):_this.slides[i].getHeight(true,params.roundLengths);slidesOffset+=_slideSize;if(slidesOffset>currentPosition){targetSlideSize=_slideSize;break}};if(targetSlideSize>containerSize)targetSlideSize=containerSize}else targetSlideSize=slideSize*params.slidesPerView;if(direction==='toNext'&&(timeDiff>300))if(diffAbs>=targetSlideSize*params.longSwipesRatio){_this.swipeNext(true)}else _this.swipeReset();if(direction==='toPrev'&&(timeDiff>300))if(diffAbs>=targetSlideSize*params.longSwipesRatio){_this.swipePrev(true)}else _this.swipeReset();if(params.onTouchEnd)_this.fireCallback(params.onTouchEnd,_this,event);_this.callPlugins('onTouchEnd')}
function noSwipingSlide(el){var noSwiping=false;do{if(el.className.indexOf(params.noSwipingClass)>-1)noSwiping=true;el=el.parentElement}while(!noSwiping&&el.parentElement&&el.className.indexOf(params.wrapperClass)===-1);if(!noSwiping&&el.className.indexOf(params.wrapperClass)>-1&&el.className.indexOf(params.noSwipingClass)>-1)noSwiping=true;return noSwiping}
function addClassToHtmlString(klass,outerHtml){var par=document.createElement('div'),child;par.innerHTML=outerHtml;child=par.firstChild;child.className+=' '+klass;return child.outerHTML};_this.swipeNext=function(internal){if(!internal&&params.loop)_this.fixLoop();if(!internal&&params.autoplay)_this.stopAutoplay(true);_this.callPlugins('onSwipeNext');var currentPosition=_this.getWrapperTranslate(),newPosition=currentPosition;if(params.slidesPerView==='auto'){for(var i=0;i<_this.snapGrid.length;i++)if(-currentPosition>=_this.snapGrid[i]&&-currentPosition<_this.snapGrid[i+1]){newPosition=-_this.snapGrid[i+1];break}}else{var groupSize=slideSize*params.slidesPerGroup;newPosition=-(Math.floor(Math.abs(currentPosition)/Math.floor(groupSize))*groupSize+groupSize)};if(newPosition<-maxWrapperPosition())newPosition=-maxWrapperPosition();if(newPosition===currentPosition)return false;swipeToPosition(newPosition,'next');return true};_this.swipePrev=function(internal){if(!internal&&params.loop)_this.fixLoop();if(!internal&&params.autoplay)_this.stopAutoplay(true);_this.callPlugins('onSwipePrev');var currentPosition=Math.ceil(_this.getWrapperTranslate()),newPosition;if(params.slidesPerView==='auto'){newPosition=0;for(var i=1;i<_this.snapGrid.length;i++){if(-currentPosition===_this.snapGrid[i]){newPosition=-_this.snapGrid[i-1];break};if(-currentPosition>_this.snapGrid[i]&&-currentPosition<_this.snapGrid[i+1]){newPosition=-_this.snapGrid[i];break}}}else{var groupSize=slideSize*params.slidesPerGroup;newPosition=-(Math.ceil(-currentPosition/groupSize)-1)*groupSize};if(newPosition>0)newPosition=0;if(newPosition===currentPosition)return false;swipeToPosition(newPosition,'prev');return true};_this.swipeReset=function(){_this.callPlugins('onSwipeReset');var currentPosition=_this.getWrapperTranslate(),groupSize=slideSize*params.slidesPerGroup,newPosition,maxPosition=-maxWrapperPosition();if(params.slidesPerView==='auto'){newPosition=0;for(var i=0;i<_this.snapGrid.length;i++){if(-currentPosition===_this.snapGrid[i])return;if(-currentPosition>=_this.snapGrid[i]&&-currentPosition<_this.snapGrid[i+1]){if(_this.positions.diff>0){newPosition=-_this.snapGrid[i+1]}else newPosition=-_this.snapGrid[i];break}};if(-currentPosition>=_this.snapGrid[_this.snapGrid.length-1])newPosition=-_this.snapGrid[_this.snapGrid.length-1];if(currentPosition<=-maxWrapperPosition())newPosition=-maxWrapperPosition()}else newPosition=currentPosition<0?Math.round(currentPosition/groupSize)*groupSize:0;if(params.scrollContainer)newPosition=currentPosition<0?currentPosition:0;if(newPosition<-maxWrapperPosition())newPosition=-maxWrapperPosition();if(params.scrollContainer&&(containerSize>slideSize))newPosition=0;if(newPosition===currentPosition)return false;swipeToPosition(newPosition,'reset');return true};_this.swipeTo=function(index,speed,runCallbacks){index=parseInt(index,10);_this.callPlugins('onSwipeTo',{index:index,speed:speed});if(params.loop)index=index+_this.loopedSlides;var currentPosition=_this.getWrapperTranslate();if(index>(_this.slides.length-1)||index<0)return;var newPosition;if(params.slidesPerView==='auto'){newPosition=-_this.slidesGrid[index]}else newPosition=-index*slideSize;if(newPosition<-maxWrapperPosition())newPosition=-maxWrapperPosition();if(newPosition===currentPosition)return false;runCallbacks=runCallbacks===false?false:true;swipeToPosition(newPosition,'to',{index:index,speed:speed,runCallbacks:runCallbacks});return true}
function swipeToPosition(newPosition,action,toOptions){var speed=(action==='to'&&toOptions.speed>=0)?toOptions.speed:params.speed,timeOld=+new Date()
function anim(){var timeNew=+new Date(),time=timeNew-timeOld;currentPosition+=animationStep*time/(1e3/60);condition=direction==='toNext'?currentPosition>newPosition:currentPosition<newPosition;if(condition){_this.setWrapperTranslate(Math.round(currentPosition));_this._DOMAnimating=true;window.setTimeout(function(){anim()},1e3/60)}else{if(params.onSlideChangeEnd)if(action==='to'){if(toOptions.runCallbacks===true)_this.fireCallback(params.onSlideChangeEnd,_this)}else _this.fireCallback(params.onSlideChangeEnd,_this);_this.setWrapperTranslate(newPosition);_this._DOMAnimating=false}};if(_this.support.transitions||!params.DOMAnimation){_this.setWrapperTranslate(newPosition);_this.setWrapperTransition(speed)}else{var currentPosition=_this.getWrapperTranslate(),rawAnimationStep=(newPosition-currentPosition)/speed*(1e3/60),animationStep=rawAnimationStep<0?Math.floor(rawAnimationStep):Math.ceil(rawAnimationStep),direction=currentPosition>newPosition?'toNext':'toPrev',condition=direction==='toNext'?currentPosition>newPosition:currentPosition<newPosition;if(_this._DOMAnimating)return;anim()};_this.updateActiveSlide(newPosition);if(params.onSlideNext&&action==='next')_this.fireCallback(params.onSlideNext,_this,newPosition);if(params.onSlidePrev&&action==='prev')_this.fireCallback(params.onSlidePrev,_this,newPosition);if(params.onSlideReset&&action==='reset')_this.fireCallback(params.onSlideReset,_this,newPosition);if(action==='next'||action==='prev'||(action==='to'&&toOptions.runCallbacks===true))slideChangeCallbacks(action)};_this._queueStartCallbacks=false;_this._queueEndCallbacks=false
function slideChangeCallbacks(direction){_this.callPlugins('onSlideChangeStart');if(params.onSlideChangeStart)if(params.queueStartCallbacks&&_this.support.transitions){if(_this._queueStartCallbacks)return;_this._queueStartCallbacks=true;_this.fireCallback(params.onSlideChangeStart,_this,direction);_this.wrapperTransitionEnd(function(){_this._queueStartCallbacks=false})}else _this.fireCallback(params.onSlideChangeStart,_this,direction);if(params.onSlideChangeEnd)if(_this.support.transitions){if(params.queueEndCallbacks){if(_this._queueEndCallbacks)return;_this._queueEndCallbacks=true;_this.wrapperTransitionEnd(function(swiper){_this.fireCallback(params.onSlideChangeEnd,swiper,direction)})}else _this.wrapperTransitionEnd(function(swiper){_this.fireCallback(params.onSlideChangeEnd,swiper,direction)})}else if(!params.DOMAnimation)setTimeout(function(){_this.fireCallback(params.onSlideChangeEnd,_this,direction)},10)};_this.updateActiveSlide=function(position){if(!_this.initialized)return;if(_this.slides.length===0)return;_this.previousIndex=_this.activeIndex;if(typeof position==='undefined')position=_this.getWrapperTranslate();if(position>0)position=0;var i;if(params.slidesPerView==='auto'){var slidesOffset=0;_this.activeIndex=_this.slidesGrid.indexOf(-position);if(_this.activeIndex<0){for(i=0;i<_this.slidesGrid.length-1;i++)if(-position>_this.slidesGrid[i]&&-position<_this.slidesGrid[i+1])break;var leftDistance=Math.abs(_this.slidesGrid[i]+position),rightDistance=Math.abs(_this.slidesGrid[i+1]+position);if(leftDistance<=rightDistance){_this.activeIndex=i}else _this.activeIndex=i+1}}else _this.activeIndex=Math[params.visibilityFullFit?'ceil':'round'](-position/slideSize);if(_this.activeIndex===_this.slides.length)_this.activeIndex=_this.slides.length-1;if(_this.activeIndex<0)_this.activeIndex=0;if(!_this.slides[_this.activeIndex])return;_this.calcVisibleSlides(position);if(!params.disableSlideClassUpdate)if(_this.support.classList){var slide;for(i=0;i<_this.slides.length;i++){slide=_this.slides[i];slide.classList.remove(params.slideActiveClass);if(_this.visibleSlides.indexOf(slide)>=0){slide.classList.add(params.slideVisibleClass)}else slide.classList.remove(params.slideVisibleClass)};_this.slides[_this.activeIndex].classList.add(params.slideActiveClass)}else{var activeClassRegexp=new RegExp('\\s*'+params.slideActiveClass),inViewClassRegexp=new RegExp('\\s*'+params.slideVisibleClass);for(i=0;i<_this.slides.length;i++){_this.slides[i].className=_this.slides[i].className.replace(activeClassRegexp,'').replace(inViewClassRegexp,'');if(_this.visibleSlides.indexOf(_this.slides[i])>=0)_this.slides[i].className+=' '+params.slideVisibleClass};_this.slides[_this.activeIndex].className+=' '+params.slideActiveClass};if(params.loop){var ls=_this.loopedSlides;_this.activeLoopIndex=_this.activeIndex-ls;if(_this.activeLoopIndex>=_this.slides.length-ls*2)_this.activeLoopIndex=_this.slides.length-ls*2-_this.activeLoopIndex;if(_this.activeLoopIndex<0)_this.activeLoopIndex=_this.slides.length-ls*2+_this.activeLoopIndex;if(_this.activeLoopIndex<0)_this.activeLoopIndex=0}else _this.activeLoopIndex=_this.activeIndex;if(params.pagination)_this.updatePagination(position)};_this.createPagination=function(firstInit){if(params.paginationClickable&&_this.paginationButtons)removePaginationEvents();_this.paginationContainer=params.pagination.nodeType?params.pagination:$$(params.pagination)[0];if(params.createPagination){var paginationHTML='',numOfSlides=_this.slides.length,numOfButtons=numOfSlides;if(params.loop)numOfButtons-=_this.loopedSlides*2;for(var i=0;i<numOfButtons;i++)paginationHTML+='<'+params.paginationElement+' class="'+params.paginationElementClass+'"></'+params.paginationElement+'>';_this.paginationContainer.innerHTML=paginationHTML};_this.paginationButtons=$$('.'+params.paginationElementClass,_this.paginationContainer);if(!firstInit)_this.updatePagination();_this.callPlugins('onCreatePagination');if(params.paginationClickable)addPaginationEvents()}
function removePaginationEvents(){var pagers=_this.paginationButtons;if(pagers)for(var i=0;i<pagers.length;i++)_this.h.removeEventListener(pagers[i],'click',paginationClick)}
function addPaginationEvents(){var pagers=_this.paginationButtons;if(pagers)for(var i=0;i<pagers.length;i++)_this.h.addEventListener(pagers[i],'click',paginationClick)}
function paginationClick(e){var index,target=e.target||e.srcElement,pagers=_this.paginationButtons;for(var i=0;i<pagers.length;i++)if(target===pagers[i])index=i;_this.swipeTo(index)};_this.updatePagination=function(position){if(!params.pagination)return;if(_this.slides.length<1)return;var activePagers=$$('.'+params.paginationActiveClass,_this.paginationContainer);if(!activePagers)return;var pagers=_this.paginationButtons;if(pagers.length===0)return;for(var i=0;i<pagers.length;i++)pagers[i].className=params.paginationElementClass;var indexOffset=params.loop?_this.loopedSlides:0;if(params.paginationAsRange){if(!_this.visibleSlides)_this.calcVisibleSlides(position);var visibleIndexes=[],j;for(j=0;j<_this.visibleSlides.length;j++){var visIndex=_this.slides.indexOf(_this.visibleSlides[j])-indexOffset;if(params.loop&&visIndex<0)visIndex=_this.slides.length-_this.loopedSlides*2+visIndex;if(params.loop&&visIndex>=_this.slides.length-_this.loopedSlides*2){visIndex=_this.slides.length-_this.loopedSlides*2-visIndex;visIndex=Math.abs(visIndex)};visibleIndexes.push(visIndex)};for(j=0;j<visibleIndexes.length;j++)if(pagers[visibleIndexes[j]])pagers[visibleIndexes[j]].className+=' '+params.paginationVisibleClass;if(params.loop){if(pagers[_this.activeLoopIndex]!==undefined)pagers[_this.activeLoopIndex].className+=' '+params.paginationActiveClass}else pagers[_this.activeIndex].className+=' '+params.paginationActiveClass}else if(params.loop){if(pagers[_this.activeLoopIndex])pagers[_this.activeLoopIndex].className+=' '+params.paginationActiveClass+' '+params.paginationVisibleClass}else pagers[_this.activeIndex].className+=' '+params.paginationActiveClass+' '+params.paginationVisibleClass};_this.calcVisibleSlides=function(position){var visibleSlides=[],_slideLeft=0,_slideSize=0,_slideRight=0;if(isH&&_this.wrapperLeft>0)position=position+_this.wrapperLeft;if(!isH&&_this.wrapperTop>0)position=position+_this.wrapperTop;for(var i=0;i<_this.slides.length;i++){_slideLeft+=_slideSize;if(params.slidesPerView==='auto'){_slideSize=isH?_this.h.getWidth(_this.slides[i],true,params.roundLengths):_this.h.getHeight(_this.slides[i],true,params.roundLengths)}else _slideSize=slideSize;_slideRight=_slideLeft+_slideSize;var isVisibile=false;if(params.visibilityFullFit){if(_slideLeft>=-position&&_slideRight<=-position+containerSize)isVisibile=true;if(_slideLeft<=-position&&_slideRight>=-position+containerSize)isVisibile=true}else{if(_slideRight>-position&&_slideRight<=(-position+containerSize))isVisibile=true;if(_slideLeft>=-position&&_slideLeft<(-position+containerSize))isVisibile=true;if(_slideLeft<-position&&_slideRight>(-position+containerSize))isVisibile=true};if(isVisibile)visibleSlides.push(_this.slides[i])};if(visibleSlides.length===0)visibleSlides=[_this.slides[_this.activeIndex]];_this.visibleSlides=visibleSlides};var autoplayTimeoutId,autoplayIntervalId;_this.startAutoplay=function(){if(_this.support.transitions){if(typeof autoplayTimeoutId!=='undefined')return false;if(!params.autoplay)return;_this.callPlugins('onAutoplayStart');if(params.onAutoplayStart)_this.fireCallback(params.onAutoplayStart,_this);autoplay()}else{if(typeof autoplayIntervalId!=='undefined')return false;if(!params.autoplay)return;_this.callPlugins('onAutoplayStart');if(params.onAutoplayStart)_this.fireCallback(params.onAutoplayStart,_this);autoplayIntervalId=setInterval(function(){if(params.loop){_this.fixLoop();_this.swipeNext(true)}else if(!_this.swipeNext(true))if(!params.autoplayStopOnLast){_this.swipeTo(0)}else{clearInterval(autoplayIntervalId);autoplayIntervalId=undefined}},params.autoplay)}};_this.stopAutoplay=function(internal){if(_this.support.transitions){if(!autoplayTimeoutId)return;if(autoplayTimeoutId)clearTimeout(autoplayTimeoutId);autoplayTimeoutId=undefined;if(internal&&!params.autoplayDisableOnInteraction)_this.wrapperTransitionEnd(function(){autoplay()});_this.callPlugins('onAutoplayStop');if(params.onAutoplayStop)_this.fireCallback(params.onAutoplayStop,_this)}else{if(autoplayIntervalId)clearInterval(autoplayIntervalId);autoplayIntervalId=undefined;_this.callPlugins('onAutoplayStop');if(params.onAutoplayStop)_this.fireCallback(params.onAutoplayStop,_this)}}
function autoplay(){autoplayTimeoutId=setTimeout(function(){if(params.loop){_this.fixLoop();_this.swipeNext(true)}else if(!_this.swipeNext(true))if(!params.autoplayStopOnLast){_this.swipeTo(0)}else{clearTimeout(autoplayTimeoutId);autoplayTimeoutId=undefined};_this.wrapperTransitionEnd(function(){if(typeof autoplayTimeoutId!=='undefined')autoplay()})},params.autoplay)};_this.loopCreated=false;_this.removeLoopedSlides=function(){if(_this.loopCreated)for(var i=0;i<_this.slides.length;i++)if(_this.slides[i].getData('looped')===true)_this.wrapper.removeChild(_this.slides[i])};_this.createLoop=function(){if(_this.slides.length===0)return;if(params.slidesPerView==='auto'){_this.loopedSlides=params.loopedSlides||1}else _this.loopedSlides=params.slidesPerView+params.loopAdditionalSlides;if(_this.loopedSlides>_this.slides.length)_this.loopedSlides=_this.slides.length;var slideFirstHTML='',slideLastHTML='',i,slidesSetFullHTML='',numSlides=_this.slides.length,fullSlideSets=Math.floor(_this.loopedSlides/numSlides),remainderSlides=_this.loopedSlides%numSlides;for(i=0;i<(fullSlideSets*numSlides);i++){var j=i;if(i>=numSlides){var over=Math.floor(i/numSlides);j=i-(numSlides*over)};slidesSetFullHTML+=_this.slides[j].outerHTML};for(i=0;i<remainderSlides;i++)slideLastHTML+=addClassToHtmlString(params.slideDuplicateClass,_this.slides[i].outerHTML);for(i=numSlides-remainderSlides;i<numSlides;i++)slideFirstHTML+=addClassToHtmlString(params.slideDuplicateClass,_this.slides[i].outerHTML);var slides=slideFirstHTML+slidesSetFullHTML+wrapper.innerHTML+slidesSetFullHTML+slideLastHTML;wrapper.innerHTML=slides;_this.loopCreated=true;_this.calcSlides();for(i=0;i<_this.slides.length;i++)if(i<_this.loopedSlides||i>=_this.slides.length-_this.loopedSlides)_this.slides[i].setData('looped',true);_this.callPlugins('onCreateLoop')};_this.fixLoop=function(){var newIndex;if(_this.activeIndex<_this.loopedSlides){newIndex=_this.slides.length-_this.loopedSlides*3+_this.activeIndex;_this.swipeTo(newIndex,0,false)}else if((params.slidesPerView==='auto'&&_this.activeIndex>=_this.loopedSlides*2)||(_this.activeIndex>_this.slides.length-params.slidesPerView*2)){newIndex=-_this.slides.length+_this.activeIndex+_this.loopedSlides;_this.swipeTo(newIndex,0,false)}};_this.loadSlides=function(){var slidesHTML='';_this.activeLoaderIndex=0;var slides=params.loader.slides,slidesToLoad=params.loader.loadAllSlides?slides.length:params.slidesPerView*(1+params.loader.surroundGroups);for(var i=0;i<slidesToLoad;i++)if(params.loader.slidesHTMLType==='outer'){slidesHTML+=slides[i]}else slidesHTML+='<'+params.slideElement+' class="'+params.slideClass+'" data-swiperindex="'+i+'">'+slides[i]+'</'+params.slideElement+'>';_this.wrapper.innerHTML=slidesHTML;_this.calcSlides(true);if(!params.loader.loadAllSlides)_this.wrapperTransitionEnd(_this.reloadSlides,true)};_this.reloadSlides=function(){var slides=params.loader.slides,newActiveIndex=parseInt(_this.activeSlide().data('swiperindex'),10);if(newActiveIndex<0||newActiveIndex>slides.length-1)return;_this.activeLoaderIndex=newActiveIndex;var firstIndex=Math.max(0,newActiveIndex-params.slidesPerView*params.loader.surroundGroups),lastIndex=Math.min(newActiveIndex+params.slidesPerView*(1+params.loader.surroundGroups)-1,slides.length-1);if(newActiveIndex>0){var newTransform=-slideSize*(newActiveIndex-firstIndex);_this.setWrapperTranslate(newTransform);_this.setWrapperTransition(0)};var i;if(params.loader.logic==='reload'){_this.wrapper.innerHTML='';var slidesHTML='';for(i=firstIndex;i<=lastIndex;i++)slidesHTML+=params.loader.slidesHTMLType==='outer'?slides[i]:'<'+params.slideElement+' class="'+params.slideClass+'" data-swiperindex="'+i+'">'+slides[i]+'</'+params.slideElement+'>';_this.wrapper.innerHTML=slidesHTML}else{var minExistIndex=1e3,maxExistIndex=0;for(i=0;i<_this.slides.length;i++){var index=_this.slides[i].data('swiperindex');if(index<firstIndex||index>lastIndex){_this.wrapper.removeChild(_this.slides[i])}else{minExistIndex=Math.min(index,minExistIndex);maxExistIndex=Math.max(index,maxExistIndex)}};for(i=firstIndex;i<=lastIndex;i++){var newSlide;if(i<minExistIndex){newSlide=document.createElement(params.slideElement);newSlide.className=params.slideClass;newSlide.setAttribute('data-swiperindex',i);newSlide.innerHTML=slides[i];_this.wrapper.insertBefore(newSlide,_this.wrapper.firstChild)};if(i>maxExistIndex){newSlide=document.createElement(params.slideElement);newSlide.className=params.slideClass;newSlide.setAttribute('data-swiperindex',i);newSlide.innerHTML=slides[i];_this.wrapper.appendChild(newSlide)}}};_this.reInit(true)}
function makeSwiper(){_this.calcSlides();if(params.loader.slides.length>0&&_this.slides.length===0)_this.loadSlides();if(params.loop)_this.createLoop();_this.init();initEvents();if(params.pagination)_this.createPagination(true);if(params.loop||params.initialSlide>0){_this.swipeTo(params.initialSlide,0,false)}else _this.updateActiveSlide(0);if(params.autoplay)_this.startAutoplay();_this.centerIndex=_this.activeIndex;if(params.onSwiperCreated)_this.fireCallback(params.onSwiperCreated,_this);_this.callPlugins('onSwiperCreated')};makeSwiper()};Swiper.prototype={plugins:{},wrapperTransitionEnd:function(callback,permanent){'use strict';var a=this,el=a.wrapper,events=['webkitTransitionEnd','transitionend','oTransitionEnd','MSTransitionEnd','msTransitionEnd'],i
function fireCallBack(){callback(a);if(a.params.queueEndCallbacks)a._queueEndCallbacks=false;if(!permanent)for(i=0;i<events.length;i++)a.h.removeEventListener(el,events[i],fireCallBack)};if(callback)for(i=0;i<events.length;i++)a.h.addEventListener(el,events[i],fireCallBack)},getWrapperTranslate:function(axis){'use strict';var el=this.wrapper,matrix,curTransform,curStyle,transformMatrix;if(typeof axis==='undefined')axis=this.params.mode==='horizontal'?'x':'y';if(this.support.transforms&&this.params.useCSS3Transforms){curStyle=window.getComputedStyle(el,null);if(window.WebKitCSSMatrix){transformMatrix=new WebKitCSSMatrix(curStyle.webkitTransform==='none'?'':curStyle.webkitTransform)}else{transformMatrix=curStyle.MozTransform||curStyle.OTransform||curStyle.MsTransform||curStyle.msTransform||curStyle.transform||curStyle.getPropertyValue('transform').replace('translate(','matrix(1, 0, 0, 1,');matrix=transformMatrix.toString().split(',')};if(axis==='x')if(window.WebKitCSSMatrix){curTransform=transformMatrix.m41}else if(matrix.length===16){curTransform=parseFloat(matrix[12])}else curTransform=parseFloat(matrix[4]);if(axis==='y')if(window.WebKitCSSMatrix){curTransform=transformMatrix.m42}else if(matrix.length===16){curTransform=parseFloat(matrix[13])}else curTransform=parseFloat(matrix[5])}else{if(axis==='x')curTransform=parseFloat(el.style.left,10)||0;if(axis==='y')curTransform=parseFloat(el.style.top,10)||0};return curTransform||0},setWrapperTranslate:function(x,y,z){'use strict';var es=this.wrapper.style,coords={x:0,y:0,z:0},translate;if(arguments.length===3){coords.x=x;coords.y=y;coords.z=z}else{if(typeof y==='undefined')y=this.params.mode==='horizontal'?'x':'y';coords[y]=x};if(this.support.transforms&&this.params.useCSS3Transforms){translate=this.support.transforms3d?'translate3d('+coords.x+'px, '+coords.y+'px, '+coords.z+'px)':'translate('+coords.x+'px, '+coords.y+'px)';es.webkitTransform=es.MsTransform=es.msTransform=es.MozTransform=es.OTransform=es.transform=translate}else{es.left=coords.x+'px';es.top=coords.y+'px'};this.callPlugins('onSetWrapperTransform',coords);if(this.params.onSetWrapperTransform)this.fireCallback(this.params.onSetWrapperTransform,this,coords)},setWrapperTransition:function(duration){'use strict';var es=this.wrapper.style;es.webkitTransitionDuration=es.MsTransitionDuration=es.msTransitionDuration=es.MozTransitionDuration=es.OTransitionDuration=es.transitionDuration=(duration/1e3)+'s';this.callPlugins('onSetWrapperTransition',{duration:duration});if(this.params.onSetWrapperTransition)this.fireCallback(this.params.onSetWrapperTransition,this,duration)},h:{getWidth:function(el,outer,round){'use strict';var width=window.getComputedStyle(el,null).getPropertyValue('width'),returnWidth=parseFloat(width);if(isNaN(returnWidth)||width.indexOf('%')>0)returnWidth=el.offsetWidth-parseFloat(window.getComputedStyle(el,null).getPropertyValue('padding-left'))-parseFloat(window.getComputedStyle(el,null).getPropertyValue('padding-right'));if(outer)returnWidth+=parseFloat(window.getComputedStyle(el,null).getPropertyValue('padding-left'))+parseFloat(window.getComputedStyle(el,null).getPropertyValue('padding-right'));if(round){return Math.round(returnWidth)}else return returnWidth},getHeight:function(el,outer,round){'use strict';if(outer)return el.offsetHeight;var height=window.getComputedStyle(el,null).getPropertyValue('height'),returnHeight=parseFloat(height);if(isNaN(returnHeight)||height.indexOf('%')>0)returnHeight=el.offsetHeight-parseFloat(window.getComputedStyle(el,null).getPropertyValue('padding-top'))-parseFloat(window.getComputedStyle(el,null).getPropertyValue('padding-bottom'));if(outer)returnHeight+=parseFloat(window.getComputedStyle(el,null).getPropertyValue('padding-top'))+parseFloat(window.getComputedStyle(el,null).getPropertyValue('padding-bottom'));if(round){return Math.round(returnHeight)}else return returnHeight},getOffset:function(el){'use strict';var box=el.getBoundingClientRect(),body=document.body,clientTop=el.clientTop||body.clientTop||0,clientLeft=el.clientLeft||body.clientLeft||0,scrollTop=window.pageYOffset||el.scrollTop,scrollLeft=window.pageXOffset||el.scrollLeft;if(document.documentElement&&!window.pageYOffset){scrollTop=document.documentElement.scrollTop;scrollLeft=document.documentElement.scrollLeft};return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft}},windowWidth:function(){'use strict';if(window.innerWidth){return window.innerWidth}else if(document.documentElement&&document.documentElement.clientWidth)return document.documentElement.clientWidth},windowHeight:function(){'use strict';if(window.innerHeight){return window.innerHeight}else if(document.documentElement&&document.documentElement.clientHeight)return document.documentElement.clientHeight},windowScroll:function(){'use strict';if(typeof pageYOffset!=='undefined'){return{left:window.pageXOffset,top:window.pageYOffset}}else if(document.documentElement)return{left:document.documentElement.scrollLeft,top:document.documentElement.scrollTop}},addEventListener:function(el,event,listener,useCapture){'use strict';if(typeof useCapture==='undefined')useCapture=false;if(el.addEventListener){el.addEventListener(event,listener,useCapture)}else if(el.attachEvent)el.attachEvent('on'+event,listener)},removeEventListener:function(el,event,listener,useCapture){'use strict';if(typeof useCapture==='undefined')useCapture=false;if(el.removeEventListener){el.removeEventListener(event,listener,useCapture)}else if(el.detachEvent)el.detachEvent('on'+event,listener)}},setTransform:function(el,transform){'use strict';var es=el.style;es.webkitTransform=es.MsTransform=es.msTransform=es.MozTransform=es.OTransform=es.transform=transform},setTranslate:function(el,translate){'use strict';var es=el.style,pos={x:translate.x||0,y:translate.y||0,z:translate.z||0},transformString=this.support.transforms3d?'translate3d('+(pos.x)+'px,'+(pos.y)+'px,'+(pos.z)+'px)':'translate('+(pos.x)+'px,'+(pos.y)+'px)';es.webkitTransform=es.MsTransform=es.msTransform=es.MozTransform=es.OTransform=es.transform=transformString;if(!this.support.transforms){es.left=pos.x+'px';es.top=pos.y+'px'}},setTransition:function(el,duration){'use strict';var es=el.style;es.webkitTransitionDuration=es.MsTransitionDuration=es.msTransitionDuration=es.MozTransitionDuration=es.OTransitionDuration=es.transitionDuration=duration+'ms'},support:{touch:(window.Modernizr&&Modernizr.touch===true)||(function(){'use strict';return!!(('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch)})(),transforms3d:(window.Modernizr&&Modernizr.csstransforms3d===true)||(function(){'use strict';var div=document.createElement('div').style;return('webkitPerspective'in div||'MozPerspective'in div||'OPerspective'in div||'MsPerspective'in div||'perspective'in div)})(),transforms:(window.Modernizr&&Modernizr.csstransforms===true)||(function(){'use strict';var div=document.createElement('div').style;return('transform'in div||'WebkitTransform'in div||'MozTransform'in div||'msTransform'in div||'MsTransform'in div||'OTransform'in div)})(),transitions:(window.Modernizr&&Modernizr.csstransitions===true)||(function(){'use strict';var div=document.createElement('div').style;return('transition'in div||'WebkitTransition'in div||'MozTransition'in div||'msTransition'in div||'MsTransition'in div||'OTransition'in div)})(),classList:(function(){'use strict';var div=document.createElement('div').style;return'classList'in div})()},browser:{ie8:(function(){'use strict';var rv=-1;if(navigator.appName==='Microsoft Internet Explorer'){var ua=navigator.userAgent,re=new RegExp(/MSIE ([0-9]{1,}[\.0-9]{0,})/);if(re.exec(ua)!==null)rv=parseFloat(RegExp.$1)};return rv!==-1&&rv<9})(),ie10:window.navigator.msPointerEnabled,ie11:window.navigator.pointerEnabled}};if(window.jQuery||window.Zepto)(function($){'use strict';$.fn.swiper=function(params){var s=new Swiper($(this)[0],params);$(this).data('swiper',s);return s}})(window.jQuery||window.Zepto);if(typeof module!=='undefined')module.exports=Swiper;if(typeof define==='function'&&define.amd)define([],function(){'use strict';return Swiper});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/modules/video_playlist/vendor/idangerous.swiper.modified.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.collections.js. */
twc.shared.apps.factory('CmsCollectionsModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({recordType:'CmsCollections',setResponse:function(response){this.data=response;this.header="NA"},getGroupId:function(){return this._get('groupid')},getId:function(){return this._get('id')},getDescription:function(){return this._get('description')},getTitle:function(){return this._get('title')},getTheme:function(){return this._get('theme')},getSponsorship:function(){return this._get('sponsorship')},getSequence:function(){return this._get('sequence')},getFeatured:function(){return this._get('featured')},getImageUrl:function(){return this._get('imageurl')},getVideoBackgroundImage:function(){return this._get('background_image')?this._get('background_image').video:null},getArticleBackgroundImage:function(){return this._get('background_image')?this._get('background_image').article:null},getTitleImage:function(){return this._get('background_image')?this._get('background_image').title:null},getUrl:function(){return this._get('url')},getSponsored:function(){return this._get('sponsored')},getAdMetrics:function(){return this._get('ad_metrics')}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.collections.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.morecord.js. */
twc.shared.apps.factory('WxdMORecordModelClass',['RecordModel','$injector','dsxModelUtils',function(RecordModel,$injector,dsxModelUtils){var pcoUser=$injector.get('pcoUser');return RecordModel.extend({recordType:'MORecord',getTemp:function(unit){unit=unit||this.getUser().getTempUnit();return this._get('tmp'+unit)},getTempUnit:function(){return this.getUser().getTempUnit()},getUser:function(){return pcoUser},getDayNight:function(){return this._get('dyNght')},getWeatherDescription:function(){return this._get('wx')},getSkyCode:function(){return this._get('sky')},getSkyCodeExtended:function(){return this._get('iconExt')},getObsDate:function(){return this._get('locObsDay')},getObsTime:function(){return this._get('locObsTm')},getObsGmt:function(){return this._get('obsTmGmt')},getFeelsLike:function(){return this._get('flsLkIdx'+this.getUser().getTempUnit())},getTodayHi:function(){return this._get('tmpMx24'+this.getUser().getTempUnit())},getTodayLo:function(){return this._get('tmpMn24'+this.getUser().getTempUnit())},getPrecip24:function(){return dsxModelUtils.getPrecipValue(this,'prcp24')},getPrecip3_6:function(){return dsxModelUtils.getPrecipValue(this,'prcp3_6hr')},getPrecipHour:function(){return dsxModelUtils.getPrecipValue(this,'prcpHr')},getPrecipLast7Days:function(){return dsxModelUtils.getPrecipValue(this,'prcp7Dy')},getPrecipMonth:function(){return dsxModelUtils.getPrecipValue(this,'prcpMTD')},getPrecipYear:function(){return dsxModelUtils.getPrecipValue(this,'prcpYr')},getSnowDepth:function(){return dsxModelUtils.getAccumulationValue(this,'snwDep')},getSnowIncrease:function(){return dsxModelUtils.getAccumulationValue(this,'snwIncr')},getSnowTotal:function(){return dsxModelUtils.getAccumulationValue(this,'snwTot')},getSnowMTD:function(){return dsxModelUtils.getAccumulationValue(this,'snwMTD')},getSnowSeason:function(){return dsxModelUtils.getAccumulationValue(this,'snwSsn')},getSnowByYear:function(){return dsxModelUtils.getAccumulationValue(this,'snwYr')},getSunrise:function(){return this._get('sunrise')},getSunset:function(){return this._get('sunset')},getSunriseISO:function(){return this._get('sunriseISO')},getSunsetISO:function(){return this._get('sunsetISO')},getSunriseISOLocal:function(){return this._get('_sunriseISOLocal')},getSunsetISOLocal:function(){return this._get('_sunsetISOLocal')},getWindDirection:function(){return this._get('wDirAsc')},getWindDirectionDegrees:function(){return this._get('wDir')},getWindGust:function(){var pLocale=TWC&&TWC.Titan&&TWC.Titan.locale;if(pLocale&&pLocale==="en_GB")return this._get('wGstM');return this._get('wGst'+this.getUser().getSpeedUnit())},getWindSpeed:function(){var pLocale=TWC&&TWC.Titan&&TWC.Titan.locale;if(pLocale&&pLocale==="en_GB")return this._get('wSpdM');return this._get('wSpd'+this.getUser().getSpeedUnit())},getHumidity:function(){return this._get('rH')},getUVIndex:function(){return this._get('uvIdx')},getUVDescription:function(){return this._get('uvDes')},getBarometricText:function(){return this._get('baroTrndAsc')},getBarometric:function(){return this._get('')},getCeiling:function(){var unit=this.getUser().getSpeedUnit();return this._get('ceil'+unit==='M'?unit:'')},getClouds:function(){return this._get('clds')},getDewPoint:function(){return this._get('dwpt'+this.getUser().getTempUnit())},getHeatIndex:function(){return this._get('hI'+this.getUser().getTempUnit())},getPressure:function(){var unit=this.getUser().getPressureUnit();return(unit==='mb'?this._get('pres'):this._get('alt'))},getPressureChange:function(){return this._get('presChnge')},getVisibility:function(){return this._get('vis'+this.getUser().getSpeedUnit())},getWindChill:function(){return this._get('wC'+this.getUser().getTempUnit())},getQualifierSeverity:function(){return this._get('qulfrSvrty')},getQualifierPhrase:function(){return this._get('_extendedQulfrPhrase')},getLocalObsTime:function(){return this._get('_obsDateLocalTimeISO')}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.morecord.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cs.datetime.js. */
twc.shared.apps.factory('CsDatetimeModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({recordType:'CsDatetimeModelClass',getDateTimeISO:function(){return this._get('datetime')},getTimeZoneAbbr:function(){return this._get('tmZnAbbr')},setResponse:function(response){this.data=response;this.header="NA"}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cs.datetime.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.loc.js. */
twc.shared.apps.factory('WxdLocModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({recordType:'loc',setResponse:function(response){this.data=response;this.header="NA"},toSavedLocation:function(savedLocation){var savedLocData=angular.copy(this.data);return savedLocation.fromDto(savedLocData)},getFullLocId:function(){return this._get('locId')+':'+this._get('locType')+':'+this._get('cntryCd')},getLocType:function(){return this._get('locType')},getLocId:function(){return this._get('locId')},getCountryCode:function(){return this._get('cntryCd')},getPresName:function(){return this._get('prsntNm')},getLatitude:function(){return this._get('lat')},getLongitude:function(){return this._get('long')},getTimezoneAbbrev:function(){return this._get('tmZnAbbr')},getGmtDiff:function(){return this._get('gmtDiff')},getZipCode:function(){return this._get('zipCd')},getGMTOffset:function(){return this._get('gmtDiff')},getStateCode:function(){return this._get('stCd')},getStateName:function(){return this._get('stNm')},getState:function(){return this._get('stNm')},getCountry:function(){return this._get("_country")},getDaylightSavingsIndicator:function(){return this._get("dySTInd")},getDaylightSavingsActive:function(){return this._get("dySTAct")},getRegion:function(){return this._get('regSat')},getCity:function(){return this._get('cityNm')},getClsRad:function(){return this._get('clsRad')},getDmaCode:function(){return this._get('dmaCd')}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/wxd.loc.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.breakingnow.js. */
twc.shared.apps.factory('CmsBreakingNowModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({recordType:'CmsBreakingNowModelClass',getTitle:function(){return this._get('title')},getHeadLine:function(){return this._get('headline')},getLinkUrl:function(){return this._get('link_url')},getColor:function(){return this._get('color')},getShare:function(){return this._get('share')},getShareType:function(){return this.getShare().type},getLocations:function(){return this.getShare().locations},setResponse:function(response){this.data=response;this.header="NA"}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.breakingnow.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.assetlist.js. */
twc.shared.apps.factory('CmsAssetListModelClass',['CmsAModelClass','pcoUser',function(CmsAModelClass,pcoUser){return CmsAModelClass.extend({recordType:'CmsAssetList',construct:function(){CmsAModelClass.prototype.construct.apply(this,arguments)},setResponse:function(response){this.data=response;this.header="NA"},getThumbnail:function(){var objVariants=this._get('variants'),thumbnailUrl=objVariants[2]||'';return thumbnailUrl}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.assetlist.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsx_date/dsx_date.directive.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module("shared",[]);twc.shared.apps.directive('dsxdate',['$rootScope','datefactory',function($rootScope,datefactory){var directoryDefinition={priority:0,replace:true,template:'<span class="wx-dsxdate" ng-bind="dsxDateOutput"></span>',scope:true,restrict:'EA',link:function($scope,$element,$attrs){$scope.dsxDateOutput='';var expsToWatch={date:$attrs.date,time:$attrs.time,datetime:$attrs.datetime,timezone:$attrs.timezone,placeholder:$attrs.placeholder,format:$attrs.format},data={};angular.forEach(expsToWatch,function(expToWatch,key){$scope.$watch(expToWatch,function(val){data[key]=val})});$scope.$watch(function(){return data},function(){if(data.datetime||data.date||data.time){var dateObj;if(data.datetime){dateObj=datefactory['new'](data.datetime,data.timezone)}else dateObj=datefactory['new'](data.date,data.time,data.timezone);if(dateObj){var formattedDate=dateObj.format(data.format);if(formattedDate)$scope.dsxDateOutput=formattedDate}}else $scope.dsxDateOutput=angular.isDefined(data.placeholder)?data.placeholder:datefactory['new']('',data.timezone).format(data.format)},true)}};return directoryDefinition}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsx_date/dsx_date.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/preload/preload.directive.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module('shared',[]);twc.shared.apps.directive('preload',function(){var preloadDefinition={priority:0,replace:false,template:'<div class="loading clearfix"><div class="preloader" data-anim="base wrapper"><div class="left-wrap"><div class="circle left" data-anim="base left"></div></div><div class="right-wrap"><div class="circle right" data-anim="base right"></div></div></div></div>',scope:true,restrict:'A'};return preloadDefinition});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/preload/preload.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.a.js. */
twc.shared.apps.factory('CmsAModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({recordType:'a',setResponse:function(response){this.data=response;this.header="NA"},getId:function(){return this._get('id')},getType:function(){return this._get('type')},getTitle:function(teaserFlag){return(teaserFlag&&this._get('teaserTitle'))||this._get('title')},setTitle:function(overrideTitle){if(overrideTitle)this.set({title:overrideTitle})},setPlaylistUrl:function(playlist){var url=this._get("url");if(playlist&&url&&url.indexOf("pl=")===-1){var hasQuestionMark=url.indexOf("?")!==-1;this.set({url:url+(hasQuestionMark?"&":"?")+"pl="+playlist})}},getAssets:function(){return this._get('assets')},getPrimaryCollectionId:function(){return this._get('pcollid')},getDuration:function(){return this._get('duration')},getSEOUrl:function(){return this._get('seourl')},getDescription:function(){return this._get('description')},getPublishDate:function(){return this._get('publishdate')},getCreatedDate:function(){return this._get('createddate')},getLastModifiedDate:function(){return this._get('lastmodifieddate')},getSourceDate:function(){return this._get('sourcedate')},getTags:function(){return this._get('tags')},getCollections:function(){return this._get('colls')},getVariants:function(){return this._get('variants')},getVariant:function(variant){var variants=this._get('variants');return variants?variants[variant]:null},getProviderId:function(){return this._get('providerid')},getProviderName:function(){return this._get('providername')},getTrimmedProviderName:function(){return this._get('providername')?this._get('providername').split(" ")[0]:""},getMarketId:function(){return this._get('marketid')},getVendorId:function(){return this._get('vendorid')},getSource:function(){var source=this._get('flags')&&this._get('flags').orig_source;return(source?source:"")},getTotalAssets:function(){return this._get('totalAssets')},getCredit:function(){return this._get('credit')},getSourceName:function(){return this._get('sourcename')},getUrl:function(){return this._get('url')},getCollectionData:function(){var colldata=this._get("_collectiondata")||{};return{getId:function(){return colldata.id},getAdMetrics:function(){return colldata.ad_metrics},getSponsored:function(){return colldata.sponsored},getBackgroundImage:function(){return colldata.background_image},getVideoBackgroundImage:function(){return colldata.background_image&&colldata.background_image.video||null},getArticleImage:function(){return colldata.background_image&&colldata.background_image.article||null},getTitleImage:function(){return colldata.background_image&&colldata.background_image.title||null},getUrl:function(){return colldata.url},getTitle:function(){return colldata.title}}},getAuthors:function(){return this._get('author')},getPlaylistData:function(){var pldata=this._get('_pldata')||{};return{getUrl:function(){return pldata.url},getTitle:function(){return pldata.title}}}})}]);twc.shared.apps.factory('UGCAssetModelClass',['CmsAModelClass',function(CmsAModelClass){return CmsAModelClass.extend({recordType:'ugc',getAltTitle:function(){return this._get('title')},getAssetUrl:function(){return this.getVariant("stream")},getCanonicalUrl:function(){return this._get('seourl')},getLargeThumbUrl:function(){return this.getVariant(12)},getProviderId:function(){return this._get('providerid')},getPublishDate:function(){return this._get('publishdate')},getCollectionData:function(){var colldata=this._get("_collectiondata")||{};return{getId:function(){return colldata.groupid},getAdMetrics:function(){return colldata.ad_metrics},getSponsored:function(){return colldata.sponsored},getBackgroundImage:function(){return colldata.background_image},getVideoBackgroundImage:function(){return colldata.background_image&&colldata.background_image.video||null},getArticleImage:function(){return colldata.background_image&&colldata.background_image.article||null},getTitleImage:function(){return colldata.background_image&&colldata.background_image.title||null},getUrl:function(){return colldata.url},getTitle:function(){return colldata.title}}}})}]);twc.shared.apps.factory('VideoAssetModelClass',['CmsAModelClass',function(CmsAModelClass){return CmsAModelClass.extend({recordType:'video',getAltTitle:function(){return this._get('altitle')},getVideoDescription:function(){return this._get('description')},getAssetUrl:function(){return this._get("mezzanine_url")},getCanonicalUrl:function(){return this._get('url')},getLargeThumbUrl:function(){return this.getVariant(200)},getItemIndex:function(){return this._get("itemIndex")}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.a.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.affiliatevideos.js. */
twc.shared.apps.factory('CmsAffiliateVideosModelClass',['RecordModel',function(RecordModel){return RecordModel.extend({recordType:'CmsAffiliateVideosModelClass',setResponse:function(response){this.data=response},getAssets:function(){return this._get("assets")},getNetwork:function(){return this._get("network")},getCollection:function(){return this._get('collection')}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/dsxclient/models/v2/cms.affiliatevideos.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/error_handler/error_handler.directive.js. */
twc.shared=twc.shared||{};twc.shared.apps=twc.shared.apps||angular.module('shared',[]);twc.shared.apps.directive('errorHandler',['twcConfig','$compile',function(twcConfig,$compile){var errorHandlerDefinition={priority:0,replace:true,template:'<div data-ng-if="hasError" class="wx-module-error" data-ng-class="{dark: errorHandlerTheme === \'dark\'}">\n    <div class="wx-module-error-content">\n        <span class="wx-iconfont-global wx-icon-error-2"></span>\n        <div class="messaging">\n            <p class="error-title" data-ng-bind-template="{{errorTitle | translate}}"></p>\n            <p class="error-description"  data-ng-bind-template="{{errorDescription | translate}}"></p>\n        </div>\n    </div>\n</div>\n',scope:{errorHandler:'=',errorHandlerMode:'@',errorHandlerTheme:'@'},restrict:'A',link:function($scope){$scope.hasError=$scope.errorHandler===twcConfig.module_status_codes.ERROR;$scope.funcs={myErrorHandler:function(){switch($scope.errorHandlerMode){case'na':$scope.errorTitle='error_handler.NOT_AVAILABLE_TITLE';$scope.errorDescription='error_handler.NOT_AVAILABLE_DESCRIPTION';break;case'generic':$scope.errorTitle='error_handler.GENERIC_ERROR_TITLE';$scope.errorDescription='error_handler.GENERIC_ERROR_DESCRIPTION';break;default:$scope.errorTitle='error_handler.GENERIC_ERROR_TITLE';$scope.errorDescription='error_handler.GENERIC_ERROR_DESCRIPTION'}}};$scope.funcs.myErrorHandler();$scope.$watch('errorHandler',function(nVal,oVal){$scope.hasError=nVal==='error'});$scope.$watch('errorHandlerMode',function(nVal,oVal){if(nVal!==oVal){$scope.errorHandlerMode=nVal;$scope.funcs.myErrorHandler()}})}};return errorHandlerDefinition}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/error_handler/error_handler.directive.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/videoplayer_amp/s.Media.config.js. */
window.TWC=window.TWC||{};TWC.Events=TWC.Events||{};TWC.Events['sMediaReady']=TWC.Events['sMediaReady']||jQuery.Deferred();TWC.Events['sMediaReady'].done(function(){if(!s){console.log("ERROR: Site Catalyst object 's' not available. Cannot do metrics.");return};s.enableVideoTracking=true;if(s.enableVideoTracking){s.Media.autoTrack=false;s.Media.trackWhilePlaying=false;s.Media.trackVars="events,eVar11,evar41,eVar44,eVar46,eVar47,eVar48,eVar58,eVar59,eVar60,eVar63,eVar64,prop23";s.Media.trackEvents="event10,event11,event12,event13,event15,event16";s.Media.trackMilestones="50";s.Media.segmentByMilestones=true;s.Media.trackUsingContextData=true;s.Media.contextDataMapping={"a.media.name":"eVar46,prop23","a.media.segment":"eVar80","a.contentType":"eVar41","a.media.view":"event15","a.media.complete":"event16","a.media.milestones":{50:"event12"},"a.media.ad.name":"eVar46,prop23","a.media.ad.view":"event13,event10","a.media.ad.complete":"event11","a.media.ad.milestones":{}}};s.Media.monitor=function(s,media){if(media.event==="OPEN")s.Media.track(media.name);if(media.event==="MILESTONE")s.Media.track(media.name);if(media.event==="CLOSE")s.Media.track(media.name)}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/videoplayer_amp/s.Media.config.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/videoplayer_amp/videoplayer_amp.value.js. */
twc.shared.apps.value("videoPlayerSettings",{common:{nonsecure_config:"/sites/all/modules/custom/angularmods/app/shared/videoplayer_amp/videoamp_config.xml",secure_config:"/sites/all/modules/custom/angularmods/app/shared/videoplayer_amp/videoampsecure_config.xml"},adPolicies:{"videopage-videoplayer":{showAds:true,firstAdPlaySlot:1,adsToMediaRatio:[2,3],playerCustParamsAdd:"wmode=transparent",adServerURL:"//pubads.g.doubleclick.net/gampad/ads?env=vp&gdfp_req=1&output=xml_vast2&unviewed_position_start=1"},"articlepage-videoplayer":{showAds:true,firstAdPlaySlot:1,adsToMediaRatio:[2,3],playerCustParamsAdd:"wmode=transparent",adServerURL:"//pubads.g.doubleclick.net/gampad/ads?env=vp&gdfp_req=1&output=xml_vast2&unviewed_position_start=1"},"social-videoplayer":{showAds:true,firstAdPlaySlot:1,adsToMediaRatio:[2,3],playerCustParamsAdd:"wmode=transparent",adServerURL:"//pubads.g.doubleclick.net/gampad/ads?env=vp&gdfp_req=1&output=xml_vast2&unviewed_position_start=1"},"ugc-videoplayer":{showAds:true,firstAdPlaySlot:1,adsToMediaRatio:[2,3],playerCustParamsAdd:"wmode=transparent",adServerURL:"//pubads.g.doubleclick.net/gampad/ads?env=vp&gdfp_req=1&output=xml_vast2&unviewed_position_start=1"},"noads-videoplayer":{showAds:false,firstAdPlaySlot:1,adsToMediaRatio:[2,3],playerCustParamsAdd:"wmode=transparent",adServerURL:"//pubads.g.doubleclick.net/gampad/ads?env=vp&gdfp_req=1&output=xml_vast2&unviewed_position_start=1"},"default":{showAds:true,firstAdPlaySlot:1,adsToMediaRatio:[2,3],playerCustParamsAdd:"wmode=transparent",adServerURL:"//pubads.g.doubleclick.net/gampad/ads?env=vp&gdfp_req=1&output=xml_vast2&unviewed_position_start=1"}},playerConfigOverridesList:{"videopage-videoplayer":{twcData:{playerMetricsPosition:"AMP 1.0 - Video Page"},autoplay:true,flash:{vars:{auto_play_override:true}}},"articlepage-videoplayer":{twcData:{playerMetricsPosition:"AMP 1.0 - News Page"},autoplay:true,flash:{vars:{auto_play_override:true}}},"social-videoplayer":{twcData:{playerMetricsPosition:"AMP 1.0 - Social Page"},autoplay:false,flash:{vars:{auto_play_override:false}}},"ugc-videoplayer":{twcData:{playerMetricsPosition:"AMP 1.0 - UGC Page"},autoplay:true,flash:{vars:{auto_play_override:true}}},"noads-videoplayer":{twcData:{playerMetricsPosition:"AMP 1.0 - No Ads"},autoplay:true,flash:{vars:{auto_play_override:true}}},"default":{twcData:{playerMetricsPosition:"AMP 1.0 - Video Player"},autoplay:true,flash:{vars:{auto_play_override:true}}}}});;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/videoplayer_amp/videoplayer_amp.value.js. */
/* Source and licensing information for the line(s) below can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/translations/twc_social_sharing.fr_fr.js. */
twc.shared.apps.config(['twcMessageProvider',function(twcMessageProvider){twcMessageProvider.add({fr_FR:{twcSocialSharing:{facebook:'Partager sur Facebook',twitter:'Tweet',googleplus:'Poster  Google+',reddit:'poster de Reddit',pinterest:'pingler',email:'Email',qq:'QIt',sina:'Sina'}}})}]);;
/* Source and licensing information for the above line(s) can be found at http://www.weather.com/sites/all/modules/custom/angularmods/app/shared/twc_social_sharing/translations/twc_social_sharing.fr_fr.js. */
