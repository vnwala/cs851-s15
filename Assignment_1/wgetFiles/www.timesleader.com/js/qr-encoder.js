/**
 * qr-encoder.js
 * encodes text to QR images (PNG/JPG/SVG)
 * 
 * by Patrick Wied
 */
(function(F){var J=F.document,N=function(){var K={canvas:function(d){var d=d||{},k=d.size||400,n=d.color||"#000",m=d.border||20,A=this.SHAPES,C=A[d.shape||"rectangles"],j=d.width,y=d.format,d=d.data,l=J.createElement("canvas"),z=l.getContext("2d"),r,x;l.width=l.height=k;z.lineWidth=1;r=(k-2*m)/j;x=Math.abs(r-(r>>0));r=Math.round(r-0.5);m=Math.round(m+j*x/2-0.5);z.fillStyle="#fff";z.fillRect(0,0,k,k);z.fillStyle=n;for(k=0;k<j;k++)for(n=0;n<j;n++)d[n*j+k]&&C.call(A,z,r*k+m,r*n+m,r);return l.toDataURL(y)}, svg:function(d){var d=d||{},k=d.size||400,n=d.color||"#000",m=d.border||20,A=this.SHAPES,C=A[d.shape||"rectangles"],j=d.width,d=d.data,y,l,z;y=""+('<svg width="'+k+'" height="'+k+'" fill="#fff" xmlns="http://www.w3.org/2000/svg" version="1.1">');k=(k-2*m)/j;l=Math.abs(k-(k>>0));k=Math.round(k-0.5);m=Math.round(m+j*l/2-0.5);for(l=0;l<j;l++)for(z=0;z<j;z++)d[z*j+l]&&(y+=C.call(A,k*l+m,k*z+m,k,n));return'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+ (y+"</svg>")}};K.canvas.SHAPES={roundedRectangles:function(d,k,n,m){d.beginPath();d.moveTo(k+5,n);d.lineTo(k+m-5,n);d.quadraticCurveTo(k+m,n,k+m,n+5);d.lineTo(k+m,n+m-5);d.quadraticCurveTo(k+m,n+m,k+m-5,n+m);d.lineTo(k+5,n+m);d.quadraticCurveTo(k,n+m,k,n+m-5);d.lineTo(k,n+5);d.quadraticCurveTo(k,n,k+5,n);d.closePath();d.fill()},rectangles:function(d,k,n,m){d.fillRect(k,n,m,m)},circles:function(d,k,n,m){d.beginPath();d.arc(k+m/2,n+m/2,m/2,0,2*Math.PI,!0);d.closePath();d.fill()}};K.svg.SHAPES={roundedRectangles:function(d, k,n,m){var A=n/4>>0;return'<rect x="'+d+'" y="'+k+'" rx="'+A+'" ry="'+A+'" width="'+n+'" height="'+n+'" fill="'+m+'" />'},rectangles:function(d,k,n,m){return'<rect x="'+d+'" y="'+k+'" width="'+n+'" height="'+n+'" fill="'+m+'" />'},circles:function(d,k,n,m){n=n/1.8>>0;return'<circle cx="'+(d+n)+'" cy="'+(k+n)+'" r="'+n+'" fill="'+m+'" />'}};var F={"image/png":"canvas","image/jpg":"canvas","image/svg":"svg"},E=function(){var d=[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24, 26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28],k=[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177],n=[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],m=[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0, 44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30, 11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4, 122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24, 46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],A=[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182, 163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117, 44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175],C=[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118, 236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],j,y,l,z,r,x,b,t= function(e,a){var b;e>a&&(b=e,e=a,a=b);z[(a*a+a>>1)+e]=1},s=function(e,a,D){l[e+b*a]=D},L=function(e,a){var b;s(e,a,1);for(b=-2;2>b;b++)s(e+b,a-2,1),s(e-2,a+b+1,1),s(e+2,a+b,1),s(e+b+1,a+2,1);for(b=0;2>b;b++)t(e-1,a+b),t(e-b,a-1),t(e+1,a-b),t(e+b,a+1)},G=function(e){for(;255<=e;)e-=255,e=(e>>8)+(e&255);return e},E=function(e,a,b,c){var i,d,k;for(i=0;i<c;i++)j[b+i]=0;for(i=0;i<a;i++){k=A[j[e+i]^j[b]];if(255==k)for(d=b;d<b+c;d++)j[d]=j[d+1];else for(d=1;d<c;d++)j[b+d-1]=j[b+d]^C[G(k+x[c-d])];j[b+c- 1]=255==k?0:C[G(k+x[0])]}},B=function(b,a){var d;b>a&&(d=b,b=a,a=d);return z[(a+a*a>>1)+b]},H=[function(){var e,a;for(a=0;a<b;a++)for(e=0;e<b;e++)!(e+a&1)&&!B(e,a)&&(l[e+a*b]^=1)},function(){var e,a;for(a=0;a<b;a++)for(e=0;e<b;e++)!(a&1)&&!B(e,a)&&(l[e+a*b]^=1)},function(){var e,a,d;for(a=0;a<b;a++)for(e=d=0;e<b;e++,d++)3==d&&(d=0),!d&&!B(e,a)&&(l[e+a*b]^=1)},function(){var e,a,d,c;for(a=c=0;a<b;a++,c++){3==c&&(c=0);d=c;for(e=0;e<b;e++,d++)3==d&&(d=0),!d&&!B(e,a)&&(l[e+a*b]^=1)}},function(){var e, a,d,c;for(a=0;a<b;a++){d=0;c=a>>1&1;for(e=0;e<b;e++,d++)3==d&&(d=0,c=!c),!c&&!B(e,a)&&(l[e+a*b]^=1)}},function(){var e,a,d,c;for(a=c=0;a<b;a++,c++){3==c&&(c=0);for(e=d=0;e<b;e++,d++)3==d&&(d=0),!((e&a&1)+!(!d|!c))&&!B(e,a)&&(l[e+a*b]^=1)}},function(){var e,a,d,c;for(a=c=0;a<b;a++,c++){3==c&&(c=0);for(e=d=0;e<b;e++,d++)3==d&&(d=0),!((e&a&1)+(d&&d==c)&1)&&!B(e,a)&&(l[e+a*b]^=1)}},function(){var e,a,d,c;for(a=c=0;a<b;a++,c++){3==c&&(c=0);for(e=d=0;e<b;e++,d++)3==d&&(d=0),!((d&&d==c)+(e+a&1)&1)&&!B(e, a)&&(l[e+a*b]^=1)}}],I=[3,3,40,10],M=function(b){var a,d=0;for(a=0;a<=b;a++)5<=r[a]&&(d+=I[0]+r[a]-5);for(a=3;a<b-1;a+=2)if(r[a-2]==r[a+2]&&r[a+2]==r[a-1]&&r[a-1]==r[a+1]&&3*r[a-1]==r[a]&&(0==r[a-3]||a+3>b||3*r[a-3]>=4*r[a]||3*r[a+3]>=4*r[a]))d+=I[2];return d},J={plain:"",email:"mailto:",telephone:"tel:",sms:"sms:",mms:"mms:",geolocation:"geo:",mecard:"MECARD:",bizcard:"BIZCARD"};return{encode:function(e){var e=e||{},a=e.format||"image/png",D,c=J[e.type||"plain"]+(e.text||"");D=e.ecclevel||4;j=[]; y=[];l=[];z=[];r=[];x=[];var i=0,v=c.length,u,o,q,w,f,h,p,g;do if(i++,h=4*(D-1)+16*(i-1),u=m[h++],o=m[h++],q=m[h++],w=m[h],h=q*(u+o)+o-3+(9>=i),v<=h)break;while(40>i);b=17+4*i;h=q+(q+w)*(u+o)+o;for(p=0;p<h;p++)y[p]=0;j=c.slice(0);for(p=b*b;p--;)l[p]=0;p=(b*(b+1)+1)/2;for(g=0;g<p;g++)z[g]=0;v=j.length;for(g=0;g<v;g++)y[g]=j.charCodeAt(g);j=y.slice(0);for(p=0;3>p;p++){h=c=0;1==p&&(h=b-7);2==p&&(c=b-7);s(c+3,h+3,1);for(f=0;6>f;f++)s(f+c,h,1),s(c,h+f+1,1),s(c+6,h+f,1),s(f+c+1,h+6,1);for(f=1;5>f;f++)t(f+ c,h+1),t(c+1,h+f+1),t(c+5,h+f),t(f+c+1,h+5);for(f=2;4>f;f++)s(f+c,h+2,1),s(c+2,h+f+1,1),s(c+4,h+f,1),s(f+c+1,h+4,1)}if(1<i){p=d[i];for(c=b-7;;){for(f=b-7;f>p-3;){L(f,c);if(f<p)break;f-=p}if(c<=p+9)break;c-=p;L(6,c);L(c,6)}}s(8,b-8,1);for(c=0;7>c;c++)t(7,c),t(b-8,c),t(7,c+b-7);for(f=0;8>f;f++)t(f,7),t(f+b-8,7),t(f,b-8);for(f=0;9>f;f++)t(f,8);for(f=0;8>f;f++)t(f+b-8,8),t(8,f);for(c=0;7>c;c++)t(8,c+b-7);for(f=0;f<b-14;f++)f&1?(t(8+f,6),t(6,8+f)):(s(8+f,6,1),s(6,8+f,1));if(6<i){p=k[i-7];h=17;for(f=0;6> f;f++)for(c=0;3>c;c++,h--)1&(11<h?i>>h-12:p>>h)?(s(5-f,2-c+b-11,1),s(2-c+b-11,5-f,1)):(t(5-f,2-c+b-11),t(2-c+b-11,5-f))}for(c=0;c<b;c++)for(f=0;f<=c;f++)l[f+b*c]&&t(f,c);f=q*(u+o)+o;v>=f-2&&(v=f-2,9<i&&v--);g=v;if(9<i){j[g+2]=0;for(j[g+3]=0;g--;)p=j[g],j[g+3]|=255&p<<4,j[g+2]=p>>4;j[2]|=255&v<<4;j[1]=v>>4;j[0]=64|v>>12}else{j[g+1]=0;for(j[g+2]=0;g--;)p=j[g],j[g+2]|=255&p<<4,j[g+1]=p>>4;j[1]|=255&v<<4;j[0]=64|v>>4}for(g=v+3-(10>i);g<f;)j[g++]=236,j[g++]=17;x[0]=1;for(g=0;g<w;g++){x[g+1]=1;for(i=g;0< i;i--)x[i]=x[i]?x[i-1]^C[G(A[x[i]]+g)]:x[i-1];x[0]=C[G(A[x[0]]+g)]}for(g=0;g<=w;g++)x[g]=A[x[g]];h=f;for(g=c=0;g<u;g++)E(c,q,h,w),c+=q,h+=w;for(g=0;g<o;g++)E(c,q+1,h,w),c+=q+1,h+=w;for(g=c=0;g<q;g++){for(i=0;i<u;i++)y[c++]=j[g+i*q];for(i=0;i<o;i++)y[c++]=j[u*q+g+i*(q+1)]}for(i=0;i<o;i++)y[c++]=j[u*q+g+i*(q+1)];for(g=0;g<w;g++)for(i=0;i<u+o;i++)y[c++]=j[f+g+i*w];j=y;f=c=b-1;h=v=1;u=(q+w)*(u+o)+o;for(g=0;g<u;g++){p=j[g];for(i=0;8>i;i++,p<<=1){128&p&&s(f,c,1);do v?f--:(f++,h?0!=c?c--:(f-=2,h=!h,6==f&& (f--,c=9)):c!=b-1?c++:(f-=2,h=!h,6==f&&(f--,c-=8))),v=!v;while(B(f,c))}}j=l.slice(0);p=0;c=3E4;for(h=0;8>h;h++){H[h].apply(H);o=f=i=w=q=o=void 0;for(q=g=u=v=0;q<b-1;q++)for(o=0;o<b-1;o++)if(l[o+b*q]&&l[o+1+b*q]&&l[o+b*(q+1)]&&l[o+1+b*(q+1)]||!l[o+b*q]&&!l[o+1+b*q]&&!l[o+b*(q+1)]&&!l[o+1+b*(q+1)])u+=I[1];for(q=0;q<b;q++){for(w=i=o=r[0]=0;o<b;o++)(f=l[o+b*q])==i?r[w]++:r[++w]=1,i=f,g+=i?1:-1;u+=M(w)}0>g&&(g=-g);for(o=g+(g<<2)<<1;o>b*b;)o-=b*b,v++;u+=v*I[3];for(o=0;o<b;o++){for(w=i=q=r[0]=0;q<b;q++)(f= l[o+b*q])==i?r[w]++:r[++w]=1,i=f;u+=M(w)}f=u;f<c&&(c=f,p=h);if(7==p)break;l=j.slice(0)}p!=h&&H[p].apply(H);c=n[p+(D-1<<3)];for(h=0;8>h;h++,c>>=1)c&1&&(s(b-1-h,8,1),6>h?s(8,h,1):s(8,h+1,1));for(h=0;7>h;h++,c>>=1)c&1&&(s(8,b-7+h,1),h?s(6-h,8,1):s(7,8,1));D=[b,l];a=K[F[a]];e.width=D[0];e.data=D[1];return a.call(a,e)}}}();return{encode:function(){return E.encode.apply(E,arguments)}}}();F.QR=N})(this);
